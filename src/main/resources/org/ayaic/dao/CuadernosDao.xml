<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.ayaic.dao.CuadernosDao">

    <update id="setRegistrarOdonMensual">
        select __snisodontologiaresumen(#{cod_esta},#{fecha_ini}, #{fecha_fin}) ;  
    </update> 
  
    <update id="setRegistrarOdonPersonal">
        select __snisodontologiapersona(#{id_persona},#{cod_esta},#{fecha_ini}, #{fecha_fin}) ;  
    </update> 
 
    <resultMap id="listaConfImp" type="Cuadernos">
        <result property="tipo_egreso"      column="tipo_egreso"/>
        <result property="exodoncia"        column="exodoncia"/>
        <result property="periodoncia"      column="periodoncia"/>
        <result property="cirugia"          column="cirugia"/>
        <result property="endodoncia"       column="endodoncia"/>
        <result property="rayosx"           column="rayosx"/>
        <result property="preventiva"       column="preventiva"/>
        <result property="primera"          column="primera"/>
        <result property="numpieza"         column="numpieza"/>
        <result property="suma1"            column="suma1"/>
        <result property="suma2"            column="suma2"/>
        <result property="suma3"            column="suma3"/>
        <result property="suma4"            column="suma4"/>
        <result property="suma5"            column="suma5"/>
        <result property="suma6"            column="suma6"/>
        <result property="suma7"            column="suma7"/>
        <result property="fuma"             column="fuma"/>
        <result property="alcohol"          column="alcohol"/>
        <result property="violencia"        column="violencia"/>
        <result property="auto"             column="auto"/>
        <result property="urinaria"         column="urinaria"/>
        <result property="sistemica"        column="sistemica"/>
        <result property="arterial"         column="arterial"/>
        <result property="diabetes"         column="diabetes"/>
        <result property="glome"            column="glome"/>
        <result property="tracto"           column="tracto"/>
        <result property="lupus"            column="lupus"/>
        <result property="litiasis"         column="litiasis"/>
        <result property="nooplasia"        column="nooplasia"/>
        <result property="nefro"            column="nefro"/>
        <result property="disli"            column="disli"/>
        <result property="frenal"           column="frenal"/>
        <result property="bajopeso"         column="bajopeso"/>
        <result property="prematuro"        column="prematuro"/>
        <result property="eritro"           column="eritro"/>
        <result property="renal"            column="renal"/>
        <result property="tuberculo"        column="tuberculo"/>
        <result property="otro"             column="otro"/>
        <result property="cardio"           column="cardio"/>
        <result property="reuma"            column="reuma"/>
        <result property="suma11"           column="suma11"/>
        <result property="suma12"           column="suma12"/>
        <result property="suma13"           column="suma13"/>
        <result property="suma14"           column="suma14"/>
        <result property="suma15"           column="suma15"/>
        <result property="suma16"           column="suma16"/>
    </resultMap>

    <select id="getConfigurarImpresion" resultMap="listaConfImp">
        SELECT id_tipo as tipo_egreso, sedes_x as  exodoncia, sedes_y as periodoncia, sedes_t as cirugia,
        red_x as endodoncia, red_y as rayosx, red_t as preventiva, 
        municipio_x as primera,municipio_y as numpieza, municipio_t as suma1, 
        servicio_x as suma2, servicio_y as suma3, servicio_t as suma4, 
        fecharep_x  as suma5, fecharep_y as suma6, fecharep_t as suma7, 
        num_registro_x as fuma, num_registro_y as alcohol, num_registro_t as violencia,
        num_hcl_x as auto, num_hcl_y as urinaria, num_hcl_t as sistemica, 
        nombre_x as arterial, nombre_y as diabetes, nombre_t as glome, 
        edad_x as tracto, edad_y as lupus, edad_t as litiasis, 
        sexo_x as nooplasia, sexo_y as nefro, sexo_t as disli, 
        establecimiento_x as frenal, establecimiento_y as bajopeso, establecimiento_t as prematuro, 
        tiposeg_x as eritro, tiposeg_y as renal, tiposeg_t as tuberculo, 
        medico_x as otro, medico_y as cardio, medico_t as reuma,
        titulo_x as suma11, titulo_y as suma12, titulo_t as suma13,
        otros4_x as suma14, otros4_y as suma15, otros4_t as suma16
        FROM conf_impresion WHERE id_tipo=#{id_laboratorio}; 
    </select>
  
    <resultMap id="listaConfImpGral" type="Cuadernos">
        <result property="tipo_egreso"      column="tipo_egreso"/>
        <result property="suma1"            column="suma1"/>
        <result property="suma2"            column="suma2"/>
        <result property="suma3"            column="suma3"/>
        <result property="suma4"            column="suma4"/>
        <result property="suma5"            column="suma5"/>
        <result property="suma6"            column="suma6"/>
        <result property="suma7"            column="suma7"/>
        <result property="suma8"            column="suma8"/>
        <result property="suma9"            column="suma9"/>
        <result property="suma10"            column="suma10"/>
        <result property="suma11"           column="suma11"/>
        <result property="suma12"           column="suma12"/>
        <result property="suma13"           column="suma13"/>
        <result property="suma14"           column="suma14"/>
        <result property="suma15"           column="suma15"/>
        <result property="suma16"           column="suma16"/>
        <result property="suma17"           column="suma17"/>
        <result property="suma18"           column="suma18"/>
        <result property="suma19"           column="suma19"/>
        <result property="suma20"           column="suma20"/>
        <result property="suma21"           column="suma21"/>
        <result property="suma22"           column="suma22"/>
        <result property="suma23"           column="suma23"/>
        <result property="suma24"           column="suma24"/>
        <result property="suma25"           column="suma25"/>
        <result property="suma26"           column="suma26"/>
        <result property="suma27"           column="suma27"/>
        <result property="suma28"           column="suma28"/>
        <result property="suma29"           column="suma29"/>
        <result property="suma30"           column="suma30"/>
        <result property="suma31"           column="suma31"/>
        <result property="suma32"           column="suma32"/>
        <result property="suma33"           column="suma33"/>
        <result property="suma34"           column="suma34"/>
        <result property="suma35"           column="suma35"/>
        <result property="suma36"           column="suma36"/>
        <result property="suma37"           column="suma37"/>
        <result property="suma38"           column="suma38"/>
        <result property="suma39"           column="suma39"/>
        <result property="suma40"           column="suma40"/>
        <result property="suma41"           column="suma41"/>
        <result property="suma42"           column="suma42"/>
    </resultMap>

    <select id="getConfigurarImpresionGral" resultMap="listaConfImpGral">
        SELECT id_tipo as tipo_egreso, glorojos_x as suma1, glorojos_y as suma2, glorojos_t as suma3,
        globlanco_x as suma4, globlanco_y  as suma5, globlanco_t as suma6,  
        plaqueta_x as suma7, plaqueta_y as suma8, plaqueta_t as suma9,
        homoglobina_x as suma10, homoglobina_y as suma11, homoglobina_t as suma12,
        hematocrito_x as suma13, hematocrito_y as suma14, hematocrito_t as suma15,
        vcm_x as suma16, vcm_y as suma17, vcm_t as suma18,
        hgm_x as suma19, hgm_y as suma20, hgm_t as suma21,
        chcm_x as suma22, chcm_y as suma23, chcm_t as suma24,
        bas_x as suma25, bas_y as suma26, bas_t as suma27,
        eos_x as suma28, eos_y as suma29, eos_t as suma30,
        mielo_x as suma31, mielo_y as suma32, mielo_t as suma33,
        juy_x as suma34, juy_y as suma35, juy_t as suma36,
        cay_x as suma37, cay_y as suma38, cay_t as suma39,
        seg_x as suma40, seg_y as suma41, seg_t as suma42
        FROM conf_impresion WHERE id_tipo=#{tipo_egreso}; 
    </select>
  
    <resultMap id="listaConfImpHcl" type="Cuadernos">
        <result property="tipo_egreso"      column="tipo_egreso"/>
        <result property="suma1"            column="suma1"/>
        <result property="suma2"            column="suma2"/>
        <result property="suma3"            column="suma3"/>
        <result property="suma4"            column="suma4"/>
        <result property="suma5"            column="suma5"/>
        <result property="suma6"            column="suma6"/>
        <result property="suma7"            column="suma7"/>
        <result property="suma8"            column="suma8"/>
        <result property="suma9"            column="suma9"/>
        <result property="suma10"           column="suma10"/>
        <result property="suma11"           column="suma11"/>
        <result property="suma12"           column="suma12"/>
        <result property="suma13"           column="suma13"/>
        <result property="suma14"           column="suma14"/>
        <result property="suma15"           column="suma15"/>
        <result property="suma16"           column="suma16"/>
        <result property="suma17"           column="suma17"/>
        <result property="suma18"           column="suma18"/>
        <result property="suma19"           column="suma19"/>
        <result property="suma20"           column="suma20"/>
        <result property="suma21"           column="suma21"/>
        <result property="suma22"           column="suma22"/>
        <result property="suma23"           column="suma23"/>
        <result property="suma24"           column="suma24"/>
        <result property="suma25"           column="suma25"/>
        <result property="suma26"           column="suma26"/>
        <result property="suma27"           column="suma27"/>
        <result property="suma28"           column="suma28"/>
        <result property="suma29"           column="suma29"/>
        <result property="suma30"           column="suma30"/>
        <result property="suma31"           column="suma31"/>
        <result property="suma32"           column="suma32"/>
        <result property="suma33"           column="suma33"/>
        <result property="suma34"           column="suma34"/>
        <result property="suma35"           column="suma35"/>
        <result property="suma36"           column="suma36"/>
        <result property="suma37"           column="suma37"/>
        <result property="suma38"           column="suma38"/>
        <result property="suma39"           column="suma39"/>
        <result property="suma40"           column="suma40"/>
        <result property="suma41"           column="suma41"/>
        <result property="suma42"           column="suma42"/>
        <result property="suma43"           column="suma43"/>
        <result property="suma44"           column="suma44"/>
        <result property="suma45"           column="suma45"/>
        <result property="suma46"           column="suma46"/>
        <result property="suma47"           column="suma47"/>
        <result property="suma48"           column="suma48"/>
        <result property="suma49"           column="suma49"/>
        <result property="suma50"           column="suma50"/>
        <result property="suma51"           column="suma51"/>
        <result property="suma52"           column="suma52"/>
        <result property="suma53"           column="suma53"/>
        <result property="speso"            column="speso"/>
        <result property="fuma"             column="fuma"/>
        <result property="alcohol"          column="alcohol"/>
        <result property="violencia"        column="violencia"/>
        <result property="auto"             column="auto"/>
        <result property="urinaria"         column="urinaria"/>
        <result property="sistemica"        column="sistemica"/>
        <result property="arterial"         column="arterial"/>
        <result property="diabetes"         column="diabetes"/>
        <result property="glome"            column="glome"/>
        <result property="tracto"           column="tracto"/>
        <result property="lupus"            column="lupus"/>
        <result property="litiasis"         column="litiasis"/>
        <result property="nooplasia"        column="nooplasia"/>
        <result property="nefro"            column="nefro"/>
        <result property="disli"            column="disli"/>
        <result property="frenal"           column="frenal"/>
        <result property="bajopeso"         column="bajopeso"/>
        <result property="prematuro"        column="prematuro"/>
    
    </resultMap>

    <select id="getConfigurarImpresionGralHcl" resultMap="listaConfImpHcl">
        SELECT id_tipo as tipo_egreso, glorojos_x as suma1, glorojos_y as suma2, glorojos_t as suma3,
        globlanco_x as suma4, globlanco_y  as suma5, globlanco_t as suma6,  
        plaqueta_x as suma7, plaqueta_y as suma8, plaqueta_t as suma9,
        homoglobina_x as suma10, homoglobina_y as suma11, homoglobina_t as suma12,
        hematocrito_x as suma13, hematocrito_y as suma14, hematocrito_t as suma15,
        vcm_x as suma16, vcm_y as suma17, vcm_t as suma18,
        hgm_x as suma19, hgm_y as suma20, hgm_t as suma21,
        chcm_x as suma22, chcm_y as suma23, chcm_t as suma24,
        bas_x as suma25, bas_y as suma26, bas_t as suma27,
        eos_x as suma28, eos_y as suma29, eos_t as suma30,
        mielo_x as suma31, mielo_y as suma32, mielo_t as suma33,
        juy_x as suma34, juy_y as suma35, juy_t as suma36,
        cay_x as suma37, cay_y as suma38, cay_t as suma39,
        seg_x as suma40, seg_y as suma41, seg_t as suma42,
        linf_x as suma43, linf_y as suma44, linf_t as suma45,
        mono_x as suma46, mono_y as suma47, mono_t as suma48,
        tiempocuag_x as suma49, tiempocuag_y as suma50, tiempocuag_t as suma51,
        tiemposang_x as suma52, tiemposang_y as suma53, tiemposang_t as speso,
        tiempoprot_x as fuma, tiempoprot_y as alcohol, tiempoprot_t as violencia,
        porcentaje_x as auto, porcentaje_y as urinaria, porcentaje_t as sistemica,
        gruposang_x as arterial, gruposang_y as diabetes, gruposang_t as glome,
        factor_x as tracto, factor_y as lupus, factor_t as litiasis,
        serieroja_x as nooplasia, serieroja_y as nefro, serieroja_t as disli,
        serieblanca_x as frenal, serieblanca_y as bajopeso, serieblanca_t as prematuro
        FROM conf_impresion WHERE id_tipo=#{tipo_egreso}; 
    </select>
  
    <resultMap id="ConfVigencia" type="Cuadernos">
        <result property="tipo_egreso"      column="tipo_egreso"/>
        <result property="suma1"            column="suma1"/>
        <result property="suma2"            column="suma2"/>
        <result property="suma3"            column="suma3"/>
        <result property="suma4"            column="suma4"/>
        <result property="suma5"            column="suma5"/>
        <result property="suma6"            column="suma6"/>
        <result property="suma7"            column="suma7"/>
        <result property="suma8"            column="suma8"/>
        <result property="suma9"            column="suma9"/>
        <result property="suma10"            column="suma10"/>
        <result property="suma11"           column="suma11"/>
        <result property="suma12"           column="suma12"/>
        <result property="suma13"           column="suma13"/>
        <result property="suma14"           column="suma14"/>
        <result property="suma15"           column="suma15"/>
        <result property="suma16"           column="suma16"/>
        <result property="suma17"           column="suma17"/>
        <result property="suma18"           column="suma18"/>
        <result property="suma19"           column="suma19"/>
        <result property="suma20"           column="suma20"/>
        <result property="suma21"           column="suma21"/>
        <result property="suma22"           column="suma22"/>
        <result property="suma23"           column="suma23"/>
        <result property="suma24"           column="suma24"/>
        <result property="suma25"           column="suma25"/>
        <result property="suma26"           column="suma26"/>
        <result property="suma27"           column="suma27"/>
        <result property="suma28"           column="suma28"/>
        <result property="suma29"           column="suma29"/>
        <result property="suma30"           column="suma30"/>
        <result property="suma31"           column="suma31"/>
        <result property="suma32"           column="suma32"/>
        <result property="suma33"           column="suma33"/>
        <result property="suma34"           column="suma34"/>
        <result property="suma35"           column="suma35"/>
        <result property="suma36"           column="suma36"/>
        <result property="suma37"           column="suma37"/>
        <result property="suma38"           column="suma38"/>
        <result property="suma39"           column="suma39"/>
        <result property="suma40"           column="suma40"/>
        <result property="suma41"           column="suma41"/>
        <result property="suma42"           column="suma42"/>
        <result property="suma43"           column="suma43"/>
        <result property="suma44"           column="suma44"/>
        <result property="suma45"           column="suma45"/>
        <result property="suma46"           column="suma46"/>
        <result property="suma47"           column="suma47"/>
        <result property="suma48"           column="suma48"/>
        <result property="suma49"           column="suma49"/>
        <result property="suma50"           column="suma50"/>
        <result property="suma51"           column="suma51"/>
        <result property="suma52"           column="suma52"/>
        <result property="suma53"           column="suma53"/>
        <result property="suma54"           column="suma54"/>
        <result property="suma55"           column="suma55"/>
        <result property="suma56"           column="suma56"/>
        <result property="suma57"           column="suma57"/>
        <result property="suma58"           column="suma58"/>
        <result property="suma59"           column="suma59"/>
        <result property="suma60"           column="suma60"/>
        <result property="suma61"           column="suma61"/>
        <result property="suma62"           column="suma62"/>
        <result property="suma63"           column="suma63"/>
        <result property="suma64"           column="suma64"/>
        <result property="suma65"           column="suma65"/>
        <result property="suma66"           column="suma66"/>
    </resultMap>
    
    <select id="getConfigurarImpresionRiesgo" resultMap="ConfVigencia">
        SELECT id_tipo as tipo_egreso, sedes_x as suma1, sedes_y as suma2, sedes_t as suma3,
        red_x as suma4, red_y  as suma5, red_t as suma6,
        municipio_x as suma7, municipio_y as suma8, municipio_t as suma9,
        servicio_x as suma10, servicio_y as suma11, servicio_t as suma12,
        fecharep_x as suma13, fecharep_y as suma14, fecharep_t as suma15,
        num_registro_x as suma16, num_registro_y as suma17, num_registro_t as suma18,
        num_hcl_x as suma19, num_hcl_y as suma20, num_hcl_t as suma21,
        nombre_x as suma22, nombre_y as suma23, nombre_t as suma24,
        edad_x as suma25, edad_y as suma26, edad_t as suma27,
        sexo_x as suma28, sexo_y as suma29, sexo_t as suma30,
        establecimiento_x as suma31, establecimiento_y as suma32, establecimiento_t as suma33,
        tiposeg_x as suma34, tiposeg_y as suma35, tiposeg_t as suma36,
        medico_x as suma37, medico_y as suma38, medico_t as suma39,
        titulo_x as suma40, titulo_y as suma41, titulo_t as suma42,
        glorojos_x as suma43, glorojos_y as suma44, glorojos_t as suma45,
        globlanco_x as suma46, globlanco_y as suma47, globlanco_t as suma48,
        plaqueta_x as suma49, plaqueta_y as suma50, plaqueta_t as suma51,
        homoglobina_x as suma52, homoglobina_y as suma53, homoglobina_t as suma54,
        hematocrito_x as suma55, hematocrito_y as suma56, hematocrito_t as suma57,
        vcm_x as suma58, vcm_y as suma59, vcm_t as suma60,
        hgm_x as suma61, hgm_y as suma62, hgm_t as suma63,
        chcm_x as suma64, chcm_y as suma65, chcm_t as suma66
        FROM conf_impresion WHERE id_tipo=#{bcg}; 
    </select>
    
    <resultMap id="listaConfImpPeri" type="Cuadernos">
        <result property="tipo_egreso"      column="tipo_egreso"/>
        <result property="suma1"            column="suma1"/>
        <result property="suma2"            column="suma2"/>
        <result property="suma3"            column="suma3"/>
        <result property="suma4"            column="suma4"/>
        <result property="suma5"            column="suma5"/>
        <result property="suma6"            column="suma6"/>
        <result property="suma7"            column="suma7"/>
        <result property="suma8"            column="suma8"/>
        <result property="suma9"            column="suma9"/>
        <result property="suma10"            column="suma10"/>
        <result property="suma11"           column="suma11"/>
        <result property="suma12"           column="suma12"/>
        <result property="suma13"           column="suma13"/>
        <result property="suma14"           column="suma14"/>
        <result property="suma15"           column="suma15"/>
        <result property="suma16"           column="suma16"/>
        <result property="suma17"           column="suma17"/>
        <result property="suma18"           column="suma18"/>
        <result property="suma19"           column="suma19"/>
        <result property="suma20"           column="suma20"/>
        <result property="suma21"           column="suma21"/>
        <result property="suma22"           column="suma22"/>
        <result property="suma23"           column="suma23"/>
        <result property="suma24"           column="suma24"/>
        <result property="suma25"           column="suma25"/>
        <result property="suma26"           column="suma26"/>
        <result property="suma27"           column="suma27"/>
        <result property="suma28"           column="suma28"/>
        <result property="suma29"           column="suma29"/>
        <result property="suma30"           column="suma30"/>
        <result property="suma31"           column="suma31"/>
        <result property="suma32"           column="suma32"/>
        <result property="suma33"           column="suma33"/>
    </resultMap>

    <select id="getConfigurarImpresionGralPerinatal" resultMap="listaConfImpPeri">
        SELECT id_tipo as tipo_egreso, glorojos_x as suma1, glorojos_y as suma2, glorojos_t as suma3,
        globlanco_x as suma4, globlanco_y  as suma5, globlanco_t as suma6,  
        plaqueta_x as suma7, plaqueta_y as suma8, plaqueta_t as suma9,
        homoglobina_x as suma10, homoglobina_y as suma11, homoglobina_t as suma12,
        hematocrito_x as suma13, hematocrito_y as suma14, hematocrito_t as suma15,
        vcm_x as suma16, vcm_y as suma17, vcm_t as suma18,
        hgm_x as suma19, hgm_y as suma20, hgm_t as suma21,
        chcm_x as suma22, chcm_y as suma23, chcm_t as suma24,
        bas_x as suma25, bas_y as suma26, bas_t as suma27,
        eos_x as suma28, eos_y as suma29, eos_t as suma30,
        mielo_x as suma31, mielo_y as suma32, mielo_t as suma33
        FROM conf_impresion WHERE id_tipo=#{tipo_egreso}; 
    </select>
  
    <select id="getConfigurarImpresionCarnetInf" resultMap="listaConfImpPeri">
        SELECT id_tipo as tipo_egreso, glorojos_x as suma1, glorojos_y as suma2, glorojos_t as suma3,
        globlanco_x as suma4, globlanco_y  as suma5, globlanco_t as suma6,  
        plaqueta_x as suma7, plaqueta_y as suma8, plaqueta_t as suma9,
        homoglobina_x as suma10, homoglobina_y as suma11, homoglobina_t as suma12,
        hematocrito_x as suma13, hematocrito_y as suma14, hematocrito_t as suma15,
        vcm_x as suma16, vcm_y as suma17, vcm_t as suma18,
        hgm_x as suma19, hgm_y as suma20, hgm_t as suma21,
        chcm_x as suma22, chcm_y as suma23, chcm_t as suma24,
        bas_x as suma25, bas_y as suma26, bas_t as suma27,
        eos_x as suma28, eos_y as suma29, eos_t as suma30,
        mielo_x as suma31, mielo_y as suma32, mielo_t as suma33
        FROM conf_impresion WHERE id_tipo=#{tipo_egreso}; 
    </select>
  
    <select id="getConfigurarImpresionGinecologica" resultMap="listaConfImpPeri">
        SELECT id_tipo as tipo_egreso, glorojos_x as suma1, glorojos_y as suma2, glorojos_t as suma3,
        globlanco_x as suma4, globlanco_y  as suma5, globlanco_t as suma6,  
        plaqueta_x as suma7, plaqueta_y as suma8, plaqueta_t as suma9,
        homoglobina_x as suma10, homoglobina_y as suma11, homoglobina_t as suma12,
        hematocrito_x as suma13, hematocrito_y as suma14, hematocrito_t as suma15,
        vcm_x as suma16, vcm_y as suma17, vcm_t as suma18,
        hgm_x as suma19, hgm_y as suma20, hgm_t as suma21,
        chcm_x as suma22, chcm_y as suma23, chcm_t as suma24,
        bas_x as suma25, bas_y as suma26, bas_t as suma27,
        eos_x as suma28, eos_y as suma29, eos_t as suma30,
        mielo_x as suma31, mielo_y as suma32, mielo_t as suma33
        FROM conf_impresion WHERE id_tipo=#{tipo_egreso}; 
    </select>
  
    <select id="getConfigurarImpresionFormulario" resultMap="listaConfImpPeri">
        SELECT id_tipo as tipo_egreso, glorojos_x as suma1, glorojos_y as suma2, glorojos_t as suma3,
        globlanco_x as suma4, globlanco_y  as suma5, globlanco_t as suma6,  
        plaqueta_x as suma7, plaqueta_y as suma8, plaqueta_t as suma9,
        homoglobina_x as suma10, homoglobina_y as suma11, homoglobina_t as suma12,
        hematocrito_x as suma13, hematocrito_y as suma14, hematocrito_t as suma15,
        vcm_x as suma16, vcm_y as suma17, vcm_t as suma18,
        hgm_x as suma19, hgm_y as suma20, hgm_t as suma21,
        chcm_x as suma22, chcm_y as suma23, chcm_t as suma24,
        bas_x as suma25, bas_y as suma26, bas_t as suma27,
        eos_x as suma28, eos_y as suma29, eos_t as suma30,
        mielo_x as suma31, mielo_y as suma32, mielo_t as suma33
        FROM conf_impresion WHERE id_tipo=#{tipo_egreso}; 
    </select>
  
    <select id="getConfigurarImpresionCarnet" resultMap="listaConfImpPeri">
        SELECT id_tipo as tipo_egreso, glorojos_x as suma1, glorojos_y as suma2, glorojos_t as suma3,
        globlanco_x as suma4, globlanco_y  as suma5, globlanco_t as suma6,  
        plaqueta_x as suma7, plaqueta_y as suma8, plaqueta_t as suma9,
        homoglobina_x as suma10, homoglobina_y as suma11, homoglobina_t as suma12,
        hematocrito_x as suma13, hematocrito_y as suma14, hematocrito_t as suma15,
        vcm_x as suma16, vcm_y as suma17, vcm_t as suma18,
        hgm_x as suma19, hgm_y as suma20, hgm_t as suma21,
        chcm_x as suma22, chcm_y as suma23, chcm_t as suma24,
        bas_x as suma25, bas_y as suma26, bas_t as suma27,
        eos_x as suma28, eos_y as suma29, eos_t as suma30,
        mielo_x as suma31, mielo_y as suma32, mielo_t as suma33
        FROM conf_impresion WHERE id_tipo=#{tipo_egreso}; 
    </select>
   
    <resultMap id="codcontrol" type="Cuadernos">
        <result property="suma1"       column="suma1"/>
        <result property="suma2"       column="suma2"/>
        <result property="num_auto"       column="num_auto"/>
        <result property="num_auto2"           column="num_auto2"/>
        <result property="aspecto"         column="aspecto"/>
        <result property="ds1"            column="ds1"/>
        
    </resultMap>
  
    <select id="getCodigoControl" resultMap="codcontrol">
        SELECT id_factura as suma1,cod_esta as suma2, nit_fact as num_auto,num_fact as num_auto2,date(fecha)::text as aspecto,importe as ds1 
        from facturas order by id_factura;
    </select>
    
    <resultMap id="listaImpEcos" type="Cuadernos">
        <result property="tipo_egreso"      column="tipo_egreso"/>
        <result property="exodoncia"        column="exodoncia"/>
        <result property="periodoncia"      column="periodoncia"/>
        <result property="cirugia"          column="cirugia"/>
        <result property="endodoncia"       column="endodoncia"/>
        <result property="rayosx"           column="rayosx"/>
        <result property="preventiva"       column="preventiva"/>
    </resultMap>
  
    <select id="getImpresionEcografia" resultMap="listaImpEcos">
        SELECT id_tipo as tipo_egreso, glorojos_x as  exodoncia,glorojos_y as periodoncia, glorojos_t as cirugia,
        globlanco_x as endodoncia, globlanco_y as rayosx, globlanco_t as preventiva
        FROM conf_impresion WHERE id_tipo=#{id_laboratorio};
    </select>
      
    <resultMap id="listaImpHemo" type="Cuadernos">
        <result property="tipo_egreso"      column="tipo_egreso"/>
        <result property="exodoncia"        column="exodoncia"/>
        <result property="periodoncia"      column="periodoncia"/>
        <result property="cirugia"          column="cirugia"/>
        <result property="endodoncia"       column="endodoncia"/>
        <result property="rayosx"           column="rayosx"/>
        <result property="preventiva"       column="preventiva"/>
        <result property="primera"          column="primera"/>
        <result property="numpieza"         column="numpieza"/>
        <result property="suma1"            column="suma1"/>
        <result property="suma2"            column="suma2"/>
        <result property="suma3"            column="suma3"/>
        <result property="suma4"            column="suma4"/>
        <result property="suma5"            column="suma5"/>
        <result property="suma6"            column="suma6"/>
        <result property="suma7"            column="suma7"/>
        <result property="fuma"             column="fuma"/>
        <result property="alcohol"          column="alcohol"/>
        <result property="violencia"        column="violencia"/>
        <result property="auto"             column="auto"/>
        <result property="urinaria"         column="urinaria"/>
        <result property="sistemica"        column="sistemica"/>
        <result property="arterial"         column="arterial"/>
        <result property="diabetes"         column="diabetes"/>
        <result property="glome"            column="glome"/>
        <result property="tracto"           column="tracto"/>
        <result property="lupus"            column="lupus"/>
        <result property="litiasis"         column="litiasis"/>
        <result property="nooplasia"        column="nooplasia"/>
        <result property="nefro"            column="nefro"/>
        <result property="disli"            column="disli"/>
        <result property="frenal"           column="frenal"/>
        <result property="bajopeso"         column="bajopeso"/>
        <result property="prematuro"        column="prematuro"/>
        <result property="eritro"           column="eritro"/>
        <result property="renal"            column="renal"/>
        <result property="tuberculo"        column="tuberculo"/>
        <result property="otro"             column="otro"/>
        <result property="cardio"           column="cardio"/>
        <result property="reuma"            column="reuma"/>
        <result property="cancer"           column="cancer"/>
        <result property="cancero"          column="cancero"/>
        <result property="depre"            column="depre"/>
        <result property="epilepsia"        column="epilepsia"/>
        <result property="psico"            column="psico"/>
        <result property="discapa"          column="discapa"/>
        <result property="orientacion"      column="orientacion"/>
        <result property="diu"              column="diu"/>
        <result property="inyectable"       column="inyectable"/>
        <result property="sueros"           column="sueros"/>
        <result property="curaciones"       column="curaciones"/>
        <result property="condon"           column="condon"/>
        <result property="pildora"          column="pildora"/>
        <result property="aqv"              column="aqv"/>
        <result property="mnatural"         column="mnatural"/>
        <result property="insumos"          column="insumos"/>
        <result property="pap"              column="pap"/>
        <result property="tabletas"         column="tabletas"/>
        <result property="sfembarazada"     column="sfembarazada"/>
        <result property="sfpuerpera"       column="sfpuerpera"/>
        <result property="vitamina"         column="vitamina"/>
        <result property="semanas"          column="semanas"/>
        <result property="parto"            column="parto"/>
        <result property="sexo"             column="sexo"/>
        <result property="imc"              column="imc"/>
        <result property="nembarazo"        column="nembarazo"/>
        <result property="eclam"            column="eclam"/>
        <result property="aborto"           column="aborto"/>
        <result property="hemo"             column="hemo"/>
        <result property="anestesia"        column="anestesia"/>
        <result property="controlpos"       column="controlpos"/>
        <result property="desesti"          column="desesti"/>
        <result property="seleccion"        column="seleccion"/>
        <result property="ingreso"          column="ingreso"/>
        <result property="anastecia"        column="anastecia"/>
        <result property="servicio"         column="servicio"/>
        <result property="egreso"           column="egreso"/>
        <result property="diasi"            column="diasi"/>
        <result property="diasc"            column="diasc"/>
        <result property="fallecido"        column="fallecido"/>
        <result property="fallecidom5"      column="fallecidom5"/>
        <result property="fallecidoy5"      column="fallecidoy5"/>
        <result property="suma8"            column="suma8"/>
        <result property="suma9"            column="suma9"/>
        <result property="suma10"           column="suma10"/> 
    </resultMap>
  
    <select id="getImpresionHemograma" resultMap="listaImpHemo">
        SELECT id_tipo as tipo_egreso, glorojos_x as  exodoncia, glorojos_y as periodoncia, glorojos_t as cirugia,
        globlanco_x as endodoncia, globlanco_y as rayosx, globlanco_t as preventiva, 
        plaqueta_x as primera,plaqueta_y as numpieza, plaqueta_t as suma1, 
        homoglobina_x as suma2, homoglobina_y as suma3, homoglobina_t as suma4, 
        hematocrito_x  as suma5, hematocrito_y as suma6, hematocrito_t as suma7, 
        vcm_x as fuma, vcm_y as alcohol, vcm_t as violencia,
        hgm_x as auto, hgm_y as urinaria, hgm_t as sistemica, 
        chcm_x as arterial, chcm_y as diabetes, chcm_t as glome, 
        bas_x as tracto, bas_y as lupus, bas_t as litiasis, 
        eos_x as nooplasia, eos_y as nefro, eos_t as disli, 
        mielo_x as frenal, mielo_y as bajopeso, mielo_t as prematuro, 
        juy_x as eritro, juy_y as renal, juy_t as tuberculo,
        cay_x as otro, cay_y as cardio, cay_t as reuma,
        seg_x as cancer, seg_y as cancero, seg_t as depre,
        linf_x as epilepsia, linf_y as psico, linf_t as discapa,
        mono_x as orientacion, mono_y as diu, mono_t as inyectable,
        tiempocuag_x as sueros, tiempocuag_y as curaciones, tiempocuag_t as condon,
        tiemposang_x as pildora, tiemposang_y as aqv, tiemposang_t as mnatural,
        tiempoprot_x as insumos, tiempoprot_y as pap, tiempoprot_t as tabletas,
        porcentaje_x as sfembarazada, porcentaje_y as sfpuerpera, porcentaje_t as vitamina,
        gruposang_x as semanas, gruposang_y as parto, gruposang_t as sexo,
        factor_x as imc, factor_y as nembarazo, factor_t as eclam,
        serieroja_x as aborto, serieroja_y as hemo, serieroja_t as anestesia,
        serieblanca_x as controlpos, serieblanca_y as desesti, serieblanca_t as seleccion,
        plaquetas_x as ingreso, plaquetas_y as anastecia, plaquetas_t as servicio,
        v_e_s_x as egreso, v_e_s_y as diasi, v_e_s_t as diasc,
        reticulo_x as fallecido, reticulo_y as fallecidom5, reticulo_t as fallecidoy5,
        otros_x as suma8, otros_y as suma9, otros_t as suma10
        FROM conf_impresion WHERE id_tipo=#{id_laboratorio};
    </select>
  
    <resultMap id="listaImpOrina" type="Cuadernos">
        <result property="tipo_egreso"      column="tipo_egreso"/>
        <result property="exodoncia"        column="exodoncia"/>
        <result property="periodoncia"      column="periodoncia"/>
        <result property="cirugia"          column="cirugia"/>
        <result property="endodoncia"       column="endodoncia"/>
        <result property="rayosx"           column="rayosx"/>
        <result property="preventiva"       column="preventiva"/>
        <result property="primera"          column="primera"/>
        <result property="numpieza"         column="numpieza"/>
        <result property="suma1"            column="suma1"/>
        <result property="suma2"            column="suma2"/>
        <result property="suma3"            column="suma3"/>
        <result property="suma4"            column="suma4"/>
        <result property="suma5"            column="suma5"/>
        <result property="suma6"            column="suma6"/>
        <result property="suma7"            column="suma7"/>
        <result property="suma8"            column="suma8"/>
        <result property="suma9"            column="suma9"/>
        <result property="suma10"           column="suma10"/>
        <result property="fuma"             column="fuma"/>
        <result property="alcohol"          column="alcohol"/>
        <result property="violencia"        column="violencia"/>
        <result property="auto"             column="auto"/>
        <result property="urinaria"         column="urinaria"/>
        <result property="sistemica"        column="sistemica"/>
        <result property="semanas"          column="semanas"/>
        <result property="parto"            column="parto"/>
        <result property="sexo"             column="sexo"/>
        <result property="imc"              column="imc"/>
        <result property="nembarazo"        column="nembarazo"/>
        <result property="eclam"            column="eclam"/>
        <result property="orientacion"      column="orientacion"/>
        <result property="diu"              column="diu"/>
        <result property="inyectable"       column="inyectable"/>
        <result property="nooplasia"        column="nooplasia"/>
        <result property="nefro"            column="nefro"/>
        <result property="disli"            column="disli"/>
        <result property="hemo"             column="hemo"/>
        <result property="anestesia"        column="anestesia"/>
        <result property="controlpos"       column="controlpos"/>
        <result property="sueros"           column="sueros"/>
        <result property="curaciones"       column="curaciones"/>
        <result property="condon"           column="condon"/>
        <result property="tracto"           column="tracto"/>
        <result property="lupus"            column="lupus"/>
        <result property="litiasis"         column="litiasis"/>
        <result property="otro"             column="otro"/>
        <result property="cardio"           column="cardio"/>
        <result property="reuma"            column="reuma"/>
        <result property="eritro"           column="eritro"/>
        <result property="renal"            column="renal"/>
        <result property="tuberculo"        column="tuberculo"/>
        <result property="ingreso"          column="ingreso"/>
        <result property="anastecia"        column="anastecia"/>
        <result property="servicio"         column="servicio"/>
        <result property="frenal"           column="frenal"/>
        <result property="bajopeso"         column="bajopeso"/>
        <result property="prematuro"        column="prematuro"/>
        <result property="epilepsia"        column="epilepsia"/>
        <result property="psico"            column="psico"/>
        <result property="discapa"          column="discapa"/>
        <result property="cancer"           column="cancer"/>
        <result property="cancero"          column="cancero"/>
        <result property="depre"            column="depre"/>
        <result property="pildora"          column="pildora"/>
        <result property="aqv"              column="aqv"/>
        <result property="mnatural"         column="mnatural"/>
        <result property="insumos"          column="insumos"/>
        <result property="pap"              column="pap"/>
        <result property="tabletas"         column="tabletas"/>
        <result property="sfembarazada"     column="sfembarazada"/>
        <result property="sfpuerpera"       column="sfpuerpera"/>
        <result property="vitamina"         column="vitamina"/>
        <result property="suma11"           column="suma11"/>
        <result property="suma12"           column="suma12"/>
        <result property="suma13"           column="suma13"/>
        <result property="suma14"           column="suma14"/>
        <result property="suma15"           column="suma15"/>
        <result property="suma16"           column="suma16"/>
        <result property="suma17"           column="suma17"/>
        <result property="suma18"           column="suma18"/>
        <result property="suma19"           column="suma19"/>
        <result property="suma20"           column="suma20"/>
        <result property="suma21"           column="suma21"/>
        <result property="suma22"           column="suma22"/>
        <result property="suma23"           column="suma23"/>
        <result property="suma24"           column="suma24"/>
        <result property="suma25"           column="suma25"/>
        <result property="suma26"           column="suma26"/>
        <result property="suma27"           column="suma27"/>
        <result property="suma28"           column="suma28"/>
        <result property="suma29"           column="suma29"/>
        <result property="suma30"           column="suma30"/>
        <result property="suma31"           column="suma31"/>
    </resultMap>
  
    <select id="getImpresionOrina" resultMap="listaImpOrina">
        SELECT id_tipo as tipo_egreso, volumen_x as  exodoncia, volumen_y as periodoncia, volumen_t as cirugia,
        color_x as endodoncia, color_y as rayosx, color_t as preventiva, 
        olor_x  as primera, olor_y as numpieza, olor_t as suma1, 
        aspecto_x as suma2,aspecto_y as suma3, aspecto_t as suma4, 
        reaccion_x as suma5, reaccion_y as suma6, reaccion_t as suma7, 
        densidad_x as suma8, densidad_y as suma9, densidad_t as suma10, 
        espuma_x as fuma, espuma_y as alcohol, espuma_t as violencia,
        deposito_x as auto, deposito_y as urinaria, deposito_t as sistemica, 
        nitritos_x as semanas, nitritos_y as parto, nitritos_t as sexo,
        glucosa_x as imc, glucosa_y as nembarazo, glucosa_t as eclam,
        hemoglo_x as orientacion, hemoglo_y as diu, hemoglo_t as inyectable,
        acetona_x as nooplasia, acetona_y as nefro, acetona_t as disli, 
        biliru_x as hemo, biliru_y as anestesia, biliru_t as controlpos,
        urobilina_x as sueros, urobilina_y as curaciones, urobilina_t as condon,
        albumina_x as tracto, albumina_y as lupus, albumina_t as litiasis, 
        pigbiliar_x as otro, pigbiliar_y as cardio, pigbiliar_t as reuma,
        salesbiliar_x as eritro, salesbiliar_y as renal, salesbiliar_t as tuberculo, 
        proteina_x as ingreso, proteina_y as anastecia, proteina_t as servicio,
        acidodiecet_x as frenal, acidodiecet_y as bajopeso, acidodiecet_t as prematuro, 
        epitelial_x as epilepsia, epitelial_y as psico, epitelial_t as discapa,
        leucocito_x as cancer, leucocito_y as cancero, leucocito_t as depre,
        hematies_x as pildora, hematies_y as aqv, hematies_t as mnatural,
        piocito_x as insumos, piocito_y as pap, piocito_t as tabletas,
        bacteria_x as sfembarazada, bacteria_y as sfpuerpera, bacteria_t as vitamina,
        cilindro_x as suma11, cilindro_y as suma12, cilindro_t as suma13,
        granulo_x as suma14, granulo_y as suma15, granulo_t as suma16,
        hialiano_x as suma17, hialiano_y as suma18, hialiano_t as suma19,
        leuco_x as suma20, leuco_y as suma21, leuco_t as suma22,
        cristal_x as suma23, cristal_y as suma24, cristal_t as suma25,
        otros1_x as suma26, otros1_y as suma27, otros1_t as suma28,
        otros2_x as suma29, otros2_y as suma30, otros2_t as suma31
        FROM conf_impresion WHERE id_tipo= #{id_laboratorio}; 
    </select>
  
    <resultMap id="listaImpQuimicas" type="Cuadernos">
        <result property="tipo_egreso"      column="tipo_egreso"/>
        <result property="exodoncia"        column="exodoncia"/>
        <result property="periodoncia"      column="periodoncia"/>
        <result property="cirugia"          column="cirugia"/>
        <result property="endodoncia"       column="endodoncia"/>
        <result property="rayosx"           column="rayosx"/>
        <result property="preventiva"       column="preventiva"/>
        <result property="suma1"            column="suma1"/>
        <result property="suma2"            column="suma2"/>
        <result property="suma3"            column="suma3"/>
        <result property="suma4"            column="suma4"/>
        <result property="suma5"            column="suma5"/>
        <result property="suma6"            column="suma6"/>
        <result property="suma7"            column="suma7"/>
        <result property="suma8"            column="suma8"/>
        <result property="suma9"            column="suma9"/>
        <result property="suma10"           column="suma10"/>
        <result property="suma11"           column="suma11"/>
        <result property="suma12"           column="suma12"/>
        <result property="suma13"           column="suma13"/>
        <result property="suma14"           column="suma14"/>
        <result property="suma15"           column="suma15"/>
        <result property="suma16"           column="suma16"/>
        <result property="suma17"           column="suma17"/>
        <result property="suma18"           column="suma18"/>
        <result property="suma19"           column="suma19"/>
        <result property="suma20"           column="suma20"/>
        <result property="suma21"           column="suma21"/>
        <result property="suma22"           column="suma22"/>
        <result property="suma23"           column="suma23"/>
        <result property="suma24"           column="suma24"/>
        <result property="suma25"           column="suma25"/>
        <result property="suma26"           column="suma26"/>
        <result property="suma27"           column="suma27"/>
        <result property="suma28"           column="suma28"/>
        <result property="suma29"           column="suma29"/>
        <result property="suma30"           column="suma30"/>
        <result property="primera"          column="primera"/>
        <result property="numpieza"         column="numpieza"/>
        <result property="fuma"             column="fuma"/>
        <result property="alcohol"          column="alcohol"/>
        <result property="violencia"        column="violencia"/>
        <result property="auto"             column="auto"/>
        <result property="urinaria"         column="urinaria"/>
        <result property="sistemica"        column="sistemica"/>
        <result property="semanas"          column="semanas"/>
        <result property="parto"            column="parto"/>
        <result property="sexo"             column="sexo"/>
        <result property="imc"              column="imc"/>
        <result property="nembarazo"        column="nembarazo"/>
        <result property="eclam"            column="eclam"/>
        <result property="orientacion"      column="orientacion"/>
        <result property="diu"              column="diu"/>
        <result property="inyectable"       column="inyectable"/>
        <result property="nooplasia"        column="nooplasia"/>
        <result property="nefro"            column="nefro"/>
        <result property="disli"            column="disli"/>
        <result property="hemo"             column="hemo"/>
        <result property="anestesia"        column="anestesia"/>
        <result property="controlpos"       column="controlpos"/>
        <result property="sueros"           column="sueros"/>
        <result property="curaciones"       column="curaciones"/>
        <result property="condon"           column="condon"/>
        <result property="tracto"           column="tracto"/>
        <result property="lupus"            column="lupus"/>
        <result property="litiasis"         column="litiasis"/>
        <result property="otro"             column="otro"/>
        <result property="cardio"           column="cardio"/>
        <result property="reuma"            column="reuma"/>
        <result property="eritro"           column="eritro"/>
        <result property="renal"            column="renal"/>
        <result property="tuberculo"        column="tuberculo"/>
        <result property="ingreso"          column="ingreso"/>
        <result property="anastecia"        column="anastecia"/>
        <result property="servicio"         column="servicio"/>
        <result property="frenal"           column="frenal"/>
        <result property="bajopeso"         column="bajopeso"/>
        <result property="prematuro"        column="prematuro"/>
        <result property="epilepsia"        column="epilepsia"/>
        <result property="psico"            column="psico"/>
        <result property="discapa"          column="discapa"/>
        <result property="cancer"           column="cancer"/>
        <result property="cancero"          column="cancero"/>
        <result property="depre"            column="depre"/>
        <result property="pildora"          column="pildora"/>
        <result property="aqv"              column="aqv"/>
        <result property="mnatural"         column="mnatural"/>
        <result property="insumos"          column="insumos"/>
        <result property="pap"              column="pap"/>
        <result property="tabletas"         column="tabletas"/>
        <result property="sfembarazada"     column="sfembarazada"/>
        <result property="sfpuerpera"       column="sfpuerpera"/>
        <result property="vitamina"         column="vitamina"/>
        <result property="suma31"           column="suma31"/>
        <result property="suma32"           column="suma32"/>
        <result property="suma33"           column="suma33"/>
        <result property="suma34"           column="suma34"/>
        <result property="suma35"           column="suma35"/>
        <result property="suma36"           column="suma36"/>
        <result property="suma37"           column="suma37"/>
        <result property="suma38"           column="suma38"/>
        <result property="suma39"           column="suma39"/>
        <result property="suma40"           column="suma40"/>
        <result property="suma41"           column="suma41"/>
        <result property="suma42"           column="suma42"/>
        <result property="suma43"           column="suma43"/>
    </resultMap>
  
    <select id="getImpresionQuimicas" resultMap="listaImpQuimicas">
        SELECT id_tipo as tipo_egreso, glorojos_x as  exodoncia, glorojos_y as periodoncia, glorojos_t as cirugia,
        globlanco_x as endodoncia, globlanco_y as rayosx, globlanco_t as preventiva,
        plaqueta_x as suma1, plaqueta_y as suma2, plaqueta_t as suma3,
        homoglobina_x as suma4, homoglobina_y as suma5, homoglobina_t as suma6,
        hematocrito_x as suma7, hematocrito_y as suma8, hematocrito_t as suma9,
        vcm_x as suma10, vcm_y as suma11, vcm_t as suma12,
        hgm_x as suma13, hgm_y as suma14, hgm_t as suma15,
        chcm_x as suma16, chcm_y as suma17, chcm_t as suma18,
        bas_x as suma19, bas_y as suma20, bas_t as suma21,
        eos_x as suma22, eos_y as suma23, eos_t as suma24,
        mielo_x as suma25, mielo_y as suma26, mielo_t as suma27,
        juy_x as suma28, juy_y as suma29, juy_t as suma30,
        cay_x as primera, cay_y as numpieza, cay_t as fuma,
        seg_x as alcohol, seg_y as violencia, seg_t as auto,
        linf_x as urinaria, linf_y as sistemica, linf_t as semanas,
        mono_x as parto, mono_y as sexo, mono_t as imc,
        tiempocuag_x as nembarazo, tiempocuag_y as eclam, tiempocuag_t as orientacion,
        tiempoprot_x as diu, tiempoprot_y as inyectable, tiempoprot_t as nooplasia,
        factor_x as nefro, factor_y as disli, factor_t as hemo,                         <!-- LDL -->
        serieroja_x as anestesia, serieroja_y as controlpos, serieroja_t as sueros,     <!-- HDL -->
        serieblanca_x as curaciones, serieblanca_y as condon, serieblanca_t as tracto,  <!-- VLD -->
        plaquetas_x as lupus, plaquetas_y as litiasis, plaquetas_t as otro,             <!-- Triglicoridos -->
        v_e_s_x as cardio, v_e_s_y as reuma, v_e_s_t as eritro,                         <!-- Sodio -->
        reticulo_x as renal, reticulo_y as tuberculo, reticulo_t as ingreso,            <!-- Potasio -->
        otros_x as anastecia, otros_y as servicio, otros_t as frenal,                   <!-- Cloro -->
        volumen_x as bajopeso, volumen_y as prematuro, volumen_t as epilepsia,          <!-- Magnesio -->
        color_x as psico, color_y as discapa, color_t as cancer,                        <!-- CK -->
        olor_x as cancero, olor_y as depre, olor_t as pildora,                          <!-- GGT -->
        aspecto_x as aqv, aspecto_y as mnatural, aspecto_t as insumos,                  <!-- Lipasa -->
        reaccion_x as pap, reaccion_y as tabletas, reaccion_t as sfembarazada,          <!-- Nus -->
        densidad_x as sfpuerpera, densidad_y as vitamina, densidad_t as suma31,         <!-- Hb Glicosilada -->
        espuma_x as suma32, espuma_y as suma33, espuma_t as suma34,                     <!-- Proteinuria 24 -->
        deposito_x as suma35, deposito_y as suma36, deposito_t as suma37,             <!-- Creatinuria 24 -->
        nitritos_x as suma38, nitritos_y as suma39, nitritos_t as suma40,               <!-- DCE -->
        glucosa_x as suma41, glucosa_y as suma42, glucosa_t as suma43                <!-- LDH -->
        FROM conf_impresion WHERE id_tipo= #{id_laboratorio}; 
    </select>
  
    <resultMap id="listaImpSerologia" type="Cuadernos">
        <result property="tipo_egreso"      column="tipo_egreso"/>
        <result property="exodoncia"        column="exodoncia"/>
        <result property="periodoncia"      column="periodoncia"/>
        <result property="cirugia"          column="cirugia"/>
        <result property="endodoncia"       column="endodoncia"/>
        <result property="rayosx"           column="rayosx"/>
        <result property="preventiva"       column="preventiva"/>
        <result property="suma1"            column="suma1"/>
        <result property="suma2"            column="suma2"/>
        <result property="suma3"            column="suma3"/>
        <result property="suma4"            column="suma4"/>
        <result property="suma5"            column="suma5"/>
        <result property="suma6"            column="suma6"/>
        <result property="suma7"            column="suma7"/>
        <result property="suma8"            column="suma8"/>
        <result property="suma9"            column="suma9"/>
        <result property="suma10"           column="suma10"/>
        <result property="suma11"           column="suma11"/>
        <result property="suma12"           column="suma12"/>
        <result property="suma13"           column="suma13"/>
        <result property="suma14"           column="suma14"/>
        <result property="suma15"           column="suma15"/>
        <result property="suma16"           column="suma16"/>
        <result property="suma17"           column="suma17"/>
        <result property="suma18"           column="suma18"/>
        <result property="suma19"           column="suma19"/>
        <result property="suma20"           column="suma20"/>
        <result property="suma21"           column="suma21"/>
        <result property="suma22"           column="suma22"/>
        <result property="suma23"           column="suma23"/>
        <result property="suma24"           column="suma24"/>
        <result property="suma25"           column="suma25"/>
        <result property="suma26"           column="suma26"/>
        <result property="suma27"           column="suma27"/>
        <result property="suma28"           column="suma28"/>
        <result property="suma29"           column="suma29"/>
        <result property="suma30"           column="suma30"/>
        <result property="suma31"           column="suma31"/>
        <result property="suma32"           column="suma32"/>
        <result property="suma33"           column="suma33"/>
        <result property="suma34"           column="suma34"/>
        <result property="suma35"           column="suma35"/>
        <result property="suma36"           column="suma36"/>
        <result property="suma37"           column="suma37"/>
        <result property="suma38"           column="suma38"/>
        <result property="suma39"           column="suma39"/>
        <result property="suma40"           column="suma40"/>
        <result property="suma41"           column="suma41"/>
        <result property="suma42"           column="suma42"/>
        <result property="primera"          column="primera"/>
        <result property="numpieza"         column="numpieza"/>
        <result property="fuma"             column="fuma"/>
        <result property="alcohol"          column="alcohol"/>
        <result property="violencia"        column="violencia"/>
        <result property="auto"             column="auto"/>
        <result property="urinaria"         column="urinaria"/>
        <result property="sistemica"        column="sistemica"/>
        <result property="semanas"          column="semanas"/>
        <result property="parto"            column="parto"/>
        <result property="sexo"             column="sexo"/>
        <result property="imc"              column="imc"/>   
    </resultMap>
  
    <select id="getImpresionSerologia" resultMap="listaImpSerologia">
        SELECT id_tipo as tipo_egreso, glorojos_x as  exodoncia, glorojos_y as periodoncia, glorojos_t as cirugia,  <!-- Proteina C reactiva -->
        globlanco_x as endodoncia, globlanco_y as rayosx, globlanco_t as preventiva,     <!-- Factor Reumatoide -->
        plaqueta_x as suma1, plaqueta_y as suma2, plaqueta_t as suma3,                   <!-- ASTO --> 
        homoglobina_x as suma4, homoglobina_y as suma5, homoglobina_t as suma6,          <!-- WIDAL -->
        hematocrito_x as suma7, hematocrito_y as suma8, hematocrito_t as suma9,          <!-- RPR-VDRL -->
        vcm_x as suma10, vcm_y as suma11, vcm_t as suma12,                               <!-- VIH -->
        hgm_x as suma13, hgm_y as suma14, hgm_t as suma15,                               <!-- HEPA A -->
        chcm_x as suma16, chcm_y as suma17, chcm_t as suma18,                            <!-- HEPA B -->                   
        bas_x as suma19, bas_y as suma20, bas_t as suma21,                               <!-- HEPA C -->
        eos_x as suma22, eos_y as suma23, eos_t as suma24,                               <!-- PSA -->
        mielo_x as suma25, mielo_y as suma26, mielo_t as suma27,                         <!-- H PILORY -->
        juy_x as suma28, juy_y as suma29, juy_t as suma30,                               <!-- HGC -->
        cay_x as suma31, cay_y as suma32, cay_t as suma33,                               <!-- TROPONINA --> 
        seg_x as suma34, seg_y as suma35, seg_t as suma36,                               <!-- ELISA CHAGAS --> 
        linf_x as suma37, linf_y as suma38, linf_t as suma39,                            <!-- ELISA TOXO -->
        mono_x as suma40, mono_y as suma41, mono_t as suma42,                            <!-- T3 -->
        tiempocuag_x as primera, tiempocuag_y as numpieza, tiempocuag_t as fuma,         <!-- T4 -->
        tiempoprot_x as alcohol, tiempoprot_y as violencia, tiempoprot_t as auto,        <!-- TSH -->
        factor_x as urinaria, factor_y as sistemica, factor_t as semanas,                <!-- T4 Libre -->
        serieroja_x as parto, serieroja_y as sexo, serieroja_t as imc                    <!-- Elisa Cistecirco -->
        FROM conf_impresion WHERE id_tipo= #{id_laboratorio}; 
    </select>
  
    <resultMap id="listaImpOtros" type="Cuadernos">
        <result property="tipo_egreso"      column="tipo_egreso"/>
        <result property="exodoncia"        column="exodoncia"/>
        <result property="periodoncia"      column="periodoncia"/>
        <result property="cirugia"          column="cirugia"/>
        <result property="endodoncia"       column="endodoncia"/>
        <result property="rayosx"           column="rayosx"/>
        <result property="preventiva"       column="preventiva"/>
    </resultMap>
  
    <select id="getImpresionOtros" resultMap="listaImpOtros">
        SELECT id_tipo as tipo_egreso, otros1_x as  exodoncia, otros1_y as periodoncia, otros1_t as cirugia,
        otros2_x as endodoncia, otros2_y as rayosx, otros2_t as preventiva
        FROM conf_impresion WHERE id_tipo= #{id_laboratorio}; 
    </select>
  
    <resultMap id="lista302_5"   type="Cuadernos">
        <result property="suma1"            column="suma1"/>
        <result property="suma2"            column="suma2"/>
        <result property="suma3"            column="suma3"/>
        <result property="suma4"            column="suma4"/>
        <result property="suma5"            column="suma5"/>
        <result property="suma6"            column="suma6"/>
        <result property="suma7"            column="suma7"/>
        <result property="suma8"            column="suma8"/>
        <result property="suma9"            column="suma9"/>
        <result property="suma10"           column="suma10"/>
        <result property="suma11"           column="suma11"/>
        <result property="suma12"           column="suma12"/>
        <result property="suma13"           column="suma13"/>
        <result property="suma14"           column="suma14"/>
        <result property="suma15"           column="suma15"/>
        <result property="suma16"           column="suma16"/>
        <result property="suma17"           column="suma17"/>
        <result property="suma18"           column="suma18"/>
        <result property="suma19"           column="suma19"/>
        <result property="suma20"           column="suma20"/>
        <result property="suma21"           column="suma21"/>
        <result property="suma22"           column="suma22"/>
        <result property="suma23"           column="suma23"/>
        <result property="suma24"           column="suma24"/>
        <result property="suma25"           column="suma25"/>
        <result property="suma26"           column="suma26"/>
        <result property="suma27"           column="suma27"/>
        <result property="suma28"           column="suma28"/>
        <result property="suma29"           column="suma29"/>
        <result property="suma30"           column="suma30"/>
        <result property="suma31"           column="suma31"/>
        <result property="suma32"           column="suma32"/>
        <result property="suma33"           column="suma33"/>
        <result property="suma34"           column="suma34"/>
        <result property="suma35"           column="suma35"/>
        <result property="suma36"           column="suma36"/>
    </resultMap>
  
    <select id="getDatos302_5" resultMap="lista302_5">
        SELECT sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and dglobal='O') THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and dglobal='O') THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=1 and dglobal='O') THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=1 and dglobal='O') THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (id_tipo_sexo=1 and (edad between 2 and 4) and dglobal='O') THEN 1 ELSE 0 END) as suma6,
        sum(CASE WHEN (id_tipo_sexo=2 and (edad between 2 and 4) and dglobal='O') THEN 1 ELSE 0 END) as suma5,
       
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and dglobal='S') THEN 1 ELSE 0 END) as suma8,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and dglobal='S') THEN 1 ELSE 0 END) as suma7,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=1 and dglobal='S') THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=1 and dglobal='S') THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (id_tipo_sexo=1 and (edad between 2 and 4) and dglobal='S') THEN 1 ELSE 0 END) as suma12,
        sum(CASE WHEN (id_tipo_sexo=2 and (edad between 2 and 4) and dglobal='S') THEN 1 ELSE 0 END) as suma11,
       
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and dglobal='N') THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and dglobal='N') THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=1 and dglobal='N') THEN 1 ELSE 0 END) as suma16,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=1 and dglobal='N') THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (id_tipo_sexo=1 and (edad between 2 and 4) and dglobal='N') THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (id_tipo_sexo=2 and (edad between 2 and 4) and dglobal='N') THEN 1 ELSE 0 END) as suma17,
       
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and dglobal='L') THEN 1 ELSE 0 END) as suma20,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and dglobal='L') THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=1 and dglobal='L') THEN 1 ELSE 0 END) as suma22,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=1 and dglobal='L') THEN 1 ELSE 0 END) as suma21,
        sum(CASE WHEN (id_tipo_sexo=1 and (edad between 2 and 4) and dglobal='L') THEN 1 ELSE 0 END) as suma24,
        sum(CASE WHEN (id_tipo_sexo=2 and (edad between 2 and 4) and dglobal='L') THEN 1 ELSE 0 END) as suma23,

        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and dglobal='M') THEN 1 ELSE 0 END) as suma26,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and dglobal='M') THEN 1 ELSE 0 END) as suma25,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=1 and dglobal='M') THEN 1 ELSE 0 END) as suma28,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=1 and dglobal='M') THEN 1 ELSE 0 END) as suma27,
        sum(CASE WHEN (id_tipo_sexo=1 and (edad between 2 and 4) and dglobal='M') THEN 1 ELSE 0 END) as suma30,
        sum(CASE WHEN (id_tipo_sexo=2 and (edad between 2 and 4) and dglobal='M') THEN 1 ELSE 0 END) as suma29,

        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and dglobal='G') THEN 1 ELSE 0 END) as suma32,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and dglobal='G') THEN 1 ELSE 0 END) as suma31,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=1 and dglobal='G') THEN 1 ELSE 0 END) as suma34,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=1 and dglobal='G') THEN 1 ELSE 0 END) as suma33,
        sum(CASE WHEN (id_tipo_sexo=1 and (edad between 2 and 4) and dglobal='G') THEN 1 ELSE 0 END) as suma36,
        sum(CASE WHEN (id_tipo_sexo=2 and (edad between 2 and 4) and dglobal='G') THEN 1 ELSE 0 END) as suma35
        from historiales join cuaderno4 on (historiales.id_historial=cuaderno4.id_historial)
        join pacientes on (historiales.id_paciente=pacientes.id_paciente)
        where seleccion=0 and tipo=1 and historiales.cod_esta=#{cod_esta} and 
              (fecha BETWEEN #{fecha_ini}  and #{fecha_fin} ) ; 
    </select>
  
    <resultMap id="lista302imc"   type="Cuadernos">
        <result property="suma1"            column="suma1"/>
        <result property="suma2"            column="suma2"/>
        <result property="suma3"            column="suma3"/>
        <result property="suma4"            column="suma4"/>
        <result property="suma5"            column="suma5"/>
        <result property="suma6"            column="suma6"/>
        <result property="suma7"            column="suma7"/>
        <result property="suma8"            column="suma8"/>
    </resultMap>
  
    <select id="getDatos302imc" resultMap="lista302imc">
        select  sum(CASE WHEN imc=1 THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN imc=2 THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN imc=3 THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN imc=4 THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN aborto=1 THEN 1 ELSE 0 END) as suma5,
        sum(CASE WHEN aborto=2 THEN 1 ELSE 0 END) as suma6,
        sum(CASE WHEN ((suma1=1 or suma2=1 or suma3=1 or suma4=1) and edad between 1 and 19) THEN 1 ELSE 0 END) as suma7,
        sum(CASE WHEN eclam=1 THEN 1 ELSE 0 END) as suma8
        from cuaderno2 join historiales on (historiales.id_historial=cuaderno2.id_historial)
        where historiales.peso>0 and talla>0 and (suma1=1 or suma2=1) and historiales.cod_esta=#{cod_esta} 
              and (fecha BETWEEN #{fecha_ini}  and #{fecha_fin} ) ;  
    </select>
  
    <resultMap id="listaImpCuadernos" type="Cuadernos">
        <result property="id_cuaderno"      column="id_cuaderno"/>
        <result property="aspecto"          column="aspecto"/>
        <result property="bacterias"        column="bacterias"/>
        <result property="suma1"            column="suma1"/>
        <result property="suma2"            column="suma2"/>
        <result property="bilirrubina"      column="bilirrubina"/>
        <result property="cantidad"         column="cantidad"/>
        <result property="cetonas"          column="cetonas"/>
        <result property="cilindros"        column="cilindros"/>
        <result property="color"            column="color"/>
        <result property="contraref"        column="contraref"/>
        <result property="cristales"        column="cristales"/>
        <result property="dcronica"         column="dcronica"/>
        <result property="densidad"         column="densidad"/>
        <result property="dglobal"          column="dglobal"/>
        <result property="dhierro"          column="dhierro"/>
        <result property="suma3"            column="suma3"/>
    </resultMap>
  
    <select id="getCuadernosImpresion" resultMap="listaImpCuadernos">
        <!--
        SELECT id_cuaderno, variable as aspecto, formato as bacterias, posicion as suma1, ancho as suma2,titulo as bilirrubina,
        subtitulo1 as cantidad,subtitulo2 as cetonas,subtitulo3 as cilindros,subtitulo4 as color,var1 as contraref,
        var2 as cristales,var3 as dcronica,var4 as densidad,var5 as dglobal,var6 as dhierro,id_persona as suma3
        FROM cuadernosvar order by posicion
        -->
    </select>
  
    <resultMap id="listaImpEmba" type="Cuadernos">
        <result property="tipo_egreso"      column="tipo_egreso"/>
        <result property="exodoncia"        column="exodoncia"/>
        <result property="periodoncia"      column="periodoncia"/>
        <result property="cirugia"          column="cirugia"/>
        <result property="endodoncia"       column="endodoncia"/>
        <result property="rayosx"           column="rayosx"/>
        <result property="preventiva"       column="preventiva"/>
        <result property="suma1"            column="suma1"/>
        <result property="suma2"            column="suma2"/>
        <result property="suma3"            column="suma3"/>
    </resultMap>
  
    <select id="getImpresionEmbarazo" resultMap="listaImpEmba">
        SELECT id_tipo as tipo_egreso, otros1_x as  exodoncia, otros1_y as periodoncia, otros1_t as cirugia,
        otros2_x as endodoncia, otros2_y as rayosx, otros2_t as preventiva, 
        otros3_x as suma1, otros3_y as suma2, otros3_t as suma3 
        FROM conf_impresion WHERE id_tipo= #{id_laboratorio}; 
    </select>
 
    <resultMap id="listaSnis301" type="Cuadernos">
        <result property="mes"           column="mes"/>
        <result property="gestion"       column="gestion"/>
    </resultMap>

    <select id="getListarSnis301" resultMap="listaSnis301">
        select gestion,mes from __snisc1
        where gestion = extract (year from now())
        group by mes,gestion order by gestion,mes 
    </select>
  
    <select id="getListarFaltaSnis301" resultMap="listaSnis301">
        select extract (month from fecha) as mes,extract (year from fecha) as gestion 
        from cuaderno1 join historiales using(id_historial)
        where extract (year from fecha) = extract (year from now())
        and not extract (month from fecha)+extract (year from fecha) in ( select gestion+mes from __snisc1 where gestion = extract (year from now()) )
        group by extract (month from fecha) ,extract (year from fecha) 
        order by gestion,mes 
    </select>

    <select id="getListarOdonMensual" resultMap="listaSnis301">
        select gestion,mes from __snisc7Odon
        where gestion = extract (year from now())
        group by mes,gestion order by gestion,mes 
    </select>
  
    <select id="getListarFaltaOdonMensual" resultMap="listaSnis301">
        select extract (month from fecha) as mes,extract (year from fecha) as gestion 
        from cuaderno7 join historiales using(id_historial)
        where extract (year from fecha) = extract (year from now())
        and not extract (month from fecha)+extract (year from fecha) in ( select gestion+mes from __snisc7Odon where gestion = extract (year from now()) )
        group by extract (month from fecha) ,extract (year from fecha) 
        order by gestion,mes  
    </select>
  
    <resultMap id="datostallapeso" type="Cuadernos">
        <result property="m3ds"               column="m3ds"/>
        <result property="m2ds"               column="m2ds"/>
        <result property="m1ds"               column="m1ds"/>
        <result property="ds0"                column="ds0"/>
        <result property="ds1"                column="ds1"/>
        <result property="ds2"                column="ds2"/>
        <result property="ds3"                column="ds3"/>
    </resultMap>
   
    <select id="getDatosPesoEdadF02" resultMap="datostallapeso">  
        select x3sd as m3ds,x2sd as m2ds,x1sd as m1ds,median as ds0, sd1 as ds1,sd2 as ds2,sd3 as ds3 
        from peg013 where edad=#{mes} 
    </select> 
    <select id="getDatosPesoEdadM02" resultMap="datostallapeso">  
        select x3sd as m3ds,x2sd as m2ds,x1sd as m1ds,median as ds0, sd1 as ds1,sd2 as ds2,sd3 as ds3 
        from peb013 where edad=#{mes} 
    </select> 
   
    <select id="getDatosTallaPesoF02" resultMap="datostallapeso">  
        select x3sd as m3ds,x2sd as m2ds,x1sd as m1ds,median as ds0, sd1 as ds1,sd2 as ds2,sd3 as ds3 
        from ptg02 where cm=#{talla} 
    </select> 
    <select id="getDatosTallaPesoF25" resultMap="datostallapeso">  
        select x3sd as m3ds,x2sd as m2ds,x1sd as m1ds,median as ds0, sd1 as ds1,sd2 as ds2,sd3 as ds3 
        from ptg25 where cm=#{talla} 
    </select>
    <select id="getDatosTallaPesoM02" resultMap="datostallapeso">  
        select x3sd as m3ds,x2sd as m2ds,x1sd as m1ds,median as ds0, sd1 as ds1,sd2 as ds2,sd3 as ds3 
        from ptb02 where cm=#{talla} 
    </select> 
    <select id="getDatosTallaPesoM25" resultMap="datostallapeso">  
        select x3sd as m3ds,x2sd as m2ds,x1sd as m1ds,median as ds0, sd1 as ds1,sd2 as ds2,sd3 as ds3 
        from ptb25 where cm=#{talla} 
    </select> 
   
    <select id="getDatosTallaEdadF02" resultMap="datostallapeso">  
        select x3sd as m3ds,x2sd as m2ds,x1sd as m1ds,median as ds0, sd1 as ds1,sd2 as ds2,sd3 as ds3 
        from teg02 where edad=#{mes} 
    </select> 
    <select id="getDatosTallaEdadF25" resultMap="datostallapeso">  
        select x3sd as m3ds,x2sd as m2ds,x1sd as m1ds,median as ds0, sd1 as ds1,sd2 as ds2,sd3 as ds3 
        from teg25 where edad=#{mes} 
    </select> 
    <select id="getDatosTallaEdadM02" resultMap="datostallapeso">  
        select x3sd as m3ds,x2sd as m2ds,x1sd as m1ds,median as ds0, sd1 as ds1,sd2 as ds2,sd3 as ds3 
        from teb02 where edad=#{mes} 
    </select> 
    <select id="getDatosTallaEdadM25" resultMap="datostallapeso">  
        select x3sd as m3ds,x2sd as m2ds,x1sd as m1ds,median as ds0, sd1 as ds1,sd2 as ds2,sd3 as ds3 
        from teb25 where edad=#{mes} 
    </select> 
   
    <resultMap id="datoshistoreservaeco" type="Cuadernos">    
        <result property="id_historial"         column="id_historial"/>       
    </resultMap>    
  
    <select id="getHistorialPacientesEco" resultMap="datoshistoreservaeco">
        select id_historial
        from laboratorio 
        join historiales using(id_historial)
        where id_costo=16 and laboratorio.id_estado='A' and historiales.id_paciente=#{id_paciente} 
    </select>    
  
    <resultMap id="datoslabreservaeco" type="Cuadernos">
        <result property="fechap"               column="fechap"/>    
        <result property="id_paciente"         column="id_paciente"/>
        <result property="id_cuaderno"         column="id_cuaderno"/>    
        <result property="nombres"                 column="nombres"/>
        <result property="expedido"                 column="expedido"/>
    </resultMap>
  
    <select id="getListarPacientesEco" resultMap="datoslabreservaeco">
        SELECT fechap,historiales.id_paciente,id_cuaderno,nombres,expedido
        FROM laboratorio
        join historiales using(id_historial)
        join pacientes using(id_paciente)
        where laboratorio.id_estado='X' and laboratorio.id_costo=16
        group by fechap,id_paciente,id_cuaderno,nombres,expedido
        order by fechap
    </select>
    
    <resultMap id="datoslabEndo" type="Cuadernos">
        <result property="id_carpeta"           column="id_carpeta"/>  
        <result property="id_cuaderno"          column="id_cuaderno"/>  
        <result property="id_historial"         column="id_historial"/>  
        <result property="resultado"            column="resultado"/>
        <result property="fechae"               column="fechae"/>   
        <result property="id_pedido"            column="id_pedido"/> 
    </resultMap>  
  
    <select id="getDetalleFotosEndo" resultMap="datoslabEndo">    
        SELECT id_detalle as id_carpeta,id_cuaderno,id_historial,fecha_reg as fechae,foto_dir as resultado,id_pedido 
        FROM detalle_lab_especial 
        where id_cuaderno=#{id_cuaderno}  and id_historial=#{id_historial}  and id_laboratorio=14
        order by id_detalle   
    </select>
  
    <resultMap id="datoslab" type="Cuadernos">
        <result property="fechap"               column="fechap"/>   
        <result property="id_historial"         column="id_historial"/>  
        <result property="laboratorio"          column="laboratorio"/>
        <result property="tipoconsulta"         column="tipoconsulta"/>
        <result property="resultado"            column="resultado"/>
        <result property="fechae"               column="fechae"/>   
        <result property="id_cuaderno"          column="id_cuaderno"/>  
        <result property="id_persona"           column="id_persona"/>  
        <result property="id_pedido"            column="id_pedido"/>  
        <result property="id_costo"            column="id_costo"/>  
    </resultMap>  
  
    <select id="getPacienteResultadoLab" resultMap="datoslab">    
        SELECT fechap,laboratorio,tipoconsulta,resultado, fechae, id_historial,id_cuaderno,l.id_persona,id_pedido,id_costo
        FROM laboratorio l
        join historiales using(id_historial)
        where octet_length(resultado)>0 and id_costo!=136 and l.id_estado='B' and id_paciente=#{id_persona} 
        order by fechap desc
    </select>
  
    <select id="getPacienteResultadoLabLab" resultMap="datoslab">    
        select fechap,laboratorio,tipoconsulta,resultado, fechae, id_historial,id_cuaderno,id_persona,id_pedido,id_costo
        from laboratorio where (id_costo!=136 and id_costo!=138) and octet_length(resultado)>1 and id_estado='B' and id_historial in
        (select id_historial from historiales where  id_paciente=#{id_persona}) 
        and id_cuaderno not in (select max(id_cuaderno) as id_cuaderno
        from laboratorio where (id_costo!=136 and id_costo!=138) and octet_length(resultado)>1 and id_estado='B' and id_historial in
        (select id_historial from historiales where  id_paciente=#{id_persona}) )
        order by fechap desc     
    </select>
  
    <select id="getPacienteResultadoLabEco" resultMap="datoslab">    
        select fechap,laboratorio,tipoconsulta,resultado, fechae, id_historial,id_cuaderno,id_persona,id_pedido,id_costo
        from laboratorio where id_costo=136 and octet_length(resultado)>1 and id_estado='B' and id_historial in
        (select id_historial from historiales where  id_paciente=#{id_persona}) 
        and id_cuaderno in (select max(id_cuaderno) as id_cuaderno
        from laboratorio where id_costo=136  and octet_length(resultado)>1 and id_estado='B' and id_historial in
        (select id_historial from historiales where  id_paciente=#{id_persona}) )
        order by fechap desc   
    </select>
  
    <select id="getPacienteResultadoLabX" resultMap="datoslab">    
        select fechap,laboratorio,tipoconsulta,resultado, fechae, id_historial,id_cuaderno,id_persona,id_pedido,id_costo
        from laboratorio where id_costo=138 and octet_length(resultado)>1 and id_estado='B' and id_historial in
        (select id_historial from historiales where  id_paciente=#{id_paciente}) 
        and id_cuaderno not in (select max(id_cuaderno) as id_cuaderno
        from laboratorio where id_costo=138  and octet_length(resultado)>1 and id_estado='B' and id_historial in
        (select id_historial from historiales where  id_paciente=#{id_paciente}) )
        order by fechap desc   
    </select>
    
    <select id="getPacienteResultadoLabEndo" resultMap="datoslab">    
        select fechap,laboratorio,tipoconsulta,resultado, fechae, id_historial,id_cuaderno,id_persona,id_pedido,id_costo
        from laboratorio where id_costo=142 and octet_length(resultado)>1 and id_estado='B' and id_historial in
        (select id_historial from historiales where  id_paciente=#{id_paciente}) 
        and id_cuaderno in (select max(id_cuaderno) as id_cuaderno
        from laboratorio where id_costo=142  and octet_length(resultado)>1 and id_estado='B' and id_historial in
        (select id_historial from historiales where  id_paciente=#{id_paciente}) )
        order by fechap desc   
    </select>
  
    <resultMap id="datoslabrealizados" type="Cuadernos">
        <result property="id_costo"            column="id_costo"/>
        <result property="expedido"            column="expedido"/>
        <result property="nombres"             column="nombres"/>
        <result property="id_paciente"         column="id_paciente"/>
        <result property="numpieza"            column="numpieza"/>
        <result property="tabletas"            column="tabletas"/>
    </resultMap>
  
    <select id="getLabRealizadoTotal" resultMap="datoslabrealizados">
        select l.id_costo, 'O' as expedido, laboratorio as nombres, costo_unit::integer  as numpieza,count(*)::integer as id_paciente,tipo as tabletas 
        from laboratorio l
        join historiales using(id_historial)
        join costos c using(id_costo)
        where (fechae::date BETWEEN #{fecha_ini} and #{fecha_fin}) and c.cod_esta=#{cod_esta} and 
        (l.id_estado='B' or l.id_estado='C') and (id_seguro between #{id_seguro} and #{id_cuaderno}) 
        group by l.id_costo,laboratorio, costo_unit,tipo order by laboratorio
    </select>
    
    <select id="getLabRealizadoSumi" resultMap="datoslabrealizados">
        select 1 as id_costo,s.prestacion as expedido,descripcion as nombres,0 as numpieza,count(*) as id_paciente,0 as tabletas 
        from recetass r
        join prestacion p using(id_prestacion)
        join prestaciones s using(id_prestacion)
        where (fecha BETWEEN #{fecha_ini} and #{fecha_fin} ) and (r.prestacion like 'PL%' or r.prestacion like 'IG%')
        group by s.prestacion,descripcion order by descripcion
    </select>
  
    <resultMap id="datoslabSspam" type="Cuadernos">
        <result property="id_pedido"           column="id_pedido"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="fecha"               column="fecha"/>
        <result property="nombre"              column="nombre"/>
        <result property="fechae"              column="fechae"/>
        <result property="numpieza"            column="numpieza"/>
        <result property="numpieza"            column="numpieza"/>
    </resultMap>
  
    <select id="getLabSSPAM" resultMap="datoslabSspam">
        SELECT id_pedido,id_persona,id_historial,fechap as fecha, laboratorio as nombre, 
        fechae, costo_unit::int as numpieza FROM laboratorio l
        inner join costos on l.costo=id_costo
        where l.id_estado='B' and costos.cod_esta=#{cod_esta} and id_historial in 
        (SELECT id_historial FROM pedidoslab where (fechae::date BETWEEN #{fecha_ini} and #{fecha_fin}) ) 
    </select>
    
    <resultMap id="ListarLabos" type="Cuadernos">
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="id_costo"            column="id_costo"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="id_laboratorio"      column="id_laboratorio"/>
        <result property="laboratorio"         column="laboratorio"/>
        <result property="resultado"              column="resultado"/>
    </resultMap>
  
    <select id="getLabPacPasados" resultMap="ListarLabos">
        SELECT id_cuaderno,id_historial,laboratorio,resultado,id_costo,id_laboratorio
        FROM laboratorio l
        where l.cod_esta=#{cod_esta} and id_historial= 
        (select max(id_historial) from historiales join laboratorio using(id_historial) 
        where id_historial!=#{id_historial} and id_paciente=#{id_paciente} and historiales.cod_esta=#{cod_esta}) 
        order by id_cuaderno
    </select>
    
    <resultMap id="datoslabpacrealizar" type="Cuadernos">
        <result property="id_pedido"           column="id_pedido"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="id_paciente"         column="id_paciente"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="fecha"               column="fecha"/>
        <result property="nombres"             column="nombres"/>
        <result property="expedido"            column="expedido"/>
        <result property="nombre"              column="nombre"/>
        <result property="fechae"              column="fechae"/>
        <result property="numpieza"            column="numpieza"/>
        <result property="primera"             column="primera"/>
        <result property="endodoncia"          column="endodoncia"/>
        <result property="aspecto"             column="aspecto"/>
        <result property="id_riesgo"           column="id_riesgo"/>
        <result property="cod_esta"            column="cod_esta"/>
        <result property="suma1"               column="suma1"/>
    </resultMap>
  
    <select id="getLabPacPendientePago" resultMap="datoslabpacrealizar">
        SELECT id_pedido,x.id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,l.nombres as nombre, 
        fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,id_riesgo,h.cod_esta,0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)     
        WHERE(internado=0 or internado=1) and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and l.id_estado='G' and fechap::date>current_date-30 and 
        id_pedido in (select id_pedido from laboratorio where cod_esta=#{cod_esta} and id_estado='G' group by id_pedido)   
        ORDER BY fechap,id_pedido,h.id_paciente,h.id_historial
    </select>
  
    <select id="getLabPacPendiente" resultMap="datoslabpacrealizar">
        SELECT id_pedido,x.id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,l.nombres as nombre, 
        fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,id_riesgo,h.cod_esta,
        (SELECT count(*) AS Expr1 from public.laboratorio WHERE id_laboratorio != 12 and id_laboratorio != 13 and
        id_historial = h.id_historial ) AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)   
        WHERE (internado=0 or internado=1) and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and l.id_estado!='P' and fechap::date>current_date-2 and  
        id_pedido in (select id_pedido from laboratorio where cod_esta=#{cod_esta} and (id_laboratorio between #{id_cargo} and #{id_laboratorio} ) and
        (id_estado='A' and id_laboratorio != 12 and id_laboratorio != 13) group by id_pedido)   
        ORDER BY fechap desc,id_pedido,h.id_paciente,h.id_historial
    </select>
    
    <select id="getLabPacPendienteEco" resultMap="datoslabpacrealizar">
        SELECT id_pedido,x.id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,l.nombres as nombre, 
        fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,id_riesgo,h.cod_esta,0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)   <!--cambio 16-05-2015-->
        WHERE (internado=0 or internado=1) and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and l.id_estado!='P' and fechap::date>current_date-3 and  
        id_pedido in (select id_pedido from laboratorio where cod_esta=#{cod_esta} and (id_laboratorio between #{id_cargo} and #{id_laboratorio} )  and
        (id_estado='A' and id_laboratorio = 12) group by id_pedido)   
        ORDER BY fechap desc,id_pedido,h.id_paciente,h.id_historial
    </select>
    
    <select id="getLabPacPendienteRx" resultMap="datoslabpacrealizar">
        SELECT id_pedido,x.id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,l.nombres as nombre, 
        fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,id_riesgo,h.cod_esta,0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)   <!--cambio 16-05-2015-->
        WHERE (internado=0 or internado=1) and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and l.id_estado!='P' and fechap::date>current_date-2 and  
        id_pedido in (select id_pedido from laboratorio where cod_esta=#{cod_esta} and (id_laboratorio between #{id_cargo} and #{id_laboratorio} )  and
        (id_estado='A' and id_laboratorio = 13) group by id_pedido)   
        ORDER BY fechap desc,id_pedido,h.id_paciente,h.id_historial
    </select>
  
    <select id="getLabPendienteAmbFecha" resultMap="datoslabpacrealizar">
        SELECT id_pedido,x.id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,l.nombres as nombre, 
        fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,id_riesgo,h.cod_esta,
        (SELECT count(*) AS Expr1 from public.laboratorio WHERE id_laboratorio != 12 and id_laboratorio != 13 and
        id_historial = h.id_historial ) AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)  
        WHERE (internado=0 or internado=1) and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and fecha::date between #{fecha_ini} and #{fecha_fin} and 
        id_pedido in (select id_pedido from laboratorio where cod_esta=#{cod_esta} and id_estado='A' and 
        (id_laboratorio between #{id_cargo} and #{id_laboratorio} and fechap::date between #{fecha_ini} and #{fecha_fin}) group by id_pedido)   
        ORDER BY fechap desc,id_pedido,h.id_paciente,h.id_historial
    </select>
    
    <select id="getLabPendienteAmb" resultMap="datoslabpacrealizar">
        SELECT id_pedido,x.id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,l.nombres as nombre, 
        fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,id_riesgo,h.cod_esta,
        (SELECT count(*) AS Expr1 from public.laboratorio WHERE id_laboratorio != 12 and id_laboratorio != 13 and
        id_historial = h.id_historial ) AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)  
        WHERE (internado=0 or internado=1) and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and UPPER(p.nombres||p.hcl||l.numero||nro_registro) like UPPER(#{nombres} )  
        and id_pedido in (select id_pedido from laboratorio where cod_esta=#{cod_esta} and id_estado='A' and id_costo != 136 
        and id_costo != 138 group by id_pedido)   
        ORDER BY fechap desc,id_pedido,h.id_paciente,h.id_historial
        <!--aareglado 19-05-2015 para Obrero no daba busquedas nombre-->
    </select>
  
    <select id="getLabPacPendienteInter" resultMap="datoslabpacrealizar">
        SELECT id_pedido,x.id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,l.nombres as nombre, 
        fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,id_riesgo,h.cod_esta,
        (SELECT count(*) AS Expr1 from public.laboratorio WHERE id_laboratorio != 12 and id_laboratorio != 13 and
        id_historial = h.id_historial ) AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)     
        WHERE internado>1 and fechap::date>current_date-2 and l.cod_esta=#{cod_esta} and urgencia=#{seleccion} and id_pedido in 
        (select id_pedido from laboratorio where cod_esta=#{cod_esta} and (id_laboratorio between #{id_cargo} and #{id_laboratorio}) 
        and id_historia!=0 and (id_estado='A') group by id_pedido) 
        ORDER BY fechap desc,id_pedido,h.id_paciente,h.id_historial  
        <!--aareglado 07-10-2015 para Obrero no daba busquedas nombre-->
    </select>
    
    <select id="getLabPendienteInterFecha" resultMap="datoslabpacrealizar">
        SELECT id_pedido,x.id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,l.nombres as nombre, 
        fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,id_riesgo,h.cod_esta,
        (SELECT count(*) AS Expr1 from public.laboratorio WHERE id_laboratorio != 12 and id_laboratorio != 13 and
        id_historial = h.id_historial ) AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)  
        WHERE internado>1  and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and fechap::date between #{fecha_ini} and #{fecha_fin} and id_pedido in 
        (select id_pedido from laboratorio where cod_esta=#{cod_esta} and id_estado='A' and id_laboratorio != 12 and id_laboratorio != 13 group by id_pedido)   
        ORDER BY fechap desc,id_pedido,h.id_paciente,h.id_historial
    </select>
    
    <select id="getLabPendienteInter" resultMap="datoslabpacrealizar">
        SELECT id_pedido,x.id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,l.nombres as nombre, 
        fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,id_riesgo,h.cod_esta,0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)  
        WHERE internado>1  and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and p.texto_vector @@ to_tsquery('spanish',#{nombres})  and  
        id_pedido in (select id_pedido from laboratorio where cod_esta=#{cod_esta} and id_estado='A' and id_laboratorio != 12 and id_laboratorio != 13 group by id_pedido)   
        ORDER BY fechap desc,id_pedido,h.id_paciente,h.id_historial
        <!--UPPER(p.nombres||p.hcl||l.numero||nro_registro) like UPPER(#{nombres})  -->
    </select>
    
    <select id="getLabPendienteInterNum" resultMap="datoslabpacrealizar">
        SELECT id_pedido,x.id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,l.nombres as nombre, 
        fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,id_riesgo,h.cod_esta,0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)  
        WHERE internado>1  and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and l.numero=#{numpieza} and id_pedido in 
        (select id_pedido from laboratorio where cod_esta=#{cod_esta} and id_estado='A' and id_laboratorio != 12 and id_laboratorio != 13 group by id_pedido)   
        ORDER BY fechap desc,id_pedido,h.id_paciente,h.id_historial
    </select>
    
    <select id="getLabPendienteInterHcl" resultMap="datoslabpacrealizar">
        SELECT id_pedido,x.id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,l.nombres as nombre, 
        fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,id_riesgo,h.cod_esta,0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)  
        WHERE internado>1  and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and p.hcl=#{numpieza} and id_pedido in 
        (select id_pedido from laboratorio where cod_esta=#{cod_esta} and id_estado='A' and id_laboratorio != 12 and id_laboratorio != 13 group by id_pedido)   
        ORDER BY fechap desc,id_pedido,h.id_paciente,h.id_historial
    </select>
    
    <select id="getLabPacPendienteEcoInter" resultMap="datoslabpacrealizar">
        SELECT id_pedido,x.id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,l.nombres as nombre, 
        fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,id_riesgo,h.cod_esta,0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)     
        WHERE internado>1  and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and fechap::date>current_date-35 and id_pedido in 
        (select id_pedido from laboratorio where cod_esta=#{cod_esta} and (id_laboratorio between #{id_cargo} and #{id_laboratorio} )
        and id_historia!=0 and (id_estado='A') group by id_pedido) 
        ORDER BY fechap desc,id_pedido,h.id_paciente,h.id_historial  
    </select>
  
    <select id="getLabPacPendienteRxInter" resultMap="datoslabpacrealizar">
        SELECT id_pedido,x.id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,l.nombres as nombre, 
        fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,id_riesgo,h.cod_esta,0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)     
        WHERE internado>1  and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and fechap::date>current_date-35 and id_pedido in 
        (select id_pedido from laboratorio where cod_esta=#{cod_esta} and (id_laboratorio between #{id_cargo} and #{id_laboratorio} )
        and id_historia!=0 and (id_estado='A') group by id_pedido) 
        ORDER BY fechap desc,id_pedido,h.id_paciente,h.id_historial
    </select>
  
    <select id="getLabRealizadoAmb" resultMap="datoslabpacrealizar">
        SELECT id_pedido,id_dispensa as id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,
        l.nombres as nombre,fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,
        id_riesgo,h.cod_esta,0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)     
        where (internado=0 or internado=1) and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and id_pedido in 
        (select id_pedido from laboratorio where cod_esta=#{cod_esta} and (id_estado='B' or id_estado='C') and laboratorio.id_persona=#{id_persona} 
        and date(fechae) >current_date-2 group by id_pedido)   
        order by fechae desc,id_pedido,h.id_paciente,h.id_historial
    </select>
  
    <select id="getLabRealizadoAmbFecha" resultMap="datoslabpacrealizar">
        SELECT id_pedido,id_dispensa as id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,
        l.nombres as nombre, fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,
        id_riesgo,h.cod_esta,0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)     
        where (internado=0 or internado=1) and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and id_pedido in 
        (select id_pedido from laboratorio where cod_esta=#{cod_esta} and (id_estado='B' or id_estado='C') 
        and (fechae::date BETWEEN #{fecha_ini} and #{fecha_fin})  group by id_pedido)   
        order by fechae desc,id_pedido,h.id_paciente,h.id_historial        
        <!--        and l.id_persona in 
      (select id_persona from personas where cod_esta=#{cod_esta} and id_consultorio in 
      (select id_consultorio from personas where id_persona=#{id_persona} and cod_esta=#{cod_esta}  )
        order by fechae,id_pedido,h.id_paciente,h.id_historial   -->
    </select>
  
    <select id="getLabRealizadoAmbNombre" resultMap="datoslabpacrealizar">
        SELECT id_pedido,id_dispensa as id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,
        l.nombres as nombre, fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,
        id_riesgo,h.cod_esta,0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)  
        where (internado=0 or internado=1) and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and UPPER(p.nombres||p.hcl||l.numero||nro_registro) like UPPER(#{nombres})  
        and id_pedido in (select id_pedido from laboratorio where cod_esta=#{cod_esta} and (id_estado='B' or id_estado='C')  group by id_pedido) 
        order by fechae desc,id_pedido,h.id_paciente,h.id_historial      
        <!--     and l.id_persona in 
      (select id_persona from personas where cod_esta=#{cod_esta} and id_consultorio in 
      (select id_consultorio from personas where id_persona=#{id_persona} and cod_esta=#{cod_esta})  )
        order by fechae,id_pedido,h.id_paciente,h.id_historial  -->
    </select>
  
    <select id="getLabRealizadoInter" resultMap="datoslabpacrealizar">
        SELECT id_pedido,id_dispensa as id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,
        l.nombres as nombre, fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,
        id_riesgo,h.cod_esta,0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)  
        where internado>1 and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and id_pedido in 
        (select id_pedido from laboratorio where cod_esta=#{cod_esta} and (id_estado='B' or id_estado='C') 
        and laboratorio.id_persona=#{id_persona} and date(fechae) > current_date-2 group by id_pedido)   
        order by fechae desc,id_pedido,h.id_paciente,h.id_historial
    </select>
  
    <select id="getLabRealizadoInterFecha" resultMap="datoslabpacrealizar">
        SELECT id_pedido,id_dispensa as id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,
        l.nombres as nombre, fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,
        id_riesgo,h.cod_esta,0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)    
        where internado>1 and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and id_pedido in 
        (select id_pedido from laboratorio where cod_esta=#{cod_esta} and (id_estado='B' or id_estado='C') 
        and (date(fechae) BETWEEN #{fecha_ini} and #{fecha_fin})  group by id_pedido)   
        order by fechae desc,id_pedido,h.id_paciente,h.id_historial
    </select>
  
    <select id="getLabRealizadoInterNombre" resultMap="datoslabpacrealizar">
        SELECT id_pedido,id_dispensa as id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,
        l.nombres as nombre, fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,
        id_riesgo,h.cod_esta,0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)  
        where internado>1 and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and UPPER(p.nombres||p.hcl||l.numero||nro_registro) like UPPER(#{nombres}) and 
        id_pedido in (select id_pedido from laboratorio where cod_esta=#{cod_esta} and (id_estado='B' or id_estado='C') group by id_pedido)   
        order by fechae desc,id_pedido,h.id_paciente,h.id_historial
    </select>
  
    <select id="getLabRealizadoInterHcl" resultMap="datoslabpacrealizar">
        SELECT id_pedido,id_dispensa as id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,
        l.nombres as nombre, fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,
        id_riesgo,h.cod_esta,0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)  
        where internado>1 and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and p.hcl=#{numpieza} and id_pedido in 
        (select id_pedido from laboratorio where cod_esta=#{cod_esta} and (id_estado='B' or id_estado='C')   group by id_pedido)   
        order by fechae desc,id_pedido,h.id_paciente,h.id_historial
    </select>
  
    <select id="getLabRealizadoInterNum" resultMap="datoslabpacrealizar">
        SELECT id_pedido,id_dispensa as id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,
        l.nombres as nombre, fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,
        id_riesgo,h.cod_esta,0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)  
        where internado>1 and urgencia=#{seleccion} and l.cod_esta=#{cod_esta} and l.numero=#{numpieza} and id_pedido in 
        (select id_pedido from laboratorio where cod_esta=#{cod_esta} and (id_estado='B' or id_estado='C') 
        and id_laboratorio != 12 and id_laboratorio != 13  group by id_pedido)   
        order by fechae desc,id_pedido,h.id_paciente,h.id_historial
    </select>
  
    <select id="getLabMedico" resultMap="datoslabpacrealizar">
        SELECT id_pedido,x.id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,l.nombres as nombre, 
        fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,id_riesgo,h.cod_esta, 0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)      
        where id_historial in (select id_historial from laboratorio 
        JOIN historiales h USING(id_historial)  
        JOIN pacientes p USING(id_paciente) 
        where p.id_paciente=#{id_persona} 
        group by id_historial)
        order by h.fecha desc,h.id_paciente,h.id_historial
    </select>
  
    <select id="getLabMedicoLab" resultMap="datoslabpacrealizar">
        SELECT id_pedido,x.id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,l.nombres as nombre, 
        fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,id_riesgo,h.cod_esta, 0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)    
        where id_historial in (select id_historial from laboratorio l
        JOIN historiales h USING(id_historial)
        JOIN pacientes p USING(id_paciente)        
        where id_costo!=136 and id_costo!=138 and octet_length(resultado)>1 
        and l.id_estado='B' and  p.id_paciente=#{id_paciente} 
        group by id_historial)
        and id_pedido not in (select max(id_pedido) as id_pedido  from laboratorio l
        JOIN historiales h USING(id_historial) 
        JOIN pacientes p USING(id_paciente) 
        where id_costo!=136 and id_costo!=138 and octet_length(resultado)>1 
        and l.id_estado='B' and  p.id_paciente=#{id_paciente}) 			    
        order by h.fecha desc,h.id_paciente,h.id_historial
    </select>
  
    <select id="getLabMedicoEco" resultMap="datoslabpacrealizar">
        SELECT id_pedido,x.id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,l.nombres as nombre, 
        fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,id_riesgo,h.cod_esta,0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)     
        where id_historial in (select id_historial from laboratorio l
        JOIN historiales h USING(id_historial) 
        JOIN pacientes p USING(id_paciente)
        where id_costo=136 and octet_length(resultado)>1 
        and l.id_estado='B' and  p.id_paciente=#{id_persona} 
        group by id_historial)
        and id_pedido not in (select max(id_pedido) as id_pedido  from laboratorio l
        JOIN historiales h USING(id_historial) 
        JOIN pacientes p USING(id_paciente)
        where id_costo=136 and octet_length(resultado)>1 
        and l.id_estado='B' and  p.id_paciente=#{id_persona}) 			    
        order by h.fecha desc,h.id_paciente,h.id_historial
    </select>
  
    <select id="getLabMedicoX" resultMap="datoslabpacrealizar">
        SELECT id_pedido,x.id_persona,p.id_paciente,id_historial,fechap as fecha, p.nombres, h.expedido,l.nombres as nombre, 
        fechae, numero as numpieza,hcl as primera,h.id_seguro as endodoncia,p.seguro as aspecto,id_riesgo,h.cod_esta,0 AS suma1
        FROM pedidoslab l
        JOIN personas x USING(id_persona) 
        JOIN pacientes p USING(id_paciente)
        JOIN historiales h USING(id_historial)    
        where id_historial in (select id_historial from laboratorio l
        JOIN historiales h USING(id_historial)  
        JOIN pacientes p USING(id_paciente)
        where id_costo=138 and octet_length(resultado)>1 
        and l.id_estado='B' and  p.id_paciente=#{id_persona} 
        group by id_historial)
        and id_pedido not in (select max(id_pedido) as id_pedido  from laboratorio l
        JOIN historiales h USING(id_historial) 
        JOIN pacientes p USING(id_paciente) 
        where id_costo=138 and octet_length(resultado)>1 
        and l.id_estado='B' and  p.id_paciente=#{id_persona} )			    
        order by h.fecha desc,h.id_paciente,h.id_historial
    </select>
  
    <resultMap id="datoshemograma" type="Cuadernos">
        <result property="id_cuaderno"          column="id_cuaderno"/>
        <result property="id_costo"             column="id_costo"/>
        <result property="id_historial"         column="id_historial"/>
        <result property="sglorojos"            column="sglorojos"/>
        <result property="sblancos"             column="sblancos"/>
        <result property="splaquetas"           column="splaquetas"/>
        <result property="shemoglo"             column="shemoglo"/>
        <result property="shemato"              column="shemato"/>
        <result property="svcm"                 column="svcm"/>
        <result property="shgm"                 column="shgm"/>
        <result property="schcm"                column="schcm"/>
        <result property="sbas"                 column="sbas"/>
        <result property="seos"                 column="seos"/>
        <result property="smielo"               column="smielo"/>
        <result property="sjuy"                 column="sjuy"/>
        <result property="scay"                 column="scay"/>
        <result property="sseg"                 column="sseg"/>
        <result property="slinf"                column="slinf"/>
        <result property="smono"                column="smono"/>
        <result property="sangre"               column="sangre"/>
        <result property="aspecto"              column="aspecto"/>
        <result property="cetonas"              column="cetonas"/>
        <result property="reaccion"             column="reaccion"/>
        <result property="color"                column="color"/>
        <result property="olor"                 column="olor"/>
        <result property="smroja"               column="smroja"/>
        <result property="smblanca"             column="smblanca"/>
        <result property="smplaquetas"          column="smplaquetas"/>
        <result property="smves"                column="smves"/>
        <result property="smreti"               column="smreti"/>
        <result property="smindreti"            column="smindreti"/>
        <result property="smotros"              column="smotros"/>
        <result property="espuma"               column="espuma"/>
        <result property="estado"               column="estado"/>
        <result property="proteinas"            column="proteinas"/>
    </resultMap>
  
    <select id="getHemograma" resultMap="datoshemograma">
        SELECT id_detalle as id_costo,id_cuaderno, d.id_historial, sglorojos, sblancos, splaquetas, shemoglo, shemato, svcm, shgm, schcm, sbas, 
        seos, smielo, sjuy,scay,sseg,slinf,smono,coagulacion as sangre,sangria as aspecto,protombina as cetonas,
        actividad as reaccion,grupo as color, factor as olor,smroja, smblanca, smplaquetas, smves, smreti, smindreti, 
        smotros, leve as espuma, moderado as estado, severo as proteinas 
        FROM detallesangre d
        join laboratorio l using(id_cuaderno)
        WHERE d.id_historial=#{id_historial} and id_detalle=#{id_cargo} and id_pedido=#{id_pedido} and d.cod_esta=#{cod_esta};
    </select>
  
    <resultMap id="detalleecos" type="Cuadernos">
        <result property="id_cuaderno"       column="id_cuaderno"/>
        <result property="id_costo"          column="id_costo"/>
        <result property="aspecto"           column="aspecto"/>
        <result property="diagnostico"       column="diagnostico"/>
        <result property="diagnostico_ing"   column="diagnostico_ing"/>
        <result property="estado"            column="estado"/> 
    </resultMap>
  
    <select id="getDetalleEcos" resultMap="detalleecos">
        SELECT id_detalle as id_cuaderno, id_costo, titulo as aspecto, defecto as diagnostico, normales as diagnostico_ing,estado
        FROM detalleecos
        WHERE id_costo=#{id_cuaderno} and estado='A' ORDER BY titulo;
    </select>
  
    <select id="getDetalleEcosI" resultMap="detalleecos">
        SELECT id_detalle as id_cuaderno, id_costo, titulo as aspecto, defecto as diagnostico, normales as diagnostico_ing,estado
        FROM detalleecos
        WHERE titulo=#{aspecto} and estado='A' ORDER BY titulo;
    </select>
  
    <resultMap id="datosIndicadores" type="Cuadernos">
        <result property="auto"              column="auto"/>
        <result property="bcg"               column="bcg"/>
        <result property="cancer"            column="cancer"/>
        <result property="cancero"           column="cancero"/>
        <result property="cardio"            column="cardio"/>
        <result property="depre"             column="depre"/>
        <result property="desesti"           column="desesti"/>
        <result property="diasi"             column="diasi"/> 
    </resultMap>
  
    <select id="getIndicadores" resultMap="datosIndicadores">
        select * from indicadores_hospitalarios() 
        as ( auto integer,bcg integer, cancer integer,cancero integer,cardio integer,depre integer,desesti integer,diasi integer)
    </select>
  
    <resultMap id="datosorina" type="Cuadernos">
        <result property="id_cuaderno"          column="id_cuaderno"/>
        <result property="id_costo"             column="id_costo"/>
        <result property="id_historial"         column="id_historial"/>
        <result property="cantidad"             column="cantidad"/>
        <result property="proteinas"            column="proteinas"/>
        <result property="color"                column="color"/>
        <result property="olor"                 column="olor"/>
        <result property="aspecto"              column="aspecto"/>
        <result property="reaccion"             column="reaccion"/>
        <result property="densidad"             column="densidad"/>
        <result property="espuma"               column="espuma"/>
        <result property="sedimento"            column="sedimento"/>
        <result property="nitritos"             column="nitritos"/>
        <result property="glucosa"              column="glucosa"/>
        <result property="sangre"               column="sangre"/>
        <result property="cetonas"              column="cetonas"/>
        <result property="bilirrubina"          column="bilirrubina"/>
        <result property="urabilinogeno"        column="urabilinogeno"/>
        <result property="proteinas"            column="proteinas"/>
        <result property="smroja"               column="smroja"/>
        <result property="smblanca"             column="smblanca"/>
        <result property="smreti"               column="smreti"/>
        <result property="smono"                column="smono"/>
        <result property="otros"                column="otros"/>
        <result property="epiteliales"          column="epiteliales"/>
        <result property="leucocitos"           column="leucocitos"/>
        <result property="ematies"              column="ematies"/>
        <result property="piocitos"             column="piocitos"/>
        <result property="bacterias"            column="bacterias"/>
        <result property="smotros"              column="smotros"/>
        <result property="cilindros"            column="cilindros"/>
        <result property="granulosos"           column="granulosos"/>
        <result property="hialianos"            column="hialianos"/>
        <result property="leucocitarios"        column="leucocitarios"/>
        <result property="cristales"            column="cristales"/>
        <result property="observaciones"        column="observaciones"/>
    </resultMap>
  
    <select id="getOrina" resultMap="datosorina">
        SELECT id_detalle as id_costo,id_cuaderno,l.id_historial,cantidad,color,olor,aspecto,reaccion,densidad,espuma,sedimento,nitritos,glucosa,
        sangre,cetonas,bilirrubina,urabilinogeno,proteinas,pigmentos as smroja,acido as smblanca,sales as smreti,leuco2 as smono,
        otros,epiteliales,leucocitos,ematies,piocitos,bacterias,smotros,cilindros,granulosos,hialianos,leucocitarios,cristales,
        observaciones
        FROM detalleorina d
        join laboratorio l using(id_cuaderno)
        WHERE d.id_historial=#{id_historial} and id_detalle=#{id_cargo} and id_pedido=#{id_pedido} and d.cod_esta=#{cod_esta};
    </select>
  
    <resultMap id="datoscenso"      type="Cuadernos">
        <result property="id_historial"        column="id_historial"/>
        <result property="id_estado"           column="id_estado"/>
        <result property="nombres"             column="nombres"/> 
        <result property="edad"                column="edad"/>   
        <result property="hcl"                 column="hcl"/>  
        <result property="vitamina"            column="vitamina"/>   
        <result property="expedido"            column="expedido"/>            
        <result property="fec_ingreso"         column="fec_ingreso"/>    
        <result property="fec_egreso"          column="fec_egreso"/>    
        <result property="id_persona"          column="id_persona"/>  
        <result property="id_consultorio"      column="id_consultorio"/> 
        <result property="id_paciente"         column="id_paciente"/> 
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma6"               column="suma6"/>
        <result property="suma7"               column="suma7"/>   
        <result property="speso"               column="speso"/>
        <result property="fuma"                column="fuma"/>
        <result property="alcohol"             column="alcohol"/>
        <result property="violencia"           column="violencia"/>
        <result property="auto"                column="auto"/>
        <result property="urinaria"            column="urinaria"/>
        <result property="sistemica"           column="sistemica"/>
        <result property="arterial"            column="arterial"/>
        <result property="diabetes"            column="diabetes"/>
        <result property="glome"               column="glome"/>
        <result property="tracto"              column="tracto"/>
        <result property="lupus"               column="lupus"/>
        <result property="litiasis"            column="litiasis"/>
        <result property="nooplasia"           column="nooplasia"/>
        <result property="nefro"               column="nefro"/>
        <result property="disli"               column="disli"/>
        <result property="frenal"              column="frenal"/>
        <result property="bajopeso"            column="bajopeso"/>
        <result property="prematuro"           column="prematuro"/>
        <result property="eritro"              column="eritro"/>
        <result property="renal"               column="renal"/>
        <result property="tuberculo"           column="tuberculo"/>
        <result property="cardio"              column="cardio"/>
        <result property="otro"                column="otro"/>
    </resultMap>
  
    <select id="getCensoDiario" resultMap="datoscenso">
        select * from _censo_diario(#{id_historial},#{id_historia},#{id_laboratorio})  
        as (id_historial integer,id_estado text,nombres text,edad integer,hcl text,vitamina integer,expedido text,
        fec_ingreso timestamp without time zone,fec_egreso timestamp without time zone, id_persona integer,
        id_consultorio integer,id_paciente integer, suma1 integer,suma2 integer, suma3 integer,suma4 integer,suma5 integer,
        suma6 integer,suma7 integer,speso integer,fuma integer,alcohol integer,violencia integer,auto integer,urinaria integer,
        sistemica integer,arterial integer,diabetes integer,glome integer,tracto integer,lupus integer,litiasis integer,
        nooplasia integer,nefro integer,disli integer,frenal integer,bajopeso integer,prematuro integer,eritro integer,
        renal integer,tuberculo integer,otro integer,cardio integer)
    </select>
  
    <resultMap id="datoslabrealizar" type="Cuadernos">
        <result property="id_pedido"            column="id_pedido"/>  
        <result property="id_costo"             column="id_costo"/>  
        <result property="id_cuaderno"          column="id_cuaderno"/>
        <result property="id_persona"           column="id_persona"/>
        <result property="id_historial"         column="id_historial"/>
        <result property="id_laboratorio"       column="id_laboratorio"/>
        <result property="laboratorio"          column="laboratorio"/>
        <result property="tipoconsulta"         column="tipoconsulta"/>
        <result property="resultado"            column="resultado"/>
        <result property="fechap"               column="fechap"/>
        <result property="fechae"               column="fechae"/>
        <result property="id_tipo_sexo"         column="id_tipo_sexo"/>
        <result property="id_estado"            column="id_estado"/>
        <result property="otros"                column="otros"/>    <!--si hay ecografias-->
        <result property="otras"                column="otras"/>
        <result property="bacterias"                column="bacterias"/>
    </resultMap>
  
    <select id="getLabPendienteMed" resultMap="datoslabrealizar">
        SELECT id_pedido,laboratorio.id_persona,id_costo,id_laboratorio,id_cuaderno,id_historial,laboratorio,laboratorio.tipoconsulta,
        resultado,fechap,fechae,p.id_tipo_sexo, laboratorio.id_estado, laboratorio.direccion as otros,id_detalles as otras, 
        'A      ' as bacterias 
        FROM laboratorio
        join historiales using(id_historial)
        join pacientes p using(id_paciente)
        where id_historial=#{id_historial} 
        order by id_costo,fechap
    </select>
    
    <select id="getLabPendienteCNS" resultMap="datoslabrealizar">
        SELECT id_pedido,l.id_persona,id_costo,id_laboratorio,id_cuaderno,id_historial,l.laboratorio,l.tipoconsulta,
        resultado,fechap,fechae,p.id_tipo_sexo, l.id_estado, l.direccion as otros,id_detalles as otras, t.laboratorio as bacterias 
        FROM laboratorio l
        join historiales using(id_historial)
        join pacientes p using(id_paciente)
        join laboratorios t using(id_laboratorio)
        where id_historial=#{id_historial} and l.cod_esta=#{cod_esta} and (l.id_estado='A' or l.id_estado='X' or l.id_estado='Y')
        order by id_laboratorio,l.id_estado,laboratorio,fechap
        <!--estado X y Y para pedientes no debe quitarse 24-06-2015  -->    
    </select>
    
    <select id="getLabPendienteCNSUlt" resultMap="datoslabrealizar">
        SELECT id_pedido,l.id_persona,id_costo,id_laboratorio,id_cuaderno,id_historial,l.laboratorio,l.tipoconsulta,
        resultado,fechap,fechae,p.id_tipo_sexo, l.id_estado, l.direccion as otros,id_detalles as otras, t.laboratorio as bacterias 
        FROM laboratorio l
        join historiales using(id_historial)
        join pacientes p using(id_paciente)
        join laboratorios t using(id_laboratorio)
        where id_historial=#{id_historial} and l.cod_esta=#{cod_esta} and (l.id_estado='A' or l.id_estado='X' or l.id_estado='Y') 
        and id_pedido in (select max(id_pedido) from pedidoslab where id_historial=#{id_historial} and cod_esta=#{cod_esta}) 
        order by id_laboratorio,l.id_estado,laboratorio,fechap   
    </select>
  
    <select id="getLabPendiente" resultMap="datoslabrealizar">
        SELECT id_pedido,laboratorio.id_persona,id_costo,id_laboratorio,id_cuaderno,id_historial,laboratorio.laboratorio,laboratorio.tipoconsulta,
        resultado, fechap,fechae,p.id_tipo_sexo,laboratorio.id_estado, laboratorio.direccion as otros,id_detalles as otras, 
        laboratorios.laboratorio as bacterias 
        FROM laboratorio
        join laboratorios using(id_laboratorio)
        join historiales using(id_historial)
        join pacientes p using(id_paciente)
        where id_pedido=#{id_pedido} and laboratorio.cod_esta=#{cod_esta} and id_laboratorio != 12 and id_laboratorio != 13 
        and id_laboratorio != 14 and id_laboratorio != 15 and id_laboratorio in 
        (select id_laboratorio from laboratorio where id_historial=#{id_historial} 
        and (id_laboratorio between #{id_cargo} and #{id_laboratorio} )  and laboratorio.cod_esta=#{cod_esta}) 
        order by id_estado,id_laboratorio,laboratorio.laboratorio,fechap
    </select>
  
    <select id="getLabPendienteImp" resultMap="datoslabrealizar">
        SELECT id_pedido,laboratorio.id_persona,id_costo,id_laboratorio,id_cuaderno,id_historial,laboratorio,laboratorio.tipoconsulta,
        resultado,fechap,fechae,p.id_tipo_sexo,laboratorio.id_estado, laboratorio.direccion as otros,id_detalles as otras, 
        'A      ' as bacterias 
        FROM laboratorio
        join historiales using(id_historial)
        join pacientes p using(id_paciente)
        where id_pedido=#{id_pedido} and laboratorio.cod_esta=#{cod_esta} and id_laboratorio != 12 and id_laboratorio != 13 
        and laboratorio.id_estado='B' and id_laboratorio != 14 and id_laboratorio != 15 and id_laboratorio in 
        (select id_laboratorio from laboratorio where id_historial=#{id_historial} 
        and (id_laboratorio between #{id_cargo} and #{id_laboratorio} ) and laboratorio.cod_esta=#{cod_esta}) 
        order by id_estado,laboratorio,fechap
    </select>
    
    <select id="getLabPendienteEpi" resultMap="datoslabrealizar">
        SELECT id_pedido,l.id_persona,id_costo,id_laboratorio,id_cuaderno,id_historial,laboratorio,l.tipoconsulta,
        resultado,fechap,fechae,p.id_tipo_sexo, l.id_estado, l.direccion as otros,id_detalles as otras, 'A' as bacterias 
        FROM laboratorio l
        join historiales using(id_historial)
        join pacientes p using(id_paciente)
        where l.cod_esta=#{cod_esta} and id_historia in (select id_historia from historiainter where cod_esta=#{cod_esta} 
        and id_historia=#{id_historia}) 
        order by id_estado,laboratorio,fechap
    </select>
  
    <select id="getLabPendienteEco" resultMap="datoslabrealizar">
        SELECT id_pedido,laboratorio.id_persona,id_costo,id_laboratorio, id_cuaderno,id_historial, laboratorio,laboratorio.tipoconsulta,
        resultado, fechap, fechae, p.id_tipo_sexo, laboratorio.id_estado, laboratorio.direccion as otros,id_detalles as otras, 
        'A      ' as bacterias 
        FROM laboratorio
        join historiales using(id_historial)
        join pacientes p using(id_paciente)
        where id_pedido=#{id_pedido} and laboratorio.cod_esta=#{cod_esta} and id_laboratorio=12 
        order by fechap
    </select>
  
    <select id="getLabPendienteRx" resultMap="datoslabrealizar">
        SELECT id_pedido,laboratorio.id_persona,id_costo,id_laboratorio,id_cuaderno,id_historial, laboratorio,laboratorio.tipoconsulta, 
        resultado, fechap, fechae, p.id_tipo_sexo, laboratorio.id_estado, laboratorio.direccion as otros,id_detalles as otras, 
        'A      ' as bacterias 
        FROM laboratorio
        join historiales using(id_historial)
        join pacientes p using(id_paciente)
        where id_pedido=#{id_pedido} and laboratorio.cod_esta=#{cod_esta} and id_laboratorio=13 
        order by fechap
    </select>
  
    <select id="getLabGen" resultMap="datoslabrealizar">
        SELECT id_pedido,laboratorio.id_persona,id_costo,id_laboratorio,id_cuaderno,id_historial, laboratorio,laboratorio.tipoconsulta, 
        resultado, fechap, fechae, p.id_tipo_sexo,laboratorio.id_estado, laboratorio.direccion as otros,id_detalles as otras, 
        'A      ' as bacterias 
        FROM laboratorio
        join historiales using(id_historial)
        join pacientes p using(id_paciente)
        where id_historial in (select id_historial from historiales where (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ))
    </select>
    
    <resultMap id="datosPedidoslab" type="Cuadernos">
        <result property="id_pedido"         column="id_pedido"/>
        <result property="fechae"            column="fechae"/>
        <result property="nombres"           column="nombres"/>
        <result property="nombre"            column="nombre"/>
        <result property="id_historial"      column="id_historial"/>
        <result property="id_historia"       column="id_historia"/>
        <result property="id_estado"         column="id_estado"/>
        <result property="id_persona"        column="id_persona"/>
        <result property="id_dispensa"       column="id_dispensa"/>
        <result property="tipo"              column="tipo"/>
        <result property="fechap"            column="fechap"/>
        <result property="numpieza"          column="numpieza"/>
    </resultMap>

    <select id="getPedidoLab" resultMap="datosPedidoslab">
        SELECT id_pedido,fechae,nombres,establecimiento as nombre,id_historial,id_historia,id_estado,id_persona,id_dispensa,tipo,
        fechap,numero as numpieza
        FROM pedidoslab
        where id_historial=#{id_historial} and cod_esta=#{cod_esta} <!--and id_persona=#{id_persona} 20-10-2015-->
        <!--order by fechap, id_pedido-->
        order by id_pedido desc limit 1
    </select>
  
    <select id="getDatoPedidoLab" resultMap="datosPedidoslab">
        SELECT id_pedido,fechae,nombres,establecimiento as nombre,id_historial,id_historia,id_estado,id_persona,id_dispensa,tipo,
        fechap,numero as numpieza
        FROM pedidoslab
        where id_pedido=#{id_pedido}
        order by fechap, id_pedido
    </select>
  
    <resultMap id="datoslaboratorio" type="Cuadernos">
        <result property="id_pedido"            column="id_pedido"/>
        <result property="id_cuaderno"          column="id_cuaderno"/>
        <result property="id_estado"            column="id_estado"/>
        <result property="id_historial"         column="id_historial"/>
        <result property="laboratorio"          column="laboratorio"/>
        <result property="id_costo"             column="id_costo"/>
        <result property="tipoconsulta"         column="tipoconsulta"/>
        <result property="resultado"            column="resultado"/>
        <result property="fechap"               column="fechap"/>
        <result property="aspecto"              column="aspecto"/>
        <result property="bacterias"            column="bacterias"/>
        <result property="id_laboratorio"       column="id_laboratorio"/>
        <result property="id_costo"             column="id_costo"/>
        <result property="id_persona"           column="id_persona"/>
        <result property="id_localidad"         column="id_localidad"/>
    </resultMap>

    <select id="getPacienteLaboratorio" resultMap="datoslaboratorio">
        SELECT id_pedido,id_cuaderno,l.id_estado,id_historial, l.laboratorio,id_costo,tipoconsulta , resultado, 
        fechap, 'A' as aspecto,t.laboratorio as bacterias, l.id_laboratorio, id_costo,id_persona, id_detalles as id_localidad
        FROM laboratorio l
        join laboratorios t using(id_laboratorio)
        where id_historial=#{id_historial} and cod_esta=#{cod_esta} 
        order by fechap desc, laboratorio,id_cuaderno
    </select>
    
    <select id="getDatosLaboratorioC" resultMap="datoslaboratorio">
        SELECT id_pedido,id_cuaderno,l.id_estado,id_historial, laboratorio,l.id_costo,tipoconsulta , resultado, 
        fechap, defecto as aspecto,'A' as bacterias , l.id_laboratorio, id_costo,id_persona, id_detalles as id_localidad
        FROM laboratorio l
        join costos using(id_costo)
        where id_cuaderno=#{id_cuaderno} and l.cod_esta=#{cod_esta} and costos.cod_esta=#{cod_esta} 
        order by fechap
    </select>
  
    <resultMap id="datoslaboratorioCob" type="Cuadernos">
        <result property="id_pedido"            column="id_pedido"/>
        <result property="id_cuaderno"          column="id_cuaderno"/>
        <result property="id_estado"            column="id_estado"/>
        <result property="id_historial"         column="id_historial"/>
        <result property="laboratorio"          column="laboratorio"/>
        <result property="id_costo"             column="id_costo"/>
        <result property="tipoconsulta"         column="tipoconsulta"/>
        <result property="resultado"            column="resultado"/>
        <result property="fechap"               column="fechap"/>
        <result property="aspecto"              column="aspecto"/>
        <result property="cm"                   column="cm"/>
        <result property="primera"              column="primera"/>
        <result property="suma1"                column="suma1"/>
    </resultMap>
  
    <select id="getDatosLaboratorios" resultMap="datoslaboratorioCob">
        SELECT id_pedido,id_cuaderno,l.id_estado,id_historial, laboratorio,l.id_costo,tipoconsulta,resultado, 
        fechap, 'A' as aspecto, costo_unit as cm,id_costo as primera, id_rubro as suma1
        FROM laboratorio l
        join costos c using(id_costo)
        where id_historial=#{id_historial} and l.id_estado='G' and c.cod_esta=#{cod_esta} and l.cod_esta=#{cod_esta} 
        order by fechap
    </select>
  
    <delete id="setEliminarLaboratorioC">
        delete from laboratorio
        where id_cuaderno=#{id_cuaderno} and id_historial=#{id_historial} and cod_esta=#{cod_esta};
        
        update historiales set n_exa=(select count(*) from laboratorio where id_historial=#{id_historial} and cod_esta=#{cod_esta} and
        (id_laboratorio!=12 and id_laboratorio!=13 and id_laboratorio!=14 and id_laboratorio!=15 and id_laboratorio!=20 and id_laboratorio!=24) ) 
        where id_historial=#{id_historial} and cod_esta=#{cod_esta} ;  
        update historiales set n_ima=(select count(*) from laboratorio where id_historial=#{id_historial} and cod_esta=#{cod_esta} and
        (id_laboratorio=12 or id_laboratorio=13 or id_laboratorio=14 or id_laboratorio=15 or id_laboratorio=20 or id_laboratorio=24) ) 
        where id_historial=#{id_historial} and cod_esta=#{cod_esta} ;                 
    </delete>
  
    <insert id="setCrearLaboratorioC">
        insert into laboratorio (id_historial, laboratorio,resultado,id_costo,tipoconsulta,id_estado,id_pedido,id_laboratorio,
        id_historia,cod_esta,fec_reg,id_porp,id_porr)
        values (#{id_historial},#{laboratorio},#{resultado},#{id_costo},#{tipoconsulta},#{id_estado},#{id_pedido},#{id_laboratorio},
        #{id_historia},#{cod_esta},now(),#{id_por},#{id_por} );
        update historiales set n_exa=(select count(*) from laboratorio where id_historial=#{id_historial} and cod_esta=#{cod_esta} and
        (id_laboratorio!=12 and id_laboratorio!=13 and id_laboratorio!=14 and id_laboratorio!=15 and id_laboratorio!=20 and id_laboratorio!=24) ) 
        where id_historial=#{id_historial} and cod_esta=#{cod_esta} ;  
        update historiales set n_ima=(select count(*) from laboratorio where id_historial=#{id_historial} and cod_esta=#{cod_esta} and
        (id_laboratorio=12 or id_laboratorio=13 or id_laboratorio=14 or id_laboratorio=15 or id_laboratorio=20 or id_laboratorio=24) ) 
        where id_historial=#{id_historial} and cod_esta=#{cod_esta} ; 
                        
        update pedidoslab set urgencia=0 where cod_esta=700241 and urgencia=1;                
    </insert>  

    <insert id="setCrearProduccion">
        delete from reporte_produccion where cod_esta=#{cod_esta};
        insert into  reporte_produccion
        (select consultorio as tipo,(p.nombres||' '||p.paterno||' '||p.materno) as tipoconsulta,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma5,    
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma6, 
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma7,    
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma8, 
                       
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 1 and 4)) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 1 and 4)) THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 1 and 4)) THEN 1 ELSE 0 END) as suma11,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 1 and 4)) THEN 1 ELSE 0 END) as suma12,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 5 and 9)) THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 5 and 9)) THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 5 and 9)) THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 5 and 9)) THEN 1 ELSE 0 END) as suma16,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 10 and 14)) THEN 1 ELSE 0 END) as suma17,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 10 and 14)) THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 10 and 14)) THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 10 and 14)) THEN 1 ELSE 0 END) as suma20,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma21,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma22,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma23,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma24,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 20 and 39)) THEN 1 ELSE 0 END) as suma25,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 20 and 39)) THEN 1 ELSE 0 END) as suma26,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 20 and 39)) THEN 1 ELSE 0 END) as suma27,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 20 and 39)) THEN 1 ELSE 0 END) as suma28,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 40 and 49)) THEN 1 ELSE 0 END) as suma29,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 40 and 49)) THEN 1 ELSE 0 END) as suma30,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 40 and 49)) THEN 1 ELSE 0 END) as suma31,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 40 and 49)) THEN 1 ELSE 0 END) as suma32,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 50 and 59)) THEN 1 ELSE 0 END) as suma33,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 50 and 9)) THEN 1 ELSE 0 END) as suma34,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 50 and 59)) THEN 1 ELSE 0 END) as suma35,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 50 and 9)) THEN 1 ELSE 0 END) as suma36,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 60 and 120)) THEN 1 ELSE 0 END) as suma37,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 60 and 120)) THEN 1 ELSE 0 END) as suma38,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 60 and 120)) THEN 1 ELSE 0 END) as suma39,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 60 and 120)) THEN 1 ELSE 0 END) as suma40,
        #{cod_esta}
        
        from historiales h
        join consultorios c using(id_consultorio)
        join pacientes a using(id_paciente)
        join personas p using(id_persona)
        where h.cod_esta=#{cod_esta} and (fecha::date between #{fecha_ini} and #{fecha_fin})  and id_cargo>0 and id_cargo!=34 and id_cargo!=10 and id_cargo!=11 and id_cargo!=7
        group by h.id_consultorio,consultorio,id_persona,p.nombres,p.paterno,p.materno order by h.id_consultorio);
    </insert>
    
    <insert id="setCrearProduccionEmerg">
        delete from reporte_produccion where cod_esta=#{cod_esta};
        insert into  reporte_produccion
        (select consultorio as tipo,(p.nombres||' '||p.paterno||' '||p.materno) as tipoconsulta,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma5,    
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma6, 
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma7,    
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma8, 
                       
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 1 and 4)) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 1 and 4)) THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 1 and 4)) THEN 1 ELSE 0 END) as suma11,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 1 and 4)) THEN 1 ELSE 0 END) as suma12,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 5 and 9)) THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 5 and 9)) THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 5 and 9)) THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 5 and 9)) THEN 1 ELSE 0 END) as suma16,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 10 and 14)) THEN 1 ELSE 0 END) as suma17,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 10 and 14)) THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 10 and 14)) THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 10 and 14)) THEN 1 ELSE 0 END) as suma20,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma21,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma22,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma23,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma24,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 20 and 39)) THEN 1 ELSE 0 END) as suma25,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 20 and 39)) THEN 1 ELSE 0 END) as suma26,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 20 and 39)) THEN 1 ELSE 0 END) as suma27,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 20 and 39)) THEN 1 ELSE 0 END) as suma28,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 40 and 49)) THEN 1 ELSE 0 END) as suma29,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 40 and 49)) THEN 1 ELSE 0 END) as suma30,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 40 and 49)) THEN 1 ELSE 0 END) as suma31,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 40 and 49)) THEN 1 ELSE 0 END) as suma32,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 50 and 59)) THEN 1 ELSE 0 END) as suma33,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 50 and 9)) THEN 1 ELSE 0 END) as suma34,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 50 and 59)) THEN 1 ELSE 0 END) as suma35,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 50 and 9)) THEN 1 ELSE 0 END) as suma36,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 60 and 120)) THEN 1 ELSE 0 END) as suma37,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 60 and 120)) THEN 1 ELSE 0 END) as suma38,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 60 and 120)) THEN 1 ELSE 0 END) as suma39,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 60 and 120)) THEN 1 ELSE 0 END) as suma40,
        #{cod_esta}
        
        from historiales h
        join consultorios c using(id_consultorio)
        join pacientes a using(id_paciente)
        join personas p using(id_persona)
        where h.cod_esta=#{cod_esta} and (fecha::date between #{fecha_ini} and #{fecha_fin})  and urgencias=1 and 
        (c.id_consultorio=17 or c.id_consultorio=19 or c.id_consultorio=23 or c.id_consultorio=45)
        group by h.id_consultorio,consultorio,id_persona,p.nombres,p.paterno,p.materno order by h.id_consultorio);
    </insert>  
  
    <insert id="setCrearDetalleSangre">
        insert into detallesangre (id_cuaderno,id_historial,sglorojos,sblancos,splaquetas,shemoglo,shemato,svcm,shgm,schcm,sbas,
        seos,smielo,sjuy,scay,sseg,slinf,smono,smroja,smblanca,smplaquetas,smves,smreti,smindreti,smotros,
        coagulacion,sangria,protombina,actividad,grupo,factor,leve,moderado,severo,cod_esta)
        values (#{id_cuaderno},#{id_historial},#{sglorojos},#{sblancos},#{splaquetas},#{shemoglo},#{shemato},#{svcm},#{shgm},#{schcm},#{sbas},
        #{seos},#{smielo},#{sjuy},#{scay},#{sseg},#{slinf},#{smono},#{smroja},#{smblanca},#{smplaquetas},#{smves},#{smreti},#{smindreti},#{smotros},
        #{sangre},#{aspecto},#{cetonas},#{reaccion},#{color},#{olor},#{espuma},#{estado},#{proteinas},#{cod_esta}) ;
        update laboratorio set id_detalles=(select max(id_detalle) from detallesangre where id_cuaderno=#{id_cuaderno} and 
        id_historial=#{id_historial} and cod_esta=#{cod_esta}) 
        where id_cuaderno=#{id_cuaderno} and id_historial=#{id_historial} and cod_esta=#{cod_esta};
    </insert>
  
    <insert id="setCrearDetalleOrina">
        insert into detalleorina (id_cuaderno,id_historial,cantidad,color,olor,aspecto,reaccion,densidad,espuma,sedimento,
        nitritos,glucosa,sangre,cetonas,bilirrubina,urabilinogeno,proteinas,pigmentos,acido,sales,leuco2,
        smotros,epiteliales,leucocitos,ematies,piocitos,bacterias,observaciones,cilindros,granulosos,
        hialianos,leucocitarios,cristales,cod_esta)
        values (#{id_cuaderno},#{id_historial},#{cantidad},#{color},#{olor},#{aspecto},#{reaccion},#{densidad},#{espuma},#{sedimento},
        #{nitritos},#{glucosa},#{sangre},#{cetonas},#{bilirrubina},#{urabilinogeno},#{proteinas},#{smroja},#{smblanca},#{smreti},#{smono},
        #{smotros},#{epiteliales},#{leucocitos},#{ematies},#{piocitos},#{bacterias},#{observaciones},#{cilindros},#{granulosos},
        #{hialianos},#{leucocitarios},#{cristales},#{cod_esta}) ;
        update laboratorio set id_detalles=(select max(id_detalle) from detalleorina where id_cuaderno=#{id_cuaderno} and 
        id_historial=#{id_historial} and cod_esta=#{cod_esta}) 
        where id_cuaderno=#{id_cuaderno} and id_historial=#{id_historial} and cod_esta=#{cod_esta};
    </insert>   
 
    <update id="setModificarLaboratorioC" >
        update laboratorio
        set  resultado = #{resultado},
        id_estado =#{estado} ,
        id_persona =#{id_persona} ,
        id_porr =#{id_por} ,
        fechae=now()
        where  id_cuaderno = #{id_cuaderno} and cod_esta=#{cod_esta};
    </update>
    
    <update id="setModificarLaboratorioCobrar" >
        update laboratorio
        set    id_estado = #{id_estado}
        where  id_historial = #{id_historial} and id_cuaderno = #{id_cuaderno} and cod_esta = #{cod_esta};
    </update>
    
    <update id="setModificarHemograma" >
        update detallesangre
        set    id_cuaderno=#{id_cuaderno},id_historial=#{id_historial},sglorojos=#{sglorojos},sblancos=#{sblancos},splaquetas=#{splaquetas},
        shemoglo=#{shemoglo},shemato=#{shemato},svcm=#{svcm},shgm=#{shgm},schcm=#{schcm},sbas=#{sbas},seos=#{seos},smielo=#{smielo},
        sjuy=#{sjuy},scay=#{scay},sseg=#{sseg},slinf=#{slinf},smono=#{smono},smroja=#{smroja},smblanca=#{smblanca},smplaquetas=#{smplaquetas},
        smves=#{smves},smreti=#{smreti},smindreti=#{smindreti},smotros=#{smotros},coagulacion=#{sangre},sangria=#{aspecto},protombina=#{cetonas},
        actividad=#{reaccion},grupo=#{color},factor=#{olor},leve=#{espuma},severo=#{estado},moderado=#{proteinas#{
        where  id_historial = #{id_historial} and id_detalle = #{id_cargo} and cod_esta=#{cod_esta};
    
    </update>  
    <update id="setModificarOrina" >
        update detalleorina
        set    id_cuaderno=#{id_cuaderno},id_historial=#{id_historial},cantidad=#{cantidad},color=#{color},olor=#{olor},aspecto=#{aspecto},
        reaccion=#{reaccion},densidad=#{densidad},espuma=#{espuma},sedimento=#{sedimento},nitritos=#{nitritos},glucosa=#{glucosa},
        sangre=#{sangre},cetonas=#{cetonas},bilirrubina=#{bilirrubina},urabilinogeno=#{urabilinogeno},proteinas=#{proteinas},
        pigmentos=#{smroja},acido=#{smblanca},sales=#{smreti},leuco2=#{smono},
        otros=#{otros},epiteliales=#{epiteliales},leucocitos=#{leucocitos},ematies=#{ematies},
        piocitos=#{piocitos},bacterias=#{bacterias},smotros=#{smotros},cilindros=#{cilindros},granulosos=#{granulosos},
        hialianos=#{hialianos},leucocitarios=#{leucocitarios},cristales=#{cristales},observaciones=#{observaciones}
        where  id_historial = #{id_historial} and id_detalle = #{id_cargo} and cod_esta=#{cod_esta};
    </update>  
    
    <insert id="setCrearPedidoLab">
        insert into pedidoslab (fechap,nombres,establecimiento,id_historial,id_historia,id_estado,id_persona,id_dispensa,fechae,tipo,
        urgencia,id_paciente,fec_reg,cod_esta)
        values (#{fechap},#{nombres},#{nombre},#{id_historial},#{id_historia},#{id_estado},#{id_persona},#{id_dispensa},#{fechae},#{tipo},
        #{seleccion},#{id_paciente},now(),#{cod_esta}) ;
    </insert>  
    
    <update id="setReservaLabEcografia">
        update laboratorio
        set  id_estado ='A'          
        where  id_cuaderno = #{id_cuaderno} and id_laboratorio=16 
    </update> 
    <update id="setModificarEcoDetalle">
        update detalleecos
        set  defecto=#{diagnostico} 
        where  id_detalle = #{id_cuaderno}  
    </update>
  
    <update id="setModificarPedidoLab">
        update pedidoslab
        set  nombres=#{nombres},establecimiento=#{nombre},numero=#{numpieza},id_dispensa=#{id_persona}, 
        fechae=#{fechae}, id_estado=#{estado} 
        where  id_pedido = #{id_pedido}  and cod_esta=#{cod_esta} 
    </update>
  
    <update id="setModificarPedidolabo">
        update pedidoslab
        set    id_estado=#{estado} 
        where  id_pedido = #{id_pedido}   and cod_esta=#{cod_esta} 
    </update>
  
    <update id="setModificarImpOrina">
        update conf_impresion
        set volumen_x=#{exodoncia},volumen_y=#{periodoncia},volumen_t=#{cirugia}, 
        color_x=#{endodoncia}, color_y=#{rayosx}, color_t=#{preventiva}, olor_x=#{primera}, olor_y=#{numpieza}, olor_t=#{suma1},
        aspecto_x=#{suma2}, aspecto_y=#{suma3}, aspecto_t=#{suma4}, reaccion_x=#{suma5}, reaccion_y=#{suma6}, reaccion_t=#{suma7},
        densidad_x=#{suma8}, densidad_y=#{suma9}, densidad_t=#{suma10}, espuma_x=#{fuma}, espuma_y=#{alcohol}, espuma_t=#{violencia},
        deposito_x=#{auto}, deposito_y=#{urinaria}, deposito_t=#{sistemica}, nitritos_x=#{semanas}, nitritos_y=#{parto}, nitritos_t=#{sexo},
        glucosa_x=#{imc}, glucosa_y=#{embarazo}, glucosa_t=#{eclam}, hemoglo_x=#{orientacion}, hemoglo_y=#{diu}, hemoglo_t=#{inyectable},
        acetona_x=#{nooplasia}, acetona_y=#{nefro}, acetona_t=#{disli}, biliru_x=#{hemo}, biliru_y=#{anestesia}, biliru_t=#{controlpos},
        urobilina_x=#{sueros}, urobilina_y=#{curaciones}, urobilina_t=#{condon}, albumina_x=#{tracto}, albumina_y=#{lupus}, albumina_t=#{litiasis},
        pigbiliar_x=#{otro}, pigbiliar_y=#{cardio}, pigbiliar_t=#{reuma}, salesbiliar_x=#{eritro}, salesbiliar_y=#{renal}, salesbiliar_t=#{tuberculo},
        acidodiecet_x=#{ingreso}, acidodiecet_y=#{anastecia}, acidodiecet_t=#{servicio}, proteina_x=#{frenal}, proteina_y=#{bajopeso}, proteina_t=#{prematuro},
        indoxilo_x=#{epilepsia}, indoxilo_y=#{psico}, indoxilo_t=#{discapa}, urea_x=#{cancer}, urea_y=#{cancero}, urea_t=#{depre},
        cloruro_x=#{pildora}, cloruro_y=#{aqv}, cloruro_t=#{mnatural}, acidourico_x=#{insumos}, acidourico_y=#{pap}, acidourico_t=#{tabletas},
        fosfato_x=#{sfembarazada}, fosfato_y=#{sfpuerpera}, fosfato_t=#{vitamina}, epitelial_x=#{suma11}, epitelial_y=#{suma12}, epitelial_t=#{suma13},
        leucocito_x=#{suma14}, leucocito_y=#{suma15}, leucocito_t=#{suma16}, hematies_x=#{suma17}, hematies_y=#{suma18}, hematies_t=#{suma19},
        piocito_x=#{suma20}, piocito_y=#{suma21}, piocito_t=#{suma22}, bacteria_x=#{suma23}, bacteria_y=#{suma24}, bacteria_t=#{suma25},
        cilindro_x=#{suma26}, cilindro_y=#{suma27}, cilindro_t=#{suma28}, granulo_x=#{suma29}, granulo_y=#{suma30}, granulo_t=#{suma31} 
        
        where  id_tipo = #{id_historial} 
    </update> 
    
    <update id="setModificarImpRiesgo">
        update conf_impresion
        set sedes_x=#{suma1},sedes_y=#{suma2},sedes_t=#{suma3},red_x=#{suma4},red_y=#{suma5},red_t=#{suma6}, 
        municipio_x=#{suma7},municipio_y=#{suma8},municipio_t=#{suma9},servicio_x=#{suma10},servicio_y=#{suma11},servicio_t=#{suma12},
        fecharep_x=#{suma13},fecharep_y=#{suma14},fecharep_t=#{suma15},num_registro_x=#{suma16},num_registro_y=#{suma17},num_registro_t=#{suma18},
        num_hcl_x=#{suma19},num_hcl_y=#{suma20},num_hcl_t=#{suma21},nombre_x=#{suma22},nombre_y=#{suma23},nombre_t=#{suma24},
        edad_x=#{suma25},edad_y=#{suma26},edad_t=#{suma27},sexo_x=#{suma28},sexo_y=#{suma29},sexo_t=#{suma30},
        establecimiento_x=#{suma31},establecimiento_y=#{suma32},establecimiento_t=#{suma33},tiposeg_x=#{suma34},tiposeg_y=#{suma35},tiposeg_t=#{suma36},
        medico_x=#{suma37},medico_y=#{suma38},medico_t=#{suma39},titulo_x=#{suma40},titulo_y=#{suma41},titulo_t=#{suma42},
        glorojos_x=#{suma43},glorojos_y=#{suma44},glorojos_t=#{suma45},globlanco_x=#{suma46},globlanco_y=#{suma47},globlanco_t=#{suma48},
        plaqueta_x=#{suma49},plaqueta_y=#{suma50},plaqueta_t=#{suma51},homoglobina_x=#{suma52},homoglobina_y=#{suma53},homoglobina_t=#{suma54},
        hematocrito_x=#{suma55},hematocrito_y=#{suma56},hematocrito_t=#{suma57},vcm_x=#{suma58},vcm_y=#{suma59},vcm_t=#{suma60},
        hgm_x=#{suma61},hgm_y=#{suma62},hgm_t=#{suma63}, chcm_x=#{suma64},chcm_y=#{suma65},chcm_t=#{suma66} 
        where  id_tipo=#{bcg}
    </update> 
  
    <resultMap id="informeProduccionPrenatal" type="Cuadernos">
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma6"               column="suma6"/>
        <result property="suma7"               column="suma7"/>
        <result property="suma8"               column="suma8"/>
        <result property="suma9"               column="suma9"/>
        <result property="suma10"              column="suma10"/>
        <result property="suma11"              column="suma11"/>
        <result property="suma12"              column="suma12"/>
        <result property="suma13"              column="suma13"/>
        <result property="suma14"              column="suma14"/>
        <result property="suma15"              column="suma15"/>
        <result property="suma16"              column="suma16"/>
        <result property="suma17"              column="suma17"/>
        <result property="suma18"              column="suma18"/>
        <result property="suma19"              column="suma19"/>
        <result property="suma20"              column="suma20"/>
        <result property="suma21"              column="suma21"/>
        <result property="suma22"              column="suma22"/>
        <result property="suma23"              column="suma23"/>
        <result property="suma24"              column="suma24"/>
        <result property="suma25"              column="suma25"/>
        <result property="suma26"              column="suma26"/>
        <result property="suma27"              column="suma27"/>
        <result property="suma28"              column="suma28"/>
        <result property="suma29"              column="suma29"/>
        <result property="suma30"              column="suma30"/>
        <result property="suma31"              column="suma31"/>
        <result property="suma32"              column="suma32"/>
        <result property="suma33"              column="suma33"/>
        <result property="suma34"              column="suma34"/>
        <result property="suma35"              column="suma35"/>
        <result property="suma36"              column="suma36"/>
        <result property="suma37"              column="suma37"/>
        <result property="suma38"              column="suma38"/>
        <result property="suma39"              column="suma39"/>
        <result property="suma40"              column="suma40"/>
        <result property="suma41"              column="suma41"/>
        <result property="suma42"              column="suma42"/>
        <result property="suma43"              column="suma43"/>
        <result property="suma44"              column="suma44"/>
        <result property="suma45"              column="suma45"/>
        <result property="suma46"              column="suma46"/>
        <result property="suma47"              column="suma47"/>
        <result property="suma48"              column="suma48"/>
        <result property="suma49"              column="suma49"/>
        <result property="suma50"              column="suma50"/>
        <result property="suma51"              column="suma51"/>
        <result property="suma52"              column="suma52"/>
        <result property="suma53"              column="suma53"/>
        <result property="suma54"              column="suma54"/>
        <result property="suma55"              column="suma55"/>
        <result property="suma56"              column="suma56"/>
        <result property="suma57"              column="suma57"/>
        <result property="suma58"              column="suma58"/>
        <result property="suma59"              column="suma59"/>
        <result property="suma60"              column="suma60"/>
    </resultMap>
    
    <select id="getReporteProduccionPrenatal" resultMap="informeProduccionPrenatal">
        select  sum(CASE WHEN (fuera=0 and suma1=1 and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma1,
        sum(CASE WHEN (fuera=1 and suma1=1 and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma2,
        sum(CASE WHEN (fuera=0 and suma1=1 and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma3,
        sum(CASE WHEN (fuera=1 and suma1=1 and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma4,
        sum(CASE WHEN (fuera=0 and suma1=1 and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma5,
        sum(CASE WHEN (fuera=1 and suma1=1 and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma6,
        sum(CASE WHEN (fuera=0 and suma1=1 and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma7,
        sum(CASE WHEN (fuera=1 and suma1=1 and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma8,
        sum(CASE WHEN (fuera=0 and suma1=1 and (edad between 50 and 60)) THEN 1 ELSE 0 END)::int as suma9,
        sum(CASE WHEN (fuera=1 and suma1=1 and (edad between 50 and 60)) THEN 1 ELSE 0 END)::int as suma10,
        
        sum(CASE WHEN (fuera=0 and suma2=1 and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma11,
        sum(CASE WHEN (fuera=1 and suma2=1 and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma12,
        sum(CASE WHEN (fuera=0 and suma2=1 and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma13,
        sum(CASE WHEN (fuera=1 and suma2=1 and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma14,
        sum(CASE WHEN (fuera=0 and suma2=1 and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma15,
        sum(CASE WHEN (fuera=1 and suma2=1 and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma16,
        sum(CASE WHEN (fuera=0 and suma2=1 and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma17,
        sum(CASE WHEN (fuera=1 and suma2=1 and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma18,
        sum(CASE WHEN (fuera=0 and suma2=1 and (edad between 50 and 60)) THEN 1 ELSE 0 END)::int as suma19,
        sum(CASE WHEN (fuera=1 and suma2=1 and (edad between 50 and 60)) THEN 1 ELSE 0 END)::int as suma20,

        sum(CASE WHEN (fuera=0 and suma3=1 and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma21,
        sum(CASE WHEN (fuera=1 and suma3=1 and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma22,
        sum(CASE WHEN (fuera=0 and suma3=1 and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma23,
        sum(CASE WHEN (fuera=1 and suma3=1 and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma24,
        sum(CASE WHEN (fuera=0 and suma3=1 and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma25,
        sum(CASE WHEN (fuera=1 and suma3=1 and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma26,
        sum(CASE WHEN (fuera=0 and suma3=1 and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma27,
        sum(CASE WHEN (fuera=1 and suma3=1 and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma28,
        sum(CASE WHEN (fuera=0 and suma3=1 and (edad between 50 and 60)) THEN 1 ELSE 0 END)::int as suma29,
        sum(CASE WHEN (fuera=1 and suma3=1 and (edad between 50 and 60)) THEN 1 ELSE 0 END)::int as suma30,

        sum(CASE WHEN (fuera=0 and suma4=1 and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma31,
        sum(CASE WHEN (fuera=1 and suma4=1 and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma32,
        sum(CASE WHEN (fuera=0 and suma4=1 and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma33,
        sum(CASE WHEN (fuera=1 and suma4=1 and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma34,
        sum(CASE WHEN (fuera=0 and suma4=1 and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma35,
        sum(CASE WHEN (fuera=1 and suma4=1 and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma36,
        sum(CASE WHEN (fuera=0 and suma4=1 and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma37,
        sum(CASE WHEN (fuera=1 and suma4=1 and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma38,
        sum(CASE WHEN (fuera=0 and suma4=1 and (edad between 50 and 60)) THEN 1 ELSE 0 END)::int as suma39,
        sum(CASE WHEN (fuera=1 and suma4=1 and (edad between 50 and 60)) THEN 1 ELSE 0 END)::int as suma40,
        
        sum(CASE WHEN (fuera=0 and suma1=1 ) THEN 1 ELSE 0 END)::int as suma41,
        sum(CASE WHEN (fuera=1 and suma1=1 ) THEN 1 ELSE 0 END)::int as suma42,
        sum(CASE WHEN (fuera=0 and suma2=1 ) THEN 1 ELSE 0 END)::int as suma43,
        sum(CASE WHEN (fuera=1 and suma2=1 ) THEN 1 ELSE 0 END)::int as suma44,
        sum(CASE WHEN (fuera=0 and suma3=1 ) THEN 1 ELSE 0 END)::int as suma45,
        sum(CASE WHEN (fuera=1 and suma3=1 ) THEN 1 ELSE 0 END)::int as suma46,
        sum(CASE WHEN (fuera=0 and suma4=1 ) THEN 1 ELSE 0 END)::int as suma47,
        sum(CASE WHEN (fuera=1 and suma4=1 ) THEN 1 ELSE 0 END)::int as suma48,
        sum(CASE WHEN (suma1=1 ) THEN 1 ELSE 0 END)::int as suma49,
        sum(CASE WHEN (suma2=1 ) THEN 1 ELSE 0 END)::int as suma50,
        sum(CASE WHEN (suma3=1 ) THEN 1 ELSE 0 END)::int as suma51,
        sum(CASE WHEN (suma4=1 ) THEN 1 ELSE 0 END)::int as suma52,
        sum(CASE WHEN (suma4=1 ) THEN 1 ELSE 0 END)::int as suma53,
        sum(CASE WHEN (suma4=1 ) THEN 1 ELSE 0 END)::int as suma54,
        sum(CASE WHEN (suma4=1 ) THEN 1 ELSE 0 END)::int as suma55,
        sum(CASE WHEN (suma4=1 ) THEN 1 ELSE 0 END)::int as suma56,
        sum(CASE WHEN (suma4=1 ) THEN 1 ELSE 0 END)::int as suma57,
        sum(CASE WHEN (suma4=1 ) THEN 1 ELSE 0 END)::int as suma58,
        sum(CASE WHEN (suma4=1 ) THEN 1 ELSE 0 END)::int as suma59,
        sum(CASE WHEN (suma4=1 ) THEN 1 ELSE 0 END)::int as suma60
 
        from cuaderno2 
        join historiales using (id_historial)
        join pacientes using (id_paciente)
        where historiales.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) 
    </select>
    
    <select id="getVerCuaderno3Prod1" resultMap="informeProduccionPrenatal">
        select  sum(CASE WHEN (diu=1 and tipoconsulta='N' and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma1,
        sum(CASE WHEN (diu=1 and tipoconsulta='N' and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma2,
        sum(CASE WHEN (diu=1 and tipoconsulta='N' and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma3,
        sum(CASE WHEN (diu=1 and tipoconsulta='N' and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma4,
        sum(CASE WHEN (diu=1 and tipoconsulta='N' and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma5,
        sum(CASE WHEN (diu=1 and tipoconsulta='C' and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma6,
        sum(CASE WHEN (diu=1 and tipoconsulta='C' and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma7,
        sum(CASE WHEN (diu=1 and tipoconsulta='C' and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma8,
        sum(CASE WHEN (diu=1 and tipoconsulta='C' and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma9,
        sum(CASE WHEN (diu=1 and tipoconsulta='C' and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma10,
        
        sum(CASE WHEN (inyectable=1 and tipoconsulta='N' and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma11,
        sum(CASE WHEN (inyectable=1 and tipoconsulta='N' and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma12,
        sum(CASE WHEN (inyectable=1 and tipoconsulta='N' and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma13,
        sum(CASE WHEN (inyectable=1 and tipoconsulta='N' and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma14,
        sum(CASE WHEN (inyectable=1 and tipoconsulta='N' and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma15,
        sum(CASE WHEN (inyectable=1 and tipoconsulta='C' and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma16,
        sum(CASE WHEN (inyectable=1 and tipoconsulta='C' and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma17,
        sum(CASE WHEN (inyectable=1 and tipoconsulta='C' and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma18,
        sum(CASE WHEN (inyectable=1 and tipoconsulta='C' and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma19,
        sum(CASE WHEN (inyectable=1 and tipoconsulta='C' and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma20,
        
        sum(CASE WHEN (condon=1 and tipoconsulta='N' and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma21,
        sum(CASE WHEN (condon=1 and tipoconsulta='N' and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma22,
        sum(CASE WHEN (condon=1 and tipoconsulta='N' and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma23,
        sum(CASE WHEN (condon=1 and tipoconsulta='N' and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma24,
        sum(CASE WHEN (condon=1 and tipoconsulta='N' and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma25,
        sum(CASE WHEN (condon=1 and tipoconsulta='C' and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma26,
        sum(CASE WHEN (condon=1 and tipoconsulta='C' and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma27,
        sum(CASE WHEN (condon=1 and tipoconsulta='C' and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma28,
        sum(CASE WHEN (condon=1 and tipoconsulta='C' and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma29,
        sum(CASE WHEN (condon=1 and tipoconsulta='C' and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma30,
        
        sum(CASE WHEN (otras=5 and tipoconsulta='N' and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma31,
        sum(CASE WHEN (otras=5 and tipoconsulta='N' and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma32,
        sum(CASE WHEN (otras=5 and tipoconsulta='N' and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma33,
        sum(CASE WHEN (otras=5 and tipoconsulta='N' and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma34,
        sum(CASE WHEN (otras=5 and tipoconsulta='N' and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma35,
        sum(CASE WHEN (otras=5 and tipoconsulta='C' and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma36,
        sum(CASE WHEN (otras=5 and tipoconsulta='C' and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma37,
        sum(CASE WHEN (otras=5 and tipoconsulta='C' and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma38,
        sum(CASE WHEN (otras=5 and tipoconsulta='C' and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma39,
        sum(CASE WHEN (otras=5 and tipoconsulta='C' and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma40,
        
        sum(CASE WHEN ((otras=5 or condon=1) and (edad between 01 and 14)) THEN insumos ELSE 0 END)::int as suma41,
        sum(CASE WHEN ((otras=5 or condon=1) and (edad between 15 and 19)) THEN insumos ELSE 0 END)::int as suma42,
        sum(CASE WHEN ((otras=5 or condon=1) and (edad between 20 and 34)) THEN insumos ELSE 0 END)::int as suma43,
        sum(CASE WHEN ((otras=5 or condon=1) and (edad between 35 and 49)) THEN insumos ELSE 0 END)::int as suma44,
        sum(CASE WHEN ((otras=5 or condon=1) and (edad between 50 and 99)) THEN insumos ELSE 0 END)::int as suma45,
        
        sum(CASE WHEN (pildora=1 and tipoconsulta='N' and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma46,
        sum(CASE WHEN (pildora=1 and tipoconsulta='N' and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma47,
        sum(CASE WHEN (pildora=1 and tipoconsulta='N' and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma48,
        sum(CASE WHEN (pildora=1 and tipoconsulta='N' and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma49,
        sum(CASE WHEN (pildora=1 and tipoconsulta='N' and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma50,
        
        sum(CASE WHEN (pildora=1 and tipoconsulta='C' and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma51,
        sum(CASE WHEN (pildora=1 and tipoconsulta='C' and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma52,
        sum(CASE WHEN (pildora=1 and tipoconsulta='C' and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma53,
        sum(CASE WHEN (pildora=1 and tipoconsulta='C' and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma54,
        sum(CASE WHEN (pildora=1 and tipoconsulta='C' and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma55,
        
        sum(CASE WHEN (pildora=1 and (tipoconsulta='N' or tipoconsulta='C') and (edad between 01 and 14)) THEN insumos ELSE 0 END)::int as suma56,
        sum(CASE WHEN (pildora=1 and (tipoconsulta='N' or tipoconsulta='C') and (edad between 15 and 19)) THEN insumos ELSE 0 END)::int as suma57,
        sum(CASE WHEN (pildora=1 and (tipoconsulta='N' or tipoconsulta='C') and (edad between 20 and 34)) THEN insumos ELSE 0 END)::int as suma58,
        sum(CASE WHEN (pildora=1 and (tipoconsulta='N' or tipoconsulta='C') and (edad between 35 and 49)) THEN insumos ELSE 0 END)::int as suma59,
        sum(CASE WHEN (pildora=1 and (tipoconsulta='N' or tipoconsulta='C') and (edad between 50 and 99)) THEN insumos ELSE 0 END)::int as suma60
        
        from cuaderno3 
        join historiales using (id_historial)
        join pacientes using (id_paciente) 
        where  historiales.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) 
    </select>
    
    <select id="getVerCuaderno3Prod2" resultMap="informeProduccionPrenatal">
        select  sum(CASE WHEN (otras=6 and tipoconsulta='N' and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma1,
        sum(CASE WHEN (otras=6 and tipoconsulta='N' and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma2,
        sum(CASE WHEN (otras=6 and tipoconsulta='N' and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma3,
        sum(CASE WHEN (otras=6 and tipoconsulta='N' and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma4,
        sum(CASE WHEN (otras=6 and tipoconsulta='N' and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma5,
        sum(CASE WHEN (otras=6 and tipoconsulta='C' and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma6,
        sum(CASE WHEN (otras=6 and tipoconsulta='C' and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma7,
        sum(CASE WHEN (otras=6 and tipoconsulta='C' and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma8,
        sum(CASE WHEN (otras=6 and tipoconsulta='C' and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma9,
        sum(CASE WHEN (otras=6 and tipoconsulta='C' and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma10,

        sum(CASE WHEN (mnatural>0 and tipoconsulta='N' and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma11,
        sum(CASE WHEN (mnatural>0 and tipoconsulta='N' and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma12,
        sum(CASE WHEN (mnatural>0 and tipoconsulta='N' and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma13,
        sum(CASE WHEN (mnatural>0 and tipoconsulta='N' and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma14,
        sum(CASE WHEN (mnatural>0 and tipoconsulta='N' and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma15,
        sum(CASE WHEN (mnatural>0 and tipoconsulta='C' and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma16,
        sum(CASE WHEN (mnatural>0 and tipoconsulta='C' and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma17,
        sum(CASE WHEN (mnatural>0 and tipoconsulta='C' and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma18,
        sum(CASE WHEN (mnatural>0 and tipoconsulta='C' and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma19,
        sum(CASE WHEN (mnatural>0 and tipoconsulta='C' and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma20,

        sum(CASE WHEN (aqv=1 and id_tipo_sexo=1 and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma21,
        sum(CASE WHEN (aqv=1 and id_tipo_sexo=1 and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma22,
        sum(CASE WHEN (aqv=1 and id_tipo_sexo=1 and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma23,
        sum(CASE WHEN (aqv=1 and id_tipo_sexo=1 and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma24,
        sum(CASE WHEN (aqv=1 and id_tipo_sexo=1 and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma25,
        sum(CASE WHEN (aqv=1 and id_tipo_sexo=2 and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma26,
        sum(CASE WHEN (aqv=1 and id_tipo_sexo=2 and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma27,
        sum(CASE WHEN (aqv=1 and id_tipo_sexo=2 and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma28,
        sum(CASE WHEN (aqv=1 and id_tipo_sexo=2 and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma29,
        sum(CASE WHEN (aqv=1 and id_tipo_sexo=2 and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma30,
        
        sum(CASE WHEN (pildora=2 and tipoconsulta='N' and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma31,
        sum(CASE WHEN (pildora=2 and tipoconsulta='N' and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma32,
        sum(CASE WHEN (pildora=2 and tipoconsulta='N' and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma33,
        sum(CASE WHEN (pildora=2 and tipoconsulta='N' and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma34,
        sum(CASE WHEN (pildora=2 and tipoconsulta='N' and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma35,

        sum(CASE WHEN (orientacion=1 and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma36,
        sum(CASE WHEN (orientacion=1 and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma37,
        sum(CASE WHEN (orientacion=1 and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma38,
        sum(CASE WHEN (orientacion=1 and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma39,
        sum(CASE WHEN (orientacion=1 and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma40,
        sum(CASE WHEN (pap=1 and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma41,
        sum(CASE WHEN (pap=1 and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma42,
        sum(CASE WHEN (pap=1 and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma43,
        sum(CASE WHEN (pap=1 and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma44,
        sum(CASE WHEN (pap=1 and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma45,

        sum(CASE WHEN (res_pap=2 and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma46,
        sum(CASE WHEN (res_pap=2 and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma47,
        sum(CASE WHEN (res_pap=2 and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma48,
        sum(CASE WHEN (res_pap=2 and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma49,
        sum(CASE WHEN (res_pap=2 and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma50,
        sum(CASE WHEN (ivaa=1 and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma51,
        sum(CASE WHEN (ivaa=1 and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma52,
        sum(CASE WHEN (ivaa=1 and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma53,
        sum(CASE WHEN (ivaa=1 and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma54,
        sum(CASE WHEN (ivaa=1 and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma55,
        sum(CASE WHEN (res_ivaa=2 and (edad between 01 and 14)) THEN 1 ELSE 0 END)::int as suma56,
        sum(CASE WHEN (res_ivaa=2 and (edad between 15 and 19)) THEN 1 ELSE 0 END)::int as suma57,
        sum(CASE WHEN (res_ivaa=2 and (edad between 20 and 34)) THEN 1 ELSE 0 END)::int as suma58,
        sum(CASE WHEN (res_ivaa=2 and (edad between 35 and 49)) THEN 1 ELSE 0 END)::int as suma59,
        sum(CASE WHEN (res_ivaa=2 and (edad between 50 and 99)) THEN 1 ELSE 0 END)::int as suma60

        from cuaderno3 
        join historiales using (id_historial)
        join pacientes using (id_paciente) 
        where  historiales.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) 
     
    </select>
    
    <resultMap id="informeProduccionG1" type="Cuadernos">
        <result property="tipo"                column="tipo"/>
        <result property="tipoconsulta"        column="tipoconsulta"/>
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
    </resultMap>
  
    <select id="getReporteProduccionG1" resultMap="informeProduccionG1">
        select consultorio as tipo,(p.nombres||' '||p.paterno||' '||p.materno) as tipoconsulta,
        sum(CASE WHEN ( a.id_tipo_sexo=1 ) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN ( a.id_tipo_sexo=2 ) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN ( a.id_tipo_sexo=2 or a.id_tipo_sexo=1 ) THEN 1 ELSE 0 END) as suma3
        from historiales h
        join consultorios c using(id_consultorio)
        join pacientes a using(id_paciente)
        join personas p using(id_persona)
        where h.cod_esta=#{cod_esta} and (fecha::date between #{fecha_ini} and #{fecha_fin})  and urgencias=1
        group by h.id_consultorio,consultorio,id_persona,p.nombres,p.paterno,p.materno 
        order by suma3 desc limit 8;
    </select>
    
    <resultMap id="informeProduccion" type="Cuadernos">
        <result property="tipo"                column="tipo"/>
        <result property="tipoconsulta"        column="tipoconsulta"/>
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma6"               column="suma6"/>
        <result property="suma7"               column="suma7"/>
        <result property="suma8"               column="suma8"/>
        <result property="suma9"               column="suma9"/>
        <result property="suma10"              column="suma10"/>
        <result property="suma11"              column="suma11"/>
        <result property="suma12"              column="suma12"/>
        <result property="suma13"              column="suma13"/>
        <result property="suma14"              column="suma14"/>
        <result property="suma15"              column="suma15"/>
        <result property="suma16"              column="suma16"/>
        <result property="suma17"              column="suma17"/>
        <result property="suma18"              column="suma18"/>
        <result property="suma19"              column="suma19"/>
        <result property="suma20"              column="suma20"/>
        <result property="suma21"              column="suma21"/>
        <result property="suma22"              column="suma22"/>
        <result property="suma23"              column="suma23"/>
        <result property="suma24"              column="suma24"/>
        <result property="suma25"              column="suma25"/>
        <result property="suma26"              column="suma26"/>
        <result property="suma27"              column="suma27"/>
        <result property="suma28"              column="suma28"/>
        <result property="suma29"              column="suma29"/>
        <result property="suma30"              column="suma30"/>
        <result property="suma31"              column="suma31"/>
        <result property="suma32"              column="suma32"/>
        <result property="suma33"              column="suma33"/>
        <result property="suma34"              column="suma34"/>
        <result property="suma35"              column="suma35"/>
        <result property="suma36"              column="suma36"/>
        <result property="suma37"              column="suma37"/>
        <result property="suma38"              column="suma38"/>
        <result property="suma39"              column="suma39"/>
        <result property="suma40"              column="suma40"/>
        <result property="suma41"              column="suma41"/>
        <result property="suma42"              column="suma42"/>
        <result property="suma43"              column="suma43"/>
        <result property="cod_esta"            column="cod_esta"/>
    </resultMap>
  
    <select id="getReporteProduccion" resultMap="informeProduccion">
        select tipo, tipoconsulta, suma1, suma2, suma3, suma4, suma5, suma6, 
        suma7, suma8, suma9, suma10, suma11, suma12, suma13, suma14, 
        suma15, suma16, suma17, suma18, suma19, suma20, suma21, suma22, 
        suma23, suma24, suma25, suma26, suma27, suma28, suma29, suma30, 
        suma31, suma32, suma33, suma34, suma35, suma36, suma37, suma38, 
        suma39, suma40,0 as suma41,0 as suma42,0 as suma43, cod_esta 
        from reporte_produccion where cod_esta=#{cod_esta} order by tipo; 
    </select>
  
    <select id="getReporteProduccion2" resultMap="informeProduccion">
        select consultorio as tipo,(p.nombres||' '||p.paterno||' '||p.materno) as tipoconsulta,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma5,    
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma6, 
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma7,    
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma8, 
                       
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 1 and 4)) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 1 and 4)) THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 1 and 4)) THEN 1 ELSE 0 END) as suma11,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 1 and 4)) THEN 1 ELSE 0 END) as suma12,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 5 and 9)) THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 5 and 9)) THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 5 and 9)) THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 5 and 9)) THEN 1 ELSE 0 END) as suma16,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 10 and 14)) THEN 1 ELSE 0 END) as suma17,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 10 and 14)) THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 10 and 14)) THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 10 and 14)) THEN 1 ELSE 0 END) as suma20,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma21,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma22,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma23,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma24,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 20 and 39)) THEN 1 ELSE 0 END) as suma25,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 20 and 39)) THEN 1 ELSE 0 END) as suma26,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 20 and 39)) THEN 1 ELSE 0 END) as suma27,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 20 and 39)) THEN 1 ELSE 0 END) as suma28,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 40 and 49)) THEN 1 ELSE 0 END) as suma29,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 40 and 49)) THEN 1 ELSE 0 END) as suma30,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 40 and 49)) THEN 1 ELSE 0 END) as suma31,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 40 and 49)) THEN 1 ELSE 0 END) as suma32,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 50 and 59)) THEN 1 ELSE 0 END) as suma33,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 50 and 9)) THEN 1 ELSE 0 END) as suma34,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 50 and 59)) THEN 1 ELSE 0 END) as suma35,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 50 and 9)) THEN 1 ELSE 0 END) as suma36,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (edad between 60 and 120)) THEN 1 ELSE 0 END) as suma37,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (edad between 60 and 120)) THEN 1 ELSE 0 END) as suma38,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (edad between 60 and 120)) THEN 1 ELSE 0 END) as suma39,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (edad between 60 and 120)) THEN 1 ELSE 0 END) as suma40,
        sum(CASE WHEN (a.id_tipo_sexo=2) THEN 1 ELSE 0 END) as suma41, 
        sum(CASE WHEN (a.id_tipo_sexo=1) THEN 1 ELSE 0 END) as suma42,
        sum(CASE WHEN (repetida='R' or repetida='N') THEN 1 ELSE 0 END) as suma43,
        h.cod_esta
        
        from historiales h
        join consultorios c using(id_consultorio)
        join pacientes a using(id_paciente)
        join personas p using(id_persona)
        where h.cod_esta=#{cod_esta} and (fecha::timestamp without time zone between #{fecha_ini} and #{fecha_fin})  and id_especialidad>2
        group by h.id_consultorio,consultorio,id_persona,p.nombres,p.paterno,p.materno, h.cod_esta order by suma43 desc limit 15;
    </select>
    
    <resultMap id="informeSNIS" type="Cuadernos">
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma6"               column="suma6"/>
        <result property="suma7"               column="suma7"/>
        <result property="suma8"               column="suma8"/>
        <result property="suma9"               column="suma9"/>
        <result property="suma10"              column="suma10"/>
        <result property="suma11"              column="suma11"/>
        <result property="suma12"              column="suma12"/>
        <result property="suma13"              column="suma13"/>
        <result property="suma14"              column="suma14"/>
        <result property="suma15"              column="suma15"/>
        <result property="suma16"              column="suma16"/>
        <result property="suma17"              column="suma17"/>
        <result property="suma18"              column="suma18"/>
        <result property="suma19"              column="suma19"/>
        <result property="suma20"              column="suma20"/>
        <result property="suma21"              column="suma21"/>
        <result property="suma22"              column="suma22"/>
        <result property="suma23"              column="suma23"/>
        <result property="suma24"              column="suma24"/>
        <result property="suma25"              column="suma25"/>
        <result property="suma26"              column="suma26"/>
        <result property="suma27"              column="suma27"/>
        <result property="suma28"              column="suma28"/>
    </resultMap>    
    
    <select id="getReporteSNISConsulta" resultMap="informeSNIS">
        select sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int=0 
        and extract(month from age( h.fecha,fec_nacimiento))::int between 0 and 5 and tipoconsulta='N' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma1,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int=0 
        and extract(month from age( h.fecha,fec_nacimiento))::int between 0 and 5 and tipoconsulta='N' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma2,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int=0 
        and extract(month from age( h.fecha,fec_nacimiento))::int between 0 and 5 and tipoconsulta='R' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma3,                   
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int=0 
        and extract(month from age( h.fecha,fec_nacimiento))::int between 0 and 5 and tipoconsulta='R' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma4,
                  
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int=0 
        and extract(month from age( h.fecha,fec_nacimiento))::int between 6 and 11 and tipoconsulta='N' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma5,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int=0 
        and extract(month from age( h.fecha,fec_nacimiento))::int between 6 and 11 and tipoconsulta='N' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma6,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int=0 
        and extract(month from age( h.fecha,fec_nacimiento))::int between 6 and 11 and tipoconsulta='R' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma7,                   
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int=0 
        and extract(month from age( h.fecha,fec_nacimiento))::int between 6 and 11 and tipoconsulta='R' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma8,

        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 1 and 4 
        and tipoconsulta='N' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma9,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 1 and 4 
        and tipoconsulta='N' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma10,   
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 1 and 4 
        and tipoconsulta='R' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma11,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 1 and 4 
        and tipoconsulta='R' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma12,
        0 as suma13,0 as suma14,0 as suma15,0 as suma16,0 as suma17,0 as suma18,0 as suma19,0 as suma20,0 as suma21,0 as suma22,
        0 as suma23,0 as suma24,0 as suma25,0 as suma26,0 as suma27,0 as suma28                                                      
        from historiales h
        join cuaderno4 c using(id_historial)
        join pacientes a using(id_paciente)
        where h.cod_esta=#{cod_esta} and seleccion=1 and (fecha::timestamp without time zone between #{fecha_ini} and #{fecha_fin} ) 
    </select>

    <select id="getReporteSNISConsulta2" resultMap="informeSNIS">
        select sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 5 and 9 
        and tipoconsulta='N' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma1,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 5 and 9 
        and tipoconsulta='N' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma2,   
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 5 and 9 
        and tipoconsulta='R' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma3,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 5 and 9 
        and tipoconsulta='R' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma4,

        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 10 and 14 
        and tipoconsulta='N' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma5,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 10 and 14 
        and tipoconsulta='N' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma6,   
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 10 and 14 
        and tipoconsulta='R' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma7,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 10 and 14 
        and tipoconsulta='R' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma8,

        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 15 and 19 
        and tipoconsulta='N' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma9,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 15 and 19 
        and tipoconsulta='N' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma10,   
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 15 and 19 
        and tipoconsulta='R' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma11,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 15 and 19 
        and tipoconsulta='R' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma12,

        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 20 and 39 
        and tipoconsulta='N' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma13,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 20 and 39 
        and tipoconsulta='N' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma14,   
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 20 and 39 
        and tipoconsulta='R' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma15,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 20 and 39 
        and tipoconsulta='R' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma16,

        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 40 and 49 
        and tipoconsulta='N' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma17,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 40 and 49 
        and tipoconsulta='N' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma18,   
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 40 and 49 
        and tipoconsulta='R' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma19,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 40 and 49 
        and tipoconsulta='R' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma20,

        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 50 and 59 
        and tipoconsulta='N' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma21,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 50 and 59 
        and tipoconsulta='N' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma22,   
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 50 and 59 
        and tipoconsulta='R' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma23,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 50 and 59 
        and tipoconsulta='R' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma24,                                                                                                             

        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 60 and 120 
        and tipoconsulta='N' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma25,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 60 and 120 
        and tipoconsulta='N' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma26,   
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 60 and 120 
        and tipoconsulta='R' and id_tipo_sexo=2) THEN 1 ELSE 0 END)::int as suma27,
        sum(CASE WHEN (extract(year from age( h.fecha,fec_nacimiento))::int between 60 and 120 
        and tipoconsulta='R' and id_tipo_sexo=1) THEN 1 ELSE 0 END)::int as suma28 
        from historiales h
        join cuaderno1 c using(id_historial)
        join pacientes a using(id_paciente)
        where h.cod_esta=#{cod_esta} and (fecha::timestamp without time zone between #{fecha_ini} and #{fecha_fin})  
    </select>
        
    <resultMap id="informeDental" type="Cuadernos">
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma6"               column="suma6"/>
        <result property="suma7"               column="suma7"/>
        <result property="suma8"               column="suma8"/>
        <result property="suma9"               column="suma9"/>
        <result property="suma10"              column="suma10"/>
        <result property="suma11"              column="suma11"/>
        <result property="suma12"              column="suma12"/>
        <result property="suma13"              column="suma13"/>
        <result property="suma14"              column="suma14"/>
        <result property="suma15"              column="suma15"/>
        <result property="suma16"              column="suma16"/>
        <result property="suma17"              column="suma17"/>
        <result property="suma18"              column="suma18"/>
        <result property="suma19"              column="suma19"/>
        <result property="suma20"              column="suma20"/>
        <result property="suma21"              column="suma21"/>
        <result property="suma22"              column="suma22"/>
        <result property="suma23"              column="suma23"/>
        <result property="suma24"              column="suma24"/>
        <result property="suma25"              column="suma25"/>
        <result property="suma26"              column="suma26"/>
        <result property="suma27"              column="suma27"/>
        <result property="suma28"              column="suma28"/>
        <result property="suma29"              column="suma29"/>
        <result property="suma30"              column="suma30"/>
        <result property="suma31"              column="suma31"/>
        <result property="suma32"              column="suma32"/>
        <result property="suma33"              column="suma33"/>
        <result property="suma34"              column="suma34"/>
        <result property="suma35"              column="suma35"/>
        <result property="suma36"              column="suma36"/>
        <result property="suma37"              column="suma37"/>
        <result property="suma38"              column="suma38"/>
        <result property="suma39"              column="suma39"/>
        <result property="suma40"              column="suma40"/>
        <result property="suma41"              column="suma41"/>
        <result property="suma42"              column="suma42"/>
        <result property="suma43"              column="suma43"/>
        <result property="suma44"              column="suma44"/>
        <result property="suma45"              column="suma45"/>
        <result property="suma46"              column="suma46"/>
        <result property="suma47"              column="suma47"/>
        <result property="suma48"              column="suma48"/>
        <result property="suma49"              column="suma49"/>
        <result property="suma50"              column="suma50"/>
        <result property="suma51"              column="suma51"/>
        <result property="suma52"              column="suma52"/>
        <result property="suma53"              column="suma53"/>
        <result property="suma60"              column="suma60"/>
        <result property="speso"               column="speso"/>
        <result property="fuma"                column="fuma"/> 
        <result property="alcohol"             column="alcohol"/>
        <result property="violencia"           column="violencia"/>
        <result property="auto"                column="auto"/>
        <result property="urinaria"            column="urinaria"/>
        <result property="sistemica"           column="sistemica"/>
        <result property="arterial"            column="arterial"/>
        <result property="diabetes"            column="diabetes"/>
        <result property="glome"               column="glome"/>
        <result property="tracto"              column="tracto"/>
        <result property="lupus"               column="lupus"/>
        <result property="litiasis"            column="litiasis"/>
        <result property="nooplasia"           column="nooplasia"/>
        <result property="nefro"               column="nefro"/>
        <result property="disli"               column="disli"/>
        <result property="frenal"              column="frenal"/>
        <result property="bajopeso"            column="bajopeso"/>
        <result property="prematuro"           column="prematuro"/>
        <result property="eritro"              column="eritro"/>
        <result property="renal"               column="renal"/>
        <result property="tuberculo"           column="tuberculo"/>
        <result property="otro"                column="otro"/>
        <result property="cardio"              column="cardio"/>
        <result property="reuma"               column="reuma"/>
        <result property="cancer"              column="cancer"/>
        <result property="cancero"             column="cancero"/>
        <result property="depre"               column="depre"/>
        <result property="epilepsia"           column="epilepsia"/>
        <result property="psico"               column="psico"/>
        <result property="discapa"             column="discapa"/>
        <result property="aqv"                 column="aqv"/>
        <result property="bcg"                 column="bcg"/>
        <result property="condon"              column="condon"/>
        <result property="controlpos"          column="controlpos"/>
        <result property="otras"               column="otras"/>
        <result property="cirugia"             column="cirugia"/>
        <result property="exodoncia"           column="exodoncia"/>
        <result property="restauracion"        column="restauracion"/>
        <result property="periodoncia"         column="periodoncia"/>
        <result property="rayosx"              column="rayosx"/>
        <result property="tabletas"            column="tabletas"/>
        <result property="sfembarazada"        column="sfembarazada"/>
        <result property="sfpuerpera"          column="sfpuerpera"/>
        <result property="vitamina"            column="vitamina"/>
        <result property="semanas"             column="semanas"/>
        <result property="parto"               column="parto"/>
        <result property="sexo"                column="sexo"/>
        <result property="imc"                 column="imc"/>
        <result property="nembarazo"           column="nembarazo"/>
        <result property="eclam"               column="eclam"/>
        <result property="aborto"              column="aborto"/>
        <result property="hemo"                column="hemo"/>
        <result property="anestesia"           column="anestesia"/>
        <result property="controlpos"          column="controlpos"/>
        <result property="pap"                 column="pap"/>
        <result property="insumos"             column="insumos"/>
    </resultMap>
        
    <select id="getReporteDental" resultMap="informeDental">
        SELECT sum(CASE WHEN (primera=1 and id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma5,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma6,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma7,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma8,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=2 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=1 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=1 and embarazada =1 and (edad between 00 and 99)) THEN 1 ELSE 0 END) as suma11,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=1 and embarazada =2 and (edad between 00 and 99)) THEN 1 ELSE 0 END) as suma12,
        <!--nuevas-->
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma16,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma17,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma20,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=2 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as suma21,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=1 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as suma22,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=1 and embarazada =1 and (edad between 00 and 99)) THEN 1 ELSE 0 END) as suma23,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=1 and embarazada =2 and (edad between 00 and 99)) THEN 1 ELSE 0 END) as suma24,
        <!--repetidas-->
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma25,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma26,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma27,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma28,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma29,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma30,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma31,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma32,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=2 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as suma33,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=1 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as suma34,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=1 and embarazada =1 and (edad between 00 and 99)) THEN 1 ELSE 0 END) as suma35,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=1 and embarazada =2 and (edad between 00 and 99)) THEN 1 ELSE 0 END) as suma36,
        <!--PREVENTIVAS-->
        sum(CASE WHEN (preventiva=1 and id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma37,
        sum(CASE WHEN (preventiva=1 and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma38,
        sum(CASE WHEN (preventiva=1 and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma39,
        sum(CASE WHEN (preventiva=1 and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma40,
        sum(CASE WHEN (preventiva=1 and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma41,
        sum(CASE WHEN (preventiva=1 and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma42,
        sum(CASE WHEN (preventiva=1 and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma43,
        sum(CASE WHEN (preventiva=1 and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma44,
        <!--PREVENTIVAS aplcacion flour-->
        sum(CASE WHEN (preventiva=1 and tipo ='A' and  id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma45,
        sum(CASE WHEN (preventiva=1 and tipo ='A' and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma46,
        sum(CASE WHEN (preventiva=1 and tipo ='A' and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma47,
        sum(CASE WHEN (preventiva=1 and tipo ='A' and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma48,
        sum(CASE WHEN (preventiva=1 and tipo ='A' and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma49,
        sum(CASE WHEN (preventiva=1 and tipo ='A' and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma50,
        sum(CASE WHEN (preventiva=1 and tipo ='A' and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma51,
        sum(CASE WHEN (preventiva=1 and tipo ='A' and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma52,
        <!--RESTAURACONES-->
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma53,
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as speso,
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as fuma,
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as alcohol,
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as violencia,
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as auto,
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as urinaria,
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as sistemica,
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=2 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as arterial,
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=1 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as diabetes,
        <!--ENDODONCIA-->
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as glome,
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as tracto,
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as lupus,
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as litiasis,
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as nooplasia,
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as nefro,
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as disli,
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as frenal,
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=2 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as bajopeso,
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=1 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as prematuro,
        <!--PRERIODONCIA-->
        sum(CASE WHEN (periodoncia=1 and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as eritro,
        sum(CASE WHEN (periodoncia=1 and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as renal,
        sum(CASE WHEN (periodoncia=1 and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as tuberculo,
        sum(CASE WHEN (periodoncia=1 and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as otro,
        sum(CASE WHEN (periodoncia=1 and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as cardio,
        sum(CASE WHEN (periodoncia=1 and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as reuma,
        sum(CASE WHEN (periodoncia=1 and id_tipo_sexo=2 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as cancer,
        sum(CASE WHEN (periodoncia=1 and id_tipo_sexo=1 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as cancero,
        <!--CIRUGIA BUCAL MENOR-->
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as depre,
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as epilepsia,
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as psico,
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as discapa,
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as aqv,
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as bcg,
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as condon,
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as controlpos,
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=2 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as otras,
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=1 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as cirugia,
        <!--EXODONCIA-->
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as exodoncia,
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as restauracion,
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as periodoncia,
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as rayosx,
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as tabletas,
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as sfembarazada,
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as sfpuerpera,
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as vitamina,
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=2 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as semanas,
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=1 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as parto,
        <!--CIRUGIA BUCOMAXILOFACIAL-->
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as sexo,
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as imc,
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as nembarazo,
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as eclam,
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as aborto,
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as hemo,
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as anestesia,
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma60,
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=2 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as pap,
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=1 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as insumos

        from historiales h
        join cuaderno7 c using(id_historial)
        join pacientes a using(id_paciente)
        where h.cod_esta=#{cod_esta} and ( h.fecha::timestamp without time zone between date(#{fecha_ini}) and date(#{fecha_fin} ) ) and c.id_persona=#{id_persona}
    </select>
    
    <select id="getReporteDentalT" resultMap="informeDental">
        SELECT sum(CASE WHEN (primera=1 and id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma5,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma6,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma7,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma8,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=2 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=1 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=1 and embarazada =1 and (edad between 00 and 99)) THEN 1 ELSE 0 END) as suma11,
        sum(CASE WHEN (primera=1 and id_tipo_sexo=1 and embarazada =2 and (edad between 00 and 99)) THEN 1 ELSE 0 END) as suma12,
        <!--nuevas-->
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma16,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma17,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma20,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=2 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as suma21,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=1 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as suma22,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=1 and embarazada =1 and (edad between 00 and 99)) THEN 1 ELSE 0 END) as suma23,
        sum(CASE WHEN (tipoconsulta='N' and id_tipo_sexo=1 and embarazada =2 and (edad between 00 and 99)) THEN 1 ELSE 0 END) as suma24,
        <!--repetidas-->
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma25,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma26,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma27,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma28,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma29,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma30,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma31,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma32,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=2 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as suma33,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=1 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as suma34,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=1 and embarazada =1 and (edad between 00 and 99)) THEN 1 ELSE 0 END) as suma35,
        sum(CASE WHEN (tipoconsulta='R' and id_tipo_sexo=1 and embarazada =2 and (edad between 00 and 99)) THEN 1 ELSE 0 END) as suma36,
        <!--PREVENTIVAS-->
        sum(CASE WHEN (preventiva=1 and id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma37,
        sum(CASE WHEN (preventiva=1 and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma38,
        sum(CASE WHEN (preventiva=1 and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma39,
        sum(CASE WHEN (preventiva=1 and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma40,
        sum(CASE WHEN (preventiva=1 and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma41,
        sum(CASE WHEN (preventiva=1 and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma42,
        sum(CASE WHEN (preventiva=1 and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma43,
        sum(CASE WHEN (preventiva=1 and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma44,
        <!--PREVENTIVAS aplcacion flour-->
        sum(CASE WHEN (preventiva=1 and tipo ='A' and  id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma45,
        sum(CASE WHEN (preventiva=1 and tipo ='A' and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma46,
        sum(CASE WHEN (preventiva=1 and tipo ='A' and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma47,
        sum(CASE WHEN (preventiva=1 and tipo ='A' and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as suma48,
        sum(CASE WHEN (preventiva=1 and tipo ='A' and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma49,
        sum(CASE WHEN (preventiva=1 and tipo ='A' and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as suma50,
        sum(CASE WHEN (preventiva=1 and tipo ='A' and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma51,
        sum(CASE WHEN (preventiva=1 and tipo ='A' and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma52,
        <!--RESTAURACONES-->
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as suma53,
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as speso,
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as fuma,
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as alcohol,
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as violencia,
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as auto,
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as urinaria,
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as sistemica,
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=2 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as arterial,
        sum(CASE WHEN (restauracion=1 and id_tipo_sexo=1 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as diabetes,
        <!--ENDODONCIA-->
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as glome,
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as tracto,
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as lupus,
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as litiasis,
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as nooplasia,
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as nefro,
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as disli,
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as frenal,
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=2 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as bajopeso,
        sum(CASE WHEN (endodoncia=1 and (tipo ='A' or tipo ='B') and id_tipo_sexo=1 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as prematuro,
        <!--PRERIODONCIA-->
        sum(CASE WHEN (periodoncia=1 and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as eritro,
        sum(CASE WHEN (periodoncia=1 and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as renal,
        sum(CASE WHEN (periodoncia=1 and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as tuberculo,
        sum(CASE WHEN (periodoncia=1 and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as otro,
        sum(CASE WHEN (periodoncia=1 and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as cardio,
        sum(CASE WHEN (periodoncia=1 and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as reuma,
        sum(CASE WHEN (periodoncia=1 and id_tipo_sexo=2 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as cancer,
        sum(CASE WHEN (periodoncia=1 and id_tipo_sexo=1 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as cancero,
        <!--CIRUGIA BUCAL MENOR-->
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as depre,
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as epilepsia,
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as psico,
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as discapa,
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as aqv,
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as bcg,
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as condon,
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as controlpos,
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=2 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as otras,
        sum(CASE WHEN (exodoncia=1 and id_tipo_sexo=1 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as cirugia,
        <!--EXODONCIA-->
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as exodoncia,
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as restauracion,
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as periodoncia,
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as rayosx,
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as tabletas,
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as sfembarazada,
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as sfpuerpera,
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as vitamina,
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=2 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as semanas,
        sum(CASE WHEN (exodoncia=1 and tipo ='A' and id_tipo_sexo=1 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as parto,
        <!--CIRUGIA BUCOMAXILOFACIAL-->
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=2 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as sexo,
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=1 and (edad between 0 and 4)) THEN 1 ELSE 0 END) as imc,
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=2 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as nembarazo,
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=1 and (edad between 5 and 13)) THEN 1 ELSE 0 END) as eclam,
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=2 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as aborto,
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=1 and (edad between 14 and 19)) THEN 1 ELSE 0 END) as hemo,
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=2 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as anestesia,
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=1 and (edad between 20 and 59)) THEN 1 ELSE 0 END) as suma60,
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=2 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as pap,
        sum(CASE WHEN (exodoncia=1 and tipo ='D' and id_tipo_sexo=1 and (edad between 60 and 99)) THEN 1 ELSE 0 END) as insumos

        from historiales h
        join cuaderno7 c using(id_historial)
        join pacientes a using(id_paciente)
        where h.cod_esta=#{cod_esta} and ( fecha::timestamp without time zone BETWEEN #{fecha_ini} and #{fecha_fin} )
    </select>
  
    <resultMap id="informecie10" type="Cuadernos">
        <result property="tipoconsulta"        column="tipoconsulta"/>            
        <result property="tipo"                column="tipo"/>          
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma6"               column="suma6"/>
        <result property="suma7"               column="suma7"/>
        <result property="suma8"               column="suma8"/>
        <result property="suma9"               column="suma9"/>
        <result property="suma10"              column="suma10"/>
        <result property="suma11"              column="suma11"/>
        <result property="suma12"              column="suma12"/>
        <result property="suma13"              column="suma13"/>
        <result property="suma14"              column="suma14"/>
        <result property="suma15"              column="suma15"/>
        <result property="suma16"              column="suma16"/>
        <result property="suma17"              column="suma17"/>
        <result property="suma18"              column="suma18"/>
        <result property="suma19"              column="suma19"/>
        <result property="suma20"              column="suma20"/>
        <result property="suma21"              column="suma21"/>
    </resultMap>
  
    <select id="getReporteCIE10xMedico" resultMap="informecie10">
        select d.codigo as tipo,literal as tipoconsulta,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma5,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma6,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma7,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma8,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma11,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma12,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma16,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma17,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma20,
        count(*) as suma21
        from detallecie10 d 
        inner join cie10 on cie10.codigo=d.codigo
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        WHERE (fecha::timestamp without time zone BETWEEN #{fecha_ini} and #{fecha_fin} ) and h.cod_esta=#{cod_esta} and h.id_persona=#{id_persona} 
        and d.tipo='A' and num=1 and d.codigo not like 'Z%' 
        group by d.codigo,literal order by -count(*)  
    </select>
    
    <select id="getReporteCIE10" resultMap="informecie10">
        select d.codigo as tipo,literal as tipoconsulta,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma5,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma6,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma7,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma8,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma11,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma12,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma16,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma17,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma20,
        count(*) as suma21
        from detallecie10 d 
        inner join cie10 on cie10.codigo=d.codigo
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        WHERE (fecha::timestamp without time zone BETWEEN #{fecha_ini} and #{fecha_fin} ) and h.cod_esta=#{cod_esta} 
        and d.tipo='A' and num=1 and d.codigo not like 'Z%' 
        group by d.codigo,literal order by -count(*)  
    </select>
    
    <select id="getReporteCIE10Urgencia" resultMap="informecie10">
        select d.codigo as tipo,literal as tipoconsulta,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma5,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma6,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma7,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma8,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma11,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma12,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma16,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma17,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma20,
        count(*) as suma21
        from detallecie10 d 
        inner join cie10 on cie10.codigo=d.codigo
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        WHERE (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) and h.cod_esta=#{cod_esta} and d.tipo='A' and num=1 
        and d.codigo not like 'Z%' and (h.id_consultorio=17 or h.id_consultorio=19 or h.id_consultorio=23 or h.id_consultorio=45)
        group by d.codigo,literal order by -count(*)  limit 50
    </select>
    
    <select id="getReporteCIE10_CEmerg" resultMap="informecie10">
        select d.codigo as tipo,literal as tipoconsulta,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma5,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma6,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma7,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma8,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma11,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma12,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma16,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma17,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma20,
        count(*) as suma21
        from detallecie10 d 
        inner join cie10 on cie10.codigo=d.codigo
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        join cuaderno1 using(id_historial)
        WHERE (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) and h.cod_esta=#{cod_esta} and atencion=1 
        and d.tipo='A' and num=1 and d.codigo not like 'Z%' 
        group by d.codigo,literal order by -count(*)        
    </select>
    
    <select id="getReporteCIE10_C1" resultMap="informecie10">
        select d.codigo as tipo,literal as tipoconsulta,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma5,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma6,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma7,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma8,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma11,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma12,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma16,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma17,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma20,
        count(*) as suma21
        from detallecie10 d 
        inner join cie10 on cie10.codigo=d.codigo
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        join cuaderno1 using(id_historial)
        WHERE (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin} ) and h.cod_esta=#{cod_esta} and atencion=0
        and d.tipo='A' and num=1 and d.codigo not like 'Z%' 
        group by d.codigo,literal order by -count(*)            
    </select>
    
    <select id="getReporteCIE10_C2" resultMap="informecie10">
        select d.codigo as tipo,literal as tipoconsulta,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma5,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma6,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma7,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma8,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma11,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma12,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma16,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma17,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma20,
        count(*) as suma21
        from detallecie10 d 
        inner join cie10 on cie10.codigo=d.codigo
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        join cuaderno2 using(id_historial)
        WHERE (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin} ) and h.cod_esta=#{cod_esta} 
        and d.tipo='A' and num=1 and d.codigo not like 'Z%' 
        group by d.codigo,literal order by -count(*)             
    </select>
    
    <select id="getReporteCIE10_C3" resultMap="informecie10">
        select d.codigo as tipo,literal as tipoconsulta,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma5,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma6,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma7,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma8,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma11,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma12,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma16,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma17,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma20,
        count(*) as suma21
        from detallecie10 d 
        inner join cie10 on cie10.codigo=d.codigo
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        join cuaderno3 using(id_historial)
        WHERE (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin} ) and h.cod_esta=#{cod_esta} 
        and d.tipo='A' and num=1 and d.codigo not like 'Z%' 
        group by d.codigo,literal order by -count(*)          
    </select>
    
    <select id="getReporteCIE10_C4" resultMap="informecie10">
        select d.codigo as tipo,literal as tipoconsulta,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma5,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma6,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma7,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma8,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma11,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma12,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma16,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma17,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma20,
        count(*) as suma21
        from detallecie10 d 
        inner join cie10 on cie10.codigo=d.codigo
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        join cuaderno4 using(id_historial)
        WHERE (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin} ) and h.cod_esta=#{cod_esta} 
        and d.tipo='A' and num=1 and d.codigo not like 'Z%' 
        group by d.codigo,literal order by -count(*)          
    </select>
    
    <select id="getReporteCIE10_C7" resultMap="informecie10">
        select d.codigo as tipo,literal as tipoconsulta,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma5,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma6,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma7,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma8,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma11,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma12,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma16,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma17,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma20,
        count(*) as suma21
        from detallecie10 d 
        inner join cie10 on cie10.codigo=d.codigo
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        join cuaderno7 using(id_historial)
        WHERE (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin} ) and h.cod_esta=#{cod_esta} 
        and d.tipo='A' and num=1 and d.codigo not like 'Z%' 
        group by d.codigo,literal order by -count(*)             
    </select>
  
    <select id="getReporteCIE10IngInter" resultMap="informecie10">
        select d.codigo as tipo,literal as tipoconsulta,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma5,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma6,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma7,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma8,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma11,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma12,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma16,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma17,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma20,
        count(*) as suma21
        from detallecie10 d 
        inner join cie10 on cie10.codigo=d.codigo
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        join cuaderno5 using(id_historial)
        WHERE (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin} ) and h.cod_esta=#{cod_esta} 
        and d.tipo='B' and num=1 and d.codigo not like 'Z%' 
        group by d.codigo,literal order by -count(*)              
    </select>
  
    <select id="getReporteCIE10EgrInter" resultMap="informecie10">
        select d.codigo as tipo,literal as tipoconsulta,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 0 and 5) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (id_tipo_sexo=1 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (id_tipo_sexo=2 and edad=0 and extract(month from age(h.fecha,p.fec_nacimiento))::int between 6 and 11) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma5,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 1 and 4) THEN 1 ELSE 0 END) as suma6,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma7,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 5 and 9) THEN 1 ELSE 0 END) as suma8,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 10 and 14) THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma11,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 15 and 19) THEN 1 ELSE 0 END) as suma12,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 20 and 39) THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 40 and 49) THEN 1 ELSE 0 END) as suma16,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma17,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 50 and 59) THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (id_tipo_sexo=1 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (id_tipo_sexo=2 and edad between 60 and 130) THEN 1 ELSE 0 END) as suma20,
        count(*) as suma21
        from detallecie10 d 
        inner join cie10 on cie10.codigo=d.codigo
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        join cuaderno5 using(id_historial)
        WHERE (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin} ) and h.cod_esta=#{cod_esta} 
        and d.tipo='C' and num=1 and d.codigo not like 'Z%' 
        group by d.codigo,literal order by -count(*)            
    </select>
    
    <resultMap id="informecie10p" type="Cuadernos">
        <result property="tipoconsulta"        column="tipoconsulta"/>            
        <result property="tipo"                column="tipo"/>          
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
    </resultMap>
  
    <select id="getReporteCIE10edad" resultMap="informecie10p">
        select * from informecie10edad(#{cod_esta},#{fecha_ini}, #{fecha_fin},#{exodoncia},#{endodoncia},#{anastecia},#{anestesia})  
        as (tipoconsulta text,tipo text,suma1 integer,suma2 integer, suma3 integer, suma4 integer, suma5 integer)
        order by -suma3 ;         
    </select> 
    <select id="getReporteCIE10edadPersonal" resultMap="informecie10p">
        select * from informecie10edadPersona(#{cod_esta},#{fecha_ini}, #{fecha_fin},#{exodoncia},#{endodoncia},#{id_persona},#{anastecia},#{anestesia})  
        as (tipoconsulta text,tipo text,suma1 integer,suma2 integer, suma3 integer, suma4 integer, suma5 integer)
        order by -suma3;         
    </select>
  
    <resultMap id="datosSspam2" type="Cuadernos">
        <result property="tipoconsulta"        column="tipoconsulta"/>            
        <result property="tipo"                column="tipo"/>          
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>

    </resultMap>
  
    <select id="getReporteSspam1" resultMap="datosSspam2">
        select detallecie10.codigo as tipo,literal as tipoconsulta ,sum(CASE WHEN repetida='N'  THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN repetida='R'  THEN 1 ELSE 0 END) as suma2,count(*) as suma3
        from detallecie10  
        join historiales using(id_historial)
        inner join cie10 on  cie10.codigo=detallecie10.codigo
        WHERE (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and id_seguro=#{id_seguro} 
        group by detallecie10.codigo,literal
        order by -count(*)
    </select>
  
    <resultMap id="datosSpam2" type="Cuadernos">
        <result property="id_historial"          column="id_historial"/>
        <result property="fechap"                column="fechap"/>
        <result property="hcl"                   column="hcl"/>
        <result property="nombres"               column="nombres"/>
        <result property="diagnostico"           column="diagnostico"/>
        <result property="accion"                column="accion"/>
        <result property="codigo"                column="codigo"/>
        <result property="edad"                  column="edad"/>
    </resultMap>
  
    <select id="getReporteSpam2" resultMap="datosSpam2">
        select id_historial, fecha as fechap, hcl,(paterno||' '||materno||' '||nombre) as nombres,diagnostico,accion,codigo,edad
        from cuaderno1
        join historiales using (id_historial)
        join pacientes using (id_paciente)
        where (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) and historiales.id_seguro=#{id_seguro} 
        order by fecha,historiales.id_historial                
    </select>
  
    <select id="getReporteSpam3" resultMap="datosSpam2">
        select id_historial, fechap, hcl,(paterno||' '||materno||' '||nombre) as nombres,diagnostico,accion,codigo,edad
        from pedidoslab
        join historiales using (id_historial)
        join pacientes using (id_paciente)
        where (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin}  and historiales.id_seguro=#{id_seguro} 
        order by fecha,historiales.id_historial                
    </select>
  
    <select id="getReporteSpam4" resultMap="datosSpam2">
        select id_historial, fechap, hcl,(paterno||' '||materno||' '||nombre) as nombres,diagnostico,accion,codigo,cuaderno6.edad
        from cuaderno6
        join historiales using (id_historial)
        join pacientes using (id_paciente)
        where (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and historiales.id_seguro=#{id_seguro} 
        order by fecha,historiales.id_historial                
    </select>
       
    <resultMap id="datoscuaderno7" type="Cuadernos">
        <result property="id_cuaderno"           column="id_cuaderno"/>
        <result property="id_persona"            column="id_persona"/>
        <result property="id_historial"          column="id_historial"/>
        <result property="exodoncia"             column="exodoncia"/>
        <result property="restauracion"          column="restauracion"/>
        <result property="periodoncia"           column="periodoncia"/>
        <result property="cirugia"               column="cirugia"/>
        <result property="endodoncia"            column="endodoncia"/>
        <result property="rayosx"                column="rayosx"/>
        <result property="preventiva"            column="preventiva"/>
        <result property="otras"                 column="otras"/>    
        <result property="numpieza"              column="numpieza"/> 
        <result property="tipoconsulta"          column="tipoconsulta"/>
        <result property="tipo"                  column="tipo"/>
        <result property="tipodent"              column="tipodent"/>
        <result property="auto"                  column="auto"/>
        <result property="codigo"                  column="codigo"/>
    </resultMap>

    <select id="getPacienteCuaderno7" resultMap="datoscuaderno7">
        SELECT id_cuaderno,h.id_persona,id_historial, exodoncia, restauracion, periodoncia, cirugia, cie10 as codigo,
        endodoncia, rayosx, preventiva, otras, numpieza, tipoconsulta, tipo, tipodent, embarazada as auto
        FROM cuaderno7 
        join historiales h using (id_historial)
        where id_historial=#{id_historial} 
    </select>
  
    <select id="getCuadernoC7" resultMap="datoscuaderno7">
        SELECT id_cuaderno,h.id_persona,id_historial, exodoncia, restauracion, periodoncia, cirugia, cie10 as codigo,
        endodoncia, rayosx, preventiva, otras, numpieza, tipoconsulta, tipo, tipodent, embarazada as auto
        FROM cuaderno7 
        join historiales h using (id_historial)
        where id_historial in (select id_historial from historiales where (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin} ))
    </select>
  
    <delete id="setEliminarCuaderno7" >
        delete from cuaderno7 where id_cuaderno=#{id_cuaderno} and id_historial=#{id_historial} and cod_esta=#{cod_esta};
        update historiales set n_c1=1 where id_historial=#{id_historial} and cod_esta=#{cod_esta} 
    </delete>
  
    <insert id="setCrearCuaderno7">
        insert into cuaderno7 (id_historial, exodoncia, restauracion, periodoncia, cirugia, endodoncia, rayosx,
        preventiva, otras, tipo,tipoconsulta,primera,tipodent,referido,contraref ,numpieza,tratamiento,embarazada,
        fec_reg,id_persona,cod_esta,cie10 )
        values (#{id_historial},#{exodoncia},#{restauracion},#{periodoncia},#{cirugia},#{endodoncia},#{rayosx},
        #{preventiva},#{otras}, #{tipo},#{tipoconsulta},#{primera},#{tipodent},#{referido},#{contraref},#{numpieza},#{nombre},#{auto},
        now(),#{id_persona},#{cod_esta},#{codigo} );
        update historiales set n_c7=1 where id_historial=#{id_historial} and cod_esta=#{cod_esta} 
    </insert>
  
    <resultMap id="snisodontologia" type="Cuadernos">
        <result property="primera"             column="primera"/>
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="restauracion"        column="restauracion"/>
        <result property="exodoncia"           column="exodoncia"/>
        <result property="endodoncia"          column="endodoncia"/>
        <result property="periodoncia"         column="periodoncia"/>
        <result property="cirugia"             column="cirugia"/>
        <result property="preventiva"          column="preventiva"/>
    </resultMap>

    <select id="getSnis301Odontologia" resultMap="snisodontologia">  
        select * from __snisc7
        where mes=#{mes} and gestion=#{gestion} 
    </select>
    <resultMap id="snisnutricion" type="Cuadernos">
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma6"               column="suma6"/>
        <result property="restauracion"        column="restauracion"/>
        <result property="exodoncia"           column="exodoncia"/>
        <result property="endodoncia"          column="endodoncia"/>
        <result property="periodoncia"         column="periodoncia"/>
        <result property="cirugia"             column="cirugia"/>
        <result property="preventiva"          column="preventiva"/>
    </resultMap>

    <select id="getSnis301Nutricion" resultMap="snisnutricion">  
        select * from __snisc4
        where mes=#{mes} and gestion=#{gestion} 
    </select>
    
    <resultMap id="datoscuaderno1" type="Cuadernos">
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma30"              column="suma30"/>
        <result property="suma31"              column="suma31"/>
        <result property="tipoconsulta"        column="tipoconsulta"/>
        <result property="referido"            column="referido"/>
        <result property="contraref"           column="contraref"/>
        <result property="violencia"           column="violencia"/>
        <result property="servicio"            column="servicio"/>
        <result property="suma11"              column="suma11"/>
        <result property="suma12"              column="suma12"/>
        <result property="suma13"              column="suma13"/>
        <result property="suma14"              column="suma14"/>
    </resultMap>

    <select id="getPacienteCuaderno1" resultMap="datoscuaderno1">
        SELECT id_cuaderno,id_historial, suma1 , suma2 , suma3 ,suma4,suma5,tipoconsulta, id_referido as suma30, 
        id_contraref as suma31,  referido, contraref,violencia,motivo as servicio,tipo as suma11,alta as suma12,
        carmelo as suma13,id_refer as suma14
        FROM cuaderno1
        where id_historial=#{id_historial} 
    </select> 
  
    <select id="getPacienteCemergencia" resultMap="datoscuaderno1">
        SELECT id_cuaderno,id_historial, suma1 , suma2 , suma3 ,suma4,suma5,tipoconsulta, id_referido as suma30, 
        id_contraref as suma31,  referido, contraref,violencia,motivo as servicio,tipo as suma11,alta as suma12,
        carmelo as suma13,id_refer as suma14
        FROM cuaderno1
        where atencion=1 and id_historial=#{id_historial} 
    </select> 
  
    <select id="getCuadernoC1" resultMap="datoscuaderno1">
        SELECT id_cuaderno,id_historial, suma1 , suma2 , suma3 ,suma4,suma5,tipoconsulta, id_referido as suma30, 
        id_contraref as suma31,  referido, contraref,violencia,motivo as servicio,tipo as suma11,alta as suma12,
        carmelo as suma13,id_refer as suma14
        FROM cuaderno1       
        join historiales using(id_historial)
        where  id_historial in (select id_historial from historiales where (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) )
        <!-- internado=0 and se quita 11-03-2016 no daba en micronutrientes no rellenaba dato cuaderno1-->
    </select> 
     
    <insert id="setCrearCuaderno1">
        insert into cuaderno1 (id_historial, suma1,suma2, suma3 , suma4, suma5,tipoconsulta,referido,contraref,speso,alcohol,fuma,
        violencia,auto, urinaria, sistemica, arterial, diabetes, glome, tracto, lupus, litiasis, nooplasia, nefro, disli, frenal, 
        bajopeso, prematuro, eritro, renal, tuberculo, otro, cardio, reuma, cancer, cancero, depre, epilepsia, psico, discapa,
        hba,gfr,creatinina,colesterol,imc,pies,ojos,dieta,ejercicios,observaciones,id_referido,id_contraref,tipo,motivo,fallecido,
        atencion,alta,mortalidad,fec_reg,id_persona,cod_esta,carmelo,id_refer)
        values (#{id_historial},#{suma1},#{suma2},#{suma3},#{suma4},#{suma5},#{tipoconsulta},#{referido},#{contraref},#{speso},#{alcohol},
        #{fuma},#{violencia},#{auto},#{urinaria},#{sistemica},#{arterial},#{diabetes},#{glome},#{tracto},#{lupus},#{litiasis},#{nooplasia},#{nefro},#{disli},
        #{frenal},#{bajopeso},#{prematuro},#{eritro},#{renal},#{tuberculo},#{otro},#{cardio},#{reuma},#{cancer},#{cancero},#{depre},#{epilepsia},#{psico},#{discapa},
        #{aspecto},#{bacterias},#{bilirrubina},#{cantidad},#{cetonas},#{aqv},#{bcg},#{condon},#{controlpos},#{observa},#{suma30},#{suma31},
        #{suma50},#{suma51},#{suma52},#{suma53},#{suma32},#{nooplasia},now(),#{id_persona},#{cod_esta},#{suma13},#{suma14}) ;
        update historiales set n_c1=1 where id_historial=#{id_historial} and cod_esta=#{cod_esta} 
    </insert>
    
    <insert id="setCrearEpicrisis">
        INSERT INTO epicrisis( fecha, id_paciente, id_historial, id_consultorio,id_persona, id_piso, id_sala, id_cama, fechaing, 
        fechaegr, consultorio, clinicos, diagnosticoing, diagnosticoegr, condicion, causa, examenes, tratquirurgico, 
        tratmedico, complicaciones, pronosticovital, pronosticofuncional, control, policlinico, hospital, recomendaciones, 
        id_seguro, fec_reg, estado, cod_esta,id_por)
        VALUES (now(),#{id_paciente},#{id_historial},#{id_consultorio},#{id_persona}, #{id_piso}, #{id_sala}, #{id_cama}, #{fechap},
        #{fechae},#{bacterias},#{cadena1},#{cadena2},#{cadena3},#{suma5},#{suma6},#{cadena6},#{cadena7},#{cadena8},#{cadena9},
        #{cadena10},#{cadena11},#{cadena12},#{cadena13},#{cadena14},#{cadena15},#{id_seguro},now(),0,#{cod_esta},#{suma22}) ;   
    </insert>
    
    <insert id="setCrearOftalmologia">
        INSERT INTO public.hcl_oftalmologia(fecha, id_paciente, id_historial, id_consultorio, id_persona, 
        situacion, ap, af, krod, os, lensometro, od_nc, od_ph, od_cc, od_mc, od_ci, oi_nc, 
        oi_ph, oi_cc, oi_mc, oi_ci, od_esfera, od_cilindro, od_eje, od_add, od_pd, oi_esfera, oi_cilindro, 
        oi_eje,  oi_add, oi_pd, kerat_i, kerat_d, dx, rx, id_seguro, fec_reg, estado, id_por, cod_esta)
        VALUES (now(),#{id_paciente},#{id_historial},#{id_consultorio},#{id_persona}, 
        #{cadena1},#{cadena2},#{cadena3},#{cadena4},#{cadena5},#{cadena6},#{cadena7},#{cadena8},#{cadena9},#{cadena10},#{cadena11},#{cadena12},
        #{cadena13},#{cadena14},#{cadena15}, #{cadena16}, #{cadena17}, #{cadena18},#{cadena19},#{cadena20},#{cadena21},#{cadena22},#{cadena23},
        #{cadena24},#{cadena25},#{cadena26},#{cadena27},#{cadena28},#{cadena29},#{cadena30}, #{id_seguro},now(),0,#{id_por},#{cod_esta}) ; 
    </insert>
    
    <insert id="setCrearTransferencia">
        insert into transferencias(fecha, id_paciente, id_historial, id_consultorio, id_persona, cod_esta_ref, id_servicio_ref, 
        id_consultorio_ref, servicio, consultorio, establecimiento, diagnostico, laboratorio, tratamiento, recomienda, 
        fec_reg, cod_esta,id_por)
        values (#{fecha},#{id_paciente},#{id_historial},#{id_consultorio},#{id_persona},#{condon},#{id_cuaderno},
        #{id_cargo},#{anti},#{bacterias},#{bilirrubina},#{diagnostico},#{laboratorio},#{aspecto},#{cetonas},
        now(),#{cod_esta},#{id_por}) ;
        insert into reservaciones (id_paciente, id_consultorio,  fecha,edad,expedido,id_estado,id_persona,id_intercon,cod_esta,id_seguro,
        vigencia,id_per_vigencia,codestaref,nombrecodestared,talla,peso,temperatura,fc,pa,fr,so2,glicemia) 
        ( select id_paciente, #{id_cargo}, fecha,#{edad},#{expedido},'C',0,0,#{condon},#{id_seguro},0,1,cod_esta,#{ematies},0,0,0,'0','0','0','0','0'
        FROM transferencias WHERE cod_esta=#{cod_esta} and id_paciente=#{id_paciente} and id_historial=#{id_historial} 
        and #{cod_esta}!=#{condon});      
        Update reservaciones set id_consultorio=23,id_persona=1369 where cod_esta=200115 and #{id_cargo#{=88 and id_reservacion in
        (select max(id_reservacion) from reservaciones where cod_esta=200115 and id_per_vigencia=1 and id_consultorio=0 and id_persona=0); <!--solo para UCA LUO  -->
    </insert>
    
    <insert id="setCrearAdmision">
        INSERT INTO admisiones( fecha, id_paciente, id_historial, id_consultorio, id_persona, id_piso, id_sala, id_cama, 
        pa, fc, fr, temperatura, talla, peso, consultorio, establecimiento, diagnostico, estadogen, prescripcion, 
        nombreacomp,padre,madre,conyugue,conviviente,direccion,id_seguro, fec_reg, cod_esta,id_por,seguro)
        VALUES (#{fecha},#{id_paciente},#{id_historial},#{id_consultorio},#{id_persona}, #{id_piso}, #{id_sala}, #{id_cama}, 
        #{pa},#{fc},#{fr},#{temperatura},#{talla},#{peso},#{bacterias},#{bilirrubina},#{diagnostico}, #{aspecto}, #{cetonas},
        #{cilindros},#{cadena1},#{cadena2},#{cadena3},#{cadena4},#{cadena5},#{id_seguro},now(),#{cod_esta},#{suma22},#{suma25}) ;        
    </insert>
    
    <insert id="setCrearProtocolo">
        INSERT INTO protocoloopera(fecha, id_paciente, id_historial, id_consultorio, id_persona, id_piso, id_sala, id_cama, id_quirofano, 
        consultorio, diagnosticopost,riesgoopera, cirujano, instrumentadora, ayuda1, ayuda2, ayuda3, circulante, anastecista, 
        ayudante, tipo_anestecia, tipo_instrumental, tipo_guantes, material,incision,cierre,quien_cerro, drenaje, 
        hallasgo, diagnosticopre, descripcion,nombre_tecnico,duracion,sangre,plasma,suero,otras, 
        id_seguro, fec_reg, estado, id_por, cod_esta)
        VALUES (#{fecha},#{id_paciente},#{id_historial},#{id_consultorio},#{id_persona}, #{id_piso}, #{id_sala}, #{id_cama}, #{suma1},
        #{bacterias},#{cadena1},#{suma2},#{cadena2},#{cadena3},#{cadena4},#{cadena5},#{cadena6},#{cadena7},#{cadena8},
        #{cadena9},#{suma3},#{suma4},#{suma5},#{cadena10},#{cadena11},#{cadena12},#{cadena13},#{cadena14},
        #{cadena15},#{cadena16},#{cadena17},#{cadena18},#{cadena19},#{cadena20},#{cadena21},#{cadena22},#{cadena23},
        #{id_seguro},now(),0,#{suma6},#{cod_esta}) ;   
    </insert>
    
    <insert id="setCrearSolSangre">
        INSERT INTO public.solsangre(fecha, id_paciente, id_historial, id_consultorio,id_persona, id_piso, id_sala, id_cama, urgencia, 
        endia, programa, quirofano, hb, plaqueta, ttpa, hto, leucocito, protombina, trans,notrans,reaccion, embarazo, ehnr, st, 
        volst, pg, volpg, pgl, volpgl, cp, volcp, fpc, volfpc, pr, volpr, crio, volcrio, 
        au, volau, otr, volotr, especifica, motivo, otros, diagnostico, fec_reg, id_por, cod_esta)
        VALUES (#{fecha},#{id_paciente},#{id_historial},#{id_consultorio},#{id_persona}, #{id_piso}, #{id_sala}, #{id_cama}, #{suma1},
        #{suma2},#{suma3},#{suma4},#{suma5},#{suma6},#{suma7},#{suma8},#{suma9},#{suma10},#{suma11},#{suma33},#{suma12},#{suma13},#{suma14},#{suma15},
        #{suma16},#{suma17},#{suma18},#{suma19},#{suma20},#{suma21},#{suma22},#{suma23},#{suma24},#{suma25},#{suma26},#{suma27},#{suma28},
        #{suma29},#{suma30},#{suma31},#{suma32},#{cadena1},#{cadena2},#{cadena3}, #{diagnostico}, now(),#{suma35},#{cod_esta}) ;
    </insert>
  
    <update id="setModificarCuaderno1" >
        update cuaderno1
        set  tipoconsulta=#{tipoconsulta},referido=#{referido},contraref=#{contraref},speso=#{speso},alcohol=#{alcohol},fuma=#{fuma},
        violencia=#{violencia},auto=#{auto},urinaria=#{urinaria},sistemica=#{sistemica},arterial=#{arterial},diabetes=#{diabetes},
        glome=#{glome},tracto=#{tracto},lupus=#{lupus},litiasis=#{litiasis},nooplasia=#{nooplasia},nefro=#{nefro},disli=#{disli},
        frenal=#{frenal},bajopeso=#{bajopeso},prematuro=#{prematuro},eritro=#{eritro},renal=#{renal},tuberculo=#{tuberculo},
        otro=#{otro},cardio=#{cardio},reuma=#{reuma},cancer=#{cancer},cancero=#{cancero},depre=#{depre},epilepsia=#{epilepsia},
        psico=#{psico},discapa=#{discapa},hba=#{aspecto},gfr=#{bacterias},creatinina=#{bilirrubina},colesterol=#{cantidad},
        imc=#{cetonas},pies=#{aqv},ojos=#{bcg},dieta=#{condon},ejercicios=#{controlpos},mortalidad=#{nooplasia},observaciones=#{observa} 
        where  id_historial = #{id_historial}  
    </update> 
    
    <update id="setModificarTranferencia" >
        update transferencias 
        set   fecha=#{fecha}, cod_esta_ref=#{condon},id_servicio_ref=#{id_cuaderno},
        id_consultorio_ref=#{id_cargo},servicio=#{anti}, consultorio=#{bacterias}, 
        establecimiento=#{bilirrubina}, diagnostico=#{diagnostico},laboratorio=#{laboratorio},
        tratamiento=#{aspecto},recomienda=#{cetonas} 
        where  cod_esta=#{cod_esta} and id_trans=#{id_laboratorio} 
    </update> 
    
    <update id="setModificarPrococolos" >
        update protocoloopera 
        set   fecha=#{fecha}, id_piso=#{id_piso}, id_sala=#{id_sala}, id_cama=#{id_cama}, id_quirofano=#{suma1}, 
        consultorio=#{bacterias}, diagnosticopost=#{cadena1},riesgoopera=#{suma2}, cirujano=#{cadena2}, instrumentadora=#{cadena3},
        ayuda1=#{cadena4}, ayuda2=#{cadena5}, ayuda3=#{cadena6}, circulante=#{cadena7}, anastecista=#{cadena8}, ayudante=#{cadena9}, 
        tipo_anestecia=#{suma3}, tipo_instrumental=#{suma4}, tipo_guantes=#{suma5}, material=#{cadena10},incision=#{cadena11},
        cierre=#{cadena12},quien_cerro=#{cadena13}, drenaje=#{cadena14}, hallasgo=#{cadena15}, diagnosticopre=#{cadena16}, 
        descripcion=#{cadena17},nombre_tecnico=#{cadena18},duracion=#{cadena19},sangre=#{cadena20},plasma=#{cadena21},
        suero=#{cadena22},otras=#{cadena23} 
        where  cod_esta=#{cod_esta} and id_opera=#{id_laboratorio} 
    </update> 
    
    <update id="setModificarSangre" >
        update solsangre 
        SET fecha=#{fecha}, id_paciente=#{id_paciente}, id_historial=#{id_historial}, id_consultorio=#{id_consultorio}, 
        id_persona=#{id_persona}, urgencia=#{suma1}, endia=#{suma2}, 
        programa=#{suma3}, quirofano=#{suma4}, hb=#{suma5}, plaqueta=#{suma6}, ttpa=#{suma7}, hto=#{suma8}, leucocito=#{suma9}, 
        protombina=#{suma10},trans=#{suma11},notrans=#{suma33}, reaccion=#{suma12}, embarazo=#{suma13}, ehnr=#{suma14}, st=#{suma15}, 
        volst=#{suma16}, pg=#{suma17}, volpg=#{suma18}, pgl=#{suma19}, volpgl=#{suma20}, cp=#{suma21}, volcp=#{suma22}, fpc=#{suma23}, 
        volfpc=#{suma24}, pr=#{suma25}, volpr=#{suma26}, crio=#{suma27}, volcrio=#{suma28}, au=#{suma29}, volau=#{suma30}, otr=#{suma31}, 
        volotr=#{suma32}, especifica=#{cadena1}, motivo=#{cadena2}, otros=#{cadena3}, diagnostico=#{diagnostico} 
        where  cod_esta=#{cod_esta} and id_sangre=#{id_laboratorio} 
    </update> 
    
    <update id="setModificarEpicrisis" >
        update epicrisis
        set   fechaing=#{fechap},fechaegr=#{fechae}, id_piso=#{id_piso}, id_sala=#{id_sala}, id_cama=#{id_cama}, 
        clinicos=#{cadena1}, diagnosticoing=#{cadena2}, diagnosticoegr=#{cadena3}, 
        condicion=#{suma5}, causa=#{suma6}, examenes=#{cadena6}, tratquirurgico=#{cadena7}, tratmedico=#{cadena8}, 
        complicaciones=#{cadena9}, pronosticovital=#{cadena10}, pronosticofuncional=#{cadena11}, control=#{cadena12}, 
        policlinico=#{cadena13}, hospital=#{cadena14}, recomendaciones=#{cadena15} 
        where  cod_esta=#{cod_esta} and id_epicrisis=#{id_laboratorio} 
    </update> 
    
    <update id="setModificarAdmision" >
        update admisiones 
        set fecha=#{fecha}, id_consultorio=#{id_consultorio}, id_persona=#{id_persona}, id_piso=#{id_piso}, 
        id_sala=#{id_sala}, id_cama=#{id_cama}, pa=#{pa}, fc=#{fc}, fr=#{fr},temperatura=#{temperatura}, 
        talla=#{talla}, peso=#{peso}, consultorio=#{bacterias}, establecimiento=#{bilirrubina}, 
        diagnostico=#{diagnostico}, estadogen=#{aspecto}, prescripcion=#{cetonas}, nombreacomp=#{cilindros},
        padre=#{cadena1},madre=#{cadena2},conyugue=#{cadena3},conviviente=#{cadena4},direccion=#{cadena5},seguro=#{suma25} 
        where  cod_esta=#{cod_esta} and id_admi=#{id_laboratorio} 
    </update> 
  
    <delete id="setEliminarCuaderno1">
        delete from cuaderno1 where id_cuaderno=#{id_cuaderno} and id_historial=#{id_historial} and cod_esta=#{cod_esta};
        update historiales set n_c1=0 where id_historial=#{id_historial} and cod_esta=#{cod_esta} 
    </delete>
    
    <resultMap id="datoscuadernof" type="Cuadernos">
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="tipoconsulta"        column="tipoconsulta"/>
        <result property="numpieza"            column="numpieza"/>
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma6"               column="suma6"/>
        <result property="suma7"               column="suma7"/>
        <result property="suma8"               column="suma8"/>
        <result property="suma9"               column="suma9"/>
        <result property="suma10"               column="suma10"/>
        <result property="suma11"               column="suma11"/>
        <result property="suma12"               column="suma12"/>
        <result property="suma13"               column="suma13"/>
        <result property="suma14"               column="suma14"/>
        <result property="suma15"               column="suma15"/>
        <result property="suma16"               column="suma16"/>
        <result property="suma17"               column="suma17"/>
        <result property="suma18"               column="suma18"/>
        <result property="suma19"               column="suma19"/>
        <result property="suma20"               column="suma20"/>
        <result property="suma21"               column="suma21"/>
        <result property="suma22"               column="suma22"/>
        <result property="suma23"               column="suma23"/>
        <result property="suma24"               column="suma24"/>
        <result property="suma25"               column="suma25"/>
        <result property="suma26"               column="suma26"/>
        <result property="suma27"               column="suma27"/>
        <result property="suma28"               column="suma28"/>
        <result property="referido"            column="referido"/>
        <result property="contraref"           column="contraref"/>
    </resultMap>

    <select id="getPacienteCuadernof" resultMap="datoscuadernof">
        SELECT id_cuaderno, id_historial, tipoconsulta, numero as numpieza, consulta as suma1, vendaje as suma2, 
        electro as suma3, ultrasono as suma4, laser as suma5, magneto as suma6, maso as suma7, mecano as suma8, 
        calorprof as suma9,lumino as suma10, termo as suma11, electroanalgesia as suma12,respiratoria as suma13,
        cinesio as suma14, lenguaje as suma15, psicomotri as suma16, tecneurologica as suma17,teckinesica as suma18,
        to1 as suma19, discapacidad as suma20, hidro as suma21, estimulacion as suma22, pisina as suma23, 
        evaluacion as suma24,tanque as suma25,psicologia as suma26, otro as suma27, otro1 as suma28, 
        referido, contraref, cod_esta
        FROM cuadernof
        where id_historial=#{id_historial} 
    </select> 
  
    <select id="getCuadernoCf" resultMap="datoscuadernof">
        SELECT id_cuaderno, id_historial, tipoconsulta, numero as numpieza, consulta as suma1, vendaje as suma2, 
        electro as suma3, ultrasono as suma4, laser as suma5, magneto as suma6, maso as suma7, mecano as suma8, 
        calorprof as suma9,lumino as suma10, termo as suma11, electroanalgesia as suma12,kinesio as suma13, 
        cinesio as suma14, lenguaje as suma15, psicomotri as suma16, tecneurologica as suma17, 
        teckinesica as suma18, to1 as suma19, discapacidad as suma20, hidro as suma21, estimulacion as suma22, 
        respiratoria as suma23, hipertension as suma24, pisina as suma25, desarrollo as suma26,evaluacion as suma27, 
        tanque as suma28, otro as suma29, otro1 as suma30, referido, contraref, cod_esta
        FROM cuadernof
        where id_historial in (select id_historial from historiales where (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ))
    </select> 
     
    <insert id="setCrearCuadernof">
        insert into cuadernof ( id_historial, tipoconsulta, numero, consulta, vendaje, electro, ultrasono, laser, 
        magneto, maso, mecano, calorprof, lumino, termo, electroanalgesia, respiratoria, cinesio, lenguaje, psicomotri,
        tecneurologica, teckinesica, to1, discapacidad, hidro, estimulacion,  hipertension, pisina, evaluacion, tanque,
        psicologia, otro, otro1, referido, contraref,fec_reg,id_persona,cod_esta)
        values (#{id_historial},#{tipoconsulta},#{numpieza},#{suma1},#{suma2},#{suma3},#{suma4},#{suma5},#{suma6},#{suma7},#{suma8},#{suma9},
        #{suma10},#{suma11},#{suma12},#{suma13},#{suma14},#{suma15},#{suma16},#{suma17},#{suma18},#{suma19},#{suma20},#{suma21},#{suma22},
        #{suma23},#{suma24},#{suma25},#{suma26},#{suma27},#{suma28},#{suma29},#{referido},#{contraref},now(),#{id_persona},#{cod_esta}) 
    </insert>
  
    <delete id="setEliminarCuadernof">
        delete from cuadernof where id_cuaderno=#{id_cuaderno} and id_historial=#{id_historial} and cod_esta=#{cod_esta};
        update historiales set n_c1=1 where id_historial=#{id_historial} and cod_esta=#{cod_esta};
    </delete>
  
    <resultMap id="snisexterna" type="Cuadernos">
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
    </resultMap>
  
    <select id="getSnis301Externa" resultMap="snisexterna">
        select * from __snisc1 
        where id_tipo_sexo=#{id_cuaderno} and tipoconsulta=#{tipoconsulta} and mes=#{mes} and gestion=#{gestion} 
    </select> 
    
    <resultMap id="datoscuaderno3count" type="Cuadernos">
        <result property="suma1"        column="suma1"/>
        <result property="suma2"        column="suma2"/>
    </resultMap>
 
    <select id="getVerCuaderno3Count" resultMap="datoscuaderno3count">
        SELECT count (pap) as suma1, id_paciente as suma2
        FROM cuaderno3
        join historiales using (id_historial)
        join pacientes using (id_paciente)
        where pap = 1 and id_paciente=#{id_paciente} 
        group by id_paciente
    </select>
    
    <resultMap id="datoscuaderno3" type="Cuadernos">
        <result property="id_cuaderno"       column="id_cuaderno"/>
        <result property="id_historial"      column="id_historial"/>
        <result property="orientacion"       column="orientacion"/>
        <result property="diu"               column="diu"/>
        <result property="inyectable"        column="inyectable"/>
        <result property="condon"            column="condon"/>
        <result property="pildora"           column="pildora"/>
        <result property="aqv"               column="aqv"/>
        <result property="mnatural"          column="mnatural"/>
        <result property="insumos"           column="insumos"/>  
        <result property="otras"             column="otras"/>
        <result property="tipoconsulta"      column="tipoconsulta"/>
        <result property="pap"               column="pap"/>
        <result property="suma1"             column="suma1"/>
        <result property="suma2"             column="suma2"/>
        <result property="suma3"             column="suma3"/>
        <result property="suma4"             column="suma4"/>
        <result property="suma5"             column="suma5"/>
        <result property="suma6"             column="suma6"/>
        <result property="suma7"             column="suma7"/>
    </resultMap>
 
    <select id="getPacienteCuaderno3" resultMap="datoscuaderno3">
        SELECT id_cuaderno,id_historial,orientacion, diu, inyectable, condon, pildora, aqv, mnatural,insumos,otras,tipoconsulta,pap,
        num_pap as suma1,res_pap as suma2,ivaa as suma3,num_ivaa as suma4,res_ivaa as suma5,mama as suma6,res_mama as suma7
        FROM cuaderno3
        where id_historial=#{id_historial} 
    </select>
  
    <select id="getCuadernoC3" resultMap="datoscuaderno3">
        SELECT id_cuaderno,id_historial,orientacion, diu, inyectable, condon, pildora, aqv, mnatural,insumos,otras,tipoconsulta,pap,
        num_pap as suma1,res_pap as suma2,ivaa as suma3,num_ivaa as suma4,res_ivaa as suma5,mama as suma6,res_mama as suma7
        FROM cuaderno3
        where id_historial in (select id_historial from historiales where (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin} ))
    </select>
  
    <delete id="setEliminarCuaderno3">
        delete from cuaderno3  where id_cuaderno=#{id_cuaderno} and id_historial=#{id_historial} and cod_esta=#{cod_esta};
        update historiales set n_c3=1 where id_historial=#{id_historial} and cod_esta=#{cod_esta} 
    </delete>
  
    <insert id="setCrearCuaderno3">
        insert into cuaderno3 (id_historial,orientacion,diu,inyectable,condon,pildora,aqv,otras,mnatural,insumos,tipoconsulta,
        referido,contraref,observa,pap,num_pap,res_pap,ivaa,num_ivaa,res_ivaa,mama,res_mama,fuera,fec_reg,id_persona,cod_esta) 
        values (#{id_historial},#{orientacion},#{diu},#{inyectable},#{condon},#{pildora},#{aqv},#{otras},#{mnatural},#{insumos},#{tipoconsulta},
        #{referido},#{contraref},#{observa},#{pap},#{suma10},#{suma11},#{suma12},#{suma13},#{suma14},#{suma15},#{suma16},#{tipo_egreso},
        now(),#{id_persona},#{cod_esta} );  
        update historiales set n_c3=1 where id_historial=#{id_historial} and cod_esta=#{cod_esta}       
    </insert>
  
    <resultMap id="datoscuaderno5" type="Cuadernos">
        <result property="id_cuaderno"      column="id_cuaderno"/>
        <result property="id_historial"     column="id_historial"/>
        <result property="id_persona"       column="id_persona"/>
        <result property="id_consultorio"   column="id_consultorio"/>
        <result property="ingreso"          column="ingreso"/>
        <result property="diagnostico_ing"  column="diagnostico_ing"/>
        <result property="cirugia"          column="cirugia"/>
        <result property="anastecia"        column="anastecia"/>
        <result property="diagnostico"      column="diagnostico"/>    
        <result property="fec_ingreso"      column="fec_ingreso"/>    
        <result property="fec_egreso"       column="fec_egreso"/>    
        <result property="egreso"           column="egreso"/>
        <result property="diasi"            column="diasi"/>
        <result property="diasc"           column="diasc"/>
        <result property="tipo_egreso"      column="tipo_egreso"/>
        <result property="fallecido"        column="fallecido"/>    
        <result property="fallecidom5"      column="fallecidom5"/>    
        <result property="fallecidoy5"      column="fallecidoy5"/> 
        <result property="referido"         column="referido"/>     
        <result property="contraref"        column="contraref"/>  
        <result property="id_cama"          column="id_cama"/>
        <result property="id_sala"          column="id_sala"/>
        <result property="id_piso"          column="id_piso"/>
        <result property="id_historia"      column="id_historia"/>
        <result property="cadena1"          column="cadena1"/>
        <result property="cadena2"          column="cadena2"/>
        <result property="cadena3"          column="cadena3"/>
    </resultMap>

    <select id="getPacienteCuaderno5" resultMap="datoscuaderno5">
        SELECT id_cuaderno,id_historial, ingreso,id_persona,id_consultorio, diagnostico_ing, cirugia, anastecia, diagnostico, 
        fec_ingreso, fec_egreso, egreso,diasi,diasc, tipo_egreso, fallecido, fallecidom5, fallecidoy5, referido, contraref,
        c.cama as id_cama,c.sala as id_sala,c.id_piso,id_historia,camas.cama as cadena1,salas.sala as cadena2,pisos.piso as cadena3
        FROM cuaderno5 c
        inner join camas  on id_cama=c.cama 
        inner join salas  on salas.id_sala=c.sala 
        inner join pisos  on pisos.id_piso=c.id_piso
        where id_historial=#{id_historial} and c.cod_esta=#{cod_esta} 
    </select>
  
    <select id="getCuadernoC5" resultMap="datoscuaderno5">
        SELECT id_cuaderno,id_historial, ingreso,id_persona,id_consultorio, diagnostico_ing, cirugia, anastecia, diagnostico, 
        fec_ingreso, fec_egreso, egreso,diasi,diasc, tipo_egreso, fallecido, fallecidom5, fallecidoy5, referido, contraref,
        c.cama as id_cama,c.sala as id_sala,c.id_piso,id_historia,camas.cama as cadena1,salas.sala as cadena2,pisos.piso as cadena3
        FROM cuaderno5 c
        inner join camas  on id_cama=c.cama 
        inner join salas  on salas.id_sala=c.sala 
        inner join pisos  on pisos.id_piso=c.id_piso
        where c.cod_esta=#{cod_esta} and id_historial in (select id_historial from historiales where (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin}) )
    </select>
  
    <delete id="setEliminarCuaderno5">
        delete from cuaderno5 where id_cuaderno=#{id_cuaderno} and id_historial=#{id_historial} and cod_esta=#{cod_esta};
        update historiales set n_c1=1 where id_historial=#{id_historial} and cod_esta=#{cod_esta};
    </delete>
  
    <insert id="setCrearCuaderno5">
        insert into cuaderno5 (id_historial,ingreso,diagnostico_ing, cirugia, anastecia, consultorio, diagnostico, fec_ingreso, 
        fec_egreso, egreso,diasi,diasc, tipo_egreso, fallecido, fallecidom5, fallecidoy5, referido, contraref, id_estado,id_persona,
        id_consultorio,cod_esta) 
        values (#{id_historial},#{ingreso},#{diagnostico_ing},#{cirugia},#{anastecia},#{servicio},#{diagnostico},now(),now(),#{egreso},
        #{diasi},#{diasc},#{tipo_egreso},#{fallecido},#{fallecidom5},#{fallecidoy5},#{referido},#{contraref},#{id_estado},#{id_persona},
        #{id_consultorio},#{cod_esta}) ;
        Update admisiones set estado=1 where cod_esta=#{cod_esta} and id_historial=#{id_historial};
        update historiales set n_c5=1 where id_historial=#{id_historial} and cod_esta=#{cod_esta} 
    </insert>
    
    <update id="setModificarCuaderno5">
        update cuaderno5
        set ingreso=#{ingreso},diagnostico_ing=#{diagnostico_ing},cirugia=#{cirugia}, anastecia=#{anastecia},diagnostico=#{diagnostico},
        egreso=#{egreso},diasi=#{diasi},diasc=#{diasc},tipo_egreso=#{tipo_egreso}, fallecido=#{fallecido}, 
        fallecidom5=#{fallecidom5},fallecidoy5=#{fallecidoy5},referido=#{referido},contraref=#{contraref} 
        where  id_historial = #{id_historial};
    </update>  
    
    <update id="setModificarAdmision2">
        Update admisiones set estado=1 where cod_esta=#{cod_esta} and id_historial=#{id_historial};
    </update>  
    
    <resultMap id="snisprevencion" type="Cuadernos">
        <result property="diu"             column="diu"/>
        <result property="inyectable"      column="inyectable"/>
        <result property="condon"          column="condon"/>
        <result property="pildora"         column="pildora"/>
        <result property="aqv"             column="aqv"/>
        <result property="mnatural"        column="mnatural"/>    
    </resultMap>
  
    <select id="getSnis301Prevencion" resultMap="snisprevencion">
        select * from __snisc3
        where tipoconsulta=#{tipoconsulta} and mes=#{mes} and gestion=#{gestion} 
    </select> 
  
    <delete id="setEliminarCuaderno2" >
        delete from cuaderno2  where id_cuaderno=#{id_cuaderno} and id_historial=#{id_historial} and cod_esta=#{cod_esta};
        update historiales set n_c1=1 where id_historial=#{id_historial} and cod_esta=#{cod_esta};
        delete from cuaderno1 where id_historial=#{id_historial} and cod_esta=#{cod_esta};
        update historiales set n_c1=0 where id_historial=#{id_historial} and cod_esta=#{cod_esta} 
    </delete>
  
    <update id="setModificarC2">
        update cuaderno2
        set  fum = #{fum}, nembarazo=#{nembarazo}       
        where id_cuaderno = #{id_cuaderno} 
    </update>
    
    <update id="setModificarCodigo">
        update facturas
        set  cod= #{aspecto}       
        where id_factura = #{suma1} and cod_esta = #{suma2}; 
    </update>
  
    <insert id="setCrearCuaderno2">
        insert into cuaderno2 (id_historial, suma1,suma2, suma3, suma4,pap,referido,contraref,tabletas ,sfembarazada,sfpuerpera,
        vitamina,parto,anestesia,peso,estado,controlpos,semanas,eclam,aborto,hemo,imc,nembarazo,fum, sexo,gramos,numero,
        id_referido,id_contraref, alimcompl,lactmaterna,apeprecoz,bonojap,rn48h,mujer48h,muertemat,muertern,num_pap,res_pap,
        ivaa,num_ivaa,res_ivaa,mama,res_mama,fuera,fec_reg,id_persona,cod_esta,rnmalformacion,id_refer)
        values (#{id_historial}, #{suma1},#{suma2}, #{suma3} , #{suma4},#{pap},#{referido},#{contraref},#{tabletas},#{sfembarazada},
        #{sfpuerpera},#{vitamina},#{parto},#{anestesia},#{peso},#{estado},#{controlpos},#{semanas},#{eclam},#{aborto},#{hemo},#{imc},
        #{nembarazo},#{fum},#{sexo},#{auto},#{numpieza},#{suma30},#{suma31},#{suma32},#{suma33},#{suma34},#{suma35},#{suma36},#{suma37},
        #{suma38},#{suma39},#{suma10},#{suma11},#{suma12},#{suma13},#{suma14},#{suma15},#{suma16},#{tipo_egreso},now(),#{id_persona},
        #{cod_esta},#{suma50},#{suma51}) ;
        
        update historiales set n_c2=1 where id_historial=#{id_historial} and cod_esta=#{cod_esta};
        <!--CNS
insert into cuaderno1 (id_historial, suma1,suma2, suma3 , suma4, suma5,tipoconsulta,referido,contraref,speso,alcohol,fuma,
violencia,auto, urinaria, sistemica, arterial, diabetes, glome, tracto, lupus, litiasis, nooplasia, nefro, disli, frenal, 
bajopeso, prematuro, eritro, renal, tuberculo, otro, cardio, reuma, cancer, cancero, depre, epilepsia, psico, discapa,
hba,gfr,creatinina,colesterol,imc,pies,ojos,dieta,ejercicios,observaciones,id_referido,id_contraref,tipo,motivo,fallecido,
atencion,alta,mortalidad,cod_esta,c4_pt,c4_te,c4_hierro,c4_vitaa,semges,numcontrol)
values (#{id_historial},1,0,0,0,0,'N',#{referido},#{contraref},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,#{imc},0,0,0,0,0,#{suma30},#{suma31},3,0,0,0,0,0,#{cod_esta},'X','X',#{sfembarazada},'X',#{semanas},#{numpieza}) ;--> 
        <!--suma30 y suma31 cod referencia y contrareferencia  -->    
        <!--delete from cuaderno1 where id_historial=#{id_historial} and (cod_esta=400010 or cod_esta=400009 or cod_esta=400014 or cod_esta=400015 or cod_esta=400007 or 
        cod_esta=400026 or cod_esta=400029 or cod_esta=400011 or cod_esta=700239);--> 
    </insert>
  
    <resultMap id="sniscontrolpre" type="Cuadernos">
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="sfembarazada"        column="sfembarazada"/>
        <result property="sfpuerpera"          column="sfpuerpera"/>
        <result property="vitamina"            column="vitamina"/>
        <result property="semanas"             column="semanas"/>
    </resultMap>
  
    <select id="getSnis301ControlPre" resultMap="sniscontrolpre">
        select suma1,suma2,suma3,suma4,sfembarazada,sfpuerpera,vitamina,semanas from __snisc2
        where mes=#{mes} and gestion=#{gestion} and tipoconsulta=#{tipoconsulta} 
    </select> 
  
    <resultMap id="datoscuaderno2" type="Cuadernos">
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="id_laboratorio"      column="id_laboratorio"/>
        <result property="fechap"              column="fechap"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="registro"            column="registro"/>
        <result property="nombres"             column="nombres"/>
        <result property="edad"                column="edad"/>
        <result property="semanas"             column="semanas"/>
        <result property="fum"                 column="fum"/>
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="pap"                 column="pap"/>
        <result property="parto"               column="parto"/>
        <result property="anestesia"           column="anestesia"/>
        <result property="pesonac"              column="pesonac"/>
        <result property="peso"                column="peso"/>
        <result property="sexo"                column="sexo"/>
        <result property="suma10"              column="suma10"/>
        <result property="talla"               column="talla"/>
        <result property="estado"              column="estado"/>
        <result property="controlpos"          column="controlpos"/>
        <result property="tabletas"            column="tabletas"/>    
        <result property="sfembarazada"        column="sfembarazada"/>
        <result property="sfpuerpera"          column="sfpuerpera"/>
        <result property="vitamina"            column="vitamina"/>
        <result property="referido"            column="referido"/>
        <result property="contraref"           column="contraref"/> 
        <result property="eclam"               column="eclam"/> 
        <result property="aborto"              column="aborto"/> 
        <result property="hemo"                column="hemo"/> 
        <result property="imc"                 column="imc"/>
        <result property="nembarazo"           column="nembarazo"/>
        <result property="diagnostico"         column="diagnostico"/>
        <result property="pa"                  column="pa"/>
        <result property="auto"                column="auto"/>
        <result property="numpieza"            column="numpieza"/>
        <result property="suma30"              column="suma30"/>
        <result property="suma31"              column="suma31"/>
        <result property="suma50"              column="suma50"/>
        <result property="suma51"              column="suma51"/>
    </resultMap>

    <select id="getPacienteCuaderno2" resultMap="datoscuaderno2">
        select id_cuaderno,id_historial as id_laboratorio,fecha as fechap,h.id_persona,hcl as id_historial,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        edad,semanas, fum, suma1,suma2,suma3,suma4,pap,parto,anestesia,cuaderno2.peso as pesonac,h.peso,sexo,gramos as suma10,talla,estado,
        controlpos,tabletas,sfembarazada,sfpuerpera,vitamina,referido,contraref,eclam,aborto,hemo,imc,nembarazo,diagnostico,pa,
        gramos as auto,numero as numpieza,id_referido as suma30,id_contraref as suma31,rnmalformacion as suma50, id_refer as suma51
        from cuaderno2 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where id_historial=#{id_historial} 
    </select>  
  
    <select id="getCuadernoC2" resultMap="datoscuaderno2">
        select id_cuaderno,id_historial as id_laboratorio,fecha as fechap,h.id_persona,hcl as id_historial,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        edad,semanas, fum, suma1,suma2,suma3,suma4,pap,parto,anestesia,cuaderno2.peso as pesonac,h.peso,sexo,gramos as suma10,talla,estado,
        controlpos,tabletas,sfembarazada,sfpuerpera,vitamina,referido,contraref,eclam,aborto,hemo,imc,nembarazo,diagnostico,pa,
        gramos as auto,numero as numpieza,id_referido as suma30,id_contraref as suma31,rnmalformacion as suma50, id_refer as suma51
        from cuaderno2 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where id_historial in (select id_historial from historiales where (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ))
    </select>  
 
    <resultMap id="datoscuaderno4A"   type="Cuadernos">
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="tipoconsulta"        column="tipoconsulta"/>
        <result property="dglobal"             column="dglobal"/>
        <result property="dcronica"            column="dcronica"/>
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="resultado"           column="resultado"/>
        <result property="accion"              column="accion"/>
        <result property="bacterias"           column="bacterias"/>
        <result property="anti"                column="anti"/>
        <result property="cetonas"             column="cetonas"/>
        <result property="alcohol"             column="alcohol"/>
        <result property="aborto"              column="aborto"/>
        <result property="bajopeso"            column="bajopeso"/>
        <result property="bcg"                 column="bcg"/>
        <result property="bilirrubina"         column="bilirrubina"/>
        <result property="cantidad"            column="cantidad"/>
        <result property="color"               column="color"/>
        <result property="cilindros"           column="cilindros"/>
        <result property="espuma"              column="espuma"/>
        <result property="contraref"           column="contraref"/>
        <result property="cristales"           column="cristales"/>
        <result property="fama"                column="fama"/>
        <result property="densidad"            column="densidad"/>
        <result property="estado"              column="estado"/>
        <result property="dhierro"             column="dhierro"/>
        <result property="dvitaa"              column="dvitaa"/>
        <result property="ematies"             column="ematies"/>
        <result property="epiteliales"         column="epiteliales"/>
        <result property="controlpos"          column="controlpos"/>
        <result property="curaciones"          column="curaciones"/>
        <result property="desesti"             column="desesti"/>
        <result property="diabetes"            column="diabetes"/>
        <result property="diasc"               column="diasc"/>
        <result property="diasi"               column="diasi"/> 
        <result property="discapa"             column="discapa"/>
        <result property="disli"               column="disli"/> 
        <result property="diu"                 column="diu"/>
        <result property="dvitaa"              column="dvitaa"/>
        <result property="eclam"               column="eclam"/>
        <result property="fec_egreso"          column="fec_egreso"/>
        <result property="endodoncia"          column="endodoncia"/>
        <result property="glucosa"             column="glucosa"/>
        <result property="granulosos"          column="granulosos"/>
        <result property="hialianos"           column="hialianos"/>
        <result property="laboratorio"         column="laboratorio"/>
        <result property="leucocitos"          column="leucocitos"/>
        <result property="leucocitarios"       column="leucocitarios"/>
        <result property="lmexclu"             column="lmexclu"/>
        <result property="mujerdt"             column="mujerdt"/>
        <result property="nitritos"            column="nitritos"/>
        <result property="observa"             column="observa"/>
        <result property="observaciones"       column="observaciones"/>
        <result property="olor"                column="olor"/>
        <result property="otros"               column="otros"/>
        <result property="penta"               column="penta"/>
        <result property="pesonac"             column="pesonac"/>
        <result property="piocitos"            column="piocitos"/>
        <result property="proteinas"           column="proteinas"/>
        <result property="reaccion"            column="reaccion"/>
        <result property="referido"            column="referido"/>
        <result property="sangre"              column="sangre"/>
        <result property="sbas"                column="sbas"/>
        <result property="sblancos"            column="sblancos"/>
        <result property="scay"                column="scay"/>
        <result property="fec_ingreso"         column="fec_ingreso"/>
        <result property="suma10"               column="suma10"/>
        <result property="suma11"               column="suma11"/>
        <result property="suma12"               column="suma12"/>
        <result property="tipodent"            column="tipodent"/>
    </resultMap>

    <select id="getPacienteCuaderno4A" resultMap="datoscuaderno4A">
        SELECT id_cuaderno,id_historial, t1 as tipoconsulta, dglobal,dcronica ,n11 as suma1,n12 as suma2,
        t2 as resultado,t3 as accion, t4 as bacterias, t5 as anti, t6 as cetonas,
        diarrea as alcohol, diarreadias as aborto,letargico as bajopeso,peligro as bcg,u1 as bilirrubina,
        u2 as cantidad,u3 as color,u4 as cilindros,u5 as espuma,u6 as contraref,u7 as cristales,u8 as fama,
        u9 as densidad,u10 as estado,u11 as dhierro,u12 as dvitaa,u13 as ematies,u14 as epiteliales, 
        respira as controlpos,respiradias as curaciones, fiebre as desesti, oido as diabetes, p1 as diasc,
        p2 as diasi, p3 as discapa, p4 as disli, p5 as diu, n13 as suma4, vacunas as eclam, 
        fvacuna as fec_egreso, desarrollo as endodoncia, u15 as glucosa, n14 as suma5, u16 as granulosos, 
        u17 as hialianos, u18 as laboratorio, u19 as leucocitos, u20 as leucocitarios,  
        u21 as lmexclu, u22 as mujerdt, u23 as nitritos, u24 as observa, u25 as observaciones, u26 as olor, 
        u27 as otros, u28 as penta, u29 as pesonac, u30 as piocitos, u31 as proteinas,u32 as reaccion,
        u33 as referido,u34 as sangre,u35 as sbas,u36 as sblancos,u37 as scay,fvisita as fec_ingreso,m1 as tipodent,
        bja as suma10, id_refer as suma11, mortalidad as suma12
        FROM cuaderno4
        where id_historial=#{id_historial} 
    </select>
  
    <resultMap id="datoscuaderno4" type="Cuadernos">
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="tipoconsulta"        column="tipoconsulta"/>
        <result property="dglobal"             column="dglobal"/>
        <result property="dcronica"            column="dcronica"/>
        <result property="suma1"               column="suma1"/>
        <result property="dhierro"             column="dhierro"/>
        <result property="dvitaa"              column="dvitaa"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma2"               column="suma2"/>
        <result property="lmexclu"             column="lmexclu"/>
        <result property="desesti"             column="desesti"/>
        <result property="contraref"           column="contraref"/>
        <result property="referido"            column="referido"/> 
        <result property="seleccion"           column="seleccion"/>
        <result property="observa"             column="observa"/>
        <result property="resultado"           column="resultado"/>
        <result property="numpieza"            column="numpieza"/>
        <result property="suma30"              column="suma30"/>
        <result property="suma31"              column="suma31"/>
        <result property="suma15"              column="suma15"/>
        <result property="suma10"               column="suma10"/>
        <result property="suma11"               column="suma11"/>
        <result property="suma12"               column="suma12"/>
        <result property="tipo_egreso"         column="tipo_egreso"/>
    </resultMap>

    <select id="getPacienteCuaderno4" resultMap="datoscuaderno4">
        SELECT id_cuaderno,id_historial, tipoconsulta , dglobal,dcronica,suma1,dhierro,dvitaa,suma4,suma5,suma2,lmexclu,desesti,
        contraref,referido, seleccion,dgloba as observa, clasifica as resultado,puntaje as numpieza,id_referido as suma30,
        id_contraref as suma31, item15 as suma15,fuera as tipo_egreso,bja as suma10, id_refer as suma11, mortalidad as suma12
        FROM cuaderno4
        where id_historial=#{id_historial} 
    </select>
  
    <select id="getCuadernoC4" resultMap="datoscuaderno4">
        SELECT id_cuaderno,id_historial, tipoconsulta , dglobal,dcronica,suma1,dhierro,dvitaa,suma4,suma5,suma2,lmexclu,desesti,
        contraref,referido, seleccion,dgloba as observa, clasifica as resultado,puntaje as numpieza,id_referido as suma30,
        id_contraref as suma31, item15 as suma15,fuera as tipo_egreso,bja as suma10, id_refer as suma11, mortalidad as suma12
        FROM cuaderno4
        where id_historial in (select id_historial from historiales where (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin}) )
    </select>
  
    <delete id="setEliminarCuaderno4">
        delete from cuaderno4 where id_cuaderno=#{id_cuaderno} and id_historial=#{id_historial} and cod_esta=#{cod_esta};
        update historiales set n_c4=1 where id_historial=#{id_historial} and cod_esta=#{cod_esta};
        delete from cuaderno1 where id_historial=#{id_historial} and cod_esta=#{cod_esta};
        update historiales set n_c1=0 where id_historial=#{id_historial} and cod_esta=#{cod_esta} 
    </delete>
  
    <insert id="setCrearCuaderno4">
        insert into cuaderno4 ( id_historial, tipoconsulta ,  dglobal,  dcronica,  suma1,  dhierro,  dvitaa, suma4,
        suma5,suma2,lmexclu,  desesti,  contraref,  referido, tipo, seleccion,dgloba, 
        anemia, edema, emacia, id_item1, id_item2, id_item3,id_item4, id_item5, punta1, punta2, punta3, 
        punta4, punta5, clasifica,id_referido,id_contraref,fuera,fec_reg,id_persona,
        cod_esta,bja,id_refer,mortalidad)
        values (#{id_historial},#{tipoconsulta},#{dglobal},#{dcronica},#{suma1},#{dhierro},#{dvitaa},#{suma4},
        #{suma5},#{suma2},#{lmexclu}, #{desesti}, #{contraref},#{referido},#{tabletas},#{seleccion},#{observa},
        #{auto},#{urinaria},#{sistemica},
        #{arterial},#{diabetes},#{glome},#{tracto},#{lupus},#{litiasis},#{nooplasia},#{nefro},#{disli},#{frenal},#{resultado},#{suma30},
        #{suma31},#{tipo_egreso},now(),#{id_persona},#{cod_esta},#{suma10},#{suma11},#{suma12}) ;
        
        update historiales set n_c4=1 where id_historial=#{id_historial} and cod_esta=#{cod_esta};
        <!--CNS DL202
insert into cuaderno1 (id_historial, suma1,suma2, suma3 , suma4, suma5,tipoconsulta,referido,contraref,speso,alcohol,fuma,
violencia,auto, urinaria, sistemica, arterial, diabetes, glome, tracto, lupus, litiasis, nooplasia, nefro, disli, frenal, 
bajopeso, prematuro, eritro, renal, tuberculo, otro, cardio, reuma, cancer, cancero, depre, epilepsia, psico, discapa,
hba,gfr,creatinina,colesterol,imc,pies,ojos,dieta,ejercicios,observaciones,id_referido,id_contraref,tipo,motivo,fallecido,
atencion,alta,mortalidad,cod_esta,c4_pt,c4_te,c4_hierro,c4_vitaa)
values (#{id_historial},1,0,0,0,0,#{tipoconsulta},#{referido},#{contraref},0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
        0,0,0,0,0,0,0,0,0,0,0,0,#{suma30},#{suma31},3,0,0,0,0,0,#{cod_esta},#{dglobal},#{dcronica},#{dhierro},#{dvitaa});-->
        <!--suma30 y suma31 cod referencia y contrareferencia  --> 
        <!--delete from cuaderno1 where id_historial=#{id_historial} and (cod_esta=400010 or cod_esta=400009 or cod_esta=400014 or cod_esta=400015 or cod_esta=400007 or 
        cod_esta=400026 or cod_esta=400029 or cod_esta=400011 or cod_esta=700239);-->
    </insert>
  
    <update id="setModificarCuaderno4">
        update cuaderno4
        set  id_historial=#{id_historial},tipoconsulta=#{tipoconsulta},dglobal=#{dglobal},dcronica=#{dcronica},suma1=#{suma1},dhierro=#{dhierro},
        dvitaa=#{dvitaa},suma4=#{suma4},suma5=#{suma5},suma2=#{suma2},lmexclu=#{lmexclu},desesti=#{desesti},contraref=#{contraref},  
        referido=#{referido},tipo=#{aqv},seleccion=#{seleccion}, dgloba=#{observa},anemia=#{auto},edema=#{urinaria},emacia=#{sistemica},
        id_item1=#{arterial},id_item2=#{diabetes},id_item3=#{glome},id_item4=#{tracto},id_item5=#{lupus},punta1=#{litiasis},
        punta2=#{nooplasia},punta3=#{nefro},punta4=#{disli}, punta5=#{frenal},clasifica=#{resultado},puntaje=#{numpieza} 
        where  id_historial = #{id_historial};
    </update> 
    
    <update id="setModificarCuaderno24">
        update cuaderno4
        set  item1=#{suma1}, item2=#{suma2}, item3=#{suma3}, item4=#{suma4}, item5=#{suma5}, item6=#{suma6}, item7=#{suma7}, item8=#{suma8}, 
        item9=#{suma9}, item10=#{suma10}, item11=#{suma11}, item12=#{suma12}, item13=#{suma13}, item14=#{suma14}, item15=#{suma15} 
        where  id_historial = #{id_historial};
    </update> 
  
    <update id="setModificarCuaderno4A" >
        update cuaderno4
        set   n11=#{desesti},t1=#{tipoconsulta},t2=#{resultado},m1=#{tipodent} 
        where  id_historial = #{id_historial};
    </update>
  
    <update id="setModificarCuaderno4B" >
        update cuaderno4
        set    diarrea=#{auto},diarreadias=#{aqv},n12=#{desesti},t3=#{tipoconsulta},t4=#{resultado},t5=#{accion},t6=#{bacterias} 
        where  id_historial = #{id_historial};
    </update>
  
    <update id="setModificarCuaderno4C">
        update cuaderno4
        set    letargico=#{bajopeso},peligro=#{bcg},u1=#{bilirrubina},u2=#{cantidad},u3=#{cetonas},u4=#{cilindros},m1=#{tipodent} 
        where  id_historial = #{id_historial};
    </update>
  
    <update id="setModificarCuaderno4D">
        update cuaderno4
        set    u5=#{espuma},u6=#{contraref},u7=#{cristales},u8=#{fama},u9=#{densidad},u10=#{estado},
        u11=#{dhierro},u12=#{dvitaa},u13=#{ematies},u14=#{epiteliales},respira=#{controlpos},respiradias=#{curaciones},
        diarrea=#{depre},fiebre=#{desesti},oido=#{diabetes},p1=#{diasc},p2=#{diasi},p3=#{discapa},
        p4=#{disli},p5=#{diu},n13=#{condon} 
        where  id_historial = #{id_historial};
    </update>
  
    <update id="setModificarCuaderno4E">
        update cuaderno4
        set    vacunas=#{eclam},fvacuna=#{fec_egreso},desarrollo=#{endodoncia},u15=#{glucosa} 
        where  id_historial = #{id_historial};
    </update>
  
    <update id="setModificarCuaderno4F">
        update cuaderno4
        set    u16=#{granulosos},u17=#{hialianos},u18=#{laboratorio},u19=#{leucocitos},u20=#{leucocitarios},
        u21=#{lmexclu},u22=#{mujerdt},u23=#{nitritos},u24=#{observa},u25=#{observaciones},
        u26=#{olor},u27=#{otros},u28=#{penta},u29=#{pesonac},u30=#{piocitos},u31=#{proteinas},n14=#{suma5},
        u32=#{reaccion},u33=#{referido} 
        where  id_historial = #{id_historial};  
    </update>
  
    <update id="setModificarCuaderno4G">
        update cuaderno4
        set    u34=#{sangre},u35=#{sbas},u36=#{sblancos},u37=#{scay},fvisita=#{fec_ingreso} 
        where  id_historial = #{id_historial};
    </update>
  
    <resultMap id="datosvacunas" type="Cuadernos">
        <result property="id_historial"        column="id_historial"/>
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="polio"               column="polio"/>
        <result property="penta"               column="penta"/>
        <result property="anti"                column="anti"/> 
        <result property="bacterias"           column="bacterias"/>
        <result property="cancer"              column="cancer"/>
        <result property="cancero"             column="cancero"/>
        <result property="auto"                column="auto"/>
        <result property="mujerdt"             column="mujerdt"/> 
        <result property="bcg"                 column="bcg"/> 
        <result property="rhumana"             column="rhumana"/>
        <result property="rcanina"             column="rcanina"/>
        <result property="srp"                 column="srp"/> 
        <result property="fama"                column="fama"/>
        <result property="dvitaa"              column="dvitaa"/>
        <result property="tipo_egreso"         column="tipo_egreso"/>
        <result property="sr"                  column="sr"/>
        <result property="vph"                 column="vph"/>
    </resultMap>

    <select id="getPacienteVacunas" resultMap="datosvacunas">
        SELECT id_historial,id_cuaderno,polio,penta,anti,neumo as bacterias,influenza as cancer,dpt as cancero,
        hepatitis as auto,mujerdt,bcg,rhumana,rcanina,srp,fama,dvitaa,fuera as tipo_egreso,sr, vph
        FROM vacunas
        where id_historial=#{id_historial} and cod_esta=#{cod_esta} 
    </select>
  
    <select id="getCuadernoV" resultMap="datosvacunas">
        SELECT id_historial,id_cuaderno,polio,penta,anti,neumo as bacterias,influenza as cancer,dpt as cancero,
        hepatitis as auto,mujerdt,bcg,rhumana,rcanina,srp,fama,dvitaa,fuera as tipo_egreso,sr, vph
        FROM vacunas
        where id_historial in (select id_historial from historiales where (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) )
    </select>
  
    <insert id="setCrearVacunas" >
        insert into vacunas (id_historial,polio,penta,anti,neumo,fechap,id_persona,mujerdt,bcg,influenza,dpt,hepatitis,rhumana,
        rcanina,srp,fama,dvitaa,fuera,cod_esta,sr,vph)
        values (#{id_historial},#{polio},#{penta},#{anti},#{bacterias},#{fechap},#{id_persona},#{mujerdt},#{bcg},#{cancer},#{cancero},#{auto},
        #{rhumana},#{rcanina},#{srp},#{fama},#{dvitaa},#{tipo_egreso},#{cod_esta},#{suma1},#{suma2}) ;
        
        update historiales set n_cv=1 where id_historial=#{id_historial} and cod_esta=#{cod_esta}
    </insert>
  
    <delete id="setEliminarVacunas" >
        delete from vacunas where id_cuaderno=#{id_cuaderno} and id_historial=#{id_historial} and cod_esta=#{cod_esta};
        
        update historiales set n_cv=0 where id_historial=#{id_historial} and cod_esta=#{cod_esta};
    </delete>
  
    <resultMap id="snisvacunass" type="Cuadernos">
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
    </resultMap>
  
    <select id="getSnis301Vacunas" resultMap="snisvacunass">
        select * from __snisva 
        where tipoconsulta=#{tipoconsulta} and mes=#{mes} and gestion=#{gestion} 
    </select> 
  
    <resultMap id="odonmensual" type="Cuadernos">
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma6"               column="suma6"/>
        <result property="suma7"               column="suma7"/>
        <result property="suma8"               column="suma8"/>
        <result property="suma9"               column="suma9"/>
        <result property="suma10"              column="suma10"/>
        <result property="suma11"              column="suma11"/>
        <result property="suma12"              column="suma12"/>
        <result property="suma13"              column="suma13"/>
        <result property="suma14"              column="suma14"/>
        <result property="suma15"              column="suma15"/>
    </resultMap>
  
    <select id="getOdonMensual" resultMap="odonmensual">
        select * from __snisc7odon order by suma15
    </select> 
  
    <resultMap id="datoscuaderno6" type="Cuadernos">
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="fechap"              column="fechap"/>
        <result property="estado"              column="estado"/>
        <result property="laboratorio"         column="laboratorio"/>
        <result property="resultado"           column="resultado"/>    
        <result property="tipo"                column="tipo"/>
        <result property="tipoconsulta"        column="tipoconsulta"/>
        <result property="inyectable"          column="inyectable"/>
        <result property="sueros"              column="sueros"/>
        <result property="curaciones"          column="curaciones"/>
        <result property="aspecto"             column="aspecto"/>
        <result property="bacterias"           column="bacterias"/>
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/> 
        <result property="suma6"               column="suma6"/> 
        <result property="suma20"               column="suma20"/>
        <result property="suma21"               column="suma21"/>
        <result property="suma22"               column="suma22"/>
        <result property="suma23"               column="suma23"/>
        <result property="suma24"               column="suma24"/>
        <result property="suma25"               column="suma25"/>
        <result property="suma26"               column="suma26"/>
        <result property="suma27"               column="suma27"/>
        <result property="suma28"               column="suma28"/>
        <result property="suma29"               column="suma29"/>
        <result property="suma30"               column="suma30"/>
        <result property="suma31"               column="suma31"/>
        <result property="suma32"               column="suma32"/>
        <result property="suma33"               column="suma33"/>
        <result property="suma34"               column="suma34"/>
        <result property="suma35"               column="suma35"/>
        <result property="suma36"               column="suma36"/>
        <result property="suma37"               column="suma37"/>
        <result property="suma38"               column="suma38"/>
        <result property="suma39"               column="suma39"/>
        <result property="suma40"               column="suma40"/>
        <result property="suma41"               column="suma41"/>
        <result property="suma42"               column="suma42"/>
        <result property="id_historial"         column="id_historial"/>  
    </resultMap>

    <select id="getPacienteCuaderno6" resultMap="datoscuaderno6">
        SELECT id_cuaderno,fechap,ingreso as estado,tratamiento as laboratorio, egreso as resultado,tipo, tipoconsulta ,inyectable,
        sueros,curaciones,suma1,suma2,suma3,suma4,suma5,suma6,id_historial,tratante as aspecto,accionmed as bacterias, 
        tcuracion as suma20,biopsia as suma21, sonda as suma22, actividad as suma23, hidrata as suma24, oxigeno as suma25,
        lipomas as suma26,suturas as suma27, retpunto as suma28, colocaciones as suma29, tinyecta as suma30, tsuero as suma31, 
        cirugia as suma32, trabquiro as suma33, bloqueo as suma34, drenaje as suma35, oninitomia as suma36, taponamiento as suma37,
        inmovilizacion as suma38,frenectomia as suma39, tendinorrafia as suma40, infeccion as suma41, tinyectable as suma42
        FROM cuaderno6
        where id_persona=#{id_persona} and fechap::date=current_date and id_historial in (select id_historial from historiales where id_paciente=#{id_paciente})
    </select>
  
    <select id="getPacienteCuaderno6H" resultMap="datoscuaderno6">
        SELECT id_cuaderno,fechap,ingreso as estado,tratamiento as laboratorio, egreso as resultado,tipo, tipoconsulta ,inyectable,
        sueros,curaciones,suma1,suma2,suma3,suma4,suma5,suma6,id_historial,tratante as aspecto,accionmed as bacterias, 
        tcuracion as suma20,biopsia as suma21, sonda as suma22, actividad as suma23, hidrata as suma24, oxigeno as suma25,
        lipomas as suma26,suturas as suma27, retpunto as suma28, colocaciones as suma29, tinyecta as suma30, tsuero as suma31, 
        cirugia as suma32, trabquiro as suma33, bloqueo as suma34, drenaje as suma35, oninitomia as suma36, taponamiento as suma37,
        inmovilizacion as suma38,frenectomia as suma39, tendinorrafia as suma40, infeccion as suma41, tinyectable as suma42
        FROM cuaderno6
        where id_historial=#{id_historial} 
    </select>
  
    <select id="getCuadernoC6" resultMap="datoscuaderno6">
        SELECT id_cuaderno,fechap,ingreso as estado,tratamiento as laboratorio, egreso as resultado,tipo, tipoconsulta ,inyectable,
        sueros,curaciones,suma1,suma2,suma3,suma4,suma5,suma6,id_historial,tratante as aspecto,accionmed as bacterias, 
        tcuracion as suma20,biopsia as suma21, sonda as suma22, actividad as suma23, hidrata as suma24, oxigeno as suma25,
        lipomas as suma26,suturas as suma27, retpunto as suma28, colocaciones as suma29, tinyecta as suma30, tsuero as suma31, 
        cirugia as suma32, trabquiro as suma33, bloqueo as suma34, drenaje as suma35, oninitomia as suma36, taponamiento as suma37,
        inmovilizacion as suma38,frenectomia as suma39, tendinorrafia as suma40, infeccion as suma41, tinyectable as suma42
        FROM cuaderno6
        where id_historial in (select id_historial from historiales where (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin} )
    </select>
  
    <insert id="setCrearCuaderno6" >
        insert into cuaderno6 (nombres,edad,id_tipo_sexo,ingreso,tratamiento,egreso, suma1,suma2, suma3, suma4, suma5, suma6, 
        referido,contraref,inyectable,sueros,curaciones,tipo,tipoconsulta ,fechap,id_persona,id_historial,
        id_consultorio,tratante,accionmed,tcuracion,biopsia,sonda,actividad,hidrata,oxigeno,lipomas,suturas,retpunto,
        colocaciones,tinyecta,tsuero,cirugia,trabquiro,bloqueo,drenaje,oninitomia,taponamiento,inmovilizacion,frenectomia,
        tendinorrafia,infeccion,tinyectable,cod_esta)
        values (#{nombres}, #{edad}, #{id_cuaderno},#{estado},#{laboratorio}, #{resultado},#{suma1},#{suma2}, #{suma3} , #{suma4}, #{suma5}, #{suma6},
        #{referido},#{contraref},#{inyectable},#{sueros},#{curaciones},#{tipo},#{tipoconsulta},#{fechap},#{id_persona},#{id_historial},
        #{id_consultorio},#{aspecto},#{bacterias},#{suma20},#{suma21},#{suma22},#{suma23},#{suma24},#{suma25},#{suma26},#{suma27},#{suma28}, 
        #{suma29},#{suma30},#{suma31},#{suma32},#{suma33},#{suma34},#{suma35},#{suma36},#{suma37},#{suma38},#{suma39},
        #{suma40},#{suma41},#{suma42},#{cod_esta} ) ;
        
        update historiales set n_c6=1 where id_historial=#{id_historial} and cod_esta=#{cod_esta}       
    </insert>
  
    <delete id="setEliminarCuaderno6" >
        delete from cuaderno6 where id_cuaderno=#{id_cuaderno} and id_historial=#{id_historial} and cod_esta=#{cod_esta};
        update historiales set n_c6=1 where id_historial=#{id_historial} and cod_esta=#{cod_esta} 
    </delete>
    <resultMap id="Listadatoscuaderno6" type="Cuadernos">
        <result property="id_laboratorio"       column="id_laboratorio"/>
        <result property="id_historial"         column="id_historial"/>
        <result property="fechap"               column="fechap"/>
        <result property="nombres"              column="nombres"/>
        <result property="edad"                 column="edad"/>
        <result property="id_tipo_sexo"         column="id_tipo_sexo"/> 
        <result property="expedido"             column="expedido"/>
    </resultMap>
  
    <select id="getListaPacientesCuaderno6xxx" resultMap="Listadatoscuaderno6">  
        select id_paciente as id_laboratorio,id_historial,fechap,nombres,h.edad,id_tipo_sexo,expedido
        from cuaderno6 c
        join historiales h using(id_historial) 
        where c.id_persona=#{id_persona} and fechap::date=current_date
        order by fechap,id_cuaderno
    </select>
  
    <resultMap id="datosCuaderno6" type="Cuadernos">
        <result property="id_historial"          column="id_historial"/>
        <result property="id_estado"             column="id_estado"/>
        <result property="nombres"               column="nombres"/> 
        <result property="edad"                  column="edad"/>      
        <result property="expedido"              column="expedido"/>            
        <result property="fecha"                 column="fecha"/>    
        <result property="id_persona"            column="id_persona"/>  
        <result property="id_consultorio"        column="id_consultorio"/>    
        <result property="id_paciente"           column="id_paciente"/>    
        <result property="edad_ini"              column="edad_ini"/>     
        <result property="edad_fin"              column="edad_fin"/>     
        <result property="id_tipo_documento"     column="id_tipo_documento"/>    
        <result property="id_tipo_parentesco"    column="id_tipo_parentesco"/>    
        <result property="id_pais"               column="id_pais"/>    
        <result property="id_departamento"       column="id_departamento"/>
        <result property="num"                   column="num"/> 
        <result property="id_provincia"          column="id_provincia"/>         
        <result property="id_localidad"          column="id_localidad"/>
        <result property="id_reservacion"        column="id_reservacion"/>
        <result property="embarazo"              column="embarazo"/>
        <result property="id_cargo"              column="id_cargo"/>   
        <result property="rango"                 column="rango"/>  
        <result property="suma50"                column="suma50"/>
    </resultMap>
  
    <select id="getListaPacientesCuaderno6Total" resultMap="datosCuaderno6">  
        select * from _verifica_atencion_enfer(#{fecha_ini},#{fecha_fin},#{id_persona})  
        as (id_historial integer,id_estado text,nombres text,edad integer,expedido text,fecha timestamp without time zone,
        id_persona integer,id_consultorio integer,id_paciente integer, edad_ini integer,edad_fin integer, 
        id_tipo_documento integer,id_tipo_parentesco integer,id_pais integer,id_departamento integer,num integer,
        id_provincia integer,id_localidad integer,id_reservacion integer,embarazo integer,id_cargo integer,
        rango integer,suma50 integer)
        order by fecha,nombres
    </select>
  
    <resultMap id="datosCuaderno6_1" type="Cuadernos">
        <result property="id_historial"          column="id_historial"/>
        <result property="id_estado"             column="id_estado"/>
        <result property="nombres"               column="nombres"/> 
        <result property="edad"                  column="edad"/>      
        <result property="expedido"              column="expedido"/>            
        <result property="fecha"                 column="fecha"/>    
        <result property="id_persona"            column="id_persona"/>  
        <result property="id_consultorio"        column="id_consultorio"/>    
        <result property="id_paciente"           column="id_paciente"/>    
        <result property="edad_ini"              column="edad_ini"/>     
        <result property="edad_fin"              column="edad_fin"/>     
        <result property="id_tipo_documento"     column="id_tipo_documento"/>    
        <result property="suma50"                column="suma50"/>
    </resultMap>
  
    <select id="getListaPacientesCuaderno6" resultMap="datosCuaderno6_1">  
        select id_paciente,id_historial,fechap as fecha,nombres,h.edad,id_tipo_sexo,expedido, id_estado, c.id_persona, 
        c.id_consultorio,id_seguro,n_rec as edad_ini,n_475 as edad_fin,n_c6 as id_tipo_documento,0 as suma50
        from cuaderno6 c
        join historiales h using(id_historial) 
        where  c.id_persona=#{id_persona} and c.cod_esta=#{cod_esta} and
        fechap::timestamp between (now()::timestamp - interval '24 hours') and (now()::timestamp + interval '2 hours')
        order by fechap desc,nombres
    </select>
 
    <resultMap id="snisenfermeria" type="Cuadernos">
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
    </resultMap>
 
    <select id="getSnis301Enfermeria" resultMap="snisenfermeria">
        select * from __snisc6 where mes=#{mes} and gestion=#{gestion} 
    </select> 
    
    <resultMap id="vdental" type="Cuadernos">
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="fechap"              column="fechap"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="tipoconsulta"        column="tipoconsulta"/>
        <result property="tipodent"            column="tipodent"/> 
        <result property="exodoncia"           column="exodoncia"/>  
        <result property="restauracion"        column="restauracion"/>    
        <result property="periodoncia"         column="periodoncia"/>
        <result property="endodoncia"          column="endodoncia"/>
        <result property="numpieza"            column="numpieza"/> 
        <result property="resultado"           column="resultado"/> 
        <result property="referido"            column="referido"/>
    </resultMap>
  
    <select id="getVerDental" resultMap="vdental"> 
        SELECT id_cuaderno,fecha as fechap,h.id_historial,tipoconsulta,tipodent,exodoncia,restauracion,periodoncia,
        endodoncia,numpieza,tratamiento as resultado, expedido as referido 
        from cuaderno7
        join historiales h using(id_historial)
        where pacientes.id_paciente=#{id_paciente}        
        order by fecha,h.id_historial
    </select> 
  
    <resultMap id="vcuaderno7" type="Cuadernos">
        <result property="fechap"              column="fechap"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="nombres"             column="nombres"/>
        <result property="dglobal"             column="dglobal"/>
        <result property="primera"             column="primera"/>
        <result property="edad"                 column="edad"/>
        <result property="tipoconsulta"        column="tipoconsulta"/>   
        <result property="endodoncia"          column="endodoncia"/>
        <result property="restauracion"        column="restauracion"/>    
        <result property="periodoncia"         column="periodoncia"/>
        <result property="cirugia"             column="cirugia"/>
        <result property="exodoncia"           column="exodoncia"/>  
        <result property="rayosx"              column="rayosx"/>   
        <result property="preventiva"          column="preventiva"/>
        <result property="otras"               column="otras"/>
        <result property="tipo"                column="tipo"/>
        <result property="tipodent"            column="tipodent"/> 
        <result property="referido"            column="referido"/>
        <result property="contraref"           column="contraref"/> 
        <result property="numpieza"            column="numpieza"/> 
        <result property="embarazo"            column="embarazo"/>  
        <result property="resultado"           column="resultado"/> 
        <result property="codigo"              column="codigo"/> 
    </resultMap>
  
    <select id="getVerCuaderno7Uni" resultMap="vcuaderno7"> 
        select fecha as fechap,h.id_persona,hcl as id_historial,id_tipo_sexo as id_cuaderno,
        (paterno||' '||materno||' '||nombre) as nombres,codigo as dglobal,primera,edad,tipoconsulta,
        endodoncia,restauracion,periodoncia,cirugia,exodoncia,rayosx,preventiva,otras,tipo,tipodent,
        referido,contraref,numpieza,embarazada as embarazo, tratamiento as resultado,cie10 as codigo
        from cuaderno7 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where pacientes.id_paciente=#{id_paciente}        
        order by fecha,cuaderno7.id_cuaderno,h.id_historial
    </select> 
  
    <select id="getVerCuaderno7Paci" resultMap="vcuaderno7"> 
        select fecha as fechap,h.id_persona,hcl as id_historial,id_tipo_sexo as id_cuaderno,
        (paterno||' '||materno||' '||nombre) as nombres,codigo as dglobal,primera,edad,cuaderno7.tipoconsulta,
        endodoncia,restauracion,periodoncia,cirugia,exodoncia,rayosx,preventiva,otras,tipo,tipodent,
        referido,contraref,numpieza,embarazada as embarazo, tratamiento as resultado,cie10 as codigo
        from cuaderno7 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where pacientes.id_paciente=#{id_paciente}        
        order by fecha,cuaderno7.id_cuaderno,h.id_historial
    </select> 
    
    <select id="getVerCuaderno7" resultMap="vcuaderno7">
        select fecha as fechap,h.id_persona,hcl as id_historial,id_tipo_sexo as id_cuaderno,
        (paterno||' '||materno||' '||nombre) as nombres,codigo as dglobal,primera,edad,tipoconsulta,
        endodoncia,restauracion,periodoncia,cirugia,exodoncia,rayosx,preventiva,otras,tipo,tipodent,
        referido,contraref,numpieza,embarazada as embarazo, tratamiento as resultado,cie10 as codigo
        from cuaderno7 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where ( date(fecha) BETWEEN date(#{fecha_ini}) and date(#{fecha_fin}) ) and h.id_persona=#{id_persona}
        order by fecha,cuaderno7.id_cuaderno,h.id_historial
    </select> 
    
    <select id="getVerCuaderno7Todos" resultMap="vcuaderno7">
        select fecha as fechap,h.id_persona,hcl as id_historial,id_tipo_sexo as id_cuaderno,
        (paterno||' '||materno||' '||nombre) as nombres,codigo as dglobal,primera,edad,tipoconsulta,
        endodoncia,restauracion,periodoncia,cirugia,exodoncia,rayosx,preventiva,otras,tipo,tipodent,
        referido,contraref,numpieza,embarazada as embarazo, tratamiento as resultado,cie10 as codigo
        from cuaderno7 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where ( date(fecha) BETWEEN date(#{fecha_ini}) and date(#{fecha_fin}) )
        order by fecha,cuaderno7.id_cuaderno,h.id_historial
    </select>
 
    <resultMap id="vvacunas" type="Cuadernos">
        <result property="id_persona"          column="id_persona"/>  
        <result property="id_historial"        column="id_historial"/>
        <result property="registro"            column="registro"/>
        <result property="fechap"              column="fechap"/>    
        <result property="nombres"             column="nombres"/>
        <result property="fec_nacimiento"      column="fec_nacimiento"/>    
        <result property="edad"                column="edad"/>
        <result property="mes"                 column="mes"/>
        <result property="dia"                 column="dia"/>
        <result property="id_tipo_sexo"        column="id_tipo_sexo"/>
        <result property="polio"               column="polio"/>
        <result property="penta"               column="penta"/>
        <result property="anti"                column="anti"/> 
        <result property="bacterias"           column="bacterias"/>
        <result property="cancer"              column="cancer"/>
        <result property="cancero"             column="cancero"/>
        <result property="auto"                column="auto"/>
        <result property="mujerdt"             column="mujerdt"/> 
        <result property="bcg"                 column="bcg"/> 
        <result property="rhumana"             column="rhumana"/>
        <result property="rcanina"             column="rcanina"/>
        <result property="srp"                 column="srp"/> 
        <result property="sr"                  column="sr"/> 
        <result property="vph"                 column="vph"/> 
        <result property="fama"                column="fama"/>
        <result property="dvitaa"              column="dvitaa"/>    
    </resultMap>
  
    <select id="getVerVacunasUni" resultMap="vvacunas">
        select vacunas.id_persona,hcl as id_historial,nro_registro as registro,fechap,(paterno||' '||materno||' '||nombre) as nombres,
        fec_nacimiento ,edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,fec_nacimiento))::int  as dia,
        id_tipo_sexo,polio,penta,anti,neumo as bacterias,influenza as cancer,dpt as cancero,hepatitis as auto,mujerdt,bcg,rhumana,rcanina,
        srp,fama,dvitaa,sr,vph
        from vacunas
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where h.cod_esta=#{cod_esta} and h.id_paciente=#{id_paciente}      
        order by fecha,h.id_historial
    </select>   
   
    <select id="getVerVacunas" resultMap="vvacunas">
        select vacunas.id_persona,hcl as id_historial,nro_registro as registro,fechap,(paterno||' '||materno||' '||nombre) as nombres,
        fec_nacimiento ,edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,
        extract(day from age( h.fecha,fec_nacimiento))::int  as dia,  id_tipo_sexo,polio,penta,anti,neumo as bacterias,
        influenza as cancer,dpt as cancero,hepatitis as auto,mujerdt,bcg,rhumana,rcanina,srp,fama,dvitaa,sr,vph
        from vacunas
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where h.cod_esta=#{cod_esta} and ( date(fecha) BETWEEN date(#{fecha_ini}) and date(#{fecha_fin}) ) and vacunas.id_persona=#{id_persona} 
        and fuera=#{bcg}
        order by fecha,h.id_historial
    </select>   
   
    <select id="getVerVacunasTodos" resultMap="vvacunas"> 
        select vacunas.id_persona,hcl as id_historial,nro_registro as registro,fechap,(paterno||' '||materno||' '||nombre) as nombres,
        fec_nacimiento ,edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,fec_nacimiento))::int  as dia,
        id_tipo_sexo,polio,penta,anti,neumo as bacterias,influenza as cancer,dpt as cancero,hepatitis as auto,mujerdt,bcg,rhumana,rcanina,
        srp,fama,dvitaa,sr,vph
        from vacunas
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where h.cod_esta=#{cod_esta} and ( date(fecha) BETWEEN date(#{fecha_ini})  and date(#{fecha_fin}) ) and fuera=#{bcg}      
        order by fecha,h.id_historial        
    </select>
    
    <resultMap id="vcuaderno1Cie" type="Cuadernos">
        <result property="id_historial"        column="id_historial"/>
        <result property="tipodent"            column="tipodent"/>
        <result property="observaciones"       column="observaciones"/>
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="registro"            column="registro"/>
    </resultMap>
  
    <select id="getVerCuaderno1Cie" resultMap="vcuaderno1Cie"> 
        select id_historial,codigo as tipodent,literal as observaciones,num as id_cuaderno,tipo as registro 
        from detallecie10 
        join cie10 using (codigo)
        where id_historial in (select id_historial from historiales h 
              where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) )
        order by id_historial,num
        <!-- and h.id_persona=#{id_persona} se quita no da para administrador-->
    </select>
   
    <select id="getVerCuaderno1CieUni" resultMap="vcuaderno1Cie"> 
        select id_historial,codigo as tipodent,literal as observaciones,num as id_cuaderno,tipo as registro 
        from detallecie10 
        join cie10 using (codigo)
        where id_historial in (select id_historial from historiales 
                               where id_paciente=#{id_paciente})
        order by id_historial,num
    </select>

    <select id="getVerCuaderno1CieMorbi" resultMap="vcuaderno1Cie">
        select id_historial,codigo as tipodent,literal as observaciones,num as id_cuaderno,tipo as registro 
        from detallecie10
        join cie10 using (codigo)
        where id_historial in (select id_historial from historiales
                              where id_historial=#{id_historial} )
        order by id_historial,num
    </select>
   
    <resultMap id="datosUNI" type="Cuadernos">
        <result property="id_historial"          column="id_historial"/>
        <result property="id_estado"             column="id_estado"/>
        <result property="nombres"               column="nombres"/> 
        <result property="fec_ingreso"           column="fec_ingreso"/>  
        <result property="expedido"              column="expedido"/> 
        <result property="fec_egreso"            column="fec_egreso"/>    
        <result property="id_persona"            column="id_persona"/>            
        <result property="id_consultorio"        column="id_consultorio"/>
        <result property="id_paciente"           column="id_paciente"/>   
        <result property="fec_egreso"            column="fec_egreso"/>
        <result property="alcohol"               column="alcohol"/> 
        <result property="anastecia"             column="anastecia"/> 
        <result property="anestesia"             column="anestesia"/> 
        <result property="ds0"                   column="ds0"/> 
        <result property="ds1"                   column="ds1"/> 
        <result property="anti"                  column="anti"/> 
        <result property="aspecto"               column="aspecto"/> 
        <result property="fechae"                column="fechae"/> 
        <result property="aqv"                   column="aqv"/> 
        <result property="ds2"                   column="ds2"/> 
        <result property="ds3"                   column="ds3"/> 
        <result property="bacterias"             column="bacterias"/>
        <result property="bilirrubina"           column="bilirrubina"/>
        <result property="fechap"                column="fechap"/> 
        <result property="arterial"              column="arterial"/> 
        <result property="m1ds"                  column="m1ds"/>
        <result property="m2ds"                  column="m2ds"/>
        <result property="cetonas"               column="cetonas"/>
        <result property="cilindros"             column="cilindros"/>
        <result property="auto"                  column="auto"/>
        <result property="color"                  column="color"/>
    </resultMap>
  
    <select id="getDatosUni" resultMap="datosUNI">  
        select * from _verifica_atencion_uni(#{id_persona},#{fecha_ini}, #{fecha_fin})  
        as (id_historial integer,id_estado text,nombres text,fec_ingreso date,expedido text,
        id_persona integer,id_consultorio integer,id_paciente integer,
        fec_egreso date,alcohol integer,anastecia integer,anestesia integer,ds0 float,ds1 float,anti text,aspecto text,
        fechae date, aqv integer,ds2 float, ds3 float,bacterias text,bilirrubina text,
        fechap date, arterial integer,m1ds float,m2ds float,cetonas text,cilindros text,auto integer,color text)
    </select> 
    
    <resultMap id="vcuadernoEco" type="Cuadernos">
        <result property="id_historial"        column="id_historial"/>  
        <result property="fechap"              column="fechap"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="hcl"                 column="hcl"/>
        <result property="registro"            column="registro"/>
        <result property="nombres"             column="nombres"/>
        <result property="accion"              column="accion"/>  
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="id_seguro"           column="id_seguro"/>
        <result property="tipoconsulta"        column="tipoconsulta"/>
        <result property="edad"                column="edad"/>
        <result property="mes"                 column="mes"/>
    </resultMap>
  
    <select id="getVerEcografias" resultMap="vcuadernoEco"> 
        select id_historial,fecha as fechap,l.id_persona,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        id_tipo_sexo as id_cuaderno,expedido,h.id_seguro,trim(resultado) as accion,repetida as tipoconsulta,
        edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes   <!--regexp_replace(resultado, E'<.*?>', '', 'g' ) as accion -->
        from laboratorio l
        join historiales h using (id_historial)
        join pacientes p using (id_paciente)
        where ( date(fecha) BETWEEN date(#{fecha_ini}) and date(#{fecha_fin}) ) and l.id_persona=#{id_persona} and 
        id_laboratorio=12 and l.id_estado='B' and l.cod_esta=#{cod_esta} 
        order by fecha,h.id_historial
    </select>  
    
    <select id="getVerEcografiasAdmi" resultMap="vcuadernoEco"> 
        select id_historial,fecha as fechap,l.id_persona,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        id_tipo_sexo as id_cuaderno,expedido,h.id_seguro,trim(resultado) as accion,repetida as tipoconsulta,
        edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes   <!--regexp_replace(resultado, E'<.*?>', '', 'g' ) as accion -->
        from laboratorio l
        join historiales h using (id_historial)
        join pacientes p using (id_paciente)
        where (fechae::date BETWEEN #{fecha_ini} and #{fecha_fin})  and 
        id_laboratorio=12 and l.id_estado='B' and l.cod_esta=#{cod_esta} 
        order by fecha,h.id_historial
    </select>  
    
    <resultMap id="verAdmisiones" type="Cuadernos">
        <result property="id_laboratorio"      column="id_laboratorio"/>  
        <result property="fecha"               column="fecha"/>
        <result property="id_paciente"         column="id_paciente"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="id_consultorio"      column="id_consultorio"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="id_seguro"           column="id_seguro"/>
        <result property="nombres"             column="nombres"/>
        <result property="nro_registro"        column="nro_registro"/> 
        <result property="diagnostico"         column="diagnostico"/>
        <result property="seos"                column="seos"/>  
        <result property="edad"                column="edad"/>
        <result property="mes"                 column="mes"/>
        <result property="dia"                 column="dia"/>
        <result property="nitritos"            column="nitritos"/> 
        <result property="fc"                  column="fc"/> 
        <result property="pa"                  column="pa"/> 
        <result property="fr"                  column="fr"/> 
        <result property="temperatura"         column="temperatura"/> 
        <result property="talla"               column="talla"/> 
        <result property="peso"                column="peso"/> 
        <result property="tipo"                column="tipo"/> 
        <result property="suma1"               column="suma1"/> 
        <result property="suma2"               column="suma2"/> 
        <result property="suma3"               column="suma3"/> 
        <result property="bacterias"           column="bacterias"/>
        <result property="bilirrubina"         column="bilirrubina"/>
        <result property="diagnostico"         column="diagnostico"/>
        <result property="aspecto"             column="aspecto"/>
        <result property="cetonas"             column="cetonas"/>
        <result property="cilindros"           column="cilindros"/>
        <result property="cadena1"             column="cadena1"/>
        <result property="cadena2"             column="cadena2"/>
        <result property="cadena3"             column="cadena3"/>
        <result property="cadena4"             column="cadena4"/>
        <result property="cadena5"             column="cadena5"/>
        <result property="fechae"              column="fechae"/>
        <result property="egreso"              column="egreso"/>
        <result property="cod_esta"            column="cod_esta"/>
        <result property="suma22"              column="suma22"/> 
        <result property="suma25"              column="suma25"/> 
    </resultMap>
    
    <select id="getVerAdmisiones" resultMap="verAdmisiones"> 
        SELECT id_admi as id_laboratorio, a.fecha, a.id_paciente, id_historial, a.id_consultorio,a.id_seguro,a.id_persona,
        nombres, nro_registro,(CASE WHEN id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,
        extract(year from age( a.fecha,fec_nacimiento))::int  as edad,
        extract(month from age( a.fecha,fec_nacimiento))::int  as mes,
        extract(day from age( a.fecha,fec_nacimiento))::int  as dia,
        codigoempresa::text as nitritos,nempresa as tipo, consultorio as bacterias, establecimiento as bilirrubina, 
        a.diagnostico, estadogen as aspecto, prescripcion as cetonas,nombreacomp as cilindros, id_piso as suma1, 
        id_sala as suma2, id_cama as suma3,a.pa,a.fc,a.fr,a.temperatura,a.peso,a.talla, a.fec_reg as fechae, 
        (CASE WHEN padre is null THEN '.' ELSE padre END) as cadena1,
        (CASE WHEN madre is null THEN '.' ELSE madre END) as cadena2, 
        (CASE WHEN conyugue is null THEN '.' ELSE conyugue END) as cadena3, 
        (CASE WHEN conviviente is null THEN '.' ELSE conviviente END) as cadena4,a.seguro as suma25, 
        (CASE WHEN a.direccion is null THEN '.' ELSE a.direccion END) as cadena5, estado as egreso, a.id_por as suma22,
        id_riesgo,a.cod_esta
        FROM admisiones a
        join pacientes using(id_paciente) 
        join historiales using(id_historial) 
        WHERE a.cod_esta=#{cod_esta} and a.id_paciente=#{id_paciente} and id_historial=#{id_historial} and id_admi in 
        (select id_admi from admisiones where cod_esta=#{cod_esta} and id_paciente=#{id_paciente} 
        and id_historial=#{id_historial} and id_consultorio=#{id_consultorio}) 
        limit 1
    </select>  
    
    <select id="getListarAdmision" resultMap="verAdmisiones"> 
        (SELECT id_admi as id_laboratorio, a.fecha, a.id_paciente, id_historial, a.id_consultorio,a.id_seguro,a.id_persona,
        nombres, nro_registro,(CASE WHEN id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,
        extract(year from age( a.fecha,fec_nacimiento))::int  as edad,
        extract(month from age( a.fecha,fec_nacimiento))::int  as mes,
        extract(day from age( a.fecha,fec_nacimiento))::int  as dia,
        codigoempresa::text as nitritos,nempresa as tipo, consultorio as bacterias, establecimiento as bilirrubina, 
        a.diagnostico, estadogen as aspecto, prescripcion as cetonas,nombreacomp as cilindros, id_piso as suma1, 
        id_sala as suma2, id_cama as suma3,a.pa,a.fc,a.fr,a.temperatura,a.peso,a.talla, a.fec_reg as fechae, 
        (CASE WHEN padre is null THEN '.' ELSE padre END) as cadena1,
        (CASE WHEN madre is null THEN '.' ELSE madre END) as cadena2, 
        (CASE WHEN conyugue is null THEN '.' ELSE conyugue END) as cadena3, 
        (CASE WHEN conviviente is null THEN '.' ELSE conviviente END) as cadena4,a.seguro as suma25, 
        (CASE WHEN a.direccion is null THEN '.' ELSE a.direccion END) as cadena5, estado as egreso, a.id_por as suma22,
        id_riesgo,a.cod_esta
        FROM admisiones a
        join pacientes using(id_paciente) 
        join historiales using(id_historial) 
        WHERE a.cod_esta=#{cod_esta} and (a.id_paciente=#{id_paciente} or a.id_por=0) order by fecha desc limit 3 )
        UNION
        (SELECT id_admi as id_laboratorio, a.fecha, a.id_paciente, id_historial, a.id_consultorio,a.id_seguro,a.id_persona,
        nombres, nro_registro,(CASE WHEN id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,
        extract(year from age( a.fecha,fec_nacimiento))::int  as edad,
        extract(month from age( a.fecha,fec_nacimiento))::int  as mes,
        extract(day from age( a.fecha,fec_nacimiento))::int  as dia,
        codigoempresa::text as nitritos,nempresa as tipo, consultorio as bacterias, establecimiento as bilirrubina, 
        a.diagnostico, estadogen as aspecto, prescripcion as cetonas,nombreacomp as cilindros, id_piso as suma1, 
        id_sala as suma2, id_cama as suma3,a.pa,a.fc,a.fr,a.temperatura,a.peso,a.talla, a.fec_reg as fechae, 
        (CASE WHEN padre is null THEN '.' ELSE padre END) as cadena1,
        (CASE WHEN madre is null THEN '.' ELSE madre END) as cadena2, 
        (CASE WHEN conyugue is null THEN '.' ELSE conyugue END) as cadena3, 
        (CASE WHEN conviviente is null THEN '.' ELSE conviviente END) as cadena4,a.seguro as suma25, 
        (CASE WHEN a.direccion is null THEN '.' ELSE a.direccion END) as cadena5, estado as egreso, a.id_por as suma22,
        id_riesgo,a.cod_esta
        FROM admisiones a
        join pacientes using(id_paciente) 
        join historiales using(id_historial) 
        WHERE a.cod_esta=#{cod_esta} and (a.id_persona=#{id_persona} or a.id_por=#{suma22})  Order by id_admi desc Limit 10)          
        Order by id_laboratorio desc Limit 10
    </select>  
    
    <select id="getListarAdmisionTot" resultMap="verAdmisiones"> 
        SELECT id_admi as id_laboratorio, a.fecha, a.id_paciente, id_historial, a.id_consultorio,a.id_seguro,a.id_persona,
        nombres, nro_registro,(CASE WHEN id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,
        extract(year from age( a.fecha,fec_nacimiento))::int  as edad,
        extract(month from age( a.fecha,fec_nacimiento))::int  as mes,
        extract(day from age( a.fecha,fec_nacimiento))::int  as dia,
        codigoempresa::text as nitritos,nempresa as tipo, consultorio as bacterias, establecimiento as bilirrubina, 
        a.diagnostico, estadogen as aspecto, prescripcion as cetonas,nombreacomp as cilindros, id_piso as suma1, 
        id_sala as suma2, id_cama as suma3,a.pa,a.fc,a.fr,a.temperatura,a.peso,a.talla, a.fec_reg as fechae, 
        (CASE WHEN padre is null THEN '.' ELSE padre END) as cadena1,
        (CASE WHEN madre is null THEN '.' ELSE madre END) as cadena2, 
        (CASE WHEN conyugue is null THEN '.' ELSE conyugue END) as cadena3, 
        (CASE WHEN conviviente is null THEN '.' ELSE conviviente END) as cadena4,a.seguro as suma25, 
        (CASE WHEN a.direccion is null THEN '.' ELSE a.direccion END) as cadena5, estado as egreso, a.id_por as suma22,
        id_riesgo,a.cod_esta
        FROM admisiones a
        join pacientes using(id_paciente) 
        join historiales using(id_historial) 
        WHERE a.cod_esta=#{cod_esta} and UPPER(nombres||nro_registro||carnet) like UPPER(#{nombres}) 
        Order by id_admi desc Limit 30
    </select>  
    
    <select id="getDatoAdmision" resultMap="verAdmisiones"> 
        SELECT id_admi as id_laboratorio, a.fecha, a.id_paciente, id_historial, a.id_consultorio,a.id_seguro,a.id_persona,
        nombres, nro_registro,(CASE WHEN id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,
        extract(year from age( a.fecha,fec_nacimiento))::int  as edad,
        extract(month from age( a.fecha,fec_nacimiento))::int  as mes,
        extract(day from age( a.fecha,fec_nacimiento))::int  as dia,
        codigoempresa::text as nitritos,nempresa as tipo, consultorio as bacterias, establecimiento as bilirrubina, 
        a.diagnostico, estadogen as aspecto, prescripcion as cetonas,nombreacomp as cilindros, id_piso as suma1, 
        id_sala as suma2, id_cama as suma3,a.pa,a.fc,a.fr,a.temperatura,a.peso,a.talla, a.fec_reg as fechae, 
        (CASE WHEN padre is null THEN '.' ELSE padre END) as cadena1,
        (CASE WHEN madre is null THEN '.' ELSE madre END) as cadena2, 
        (CASE WHEN conyugue is null THEN '.' ELSE conyugue END) as cadena3, 
        (CASE WHEN conviviente is null THEN '.' ELSE conviviente END) as cadena4,a.seguro as suma25, 
        (CASE WHEN a.direccion is null THEN '.' ELSE a.direccion END) as cadena5, estado as egreso, a.id_por as suma22,
        id_riesgo,a.cod_esta
        FROM admisiones a
        join pacientes using(id_paciente) 
        join historiales using(id_historial) 
        WHERE a.cod_esta=#{cod_esta} and id_admi=#{id_laboratorio} Order by fecha desc Limit 1
    </select>  
    
    <resultMap id="verProtocolos" type="Cuadernos">
        <result property="id_laboratorio"      column="id_laboratorio"/>  
        <result property="fecha"               column="fecha"/>
        <result property="id_paciente"         column="id_paciente"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="id_consultorio"      column="id_consultorio"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="id_seguro"           column="id_seguro"/>
        <result property="id_cama"             column="id_cama"/>
        <result property="id_sala"             column="id_sala"/>
        <result property="id_piso"             column="id_piso"/>
        <result property="nombres"             column="nombres"/>
        <result property="nro_registro"        column="nro_registro"/> 
        <result property="seos"                column="seos"/>  
        <result property="edad"                column="edad"/>
        <result property="mes"                 column="mes"/>
        <result property="dia"                 column="dia"/>
        <result property="nitritos"            column="nitritos"/> 
        <result property="bacterias"           column="bacterias"/> 
        <result property="tipo"                column="tipo"/> 
        <result property="suma1"               column="suma1"/> 
        <result property="suma2"               column="suma2"/> 
        <result property="suma3"               column="suma3"/> 
        <result property="suma4"               column="suma4"/> 
        <result property="suma5"               column="suma5"/> 
        <result property="id_por"              column="id_por"/>
        <result property="cadena1"             column="cadena1"/>
        <result property="cadena2"             column="cadena2"/>
        <result property="cadena3"             column="cadena3"/>
        <result property="cadena4"             column="cadena4"/>
        <result property="cadena5"             column="cadena5"/>
        <result property="cadena6"             column="cadena6"/>
        <result property="cadena7"             column="cadena7"/>
        <result property="cadena8"             column="cadena8"/>
        <result property="cadena9"             column="cadena9"/>
        <result property="cadena10"            column="cadena10"/>
        <result property="cadena11"            column="cadena11"/>
        <result property="cadena12"            column="cadena12"/>
        <result property="cadena13"            column="cadena13"/>
        <result property="cadena14"            column="cadena14"/>
        <result property="cadena15"            column="cadena15"/>
        <result property="cadena16"            column="cadena16"/>
        <result property="cadena17"            column="cadena17"/>
        <result property="cadena18"            column="cadena18"/>
        <result property="cadena19"            column="cadena19"/>
        <result property="cadena20"            column="cadena20"/>
        <result property="cadena21"            column="cadena21"/>
        <result property="cadena22"            column="cadena22"/>
        <result property="cadena23"            column="cadena23"/>
        <result property="cadena24"            column="cadena24"/>
        <result property="cod_esta"            column="cod_esta"/>
    </resultMap>
    
    <select id="getVerProtocolos" resultMap="verProtocolos"> 
        SELECT id_opera  as id_laboratorio, fecha, id_paciente, id_historial, o.id_consultorio, o.id_seguro,id_persona,o.id_piso, id_sala,
        id_cama,id_quirofano as suma1,p.nombres, nro_registro,(CASE WHEN p.id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,
        extract(year from age( o.fecha,p.fec_nacimiento))::int as edad, extract(month from age( o.fecha,p.fec_nacimiento))::int  as mes,
        extract(day from age( o.fecha,p.fec_nacimiento))::int as dia, codigoempresa::text as nitritos,nempresa as tipo, 
        consultorio as bacterias, diagnosticopost as cadena1,riesgoopera as suma2, cirujano as cadena2, ayuda1 as cadena3, 
        ayuda2 as cadena4, ayuda3 as cadena5, instrumentadora as cadena6, circulante as cadena7,anastecista  as cadena8, 
        ayudante as cadena9, tipo_anestecia as suma3, tipo_instrumental as suma4,tipo_guantes as suma5, 
        material as cadena10, incision as cadena11, cierre as cadena12, quien_cerro as cadena13, 
        drenaje as cadena14,hallasgo as cadena15, diagnosticopre as cadena16, descripcion as cadena17, nombre_tecnico as cadena18,
        duracion as cadena19,sangre as cadena20,suero as cadena21,plasma as cadena22,otras as cadena23,o.cod_esta, id_por,
        e.nombres||' '||e.paterno||' '||e.materno as cadena24
        FROM protocoloopera o
        join pacientes p using(id_paciente) 
        join personas e using(id_persona) 
        WHERE o.cod_esta=#{cod_esta} and id_paciente=#{id_paciente} and id_historial=#{id_historial} and id_opera in 
        (select max(id_opera) from protocoloopera where cod_esta=#{cod_esta} and id_persona=#{id_persona} and id_paciente=#{id_paciente} and id_historial=#{id_historial}) 
        limit 10
    </select>  
    
    <select id="getListarProtocolos" resultMap="verProtocolos"> 
        (SELECT id_opera  as id_laboratorio, fecha, id_paciente, id_historial, o.id_consultorio, o.id_seguro,id_persona,o.id_piso, id_sala,
        id_cama,id_quirofano as suma1,p.nombres, nro_registro,(CASE WHEN p.id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,
        extract(year from age( o.fecha,p.fec_nacimiento))::int as edad, extract(month from age( o.fecha,p.fec_nacimiento))::int  as mes,
        extract(day from age( o.fecha,p.fec_nacimiento))::int as dia, codigoempresa::text as nitritos,nempresa as tipo, 
        consultorio as bacterias, diagnosticopost as cadena1,riesgoopera as suma2, cirujano as cadena2, ayuda1 as cadena3, 
        ayuda2 as cadena4, ayuda3 as cadena5, instrumentadora as cadena6, circulante as cadena7,anastecista  as cadena8, 
        ayudante as cadena9, tipo_anestecia as suma3, tipo_instrumental as suma4,tipo_guantes as suma5, 
        material as cadena10, incision as cadena11, cierre as cadena12, quien_cerro as cadena13, 
        drenaje as cadena14,hallasgo as cadena15, diagnosticopre as cadena16, descripcion as cadena17, nombre_tecnico as cadena18,
        duracion as cadena19,sangre as cadena20,suero as cadena21,plasma as cadena22,otras as cadena23,o.cod_esta, id_por,
        e.nombres||' '||e.paterno||' '||e.materno as cadena24
        FROM protocoloopera o
        join pacientes p using(id_paciente) 
        join personas e using(id_persona) 
        WHERE o.cod_esta=#{cod_esta} and id_paciente=#{id_paciente})
        UNION
        (SELECT id_opera  as id_laboratorio, fecha, id_paciente, id_historial, o.id_consultorio, o.id_seguro,id_persona,o.id_piso, id_sala,
        id_cama,id_quirofano as suma1,p.nombres, nro_registro,(CASE WHEN p.id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,
        extract(year from age( o.fecha,p.fec_nacimiento))::int as edad, extract(month from age( o.fecha,p.fec_nacimiento))::int  as mes,
        extract(day from age( o.fecha,p.fec_nacimiento))::int as dia, codigoempresa::text as nitritos,nempresa as tipo, 
        consultorio as bacterias, diagnosticopost as cadena1,riesgoopera as suma2, cirujano as cadena2, ayuda1 as cadena3, 
        ayuda2 as cadena4, ayuda3 as cadena5, instrumentadora as cadena6, circulante as cadena7,anastecista  as cadena8, 
        ayudante as cadena9, tipo_anestecia as suma3, tipo_instrumental as suma4,tipo_guantes as suma5, 
        material as cadena10, incision as cadena11, cierre as cadena12, quien_cerro as cadena13, 
        drenaje as cadena14,hallasgo as cadena15, diagnosticopre as cadena16, descripcion as cadena17, nombre_tecnico as cadena18,
        duracion as cadena19,sangre as cadena20,suero as cadena21,plasma as cadena22,otras as cadena23,o.cod_esta, id_por,
        e.nombres||' '||e.paterno||' '||e.materno as cadena24
        FROM protocoloopera o
        join pacientes p using(id_paciente) 
        join personas e using(id_persona) 
        WHERE o.cod_esta=#{cod_esta} and (o.id_persona=#{id_persona} or id_por=#{id_por}) ) 
        Order by id_laboratorio desc Limit 11
    </select>  
    
    <select id="getDatoProtocolo" resultMap="verProtocolos"> 
        SELECT id_opera  as id_laboratorio, fecha, id_paciente, id_historial, o.id_consultorio, o.id_seguro,id_persona,o.id_piso, id_sala,
        id_cama,id_quirofano as suma1,p.nombres, nro_registro,(CASE WHEN p.id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,
        extract(year from age( o.fecha,p.fec_nacimiento))::int as edad, extract(month from age( o.fecha,p.fec_nacimiento))::int  as mes,
        extract(day from age( o.fecha,p.fec_nacimiento))::int as dia, codigoempresa::text as nitritos,nempresa as tipo, 
        consultorio as bacterias, diagnosticopost as cadena1,riesgoopera as suma2, cirujano as cadena2, ayuda1 as cadena3, 
        ayuda2 as cadena4, ayuda3 as cadena5, instrumentadora as cadena6, circulante as cadena7,anastecista  as cadena8, 
        ayudante as cadena9, tipo_anestecia as suma3, tipo_instrumental as suma4,tipo_guantes as suma5, 
        material as cadena10, incision as cadena11, cierre as cadena12, quien_cerro as cadena13, 
        drenaje as cadena14,hallasgo as cadena15, diagnosticopre as cadena16, descripcion as cadena17, nombre_tecnico as cadena18,
        duracion as cadena19,sangre as cadena20,suero as cadena21,plasma as cadena22,otras as cadena23,o.cod_esta, id_por,
        e.nombres||' '||e.paterno||' '||e.materno as cadena24
        FROM protocoloopera o
        join pacientes p using(id_paciente) 
        join personas e using(id_persona) 
        WHERE o.cod_esta=#{cod_esta} and id_opera=#{id_laboratorio} and id_historial=#{id_historial} 
    </select>  
    
    <resultMap id="verOftalmologia" type="Cuadernos">
        <result property="id_laboratorio"      column="id_laboratorio"/>  
        <result property="fecha"               column="fecha"/>
        <result property="id_paciente"         column="id_paciente"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="id_consultorio"      column="id_consultorio"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="id_seguro"           column="id_seguro"/>
        <result property="nombres"             column="nombres"/>
        <result property="nro_registro"        column="nro_registro"/> 
        <result property="seos"                column="seos"/>  
        <result property="edad"                column="edad"/>
        <result property="mes"                 column="mes"/>
        <result property="dia"                 column="dia"/>
        <result property="nitritos"            column="nitritos"/> 
        <result property="bacterias"           column="bacterias"/> 
        <result property="tipo"                column="tipo"/> 
        <result property="suma1"               column="suma1"/> 
        <result property="suma2"               column="suma2"/> 
        <result property="suma3"               column="suma3"/> 
        <result property="suma5"               column="suma5"/> 
        <result property="suma6"               column="suma6"/> 
        <result property="id_por"              column="id_por"/> 
        <result property="cadena1"             column="cadena1"/>
        <result property="cadena2"             column="cadena2"/>
        <result property="cadena3"             column="cadena3"/>
        <result property="cadena6"             column="cadena6"/>
        <result property="cadena7"             column="cadena7"/>
        <result property="cadena8"             column="cadena8"/>
        <result property="cadena9"             column="cadena9"/>
        <result property="cadena10"             column="cadena10"/>
        <result property="cadena11"             column="cadena11"/>
        <result property="cadena12"             column="cadena12"/>
        <result property="cadena13"             column="cadena13"/>
        <result property="cadena14"             column="cadena14"/>
        <result property="cadena15"             column="cadena15"/>
        <result property="fechae"              column="fechae"/>
        <result property="fechap"              column="fechap"/>
        <result property="cod_esta"            column="cod_esta"/>
    </resultMap>
    
    <select id="getVerOftalmologia" resultMap="verOftalmologia"> 
        SELECT id_epicrisis as id_laboratorio, fecha,fechaing as fechap,fechaegr as fechae, id_paciente, id_historial, id_consultorio,
        e.id_seguro,id_persona,id_piso as suma1,id_sala as suma2,id_cama as suma3,condicion as suma5, causa as suma6, 
        nombres, nro_registro,(CASE WHEN id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,
        extract(year from age( e.fecha,fec_nacimiento))::int  as edad,
        extract(month from age( e.fecha,fec_nacimiento))::int  as mes,
        extract(day from age( e.fecha,fec_nacimiento))::int  as dia,
        codigoempresa::text as nitritos,nempresa as tipo, consultorio as bacterias, 
        clinicos as cadena1, diagnosticoing as cadena2, diagnosticoegr as cadena3, examenes as cadena6, tratquirurgico as cadena7, 
        tratmedico as cadena8, complicaciones as cadena9, pronosticovital as cadena10,pronosticofuncional as cadena11, 
        control as cadena12, policlinico as cadena13, hospital as cadena14, recomendaciones as cadena15,
        id_por,cod_esta
        FROM hcl_oftalmologia e
        join pacientes using(id_paciente) 
        WHERE cod_esta=#{cod_esta} and id_paciente=#{id_paciente} and id_historial=#{id_historial} and id_epicrisis in 
        (select max(id_oftal) from epicrisis where cod_esta=#{cod_esta} and id_paciente=#{id_paciente} 
        and id_historial=#{id_historial}) 
        limit 10
    </select>  
    
    <resultMap id="verEpicrisis" type="Cuadernos">
        <result property="id_laboratorio"      column="id_laboratorio"/>  
        <result property="fecha"               column="fecha"/>
        <result property="id_paciente"         column="id_paciente"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="id_consultorio"      column="id_consultorio"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="id_seguro"           column="id_seguro"/>
        <result property="nombres"             column="nombres"/>
        <result property="nro_registro"        column="nro_registro"/> 
        <result property="seos"                column="seos"/>  
        <result property="edad"                column="edad"/>
        <result property="mes"                 column="mes"/>
        <result property="dia"                 column="dia"/>
        <result property="nitritos"            column="nitritos"/> 
        <result property="bacterias"           column="bacterias"/> 
        <result property="tipo"                column="tipo"/> 
        <result property="suma1"               column="suma1"/> 
        <result property="suma2"               column="suma2"/> 
        <result property="suma3"               column="suma3"/> 
        <result property="suma5"               column="suma5"/> 
        <result property="suma6"               column="suma6"/> 
        <result property="id_por"              column="id_por"/> 
        <result property="cadena1"             column="cadena1"/>
        <result property="cadena2"             column="cadena2"/>
        <result property="cadena3"             column="cadena3"/>
        <result property="cadena6"             column="cadena6"/>
        <result property="cadena7"             column="cadena7"/>
        <result property="cadena8"             column="cadena8"/>
        <result property="cadena9"             column="cadena9"/>
        <result property="cadena10"             column="cadena10"/>
        <result property="cadena11"             column="cadena11"/>
        <result property="cadena12"             column="cadena12"/>
        <result property="cadena13"             column="cadena13"/>
        <result property="cadena14"             column="cadena14"/>
        <result property="cadena15"             column="cadena15"/>
        <result property="fechae"              column="fechae"/>
        <result property="fechap"              column="fechap"/>
        <result property="cod_esta"            column="cod_esta"/>
    </resultMap>
    
    <select id="getVerEpicrisis" resultMap="verEpicrisis"> 
        SELECT id_epicrisis as id_laboratorio, fecha,fechaing as fechap,fechaegr as fechae, id_paciente, id_historial, id_consultorio,
        e.id_seguro,id_persona,id_piso as suma1,id_sala as suma2,id_cama as suma3,condicion as suma5, causa as suma6, 
        nombres, nro_registro,(CASE WHEN id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,
        extract(year from age( e.fecha,fec_nacimiento))::int  as edad,
        extract(month from age( e.fecha,fec_nacimiento))::int  as mes,
        extract(day from age( e.fecha,fec_nacimiento))::int  as dia,
        codigoempresa::text as nitritos,nempresa as tipo, consultorio as bacterias, 
        clinicos as cadena1, diagnosticoing as cadena2, diagnosticoegr as cadena3, examenes as cadena6, tratquirurgico as cadena7, 
        tratmedico as cadena8, complicaciones as cadena9, pronosticovital as cadena10,pronosticofuncional as cadena11, 
        control as cadena12, policlinico as cadena13, hospital as cadena14, recomendaciones as cadena15,
        id_por,cod_esta
        FROM epicrisis e
        join pacientes using(id_paciente) 
        WHERE cod_esta=#{cod_esta} and id_paciente=#{id_paciente} and id_historial=#{id_historial} and id_epicrisis in 
        (select max(id_epicrisis) from epicrisis where cod_esta=#{cod_esta} and id_paciente=#{id_paciente} 
        and id_historial=#{id_historial} )
        limit 10
    </select>  
    
    <select id="getListarEpicrisis" resultMap="verEpicrisis"> 
        SELECT id_epicrisis as id_laboratorio, fecha,fechaing as fechap,fechaegr as fechae, id_paciente, id_historial, id_consultorio,
        e.id_seguro,id_persona,id_piso as suma1,id_sala as suma2,id_cama as suma3,condicion as suma5, causa as suma6, 
        nombres, nro_registro,(CASE WHEN id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,
        extract(year from age( e.fecha,fec_nacimiento))::int  as edad,
        extract(month from age( e.fecha,fec_nacimiento))::int  as mes,
        extract(day from age( e.fecha,fec_nacimiento))::int  as dia,
        codigoempresa::text as nitritos,nempresa as tipo, consultorio as bacterias, 
        clinicos as cadena1, diagnosticoing as cadena2, diagnosticoegr as cadena3, examenes as cadena6, tratquirurgico as cadena7, 
        tratmedico as cadena8, complicaciones as cadena9, pronosticovital as cadena10,pronosticofuncional as cadena11, 
        control as cadena12, policlinico as cadena13, hospital as cadena14, recomendaciones as cadena15,
        id_por,cod_esta
        FROM epicrisis e
        join pacientes using(id_paciente) 
        WHERE cod_esta=#{cod_esta} and id_persona=#{id_persona} Order by id_epicrisis desc Limit 10
    </select>  
    
    <select id="getListarEpicrisisTot" resultMap="verEpicrisis"> 
        SELECT id_epicrisis as id_laboratorio, fecha,fechaing as fechap,fechaegr as fechae, id_paciente, id_historial, id_consultorio,
        e.id_seguro,id_persona,id_piso as suma1,id_sala as suma2,id_cama as suma3,condicion as suma5, causa as suma6, 
        nombres, nro_registro,(CASE WHEN id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,
        extract(year from age( e.fecha,fec_nacimiento))::int  as edad,
        extract(month from age( e.fecha,fec_nacimiento))::int  as mes,
        extract(day from age( e.fecha,fec_nacimiento))::int  as dia,
        codigoempresa::text as nitritos,nempresa as tipo, consultorio as bacterias, 
        clinicos as cadena1, diagnosticoing as cadena2, diagnosticoegr as cadena3, examenes as cadena6, tratquirurgico as cadena7, 
        tratmedico as cadena8, complicaciones as cadena9, pronosticovital as cadena10,pronosticofuncional as cadena11, 
        control as cadena12, policlinico as cadena13, hospital as cadena14, recomendaciones as cadena15,
        id_por,cod_esta
        FROM epicrisis e
        join pacientes using(id_paciente) 
        WHERE cod_esta=#{cod_esta} and UPPER(nombres||nro_registro||carnet) like UPPER(#{nombres}) 
        Order by id_epicrisis desc Limit 30
    </select>  
    
    <select id="getDatoEpicrisis" resultMap="verEpicrisis"> 
        SELECT id_epicrisis as id_laboratorio, fecha,fechaing as fechap,fechaegr as fechae, id_paciente, id_historial, id_consultorio,
        e.id_seguro,id_persona,id_piso as suma1,id_sala as suma2,id_cama as suma3,condicion as suma5, causa as suma6, 
        nombres, nro_registro,(CASE WHEN id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,
        extract(year from age( e.fecha,fec_nacimiento))::int  as edad,
        extract(month from age( e.fecha,fec_nacimiento))::int  as mes,
        extract(day from age( e.fecha,fec_nacimiento))::int  as dia,
        codigoempresa::text as nitritos,nempresa as tipo, consultorio as bacterias, 
        clinicos as cadena1, diagnosticoing as cadena2, diagnosticoegr as cadena3, examenes as cadena6, tratquirurgico as cadena7, 
        tratmedico as cadena8, complicaciones as cadena9, pronosticovital as cadena10,pronosticofuncional as cadena11, 
        control as cadena12, policlinico as cadena13, hospital as cadena14, recomendaciones as cadena15,
        id_por,cod_esta
        FROM epicrisis e
        join pacientes using(id_paciente) 
        WHERE cod_esta=#{cod_esta} and id_epicrisis=#{id_laboratorio} and id_historial=#{id_historial} and e.id_paciente=#{id_paciente} 
    </select>  
    
    <resultMap id="verFechasC" type="Cuadernos">
        <result property="id_consultorio"      column="id_consultorio"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="cod_esta"            column="cod_esta"/>
        <result property="fech1"               column="fech1"/>
        <result property="suma1"               column="suma1"/>
    </resultMap>
    
    <select id="getListarFechasCount" resultMap="verFechasC"> 
        SELECT id_persona,r.id_consultorio,cod_esta,date(fecha) as fech1,count(*) as suma1
        FROM reservaciones r 
        where r.id_consultorio=23  and r.cod_esta=200115
        and (r.id_estado like '%') and r.id_persona=1369 and fecha::date between current_date-1 and current_date+33
        group by id_persona,r.id_consultorio,cod_esta,date(fecha)      
        order by date(fecha)
    </select>  
    
    <resultMap id="verFechas" type="Cuadernos">
        <result property="fech1"               column="fech1"/>
        <result property="fech2"               column="fech2"/>
        <result property="fech3"               column="fech3"/>
        <result property="fech4"               column="fech4"/>
        <result property="fech5"               column="fech5"/>
        <result property="fech6"               column="fech6"/>
        <result property="fech7"               column="fech7"/>
        <result property="fech8"               column="fech8"/>
        <result property="fech9"               column="fech9"/>
        <result property="fech10"               column="fech10"/>
        <result property="fech11"               column="fech11"/>
        <result property="fech12"               column="fech12"/>
        <result property="fech13"               column="fech13"/>
        <result property="fech14"               column="fech14"/>
        <result property="fech15"               column="fech15"/>
        <result property="fech16"               column="fech16"/>
        <result property="fech17"               column="fech17"/>
        <result property="fech18"               column="fech18"/>
        <result property="fech19"               column="fech19"/>
        <result property="fech20"               column="fech20"/>
        <result property="fech21"               column="fech21"/>
        <result property="fech22"               column="fech22"/>
        <result property="fech23"               column="fech23"/>
        <result property="fech24"               column="fech24"/>
        <result property="fech25"               column="fech25"/>
        <result property="fech26"               column="fech26"/>
        <result property="fech27"               column="fech27"/>
        <result property="fech28"               column="fech28"/>
        <result property="fech29"               column="fech29"/>
        <result property="fech30"               column="fech30"/>
        <result property="fech31"               column="fech31"/>
        <result property="fech32"               column="fech32"/>
        <result property="fech33"               column="fech33"/>
        <result property="fech34"               column="fech34"/>
        <result property="fech35"               column="fech35"/>
    </resultMap>
    
    <select id="getListarFechas" resultMap="verFechas"> 
        select (date(now())-1) as fech1,(date(now())) as fech2,(date(now())+1) as fech3,(date(now())+2) as fech4,(date(now())+3) as fech5,
        (date(now())+4) as fech6,(date(now())+5) as fech7,(date(now())+6) as fech8,(date(now())+7) as fech9,(date(now())+8) as fech10,
        (date(now())+9) as fech11,(date(now())+10) as fech12,(date(now())+11) as fech13,(date(now())+12) as fech14,(date(now())+13) as fech15,
        (date(now())+14) as fech16,(date(now())+15) as fech17,(date(now())+16) as fech18,(date(now())+17) as fech19,(date(now())+18) as fech20,
        (date(now())+19) as fech21,(date(now())+20) as fech22,(date(now())+21) as fech23,(date(now())+22) as fech24,(date(now())+23) as fech25,
        (date(now())+24) as fech26,(date(now())+25) as fech27,(date(now())+26) as fech28,(date(now())+27) as fech29,(date(now())+28) as fech30,
        (date(now())+29) as fech31,(date(now())+30) as fech32,(date(now())+31) as fech33,(date(now())+32) as fech34,(date(now())+33) as fech35
    </select>  
    
    <resultMap id="verSolSangre" type="Cuadernos">
        <result property="id_laboratorio"      column="id_laboratorio"/>  
        <result property="fecha"               column="fecha"/>
        <result property="id_paciente"         column="id_paciente"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="id_consultorio"      column="id_consultorio"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="nombres"             column="nombres"/>
        <result property="nombre"              column="nombre"/>
        <result property="nro_registro"        column="nro_registro"/> 
        <result property="nro"                 column="nro"/> 
        <result property="seguro"              column="seguro"/> 
        <result property="diagnostico"         column="diagnostico"/>
        <result property="seos"                column="seos"/>  
        <result property="edad"                column="edad"/>
        <result property="mes"                 column="mes"/>
        <result property="dia"                 column="dia"/>
        <result property="nitritos"            column="nitritos"/> 
        <result property="tipo"                column="tipo"/> 
        <result property="bacterias"           column="bacterias"/> 
        <result property="suma1"               column="suma1"/> 
        <result property="suma2"               column="suma2"/> 
        <result property="suma3"               column="suma3"/> 
        <result property="suma4"               column="suma4"/> 
        <result property="suma5"               column="suma5"/> 
        <result property="suma6"               column="suma6"/> 
        <result property="suma7"               column="suma7"/> 
        <result property="suma8"               column="suma8"/> 
        <result property="suma9"               column="suma9"/>
        <result property="suma10"              column="suma10"/> 
        <result property="suma11"              column="suma11"/> 
        <result property="suma12"              column="suma12"/> 
        <result property="suma13"              column="suma13"/> 
        <result property="suma14"              column="suma14"/> 
        <result property="suma15"              column="suma15"/> 
        <result property="suma16"              column="suma16"/> 
        <result property="suma17"              column="suma17"/> 
        <result property="suma18"              column="suma18"/> 
        <result property="suma19"              column="suma19"/> 
        <result property="suma20"              column="suma20"/>
        <result property="suma21"              column="suma21"/>
        <result property="suma22"              column="suma22"/>
        <result property="suma23"              column="suma23"/>
        <result property="suma24"              column="suma24"/>
        <result property="suma25"              column="suma25"/>
        <result property="suma26"              column="suma26"/>
        <result property="suma27"              column="suma27"/>
        <result property="suma28"              column="suma28"/>
        <result property="suma29"              column="suma29"/>
        <result property="suma30"              column="suma30"/> 
        <result property="suma31"              column="suma31"/> 
        <result property="suma32"              column="suma32"/> 
        <result property="suma33"              column="suma33"/> 
        <result property="suma40"              column="suma40"/> 
        <result property="suma41"              column="suma41"/> 
        <result property="suma42"              column="suma42"/> 
        <result property="diagnostico"         column="diagnostico"/>
        <result property="fechap"              column="fechap"/>
        <result property="cadena1"             column="cadena1"/>
        <result property="cadena2"             column="cadena2"/>
        <result property="cadena3"             column="cadena3"/>
        <result property="cadena4"             column="cadena4"/>
        <result property="cod_esta"            column="cod_esta"/>
    </resultMap>
    
    <select id="getVerSolSangre" resultMap="verSolSangre"> 
        SELECT id_sangre as id_laboratorio, fecha, id_paciente, id_historial, s.id_consultorio, id_persona,nro_registro,codcns as nro,
        p.nombres, nro_registro,(CASE WHEN p.id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,seguro,
        extract(year from age( s.fecha,p.fec_nacimiento))::int  as edad,
        extract(month from age( s.fecha,p.fec_nacimiento))::int  as mes,
        extract(day from age( s.fecha,p.fec_nacimiento))::int  as dia,
        e.nombres||' '||e.paterno||' '||e.materno as nombre,codigoempresa::text as nitritos,
        nempresa as tipo,consultorio as bacterias, diagnostico, id_cama as suma40, urgencia as suma1, 
        endia as suma2, programa as suma3, quirofano as suma4, hb as suma5, plaqueta as suma6, ttpa as suma7, 
        hto as suma8, leucocito as suma9, protombina as suma10, trans as suma11,notrans as suma33, reaccion as suma12, 
        s.embarazo as suma13, ehnr as suma14, st as suma15, volst as suma16, pg as suma17, volpg as suma18, 
        pgl as suma19, volpgl as suma20, cp as suma21, volcp as suma22, fpc as suma23, volfpc as suma24, 
        pr as suma25, volpr as suma26, crio as suma27, volcrio as suma28, au as suma29, volau as suma30, 
        otr as suma31, volotr as suma32, especifica as cadena1, motivo as cadena2, otros as cadena3,codigoprof as cadena4,  
        diagnostico, fec_reg as fechap, s.estado as suma41, id_por as suma42, s.cod_esta
        FROM solsangre s
        join pacientes p using(id_paciente) 
        join consultorios using(id_consultorio) 
        join personas e using(id_persona)
        WHERE s.cod_esta=#{cod_esta} and id_paciente=#{id_paciente} and id_historial=#{id_historial} and id_sangre in 
        (select max(id_sangre) from solsangre where cod_esta=#{cod_esta} and id_paciente=#{id_paciente} 
        and id_historial=#{id_historial})
        limit 30
    </select>  
    
    <select id="getListarSolSangres" resultMap="verSolSangre"> 
        SELECT id_sangre as id_laboratorio, fecha, id_paciente, id_historial, s.id_consultorio, id_persona,nro_registro,codcns as nro,
        p.nombres, nro_registro,(CASE WHEN p.id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,seguro,
        extract(year from age( s.fecha,p.fec_nacimiento))::int  as edad,
        extract(month from age( s.fecha,p.fec_nacimiento))::int  as mes,
        extract(day from age( s.fecha,p.fec_nacimiento))::int  as dia,
        e.nombres||' '||e.paterno||' '||e.materno as nombre,codigoempresa::text as nitritos,
        nempresa as tipo,consultorio as bacterias, diagnostico, id_cama as suma40, urgencia as suma1, 
        endia as suma2, programa as suma3, quirofano as suma4, hb as suma5, plaqueta as suma6, ttpa as suma7, 
        hto as suma8, leucocito as suma9, protombina as suma10, trans as suma11,notrans as suma33, reaccion as suma12, 
        s.embarazo as suma13, ehnr as suma14, st as suma15, volst as suma16, pg as suma17, volpg as suma18, 
        pgl as suma19, volpgl as suma20, cp as suma21, volcp as suma22, fpc as suma23, volfpc as suma24, 
        pr as suma25, volpr as suma26, crio as suma27, volcrio as suma28, au as suma29, volau as suma30, 
        otr as suma31, volotr as suma32, especifica as cadena1, motivo as cadena2, otros as cadena3, codigoprof as cadena4, 
        diagnostico, fec_reg as fechap, s.estado as suma41, id_por as suma42, s.cod_esta
        FROM solsangre s
        join pacientes p using(id_paciente) 
        join consultorios using(id_consultorio) 
        join personas e using(id_persona)
        WHERE s.cod_esta=#{cod_esta} and s.id_paciente=#{id_paciente} Order by id_sangre desc Limit 10
    </select>  
    
    <select id="getDatoSolSangre" resultMap="verSolSangre"> 
        SELECT id_sangre as id_laboratorio, fecha, id_paciente, id_historial, s.id_consultorio, id_persona,nro_registro,codcns as nro,
        p.nombres, nro_registro,(CASE WHEN p.id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,seguro,
        extract(year from age( s.fecha,p.fec_nacimiento))::int  as edad,
        extract(month from age( s.fecha,p.fec_nacimiento))::int  as mes,
        extract(day from age( s.fecha,p.fec_nacimiento))::int  as dia,
        e.nombres||' '||e.paterno||' '||e.materno as nombre,codigoempresa::text as nitritos,
        nempresa as tipo,consultorio as bacterias, diagnostico, id_cama as suma40, urgencia as suma1, 
        endia as suma2, programa as suma3, quirofano as suma4, hb as suma5, plaqueta as suma6, ttpa as suma7, 
        hto as suma8, leucocito as suma9, protombina as suma10, trans as suma11,notrans as suma33, reaccion as suma12, 
        s.embarazo as suma13, ehnr as suma14, st as suma15, volst as suma16, pg as suma17, volpg as suma18, 
        pgl as suma19, volpgl as suma20, cp as suma21, volcp as suma22, fpc as suma23, volfpc as suma24, 
        pr as suma25, volpr as suma26, crio as suma27, volcrio as suma28, au as suma29, volau as suma30, 
        otr as suma31, volotr as suma32, especifica as cadena1, motivo as cadena2, otros as cadena3,codigoprof as cadena4, 
        diagnostico, fec_reg as fechap, s.estado as suma41, id_por as suma42, s.cod_esta
        FROM solsangre s
        join pacientes p using(id_paciente) 
        join consultorios using(id_consultorio) 
        join personas e using(id_persona) 
        WHERE s.cod_esta=#{cod_esta} and id_sangre=#{id_laboratorio} Order by fecha desc Limit 1
    </select>  
    
    <resultMap id="verTransferencia" type="Cuadernos">
        <result property="id_laboratorio"      column="id_laboratorio"/>  
        <result property="fecha"               column="fecha"/>
        <result property="id_paciente"         column="id_paciente"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="id_consultorio"      column="id_consultorio"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="condon"              column="condon"/>
        <result property="nombres"             column="nombres"/>
        <result property="nro_registro"        column="nro_registro"/> 
        <result property="diagnostico"         column="diagnostico"/>
        <result property="seos"                column="seos"/>  
        <result property="edad"                column="edad"/>
        <result property="mes"                 column="mes"/>
        <result property="dia"                 column="dia"/>
        <result property="nitritos"            column="nitritos"/> 
        <result property="tipo"                column="tipo"/> 
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="id_cargo"            column="id_cargo"/>
        <result property="id_por"              column="id_por"/>
        <result property="anti"                column="anti"/>
        <result property="bacterias"           column="bacterias"/>
        <result property="bilirrubina"         column="bilirrubina"/>
        <result property="diagnostico"         column="diagnostico"/>
        <result property="laboratorio"         column="laboratorio"/>
        <result property="aspecto"             column="aspecto"/>
        <result property="cetonas"             column="cetonas"/>
        <result property="fechae"              column="fechae"/>
        <result property="carnet"              column="carnet"/>
        <result property="cadena10"            column="cadena10"/>
        <result property="cod_esta"            column="cod_esta"/>
    </resultMap>
    
    <select id="getVerTransferencia" resultMap="verTransferencia"> 
        SELECT id_trans as id_laboratorio, fecha, id_paciente, id_historial, id_consultorio, id_persona,cod_esta_ref as condon,
        nombres, nro_registro,(CASE WHEN id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,
        extract(year from age( t.fecha,fec_nacimiento))::int  as edad,
        extract(month from age( t.fecha,fec_nacimiento))::int  as mes,
        extract(day from age( t.fecha,fec_nacimiento))::int  as dia,
        codigoempresa::text as nitritos,nempresa as tipo,
        id_servicio_ref id_cuaderno, id_consultorio_ref as id_cargo, servicio as anti ,consultorio as bacterias, 
        establecimiento as bilirrubina, diagnostico, laboratorio, tratamiento as aspecto,recomienda as cetonas, 
        t.fec_reg as fechae,carnet,lugarci as cadena10, id_por, cod_esta
        FROM transferencias t
        join pacientes using(id_paciente) 
        WHERE cod_esta=#{cod_esta} and id_paciente=#{id_paciente} and id_historial=#{id_historial} and id_trans in 
        (select max(id_trans) from transferencias where cod_esta=#{cod_esta} and id_paciente=#{id_paciente} 
        and id_historial=#{id_historial} and id_consultorio_ref=#{id_cargo})   <!--and id_consultorio_ref=#{id_cargo}  se quita09-03-2017 -->
        limit 30
    </select>  
    
    <select id="getListarTransferencia" resultMap="verTransferencia"> 
        (SELECT id_trans as id_laboratorio, fecha, id_paciente, id_historial, id_consultorio, id_persona,cod_esta_ref as condon,
        nombres, nro_registro,(CASE WHEN id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,
        extract(year from age( t.fecha,fec_nacimiento))::int  as edad,
        extract(month from age( t.fecha,fec_nacimiento))::int  as mes,
        extract(day from age( t.fecha,fec_nacimiento))::int  as dia,
        codigoempresa::text as nitritos,nempresa as tipo,
        id_servicio_ref id_cuaderno, id_consultorio_ref as id_cargo, servicio as anti ,consultorio as bacterias, 
        establecimiento as bilirrubina, diagnostico, laboratorio, tratamiento as aspecto,recomienda as cetonas, 
        t.fec_reg as fechae, carnet, lugarci as cadena10, id_por, cod_esta
        FROM transferencias t
        join pacientes using(id_paciente) 
        WHERE cod_esta=#{cod_esta} and id_paciente=#{id_paciente} Order by id_trans desc)  
        UNION          
        (SELECT id_trans as id_laboratorio, fecha, id_paciente, id_historial, id_consultorio, id_persona,cod_esta_ref as condon,
        nombres, nro_registro,(CASE WHEN id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,
        extract(year from age( t.fecha,fec_nacimiento))::int  as edad,
        extract(month from age( t.fecha,fec_nacimiento))::int  as mes,
        extract(day from age( t.fecha,fec_nacimiento))::int  as dia,
        codigoempresa::text as nitritos,nempresa as tipo,
        id_servicio_ref id_cuaderno, id_consultorio_ref as id_cargo, servicio as anti ,consultorio as bacterias, 
        establecimiento as bilirrubina, diagnostico, laboratorio, tratamiento as aspecto,recomienda as cetonas, 
        t.fec_reg as fechae, carnet, lugarci as cadena10,id_por, cod_esta
        FROM transferencias t
        join pacientes using(id_paciente) 
        WHERE cod_esta=#{cod_esta} and id_persona=#{id_persona} Order by id_trans desc) 
        ORDER BY FECHA DESC      Limit 30
    </select>  
    
    <select id="getDatoTransferencia" resultMap="verTransferencia"> 
        SELECT id_trans as id_laboratorio, fecha, id_paciente, id_historial, id_consultorio, id_persona,cod_esta_ref as condon,
        nombres, nro_registro,(CASE WHEN id_tipo_sexo=1 THEN 'FEMENINO' ELSE 'MASCULINO' END) as seos,
        extract(year from age( t.fecha,fec_nacimiento))::int  as edad,
        extract(month from age( t.fecha,fec_nacimiento))::int  as mes,
        extract(day from age( t.fecha,fec_nacimiento))::int  as dia,
        codigoempresa::text as nitritos,nempresa as tipo,
        id_servicio_ref as id_cuaderno, id_consultorio_ref as id_cargo, servicio as anti ,consultorio as bacterias, 
        establecimiento as bilirrubina, diagnostico, laboratorio, tratamiento as aspecto,recomienda as cetonas, 
        t.fec_reg as fechae, carnet,lugarci as cadena10,id_por, cod_esta
        FROM transferencias t
        join pacientes using(id_paciente) 
        WHERE cod_esta=#{cod_esta} and id_trans=#{id_laboratorio} Order by fecha desc Limit 1
    </select>  
   
    <resultMap id="vcuaderno1" type="Cuadernos">
        <result property="id_laboratorio"      column="id_laboratorio"/>  
        <result property="fechap"              column="fechap"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="registro"            column="registro"/>
        <result property="nombres"             column="nombres"/>
        <result property="diagnostico"         column="diagnostico"/>
        <result property="accion"              column="accion"/>  
        <result property="tipodent"            column="tipodent"/> 
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="tipoconsulta"        column="tipoconsulta"/> 
        <result property="peso"                column="peso"/>
        <result property="talla"               column="talla"/>
        <result property="pa"                  column="pa"/>
        <result property="edad"                column="edad"/>
        <result property="mes"                 column="mes"/>
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="referido"            column="referido"/>
        <result property="contraref"           column="contraref"/> 
        <result property="speso"               column="speso"/>
        <result property="alcohol"             column="alcohol"/>
        <result property="fuma"                column="fuma"/> 
        <result property="violencia"           column="violencia"/>
        <result property="cardio"              column="cardio"/>
        <result property="reuma"               column="reuma"/>
        <result property="cancer"              column="cancer"/>
        <result property="cancero"             column="cancero"/>
        <result property="diabetes"            column="diabetes"/>
        <result property="arterial"            column="arterial"/>
        <result property="depre"               column="depre"/>
        <result property="epilepsia"           column="epilepsia"/>
        <result property="psico"               column="psico"/>
        <result property="discapa"             column="discapa"/>
        <result property="aqv"                 column="aqv"/>
        <result property="bcg"                 column="bcg"/>
        <result property="condon"              column="condon"/>
        <result property="controlpos"          column="controlpos"/>
        <result property="aspecto"             column="aspecto"/>
        <result property="bacterias"           column="bacterias"/>
        <result property="bilirrubina"         column="bilirrubina"/>
        <result property="cantidad"            column="cantidad"/>
        <result property="cetonas"             column="cetonas"/>
        <result property="observa"             column="observa"/>
        <result property="id_seguro"           column="id_seguro"/>
        <result property="tipo"                column="tipo"/>
        <result property="internado"           column="internado"/>
        <result property="nooplasia"           column="nooplasia"/>
        <result property="suma30"              column="suma30"/>
        <result property="suma31"              column="suma31"/>
        <result property="suma50"              column="suma50"/>
        <result property="suma51"              column="suma51"/>
        <result property="suma52"              column="suma52"/>
        <result property="suma53"              column="suma53"/>
        <result property="cadena1"             column="cadena1"/>
        <result property="cadena2"             column="cadena2"/>
        <result property="cadena3"             column="cadena3"/>
        <result property="cadena4"             column="cadena4"/>
        <result property="suma13"              column="suma13"/>
        <result property="suma14"              column="suma14"/>
    </resultMap>
  
    <select id="getVerCemergencias" resultMap="vcuaderno1"> 
        select id_historial as id_laboratorio,fecha as fechap,h.id_persona,hcl as id_historial,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,diagnostico,accion ,codigo as tipodent,id_tipo_sexo as id_cuaderno,
        cuaderno1.tipoconsulta,peso,talla,pa,extract(year from age( h.fecha,fec_nacimiento))::int  as edad,
        extract(month from age( h.fecha,fec_nacimiento))::int  as mes,suma1,suma2,suma3,
        suma4,suma5,referido,contraref,speso,alcohol,fuma, violencia,cardio,reuma,cancer,cancero,diabetes,arterial,depre,epilepsia,
        psico,discapa,pies as aqv,ojos as bcg,dieta as condon,ejercicios as controlpos,hba as aspecto, gfr as bacterias, 
        creatinina as bilirrubina,colesterol as cantidad,imc as cetonas,observaciones as observa,h.id_seguro,
        expedido as tipo,internado,id_referido as suma30, id_contraref as suma31,
        tipo as suma50,motivo as suma51,fallecido as suma52, atencion as suma53,mortalidad as nooplasia,
        c4_pt as cadena1,c4_te as cadena2,c4_hierro as cadena3,c4_vitaa as cadena4,carmelo as suma13,id_refer as suma14       
        from cuaderno1 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  h.cod_esta=#{cod_esta} and atencion=1 and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) and h.id_persona=#{id_persona} 
        order by fecha,h.id_historial
    </select>  
   
    <select id="getVerCemergenciasTodos" resultMap="vcuaderno1"> 
        select id_historial as id_laboratorio,fecha as fechap,h.id_persona,hcl as id_historial,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,diagnostico,accion ,codigo as tipodent,id_tipo_sexo as id_cuaderno,
        cuaderno1.tipoconsulta,peso,talla,pa,extract(year from age( h.fecha,fec_nacimiento))::int  as edad,
        extract(month from age( h.fecha,fec_nacimiento))::int  as mes,suma1,suma2,suma3,
        suma4,suma5,referido,contraref,speso,alcohol,fuma, violencia,cardio,reuma,cancer,cancero,diabetes,arterial,depre,epilepsia,
        psico,discapa,pies as aqv,ojos as bcg,dieta as condon,ejercicios as controlpos,hba as aspecto, gfr as bacterias, 
        creatinina as bilirrubina,colesterol as cantidad,imc as cetonas,observaciones as observa,h.id_seguro,
        expedido as tipo,internado, id_referido as suma30, id_contraref as suma31,
        tipo as suma50,motivo as suma51,fallecido as suma52, atencion as suma53,mortalidad as nooplasia,
        c4_pt as cadena1,c4_te as cadena2,c4_hierro as cadena3,c4_vitaa as cadena4,carmelo as suma13,id_refer as suma14      
        from cuaderno1
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where h.cod_esta=#{cod_esta} and atencion=1 and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin})
        order by fecha,h.id_historial
    </select>
  
    <select id="getVerCuaderno1Uni" resultMap="vcuaderno1"> 
        select id_historial as id_laboratorio,fecha as fechap,h.id_persona,hcl as id_historial,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,diagnostico,accion ,codigo as tipodent,id_tipo_sexo as id_cuaderno,
        cuaderno1.tipoconsulta,peso,talla,pa,edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,suma1,suma2,suma3,
        suma4,suma5,referido,contraref,speso,alcohol,fuma, violencia,cardio,reuma,cancer,cancero,diabetes,arterial,depre,epilepsia,
        psico,discapa,pies as aqv,ojos as bcg,dieta as condon,ejercicios as controlpos,hba as aspecto, gfr as bacterias, 
        creatinina as bilirrubina,colesterol as cantidad,imc as cetonas,observaciones as observa,h.id_seguro,
        expedido as tipo,internado,id_referido as suma30, id_contraref as suma31,
        tipo as suma50,motivo as suma51,fallecido as suma52, atencion as suma53,mortalidad as nooplasia,
        c4_pt as cadena1,c4_te as cadena2,c4_hierro as cadena3,c4_vitaa as cadena4,carmelo as suma13,id_refer as suma14      
        from cuaderno1 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where h.cod_esta=#{cod_esta} and atencion=0 and h.id_paciente=#{id_paciente} 
        order by fecha,h.id_historial
    </select>
   
    <select id="getVerCuaderno1" resultMap="vcuaderno1"> 
        select id_historial as id_laboratorio,fecha as fechap,h.id_persona,hcl as id_historial,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,diagnostico,accion ,codigo as tipodent,id_tipo_sexo as id_cuaderno,
        cuaderno1.tipoconsulta,peso,talla,pa,edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,suma1,suma2,suma3,
        suma4,suma5,referido,contraref,speso,alcohol,fuma, violencia,cardio,reuma,cancer,cancero,diabetes,arterial,depre,epilepsia,
        psico,discapa,pies as aqv,ojos as bcg,dieta as condon,ejercicios as controlpos,hba as aspecto, gfr as bacterias, 
        creatinina as bilirrubina,colesterol as cantidad,imc as cetonas,observaciones as observa,h.id_seguro,
        expedido as tipo,internado,id_referido as suma30, id_contraref as suma31,tipo as suma50,motivo as suma51,fallecido as suma52, 
        atencion as suma53,mortalidad as nooplasia,c4_pt as cadena1,c4_te as cadena2,c4_hierro as cadena3,c4_vitaa as cadena4,
        carmelo as suma13,id_refer as suma14     
        from cuaderno1 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  h.cod_esta=#{cod_esta} and atencion=0 and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin}) 
        and h.id_persona=#{id_persona} 
        order by fecha,h.id_historial
    </select>  
    
    <select id="getVerCuaderno1T" resultMap="vcuaderno1"> 
        select id_historial as id_laboratorio,fecha as fechap,h.id_persona,hcl as id_historial,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,diagnostico,accion ,codigo as tipodent,id_tipo_sexo as id_cuaderno,
        cuaderno1.tipoconsulta,peso,talla,pa,edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,suma1,suma2,suma3,
        suma4,suma5,referido,contraref,speso,alcohol,fuma, violencia,cardio,reuma,cancer,cancero,diabetes,arterial,depre,epilepsia,
        psico,discapa,pies as aqv,ojos as bcg,dieta as condon,ejercicios as controlpos,hba as aspecto, gfr as bacterias, 
        creatinina as bilirrubina,colesterol as cantidad,imc as cetonas,observaciones as observa,h.id_seguro,
        expedido as tipo,internado,id_referido as suma30, id_contraref as suma31,
        tipo as suma50,motivo as suma51,fallecido as suma52, atencion as suma53,mortalidad as nooplasia,c4_pt as cadena1,
        c4_te as cadena2,c4_hierro as cadena3,c4_vitaa as cadena4,carmelo as suma13,id_refer as suma14       
        from cuaderno1
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  h.cod_esta=#{cod_esta} and atencion=0 and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin})
        order by fecha,h.id_historial
    </select>
    
    <select id="getVerCuaderno1Todos" resultMap="vcuaderno1"> 
        select id_historial as id_laboratorio,fecha as fechap,h.id_persona,hcl as id_historial,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,diagnostico,accion ,codigo as tipodent,id_tipo_sexo as id_cuaderno,
        cuaderno1.tipoconsulta,peso,talla,pa,edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,suma1,suma2,suma3,
        suma4,suma5,referido,contraref,speso,alcohol,fuma, violencia,cardio,reuma,cancer,cancero,diabetes,arterial,depre,epilepsia,
        psico,discapa,pies as aqv,ojos as bcg,dieta as condon,ejercicios as controlpos,hba as aspecto, gfr as bacterias, 
        creatinina as bilirrubina,colesterol as cantidad,imc as cetonas,observaciones as observa,h.id_seguro,
        expedido as tipo,internado,id_referido as suma30, id_contraref as suma31,
        tipo as suma50,motivo as suma51,fallecido as suma52, atencion as suma53,mortalidad as nooplasia,
        c4_pt as cadena1,c4_te as cadena2,c4_hierro as cadena3,c4_vitaa as cadena4,carmelo as suma13,id_refer as suma14      
        from cuaderno1
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin})
        order by fecha,h.id_historial
        <!-- atencion=0 and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin})  and pacientes.id_estado !='P' -->
    </select>
    <select id="getVerCuaderno1Sspam" resultMap="vcuaderno1"> 
        select id_historial as id_laboratorio,fecha as fechap,h.id_persona,hcl as id_historial,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,diagnostico,accion ,codigo as tipodent,id_tipo_sexo as id_cuaderno,
        cuaderno1.tipoconsulta,peso,talla,pa,edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,suma1,suma2,suma3,
        suma4,suma5,referido,contraref,speso,alcohol,fuma, violencia,cardio,reuma,cancer,cancero,diabetes,arterial,depre,epilepsia,
        psico,discapa,pies as aqv,ojos as bcg,dieta as condon,ejercicios as controlpos,hba as aspecto, gfr as bacterias, 
        creatinina as bilirrubina,colesterol as cantidad,imc as cetonas,observaciones as observa,h.id_seguro,
        expedido as tipo,internado,id_referido as suma30, id_contraref as suma31,
        tipo as suma50,motivo as suma51,fallecido as suma52, atencion as suma53,mortalidad as nooplasia,
        c4_pt as cadena1,c4_te as cadena2,c4_hierro as cadena3,c4_vitaa as cadena4,carmelo as suma13,id_refer as suma14      
        from cuaderno1
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  h.cod_esta=#{cod_esta} and atencion=0 and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin}) and h.id_persona=#{id_persona} and pacientes.id_estado ='P'
        order by fecha,h.id_historial
    </select>   
    
    <select id="getVerCuaderno1SspamTodos" resultMap="vcuaderno1"> 
        select id_historial as id_laboratorio,fecha as fechap,h.id_persona,hcl as id_historial,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,diagnostico,accion ,codigo as tipodent,id_tipo_sexo as id_cuaderno,
        cuaderno1.tipoconsulta,peso,talla,pa,edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,suma1,suma2,suma3,
        suma4,suma5,referido,contraref,speso,alcohol,fuma, violencia,cardio,reuma,cancer,cancero,diabetes,arterial,depre,epilepsia,
        psico,discapa,pies as aqv,ojos as bcg,dieta as condon,ejercicios as controlpos,hba as aspecto, gfr as bacterias, 
        creatinina as bilirrubina,colesterol as cantidad,imc as cetonas,observaciones as observa,h.id_seguro,
        expedido as tipo,internado,id_referido as suma30, id_contraref as suma31,
        tipo as suma50,motivo as suma51,fallecido as suma52, atencion as suma53,mortalidad as nooplasia,
        c4_pt as cadena1,c4_te as cadena2,c4_hierro as cadena3,c4_vitaa as cadena4,carmelo as suma13,id_refer as suma14      
        from cuaderno1 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  h.cod_esta=#{cod_esta} and atencion=0 and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) and pacientes.id_estado ='P'
        order by fecha,h.id_historial
    </select>
   
    <resultMap id="vcuaderno1CNS" type="Cuadernos">
        <result property="hcl"                 column="hcl"/>  
        <result property="fechap"              column="fechap"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="id_historia"         column="id_historia"/>
        <result property="registro"            column="registro"/>
        <result property="nombres"             column="nombres"/>
        <result property="diagnostico"         column="diagnostico"/>
        <result property="accion"              column="accion"/>  
        <result property="tipodent"            column="tipodent"/> 
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="tipoconsulta"        column="tipoconsulta"/> 
        <result property="peso"                column="peso"/>
        <result property="talla"               column="talla"/>
        <result property="pa"                  column="pa"/>
        <result property="edad"                column="edad"/>
        <result property="mes"                 column="mes"/>
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="referido"            column="referido"/>
        <result property="contraref"           column="contraref"/> 
        <result property="speso"               column="speso"/>
        <result property="alcohol"             column="alcohol"/>
        <result property="fuma"                column="fuma"/> 
        <result property="violencia"           column="violencia"/>
        <result property="cardio"              column="cardio"/>
        <result property="reuma"               column="reuma"/>
        <result property="cancer"              column="cancer"/>
        <result property="cancero"             column="cancero"/>
        <result property="diabetes"            column="diabetes"/>
        <result property="arterial"            column="arterial"/>
        <result property="depre"               column="depre"/>
        <result property="epilepsia"           column="epilepsia"/>
        <result property="psico"               column="psico"/>
        <result property="discapa"             column="discapa"/>
        <result property="aqv"                 column="aqv"/>
        <result property="bcg"                 column="bcg"/>
        <result property="condon"              column="condon"/>
        <result property="controlpos"          column="controlpos"/>
        <result property="aspecto"             column="aspecto"/>
        <result property="bacterias"           column="bacterias"/>
        <result property="bilirrubina"         column="bilirrubina"/>
        <result property="cantidad"            column="cantidad"/>
        <result property="cetonas"             column="cetonas"/>
        <result property="observa"             column="observa"/>
        <result property="id_seguro"           column="id_seguro"/>
        <result property="tipo"                column="tipo"/>
        <result property="internado"           column="internado"/>
        <result property="nooplasia"           column="nooplasia"/>
        <result property="suma30"              column="suma30"/>
        <result property="suma31"              column="suma31"/>
        <result property="suma50"              column="suma50"/>
        <result property="suma51"              column="suma51"/>
        <result property="suma52"              column="suma52"/>
        <result property="suma53"              column="suma53"/>
        <result property="suma10"              column="suma10"/>
        <result property="suma11"              column="suma11"/>
        <result property="suma12"              column="suma12"/>
        <result property="suma13"              column="suma13"/>
        <result property="cadena1"             column="cadena1"/>
        <result property="cadena2"             column="cadena2"/>
        <result property="cadena3"             column="cadena3"/>
        <result property="cadena4"             column="cadena4"/>
        <result property="cadena5"             column="cadena5"/>
        <result property="suma15"              column="suma15"/>
        <result property="suma16"              column="suma16"/>
        <result property="num_auto"            column="num_auto"/>
    </resultMap>

    <select id="getVerCuaderno1CNS" resultMap="vcuaderno1CNS"> 
        select id_historial,0 as id_historia,fecha as fechap,h.id_persona,hcl,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,diagnostico,accion ,codigo as tipodent,id_tipo_sexo as id_cuaderno,
        cuaderno1.tipoconsulta,peso,talla,pa,edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,suma1,suma2,suma3,
        suma4,suma5,referido,contraref,speso,alcohol,fuma, violencia,cardio,reuma,cancer,cancero,diabetes,arterial,depre,epilepsia,
        psico,discapa,pies as aqv,ojos as bcg,dieta as condon,ejercicios as controlpos,hba as aspecto, gfr as bacterias, 
        creatinina as bilirrubina,colesterol as cantidad,imc as cetonas,observaciones as observa,h.id_seguro,
        expedido as tipo,internado,id_referido as suma30, id_contraref as suma31, tipo as suma50,motivo as suma51,
        fallecido as suma52, atencion as suma53,mortalidad as nooplasia,codcns as cadena1 ,codigoempresa as num_auto,
        n_rec as suma10,n_exa as suma11,n_ima as suma12,(CASE WHEN  octet_length(referido)>2 THEN 1 ELSE 0 END) as suma13,
        c4_pt as cadena2,c4_te as cadena3,c4_hierro as cadena4,c4_vitaa as cadena5,semges as suma15,numcontrol as suma16
        from cuaderno1 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) 
        and h.id_persona=#{id_persona} 
        order by fecha,h.id_historial
    </select>  
    
    <select id="getVerCuaderno1CNSInter" resultMap="vcuaderno1CNS"> 
        Select id_historial, id_historia,i.fecha as fechap,i.id_persona,hcl,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,i.diagnostico,accion,id_tipo_sexo as id_cuaderno,
        (SELECT codigo AS Expr1 FROM DetalleCie10 d WHERE (d.id_persona = i.id_persona and d.id_historial = h.id_historial and d.id_persona=#{id_persona})  limit 1) AS tipodent,
        cuaderno1.tipoconsulta,i.peso,i.talla,i.pa,edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,suma1,suma2,suma3,
        suma4,suma5,referido,contraref,speso,alcohol,fuma, violencia,cardio,reuma,cancer,cancero,diabetes,arterial,depre,epilepsia,
        psico,discapa,pies as aqv,ojos as bcg,dieta as condon,ejercicios as controlpos,hba as aspecto, gfr as bacterias, 
        creatinina as bilirrubina,colesterol as cantidad,imc as cetonas,observaciones as observa,h.id_seguro,
        expedido as tipo,internado,id_referido as suma30, id_contraref as suma31, tipo as suma50,motivo as suma51,
        fallecido as suma52, atencion as suma53,mortalidad as nooplasia,codcns as cadena1 ,codigoempresa as num_auto,
        n_rec as suma10,n_exa as suma11,n_ima as suma12,(CASE WHEN  octet_length(referido)>2 THEN 1 ELSE 0 END) as suma13,
        c4_pt as cadena2,c4_te as cadena3,c4_hierro as cadena4,c4_vitaa as cadena5,semges as suma15,numcontrol as suma16
        from cuaderno1 
        join historiales h using (id_historial)
        join historiainter i using (id_historial)
        join pacientes using (id_paciente)
        where  h.cod_esta=#{cod_esta} and ( i.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) 
        and i.id_persona=#{id_persona} 
        order by i.fecha,h.id_historial
    </select>  
    
    <select id="getVerCuaderno1CNST" resultMap="vcuaderno1CNS"> 
        select id_historial,0 as id_historia,fecha as fechap,h.id_persona,hcl,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,diagnostico,accion ,codigo as tipodent,id_tipo_sexo as id_cuaderno,
        cuaderno1.tipoconsulta,peso,talla,pa,edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,suma1,suma2,suma3,
        suma4,suma5,referido,contraref,speso,alcohol,fuma, violencia,cardio,reuma,cancer,cancero,diabetes,arterial,depre,epilepsia,
        psico,discapa,pies as aqv,ojos as bcg,dieta as condon,ejercicios as controlpos,hba as aspecto, gfr as bacterias, 
        creatinina as bilirrubina,colesterol as cantidad,imc as cetonas,observaciones as observa,h.id_seguro,
        expedido as tipo,internado,id_referido as suma30, id_contraref as suma31, tipo as suma50,motivo as suma51,
        fallecido as suma52, atencion as suma53,mortalidad as nooplasia,codcns,codigoempresa,
        c4_pt as cadena2,c4_te as cadena3,c4_hierro as cadena4,c4_vitaa as cadena5,semges as suma15,numcontrol as suma16
        from cuaderno1 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  h.cod_esta=#{cod_esta} and atencion=0 and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin}) 
        and h.id_persona=#{id_persona} 
        order by fecha,h.id_historial
    </select>  
    
    <resultMap id="vcuadernoFisio" type="Cuadernos">
        <result property="fechap"              column="fechap"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="hcl"                 column="hcl"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="registro"            column="registro"/>
        <result property="nombres"             column="nombres"/>
        <result property="diagnostico"         column="diagnostico"/>
        <result property="accion"              column="accion"/>  
        <result property="tipodent"            column="tipodent"/> 
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="tipoconsulta"        column="tipoconsulta"/>   
        <result property="edad"                column="edad"/>
        <result property="mes"                 column="mes"/>
        <result property="numpieza"            column="numpieza"/>
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma6"               column="suma6"/>
        <result property="suma7"               column="suma7"/>
        <result property="suma8"               column="suma8"/>
        <result property="suma9"               column="suma9"/>
        <result property="suma10"               column="suma10"/>
        <result property="suma11"               column="suma11"/>
        <result property="suma12"               column="suma12"/>
        <result property="suma13"               column="suma13"/>
        <result property="suma14"               column="suma14"/>
        <result property="suma15"               column="suma15"/>
        <result property="suma16"               column="suma16"/>
        <result property="suma17"               column="suma17"/>
        <result property="suma18"               column="suma18"/>
        <result property="suma19"               column="suma19"/>
        <result property="suma20"               column="suma20"/>
        <result property="suma21"               column="suma21"/>
        <result property="suma22"               column="suma22"/>
        <result property="suma23"               column="suma23"/>
        <result property="suma24"               column="suma24"/>
        <result property="suma25"               column="suma25"/>
        <result property="suma26"               column="suma26"/>
        <result property="suma27"               column="suma27"/>
        <result property="suma28"               column="suma28"/>
        <result property="referido"             column="referido"/>
        <result property="contraref"            column="contraref"/> 
    </resultMap>
  
    <select id="getVerCuadernoFisioUni" resultMap="vcuadernoFisio"> 
        select fecha as fechap,h.id_persona,hcl,id_historial,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        diagnostico,accion ,codigo as tipodent,id_tipo_sexo as id_cuaderno,tipoconsulta,edad,
        extract(month from age( h.fecha,fec_nacimiento))::int  as mes,numero as numpieza, consulta as suma1, vendaje as suma2, 
        electro as suma3, ultrasono as suma4, laser as suma5, magneto as suma6, maso as suma7, mecano as suma8, 
        calorprof as suma9,lumino as suma10, termo as suma11, electroanalgesia as suma12,respiratoria as suma13,
        cinesio as suma14, lenguaje as suma15, psicomotri as suma16, tecneurologica as suma17,teckinesica as suma18,
        to1 as suma19, discapacidad as suma20, hidro as suma21, estimulacion as suma22, pisina as suma23, 
        evaluacion as suma24,tanque as suma25,psicologia as suma26, otro as suma27, otro1 as suma28, 
        referido, contraref    
        from cuadernof 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  h.cod_esta=#{cod_esta} and h.id_paciente=#{id_paciente} 
        order by fecha,h.id_historial
    </select>
   
    <select id="getVerCuadernoFisio" resultMap="vcuadernoFisio"> 
        select fecha as fechap,h.id_persona,hcl,id_historial,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        diagnostico,accion ,codigo as tipodent,id_tipo_sexo as id_cuaderno,tipoconsulta,edad,
        extract(month from age( h.fecha,fec_nacimiento))::int  as mes,numero as numpieza, consulta as suma1, vendaje as suma2, 
        electro as suma3, ultrasono as suma4, laser as suma5, magneto as suma6, maso as suma7, mecano as suma8, 
        calorprof as suma9,lumino as suma10, termo as suma11, electroanalgesia as suma12,respiratoria as suma13,
        cinesio as suma14, lenguaje as suma15, psicomotri as suma16, tecneurologica as suma17,teckinesica as suma18,
        to1 as suma19, discapacidad as suma20, hidro as suma21, estimulacion as suma22, pisina as suma23, 
        evaluacion as suma24,tanque as suma25,psicologia as suma26, otro as suma27, otro1 as suma28, 
        referido, contraref     
        from cuadernof  
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin}) and h.id_persona=#{id_persona} 
        order by fecha,h.id_historial
    </select>   
    
    <select id="getVerCuadernoFisioTodos" resultMap="vcuadernoFisio"> 
        select fecha as fechap,h.id_persona,hcl,id_historial,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        diagnostico,accion ,codigo as tipodent,id_tipo_sexo as id_cuaderno,tipoconsulta,edad,
        extract(month from age( h.fecha,fec_nacimiento))::int  as mes,numero as numpieza, consulta as suma1, vendaje as suma2, 
        electro as suma3, ultrasono as suma4, laser as suma5, magneto as suma6, maso as suma7, mecano as suma8, 
        calorprof as suma9,lumino as suma10, termo as suma11, electroanalgesia as suma12,respiratoria as suma13,
        cinesio as suma14, lenguaje as suma15, psicomotri as suma16, tecneurologica as suma17,teckinesica as suma18,
        to1 as suma19, discapacidad as suma20, hidro as suma21, estimulacion as suma22, pisina as suma23, 
        evaluacion as suma24,tanque as suma25,psicologia as suma26, otro as suma27, otro1 as suma28, 
        referido, contraref    
        from cuadernof 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin})  
        order by fecha,h.id_historial
    </select>
   
    <resultMap id="vcuaderno6c1" type="Cuadernos">
        <result property="id_historial"        column="id_historial"/>
        <result property="inyectable"          column="inyectable"/>
        <result property="sueros"              column="sueros"/>
        <result property="curaciones"          column="curaciones"/>
    </resultMap>
  
    <select id="getVerCuaderno6C1" resultMap="vcuaderno6c1"> 
        select id_historial,inyectable,sueros,curaciones from cuaderno6 where id_historial in 
        (select id_historial from cuaderno6 
        join historiales using (id_historial)
        where historiales.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin}) )
    </select>  
   
    <select id="getVerCuaderno6C4" resultMap="vcuaderno6c1"> 
        select id_historial,inyectable,sueros,curaciones from cuaderno6 where id_historial in 
        (select id_historial from cuaderno4 
        join historiales using (id_historial)
        where historiales.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin}) )
    </select>  
   
    <resultMap id="vcuaderno6" type="Cuadernos">
        <result property="id_historial"        column="id_historial"/>
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="hcl"                 column="hcl"/>
        <result property="registro"            column="registro"/>    
        <result property="id_persona"          column="id_persona"/>    
        <result property="fechap"              column="fechap"/>
        <result property="nombres"             column="nombres"/>
        <result property="id_laboratorio"      column="id_laboratorio"/>
        <result property="tipo"                column="tipo"/>   
        <result property="tipoconsulta"        column="tipoconsulta"/>   
        <result property="edad"                column="edad"/>
        <result property="mes"                 column="mes"/>
        <result property="dia"                 column="dia"/>
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma6"               column="suma6"/>
        <result property="estado"              column="estado"/>
        <result property="laboratorio"         column="laboratorio"/>
        <result property="diagnostico"         column="diagnostico"/>
        <result property="accion"              column="accion"/> 
        <result property="resultado"           column="resultado"/>
        <result property="inyectable"          column="inyectable"/>
        <result property="sueros"              column="sueros"/>
        <result property="curaciones"          column="curaciones"/>
        <result property="referido"            column="referido"/>
        <result property="contraref"           column="contraref"/> 
        <result property="id_seguro"           column="id_seguro"/> 
        <result property="aspecto"             column="aspecto"/>
        <result property="bacterias"           column="bacterias"/>
        <result property="suma20"               column="suma20"/>
        <result property="suma21"               column="suma21"/>
        <result property="suma22"               column="suma22"/>
        <result property="suma23"               column="suma23"/>
        <result property="suma24"               column="suma24"/>
        <result property="suma25"               column="suma25"/>
        <result property="suma26"               column="suma26"/>
        <result property="suma27"               column="suma27"/>
        <result property="suma28"               column="suma28"/>
        <result property="suma29"               column="suma29"/>
        <result property="suma30"               column="suma30"/>
        <result property="suma31"               column="suma31"/>
        <result property="suma32"               column="suma32"/>
        <result property="suma33"               column="suma33"/>
        <result property="suma34"               column="suma34"/>
        <result property="suma35"               column="suma35"/>
        <result property="suma36"               column="suma36"/>
        <result property="suma37"               column="suma37"/>
        <result property="suma38"               column="suma38"/>
        <result property="suma39"               column="suma39"/>
        <result property="suma40"               column="suma40"/>
        <result property="suma41"               column="suma41"/>
        <result property="suma42"               column="suma42"/>
        <result property="id_historial"        column="id_historial"/>  
    </resultMap>
    <select id="getVerCuaderno6Uni" resultMap="vcuaderno6"> 
        select id_historial,id_cuaderno,hcl,nro_registro as registro,c.id_persona,fechap::timestamp without time zone,c.nombres,c.id_tipo_sexo as id_laboratorio,
        tipo,expedido as tipoconsulta,extract(year from age( fec_nacimiento))::int  as edad,extract(month from age( fec_nacimiento))::int  as mes,
        extract(day from age( fec_nacimiento))::int  as dia,suma1,suma2,suma3,suma4,suma5,suma6,ingreso as estado,tratamiento as laboratorio, diagnostico,accion,
        egreso as resultado,inyectable,sueros,curaciones,referido,contraref,h.id_seguro,tratante as aspecto,accionmed as bacterias, 
        tcuracion as suma20,biopsia as suma21, sonda as suma22, actividad as suma23, hidrata as suma24, oxigeno as suma25,
        lipomas as suma26,suturas as suma27, retpunto as suma28, colocaciones as suma29, tinyecta as suma30, tsuero as suma31, 
        cirugia as suma32, trabquiro as suma33, bloqueo as suma34, drenaje as suma35, oninitomia as suma36, taponamiento as suma37,
        inmovilizacion as suma38,frenectomia as suma39, tendinorrafia as suma40, infeccion as suma41, tinyectable as suma42
        from cuaderno6 c   
        join historiales h using (id_historial)
        join pacientes using (id_paciente)  
        where  h.cod_esta=#{cod_esta} and pacientes.id_paciente=#{id_paciente} 
        order by fechap, id_cuaderno
    </select>  
    <select id="getVerCuaderno6" resultMap="vcuaderno6"> 
        select id_historial,id_cuaderno,hcl,nro_registro as registro,c.id_persona,fechap::timestamp without time zone,c.nombres,c.id_tipo_sexo as id_laboratorio,
        tipo,expedido as tipoconsulta,extract(year from age( fec_nacimiento))::int  as edad,extract(month from age( fec_nacimiento))::int  as mes,
        extract(day from age( fec_nacimiento))::int  as dia,suma1,suma2,suma3,suma4,suma5,suma6,ingreso as estado,tratamiento as laboratorio, diagnostico,accion,
        egreso as resultado,inyectable,sueros,curaciones,referido,contraref,h.id_seguro,tratante as aspecto,accionmed as bacterias, 
        tcuracion as suma20,biopsia as suma21, sonda as suma22, actividad as suma23, hidrata as suma24, oxigeno as suma25,
        lipomas as suma26,suturas as suma27, retpunto as suma28, colocaciones as suma29, tinyecta as suma30, tsuero as suma31, 
        cirugia as suma32, trabquiro as suma33, bloqueo as suma34, drenaje as suma35, oninitomia as suma36, taponamiento as suma37,
        inmovilizacion as suma38,frenectomia as suma39, tendinorrafia as suma40, infeccion as suma41, tinyectable as suma42
        from cuaderno6 c 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)  
        where  h.cod_esta=#{cod_esta} and (fechap::date BETWEEN #{fecha_ini} and #{fecha_fin}) and c.id_persona=#{id_persona} 
        order by fechap, id_cuaderno
    </select>   
    <select id="getVerCuaderno6Todos" resultMap="vcuaderno6"> 
        select id_historial,id_cuaderno,hcl,nro_registro as registro,c.id_persona,fechap::timestamp without time zone,c.nombres,c.id_tipo_sexo as id_laboratorio,
        tipo,expedido as tipoconsulta,extract(year from age( fec_nacimiento))::int  as edad,extract(month from age( fec_nacimiento))::int  as mes,
        extract(day from age( fec_nacimiento))::int  as dia,suma1,suma2,suma3,suma4,suma5,suma6,ingreso as estado,tratamiento as laboratorio, diagnostico,accion,
        egreso as resultado,inyectable,sueros,curaciones,referido,contraref,h.id_seguro,tratante as aspecto,accionmed as bacterias, 
        tcuracion as suma20,biopsia as suma21, sonda as suma22, actividad as suma23, hidrata as suma24, oxigeno as suma25,
        lipomas as suma26,suturas as suma27, retpunto as suma28, colocaciones as suma29, tinyecta as suma30, tsuero as suma31, 
        cirugia as suma32, trabquiro as suma33, bloqueo as suma34, drenaje as suma35, oninitomia as suma36, taponamiento as suma37,
        inmovilizacion as suma38,frenectomia as suma39, tendinorrafia as suma40, infeccion as suma41, tinyectable as suma42
        from cuaderno6 c  
        join historiales h using (id_historial)
        join pacientes using (id_paciente)  
        where  h.cod_esta=#{cod_esta} and (fechap::date BETWEEN #{fecha_ini}  and #{fecha_fin}) 
        order by fechap, id_cuaderno
    </select>  
   
    <resultMap id="vcuaderno3" type="Cuadernos">
        <result property="fecha"              column="fecha"/>
        <result property="hcl"                column="hcl"/>
        <result property="registro"            column="registro"/>
        <result property="nombres"             column="nombres"/>
        <result property="edad"                column="edad"/>    
        <result property="id_tipo_sexo"        column="id_tipo_sexo"/>
        <result property="orientacion"         column="orientacion"/>
        <result property="diu"                 column="diu"/>
        <result property="inyectable"          column="inyectable"/>
        <result property="condon"              column="condon"/>
        <result property="pildora"             column="pildora"/>
        <result property="aqv"                 column="aqv"/>
        <result property="otras"               column="otras"/> 
        <result property="mnatural"            column="mnatural"/>
        <result property="tipoconsulta"        column="tipoconsulta"/>
        <result property="insumos"             column="insumos"/> 
        <result property="pap"                 column="pap"/>
        <result property="referido"            column="referido"/>
        <result property="contraref"           column="contraref"/> 
        <result property="observa"             column="observa"/>   
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma6"               column="suma6"/>
        <result property="suma7"               column="suma7"/>
    </resultMap>
  
    <select id="getVerCuaderno3Uni" resultMap="vcuaderno3"> 
        select fecha,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,edad,id_tipo_sexo,edad,
        orientacion,diu,inyectable,condon,pildora,aqv,otras,mnatural,tipoconsulta,insumos,pap,referido,contraref,observa,
        num_pap as suma1,res_pap as suma2, ivaa as suma3, num_ivaa as suma4, res_ivaa as suma5, mama as suma6, res_mama as suma7
        from cuaderno3 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)      
        where  h.cod_esta=#{cod_esta} and h.id_paciente=#{id_paciente} 
        order by fecha,h.id_historial
    </select>  
   
    <select id="getVerCuaderno3" resultMap="vcuaderno3"> 
        select fecha,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,edad,id_tipo_sexo,edad,
        orientacion,diu,inyectable,condon,pildora,aqv,otras,mnatural,tipoconsulta,insumos,pap,referido,contraref,observa,
        num_pap as suma1,res_pap as suma2, ivaa as suma3, num_ivaa as suma4, res_ivaa as suma5, mama as suma6, res_mama as suma7
        from cuaderno3 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)      
        where  h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin}) and h.id_persona=#{id_persona} 
        order by fecha,h.id_historial
    </select>   
       
    <select id="getVerCuaderno3Todos" resultMap="vcuaderno3"> 
        select fecha,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,edad,id_tipo_sexo,edad,
        orientacion,diu,inyectable,condon,pildora,aqv,otras,mnatural,tipoconsulta,insumos,pap,referido,contraref,observa,
        num_pap as suma1,res_pap as suma2, ivaa as suma3, num_ivaa as suma4, res_ivaa as suma5, mama as suma6, res_mama as suma7
        from cuaderno3 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)      
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin}) 
        order by fecha,h.id_historial
    </select>  
    
    <resultMap id="desarrollo"      type="Cuadernos">
        <result property="id_laboratorio"      column="id_laboratorio"/>
        <result property="suma1"               column="suma1"/> 
        <result property="suma2"               column="suma2"/> 
        <result property="suma3"               column="suma3"/> 
        <result property="suma4"               column="suma4"/> 
        <result property="suma5"               column="suma5"/> 
        <result property="suma6"               column="suma6"/> 
        <result property="suma7"               column="suma7"/> 
        <result property="suma8"               column="suma8"/> 
        <result property="suma9"               column="suma9"/> 
        <result property="suma10"               column="suma10"/> 
        <result property="suma11"               column="suma11"/> 
        <result property="suma12"               column="suma12"/> 
        <result property="suma13"               column="suma13"/> 
        <result property="suma14"               column="suma14"/> 
    </resultMap>
  
    <select id="getDesarrolloSimple" resultMap="desarrollo"> 
        select id_historial as id_laboratorio,item1 as suma1,item2 as suma2,item3 as suma3,item4 as suma4,item5 as suma5,item6 as suma6,
        item7 as suma7,item8 as suma8,item9 as suma9,item10 as suma10,item11 as suma11,item12 as suma12,item13 as suma13,
        item14 as suma14
        from cuaderno4 
        where id_historial=#{id_historial}        
    </select>
   
    <resultMap id="vcuaderno4" type="Cuadernos">
        <result property="id_laboratorio"      column="id_laboratorio"/>
        <result property="fecha"               column="fecha"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="hcl"                 column="hcl"/>
        <result property="registro"            column="registro"/>
        <result property="nombres"             column="nombres"/>
        <result property="tipoconsulta"        column="tipoconsulta"/>    
        <result property="id_tipo_sexo"        column="id_tipo_sexo"/>
        <result property="edad"                column="edad"/>
        <result property="mes"                 column="mes"/>
        <result property="dia"                 column="dia"/>
        <result property="peso"                column="peso"/>
        <result property="talla"               column="talla"/>
        <result property="dglobal"             column="dglobal"/>
        <result property="dcronica"            column="dcronica"/>
        <result property="suma1"               column="suma1"/>
        <result property="dhierro"             column="dhierro"/>
        <result property="dvitaa"              column="dvitaa"/>
        <result property="suma4"               column="suma4"/> 
        <result property="suma5"               column="suma5"/> 
        <result property="suma2"               column="suma2"/> 
        <result property="lmexclu"             column="lmexclu"/>
        <result property="desesti"             column="desesti"/> 
        <result property="diagnostico"         column="diagnostico"/> 
        <result property="fc"                  column="fc"/> 
        <result property="pa"                  column="pa"/> 
        <result property="fr"                  column="fr"/> 
        <result property="temperatura"         column="temperatura"/> 
        <result property="accion"              column="accion"/>
        <result property="tipodent"            column="tipodent"/>
        <result property="contraref"           column="contraref"/>
        <result property="referido"            column="referido"/> 
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="seleccion"           column="seleccion"/>
        <result property="observa"             column="observa"/>
        <result property="resultado"           column="resultado"/>
        <result property="numpieza"            column="numpieza"/>
        <result property="internado"           column="internado"/>
        <result property="suma15"              column="suma15"/>
        <result property="suma10"              column="suma10"/>
        <result property="suma11"              column="suma11"/>
        <result property="suma12"              column="suma12"/>
        <result property="tipo_egreso"         column="tipo_egreso"/>
    </resultMap>
  
    <select id="getVerCuaderno4Paci" resultMap="vcuaderno4"> 
        select id_historial as id_laboratorio,fecha,h.id_persona,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        cuaderno4.tipoconsulta,id_tipo_sexo, edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,
        fec_nacimiento))::int  as dia,peso,talla,dglobal,dcronica,suma1,dhierro,dvitaa,suma4,suma5,suma2,lmexclu,desesti,diagnostico,
        fc,pa,fr,temperatura,codigo as tipodent,contraref,referido,tipo as id_cuaderno,seleccion,dgloba as observa, clasifica as resultado,
        (CASE WHEN (accion is null) THEN '.' ELSE accion END),bja as suma10, id_refer as suma11, mortalidad as suma12, 
        puntaje as numpieza, internado,id_referido as suma30, id_contraref as suma31,item15 as suma15,fuera as tipo_egreso
        from cuaderno4 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)        
        where h.cod_esta=#{cod_esta} and pacientes.id_paciente=#{id_paciente} and (edad between 0 and 4)        
        order by fecha desc,h.id_historial
        <!-- paRECE REPETIDO DE ABAJO REVISAR no hay con id_historial-->
    </select>
  
    <select id="getVerCuaderno4Uni" resultMap="vcuaderno4"> 
        select id_historial as id_laboratorio,fecha,h.id_persona,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        cuaderno4.tipoconsulta,id_tipo_sexo, edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,
        fec_nacimiento))::int  as dia,peso,talla,dglobal,dcronica,suma1,dhierro,dvitaa,suma4,suma5,suma2,lmexclu,desesti,diagnostico,
        fc,pa,fr,temperatura,codigo as tipodent,contraref,referido,tipo as id_cuaderno,seleccion,dgloba as observa, clasifica as resultado,
        (CASE WHEN (accion is null) THEN '.' ELSE accion END), bja as suma10, id_refer as suma11, mortalidad as suma12,
        puntaje as numpieza, internado,id_referido as suma30, id_contraref as suma31,item15 as suma15,fuera as tipo_egreso
        from cuaderno4 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)        
        where h.cod_esta=#{cod_esta} and pacientes.id_paciente=#{id_paciente} and (edad between 0 and 4)        
        order by fecha,h.id_historial
    </select> 
  
    <select id="getVerCuaderno4PaciUlt" resultMap="vcuaderno4"> 
        select id_historial as id_laboratorio,fecha,h.id_persona,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        cuaderno4.tipoconsulta,id_tipo_sexo, edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,
        fec_nacimiento))::int  as dia,peso,talla,dglobal,dcronica,suma1,dhierro,dvitaa,suma4,suma5,suma2,lmexclu,desesti,diagnostico,
        fc,pa,fr,temperatura,codigo as tipodent,contraref,referido,tipo as id_cuaderno,seleccion,dgloba as observa, clasifica as resultado,
        (CASE WHEN (accion is null) THEN '.' ELSE accion END), bja as suma10, id_refer as suma11, mortalidad as suma12,
        puntaje as numpieza, internado,id_referido as suma30, id_contraref as suma31,item15 as suma15,fuera as tipo_egreso
        from cuaderno4 
        join historiales h using (id_historial)
        join pacientes using (id_paciente) 
        where h.cod_esta=#{cod_esta} and id_paciente=#{id_paciente} and (edad between 0 and 4)  and id_cuaderno in 
        (select max(id_cuaderno) from cuaderno4 join historiales using (id_historial) 
        where  h.cod_esta=#{cod_esta} and id_paciente=#{id_paciente} and not(dglobal='0'))
    </select> 
  
    <select id="getVerCuaderno4" resultMap="vcuaderno4"> 
        select id_historial as id_laboratorio,fecha,h.id_persona,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        cuaderno4.tipoconsulta,id_tipo_sexo, edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,
        fec_nacimiento))::int  as dia,peso,talla,dglobal,dcronica,suma1,dhierro,dvitaa,suma4,suma5,suma2,lmexclu,desesti,diagnostico,
        fc,pa,fr,temperatura,codigo as tipodent,contraref,referido,tipo as id_cuaderno,seleccion,dgloba as observa, clasifica as resultado,
        (CASE WHEN (accion is null) THEN '.' ELSE accion END), bja as suma10, id_refer as suma11, mortalidad as suma12,
        puntaje as numpieza, internado,id_referido as suma30, id_contraref as suma31,item15 as suma15,fuera as tipo_egreso
        from cuaderno4 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)        
        where  h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and 
        h.id_persona=#{id_persona} and fuera=#{bcg} and (edad between 0 and 4)              
        order by fecha,h.id_historial
    </select> 
  
    <select id="getVerCuaderno4Todos" resultMap="vcuaderno4"> 
        select id_historial as id_laboratorio,fecha,h.id_persona,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        cuaderno4.tipoconsulta,id_tipo_sexo, edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,
        fec_nacimiento))::int  as dia,peso,talla,dglobal,dcronica,suma1,dhierro,dvitaa,suma4,suma5,suma2,lmexclu,desesti,diagnostico,
        fc,pa,fr,temperatura,codigo as tipodent,contraref,referido,tipo as id_cuaderno,seleccion,dgloba as observa, clasifica as resultado,
        (CASE WHEN (accion is null) THEN '.' ELSE accion END), bja as suma10, id_refer as suma11, mortalidad as suma12,
        puntaje as numpieza, internado,id_referido as suma30, id_contraref as suma31,item15 as suma15,fuera as tipo_egreso
        from cuaderno4 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)        
        where (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) and (edad between 0 and 4)        
        order by fecha,h.id_historial
    </select> 
    
    <select id="getVerCuaderno4Creci" resultMap="vcuaderno4"> 
        select id_historial as id_laboratorio,fecha,h.id_persona,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        cuaderno4.tipoconsulta,id_tipo_sexo, edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,
        fec_nacimiento))::int  as dia,peso,talla,dglobal,dcronica,suma1,dhierro,dvitaa,suma4,suma5,suma2,lmexclu,desesti,diagnostico,
        fc,pa,fr,temperatura,codigo as tipodent,contraref,referido,tipo as id_cuaderno,seleccion,dgloba as observa, clasifica as resultado,
        (CASE WHEN (accion is null) THEN '.' ELSE accion END), bja as suma10, id_refer as suma11, mortalidad as suma12,
        puntaje as numpieza, internado,id_referido as suma30, id_contraref as suma31,item15 as suma15,fuera as tipo_egreso
        from cuaderno4 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)        
        where  h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) and seleccion=0 and (edad between 0 and 4)    
        order by fecha,h.id_historial
    </select> 
  
    <select id="getVerCuaderno4CreciDA" resultMap="vcuaderno4"> 
        select id_historial as id_laboratorio,fecha,h.id_persona,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        cuaderno4.tipoconsulta,id_tipo_sexo, edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,
        fec_nacimiento))::int  as dia,peso,talla,dglobal,dcronica,suma1,dhierro,dvitaa,suma4,suma5,suma2,lmexclu,desesti,diagnostico,
        fc,pa,fr,temperatura,codigo as tipodent,contraref,referido,tipo as id_cuaderno,seleccion,dgloba as observa, clasifica as resultado,
        (CASE WHEN (accion is null) THEN '.' ELSE accion END), bja as suma10, id_refer as suma11, mortalidad as suma12,
        puntaje as numpieza, internado,id_referido as suma30, id_contraref as suma31,item15 as suma15,fuera as tipo_egreso
        from cuaderno4 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)        
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) and seleccion=0 and (dglobal='M' or dglobal='G')
        order by fecha,h.id_historial
    </select> 
  
    <select id="getVerCuaderno4CreciNuevoDA" resultMap="vcuaderno4"> 
        select id_historial as id_laboratorio,fecha,h.id_persona,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        cuaderno4.tipoconsulta,id_tipo_sexo, edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,
        fec_nacimiento))::int  as dia,peso,talla,dglobal,dcronica,suma1,dhierro,dvitaa,suma4,suma5,suma2,lmexclu,desesti,diagnostico,
        fc,pa,fr,temperatura,codigo as tipodent,contraref,referido,tipo as id_cuaderno,seleccion,dgloba as observa, clasifica as resultado,
        (CASE WHEN (accion is null) THEN '.' ELSE accion END), bja as suma10, id_refer as suma11, mortalidad as suma12,
        puntaje as numpieza, internado,id_referido as suma30, id_contraref as suma31,item15 as suma15,fuera as tipo_egreso
        from cuaderno4 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)        
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin}) and tipo=1 and seleccion=0 and (dglobal='M' or dglobal='G')
        order by fecha,h.id_historial
    </select> 
  
    <select id="getVerCuaderno4Enfer" resultMap="vcuaderno4"> 
        select id_historial as id_laboratorio,fecha,h.id_persona,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        cuaderno4.tipoconsulta,id_tipo_sexo, edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,
        fec_nacimiento))::int  as dia,peso,talla,dglobal,dcronica,suma1,dhierro,dvitaa,suma4,suma5,suma2,lmexclu,desesti,diagnostico,
        fc,pa,fr,temperatura,codigo as tipodent,contraref,referido,tipo as id_cuaderno,seleccion,dgloba as observa, clasifica as resultado,
        (CASE WHEN (accion is null) THEN '.' ELSE accion END), bja as suma10, id_refer as suma11, mortalidad as suma12,
        puntaje as numpieza, internado,id_referido as suma30, id_contraref as suma31,item15 as suma15,fuera as tipo_egreso
        from cuaderno4 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)        
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin}) and seleccion=1 and (edad between 0 and 4)       
        order by fecha,h.id_historial
    </select> 
  
    <select id="getVerCuaderno4_C2Creci" resultMap="vcuaderno4"> 
        select id_historial as id_laboratorio,fecha,h.id_persona,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        (CASE WHEN cuaderno4.tipoconsulta is null THEN 'N' ELSE cuaderno4.tipoconsulta END) as tipoconsulta,
        id_tipo_sexo, edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,
        fec_nacimiento))::int  as dia,peso,talla,dglobal,dcronica,suma1,dhierro,dvitaa,suma4,suma5,suma2,lmexclu,desesti,diagnostico,
        fc,pa,fr,temperatura,codigo as tipodent,contraref,referido,tipo as id_cuaderno,seleccion,dgloba as observa, clasifica as resultado,
        (CASE WHEN (accion is null) THEN '.' ELSE accion END), bja as suma10, id_refer as suma11, mortalidad as suma12,
        puntaje as numpieza, internado,id_referido as suma30, id_contraref as suma31,item15 as suma15,fuera as tipo_egreso
        from cuaderno4 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)        
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) and seleccion=0 and (edad between 0 and 4)         
        order by fecha,h.id_historial
    </select> 
    
    <select id="getVerCuaderno4_C22014D" resultMap="vcuaderno4"> 
        select id_historial as id_laboratorio,fecha,h.id_persona,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        (CASE WHEN cuaderno4.tipoconsulta is null THEN 'N' ELSE cuaderno4.tipoconsulta END) as tipoconsulta,
        id_tipo_sexo, edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,
        fec_nacimiento))::int  as dia,peso,talla,dglobal,dcronica,suma1,dhierro,dvitaa,suma4,suma5,suma2,lmexclu,desesti,diagnostico,
        fc,pa,fr,temperatura,codigo as tipodent,contraref,referido,tipo as id_cuaderno,seleccion,dgloba as observa, clasifica as resultado,
        (CASE WHEN (accion is null) THEN '.' ELSE accion END), bja as suma10, id_refer as suma11, mortalidad as suma12,
        puntaje as numpieza, internado,id_referido as suma30, id_contraref as suma31,item15 as suma15,fuera as tipo_egreso
        from cuaderno4 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)        
        where h.cod_esta=#{cod_esta} and fuera=0 and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) and (edad between 0 and 4) 
        order by fecha,h.id_historial
    </select> 
    
    <select id="getVerCuaderno4_C22014DIndi" resultMap="vcuaderno4"> 
        select id_historial as id_laboratorio,fecha,h.id_persona,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        (CASE WHEN cuaderno4.tipoconsulta is null THEN 'N' ELSE cuaderno4.tipoconsulta END) as tipoconsulta,
        id_tipo_sexo, edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,
        fec_nacimiento))::int  as dia,peso,talla,dglobal,dcronica,suma1,dhierro,dvitaa,suma4,suma5,suma2,lmexclu,desesti,diagnostico,
        fc,pa,fr,temperatura,codigo as tipodent,contraref,referido,tipo as id_cuaderno,seleccion,dgloba as observa, clasifica as resultado,
        (CASE WHEN (accion is null) THEN '.' ELSE accion END), bja as suma10, id_refer as suma11, mortalidad as suma12,
        puntaje as numpieza, internado,id_referido as suma30, id_contraref as suma31,item15 as suma15,fuera as tipo_egreso
        from cuaderno4 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)        
        where h.cod_esta=#{cod_esta} and h.id_persona=#{id_persona} and fuera=0 and 
        (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and (edad between 0 and 4)    
        order by fecha,h.id_historial
    </select> 
    
    <select id="getVerCuaderno4_C22014F" resultMap="vcuaderno4"> 
        select id_historial as id_laboratorio,fecha,h.id_persona,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        (CASE WHEN cuaderno4.tipoconsulta is null THEN 'N' ELSE cuaderno4.tipoconsulta END) as tipoconsulta,
        id_tipo_sexo, edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,
        fec_nacimiento))::int  as dia,peso,talla,dglobal,dcronica,suma1,dhierro,dvitaa,suma4,suma5,suma2,lmexclu,desesti,diagnostico,
        fc,pa,fr,temperatura,codigo as tipodent,contraref,referido,tipo as id_cuaderno,seleccion,dgloba as observa, clasifica as resultado,
        (CASE WHEN (accion is null) THEN '.' ELSE accion END), bja as suma10, id_refer as suma11, mortalidad as suma12,
        puntaje as numpieza, internado,id_referido as suma30, id_contraref as suma31,item15 as suma15,fuera as tipo_egreso
        from cuaderno4 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)        
        where h.cod_esta=#{cod_esta} and fuera=1 and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and (edad between 0 and 4)    
        order by fecha,h.id_historial
    </select> 
    
    <select id="getVerCuaderno4_C22014FIndi" resultMap="vcuaderno4"> 
        select id_historial as id_laboratorio,fecha,h.id_persona,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        (CASE WHEN cuaderno4.tipoconsulta is null THEN 'N' ELSE cuaderno4.tipoconsulta END) as tipoconsulta,
        id_tipo_sexo, edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,
        fec_nacimiento))::int  as dia,peso,talla,dglobal,dcronica,suma1,dhierro,dvitaa,suma4,suma5,suma2,lmexclu,desesti,diagnostico,
        fc,pa,fr,temperatura,codigo as tipodent,contraref,referido,tipo as id_cuaderno,seleccion,dgloba as observa, clasifica as resultado,
        (CASE WHEN (accion is null) THEN '.' ELSE accion END), bja as suma10, id_refer as suma11, mortalidad as suma12,
        puntaje as numpieza, internado,id_referido as suma30, id_contraref as suma31,item15 as suma15,fuera as tipo_egreso
        from cuaderno4  
        join historiales h using (id_historial)
        join pacientes using (id_paciente)        
        where h.cod_esta=#{cod_esta} and h.id_persona=#{id_persona} and fuera=1 and 
        (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) and (edad between 0 and 4)     
        order by fecha,h.id_historial
    </select> 
    
    <select id="getVerCuaderno4_C2Consul" resultMap="vcuaderno4"> 
        select id_historial as id_laboratorio,fecha,h.id_persona,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        (CASE WHEN cuaderno4.tipoconsulta is null THEN 'N' ELSE cuaderno4.tipoconsulta END) as tipoconsulta,
        id_tipo_sexo, edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,
        fec_nacimiento))::int  as dia,peso,talla,dglobal,dcronica,suma1,dhierro,dvitaa,suma4,suma5,suma2,lmexclu,desesti,diagnostico,
        fc,pa,fr,temperatura,codigo as tipodent,contraref,referido,tipo as id_cuaderno,seleccion,dgloba as observa, clasifica as resultado,
        (CASE WHEN (accion is null) THEN '.' ELSE accion END), bja as suma10, id_refer as suma11, mortalidad as suma12,
        puntaje as numpieza, internado,id_referido as suma30, id_contraref as suma31,item15 as suma15,fuera as tipo_egreso
        from cuaderno4 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)        
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) and seleccion=1 and (edad between 0 and 4)         
        order by fecha,h.id_historial
    </select> 
    
    <select id="getVerCuaderno4_C2" resultMap="vcuaderno4"> 
        select id_historial as id_laboratorio,fecha,h.id_persona,hcl,nro_registro as registro,(paterno||' '||materno||' '||nombre) as nombres,
        (CASE WHEN cuaderno4.tipoconsulta is null THEN 'N' ELSE cuaderno4.tipoconsulta END) as tipoconsulta,
        id_tipo_sexo, edad,extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,
        fec_nacimiento))::int  as dia,peso,talla,dglobal,dcronica,suma1,dhierro,dvitaa,suma4,suma5,suma2,lmexclu,desesti,diagnostico,
        fc,pa,fr,temperatura,codigo as tipodent,contraref,referido,tipo as id_cuaderno,seleccion,dgloba as observa, clasifica as resultado,
        (CASE WHEN (accion is null) THEN '.' ELSE accion END), bja as suma10, id_refer as suma11, mortalidad as suma12,
        puntaje as numpieza, internado,id_referido as suma30, id_contraref as suma31,item15 as suma15,fuera as tipo_egreso
        from cuaderno4 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)        
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and fuera=#{bcg} and (edad between 0 and 4)          
        order by fecha,h.id_historial
    </select> 
  
    <resultMap id="vdesarrollo" type="Cuadernos">
        <result property="id_cuaderno"         column="id_cuaderno"/>      
        <result property="mes"                 column="mes"/>
        <result property="registro"            column="registro"/>
        <result property="diagnostico"         column="diagnostico"/> 
        <result property="accion"              column="accion"/>
    </resultMap>
  
    <select id="getVerDesarrolloSimple" resultMap="vdesarrollo"> 
        select id_detalle as id_cuaderno,mes,trim(item) as registro,trim(caracter) as diagnostico,trim(criterio) as accion 
        from seguimiento 
        where id_estado=#{id_laboratorio} and mes=#{id_paciente} 
        order by id_detalle,id_estado
    </select>
    
    <select id="getVerDesarrollo2" resultMap="vdesarrollo"> 
        select id_detalle as id_cuaderno,mes,trim(item) as registro,trim(caracter) as diagnostico,direccion as accion 
        from seguimiento2 
        where mes=#{id_paciente} 
        order by id_detalle,id_estado
    </select>
  
    <select id="getVerDesarrollo" resultMap="vdesarrollo"> 
        select id_detalle as id_cuaderno,mes,trim(item) as registro,trim(caracter) as diagnostico,trim(criterio) as accion 
        from seguimiento 
        where id_estado=#{id_laboratorio} and id_detalle=(select (id_detalle) from seguimiento where id_estado=#{id_laboratorio} and mes=#{id_paciente}) 
        UNION
        select id_detalle as id_cuaderno,mes,trim(item) as registro,trim(caracter) as diagnostico,trim(criterio) as accion 
        from seguimiento 
        where id_estado=#{id_laboratorio} and id_detalle=(select (id_detalle) from seguimiento where id_estado=#{id_laboratorio} and mes=#{id_paciente}) -1
        UNION
        select id_detalle as id_cuaderno,mes,trim(item) as registro,trim(caracter) as diagnostico,trim(criterio) as accion 
        from seguimiento 
        where id_estado=#{id_laboratorio} and id_detalle=(select (id_detalle) from seguimiento where id_estado=#{id_laboratorio} and mes=#{id_paciente}) -2
        UNION
        select id_detalle as id_cuaderno,mes,trim(item) as registro,trim(caracter) as diagnostico,trim(criterio) as accion 
        from seguimiento 
        where id_estado=#{id_laboratorio} and id_detalle=(select (id_detalle) from seguimiento where id_estado=#{id_laboratorio} and mes=#{id_paciente}) -3
        UNION
        select id_detalle as id_cuaderno,mes,trim(item) as registro,trim(caracter) as diagnostico,trim(criterio) as accion 
        from seguimiento 
        where id_estado=#{id_laboratorio} and id_detalle=(select (id_detalle) from seguimiento where id_estado=#{id_laboratorio} and mes=#{id_paciente}) -4
        order by mes
    </select>
    <resultMap id="vcuaderno2" type="Cuadernos">
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="id_laboratorio"      column="id_laboratorio"/>
        <result property="fechap"              column="fechap"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="hcl"                 column="hcl"/>
        <result property="registro"            column="registro"/>
        <result property="nombres"             column="nombres"/>
        <result property="edad"                column="edad"/>
        <result property="semanas"             column="semanas"/>
        <result property="fum"                 column="fum"/>
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma10"              column="suma10"/>
        <result property="suma11"              column="suma11"/>
        <result property="suma12"              column="suma12"/>
        <result property="suma13"              column="suma13"/>
        <result property="suma14"              column="suma14"/>
        <result property="suma15"              column="suma15"/>
        <result property="suma16"              column="suma16"/>
        <result property="pap"                 column="pap"/>
        <result property="parto"               column="parto"/>
        <result property="anestesia"           column="anestesia"/>
        <result property="pesonac"              column="pesonac"/>
        <result property="peso"                column="peso"/>
        <result property="sexo"                column="sexo"/>
        <result property="talla"               column="talla"/>
        <result property="estado"              column="estado"/>
        <result property="controlpos"          column="controlpos"/>
        <result property="tabletas"            column="tabletas"/>    
        <result property="sfembarazada"        column="sfembarazada"/>
        <result property="sfpuerpera"          column="sfpuerpera"/>
        <result property="vitamina"            column="vitamina"/>
        <result property="referido"            column="referido"/>
        <result property="contraref"           column="contraref"/> 
        <result property="eclam"               column="eclam"/> 
        <result property="aborto"              column="aborto"/> 
        <result property="hemo"                column="hemo"/> 
        <result property="imc"                 column="imc"/>
        <result property="nembarazo"           column="nembarazo"/>
        <result property="diagnostico"         column="diagnostico"/>
        <result property="pa"                  column="pa"/>
        <result property="auto"                column="auto"/>
        <result property="numpieza"            column="numpieza"/>
        <result property="suma10"              column="suma10"/> 
        <result property="suma11"              column="suma11"/> 
        <result property="suma12"              column="suma12"/> 
        <result property="suma13"              column="suma13"/> 
        <result property="suma14"              column="suma14"/> 
        <result property="suma15"              column="suma15"/> 
        <result property="suma16"              column="suma16"/> 
        <result property="suma20"              column="suma20"/> 
        <result property="suma50"              column="suma50"/> 
        <result property="suma51"              column="suma51"/> 
        <result property="tipo_egreso"         column="tipo_egreso"/> 
    </resultMap>
   
    <select id="getVerCuaderno2Uni" resultMap="vcuaderno2"> 
        select id_cuaderno,id_historial as id_laboratorio,fecha as fechap,h.id_persona,hcl,id_historial,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,edad,semanas, fum, suma1,suma2,suma3,suma4,pap,parto,anestesia,
        cuaderno2.peso as pesonac,h.peso,sexo,talla,estado,controlpos,tabletas,sfembarazada,sfpuerpera,vitamina,referido,
        contraref,eclam,aborto,hemo,imc,nembarazo,diagnostico,pa,gramos as auto,numero as numpieza, num_pap as suma10,
        res_pap as suma11, ivaa as suma12, num_ivaa as suma13, res_ivaa as suma14, mama as suma15, res_mama  as suma16,
        bonojap as suma20,fuera as tipo_egreso,rnmalformacion as suma50, id_refer as suma51
        from cuaderno2 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where h.cod_esta=#{cod_esta} and  h.id_paciente=#{id_paciente} 
        order by fecha,h.id_historial       
    </select> 
   
    <select id="getVerCuaderno2Parto" resultMap="vcuaderno2"> 
        select id_cuaderno,id_historial as id_laboratorio,fecha as fechap,h.id_persona,hcl,id_historial,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,edad,semanas, fum, suma1,suma2,suma3,suma4,pap,parto,anestesia,
        cuaderno2.peso as pesonac,h.peso,sexo,talla,estado,controlpos,tabletas,sfembarazada,sfpuerpera,vitamina,referido,
        contraref,eclam,aborto,hemo,imc,nembarazo,diagnostico,pa,gramos as auto,numero as numpieza, num_pap as suma10,
        res_pap as suma11, ivaa as suma12, num_ivaa as suma13, res_ivaa as suma14, mama as suma15, res_mama  as suma16,
        bonojap as suma20,fuera as tipo_egreso,rnmalformacion as suma50, id_refer as suma51
        from cuaderno2 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin}) and parto>0
        order by fecha,h.id_historial      
    </select> 
   
    <select id="getVerCuaderno2Ult" resultMap="vcuaderno2"> 
        select id_cuaderno,id_historial as id_laboratorio,fecha as fechap,h.id_persona,hcl,id_historial,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,edad,semanas, fum, suma1,suma2,suma3,suma4,pap,parto,anestesia,
        cuaderno2.peso as pesonac,h.peso,sexo,talla,estado,controlpos,tabletas,sfembarazada,sfpuerpera,vitamina,referido,
        contraref,eclam,aborto,hemo,imc,nembarazo,diagnostico,pa,gramos as auto,numero as numpieza, num_pap as suma10,
        res_pap as suma11, ivaa as suma12, num_ivaa as suma13, res_ivaa as suma14, mama as suma15, res_mama  as suma16,
        bonojap as suma20,fuera as tipo_egreso,rnmalformacion as suma50, id_refer as suma51
        from cuaderno2 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where h.cod_esta=#{cod_esta} and id_paciente=#{id_paciente} and id_cuaderno in 
              (select max(id_cuaderno) from cuaderno2 join historiales h using (id_historial) 
                      where h.cod_esta=#{cod_esta} and id_paciente=#{id_paciente}) 
    </select>
   
    <select id="getVerCuaderno2" resultMap="vcuaderno2"> 
        select id_cuaderno,id_historial as id_laboratorio,fecha as fechap,h.id_persona,hcl,id_historial,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,edad,semanas, fum, suma1,suma2,suma3,suma4,pap,parto,anestesia,
        cuaderno2.peso as pesonac,h.peso,sexo,talla,estado,controlpos,tabletas,sfembarazada,sfpuerpera,vitamina,referido,
        contraref,eclam,aborto,hemo,imc,nembarazo,diagnostico,pa,gramos as auto,numero as numpieza, num_pap as suma10,
        res_pap as suma11, ivaa as suma12, num_ivaa as suma13, res_ivaa as suma14, mama as suma15, res_mama  as suma16,
        bonojap as suma20,fuera as tipo_egreso,rnmalformacion as suma50, id_refer as suma51
        from cuaderno2 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin}) and h.id_persona=#{id_persona} 
        order by fecha,h.id_historial       
    </select>    
    
    <select id="getVerCuaderno2Todos" resultMap="vcuaderno2"> 
        select id_cuaderno,id_historial as id_laboratorio,fecha as fechap,h.id_persona,hcl,id_historial,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,edad,semanas, fum, suma1,suma2,suma3,suma4,pap,parto,anestesia,
        cuaderno2.peso as pesonac,h.peso,sexo,talla,estado,controlpos,tabletas,sfembarazada,sfpuerpera,vitamina,referido,
        contraref,eclam,aborto,hemo,imc,nembarazo,diagnostico,pa,gramos as auto,numero as numpieza, num_pap as suma10,
        res_pap as suma11, ivaa as suma12, num_ivaa as suma13, res_ivaa as suma14, mama as suma15, res_mama  as suma16,
        bonojap as suma20,fuera as tipo_egreso,rnmalformacion as suma50, id_refer as suma51
        from cuaderno2 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin}) 
        order by fecha,h.id_historial       
    </select> 
   
    <resultMap id="vcuaderno2C3" type="Cuadernos">
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="fecha"               column="fecha"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="hcl"                column="hcl"/>
        <result property="registro"            column="registro"/>
        <result property="nombres"             column="nombres"/>
        <result property="edad"                column="edad"/>
        <result property="id_tipo_sexo"        column="id_tipo_sexo"/>
        <result property="pap"                 column="pap"/>
        <result property="semanas"             column="semanas"/>
        <result property="fum"                 column="fum"/>
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="parto"               column="parto"/>
        <result property="anestesia"           column="anestesia"/>
        <result property="pesonac"              column="pesonac"/>
        <result property="peso"                column="peso"/>
        <result property="sexo"                column="sexo"/>
        <result property="talla"               column="talla"/>
        <result property="estado"              column="estado"/>
        <result property="controlpos"          column="controlpos"/>
        <result property="tabletas"            column="tabletas"/>    
        <result property="sfembarazada"        column="sfembarazada"/>
        <result property="sfpuerpera"          column="sfpuerpera"/>
        <result property="vitamina"            column="vitamina"/>
        <result property="referido"            column="referido"/>
        <result property="contraref"           column="contraref"/> 
        <result property="eclam"               column="eclam"/> 
        <result property="aborto"              column="aborto"/> 
        <result property="hemo"                column="hemo"/> 
        <result property="imc"                 column="imc"/>
        <result property="nembarazo"           column="nembarazo"/>
        <result property="diagnostico"         column="diagnostico"/>
        <result property="pa"                  column="pa"/>
        <result property="auto"                column="auto"/>
        <result property="numpieza"            column="numpieza"/>
        <result property="referido"            column="referido"/>
        <result property="contraref"           column="contraref"/> 
        <result property="orientacion"         column="orientacion"/>
        <result property="diu"                 column="diu"/>
        <result property="inyectable"          column="inyectable"/>
        <result property="condon"              column="condon"/>
        <result property="pildora"             column="pildora"/>
        <result property="aqv"                 column="aqv"/>
        <result property="otras"               column="otras"/> 
        <result property="mnatural"            column="mnatural"/>
        <result property="tipoconsulta"        column="tipoconsulta"/>
        <result property="insumos"             column="insumos"/> 
        <result property="observa"             column="observa"/> 
        <result property="id_laboratorio"      column="id_laboratorio"/> 
        <result property="suma11"              column="suma11"/>
        <result property="suma12"              column="suma12"/>
        <result property="suma13"              column="suma13"/>
        <result property="suma14"              column="suma14"/>
        <result property="suma15"              column="suma15"/>
        <result property="suma16"              column="suma16"/>
        <result property="suma17"              column="suma17"/>
        <result property="suma18"              column="suma18"/>
        <result property="suma19"              column="suma19"/>
        <result property="suma20"              column="suma20"/>
        <result property="suma30"              column="suma30"/>
        <result property="suma50"              column="suma50"/>
        <result property="suma51"              column="suma51"/>
        <result property="tipo_egreso"         column="tipo_egreso"/> 
    </resultMap>
  
    <select id="getVerCuaderno2C3" resultMap="vcuaderno2C3"> 
        (select id_cuaderno,id_historial,fecha,h.id_persona,hcl,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,edad,1 as id_tipo_sexo,pap,semanas, 
        fum, suma1,suma2,suma3,suma4,parto,anestesia, cuaderno2.peso as pesonac,h.peso,sexo,
        talla,estado,controlpos,tabletas,sfembarazada,sfpuerpera,vitamina,eclam,aborto,hemo,imc,nembarazo,
        diagnostico,pa,gramos as auto,numero as numpieza,lactmaterna as suma18,apeprecoz as suma19,referido,contraref,
        0 as orientacion,0 as diu,0 as inyectable,0 as condon,0 as pildora,0 as aqv,0 as otras,0 as mnatural,
        '0' as tipoconsulta,0 as insumos,'0' as observa,1 as id_laboratorio,id_referido as suma30,
        num_pap as suma11,res_pap as suma12,ivaa as suma13,num_ivaa as suma14,res_ivaa as suma15,mama as suma16,res_mama as suma17,
        bonojap as suma20,fuera as tipo_egreso,rnmalformacion as suma50, id_refer as suma51
        from cuaderno2 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) 
        order by fecha,h.id_historial) 
        UNION
        (select id_cuaderno,id_historial,fecha,h.id_persona,hcl,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,edad,id_tipo_sexo,pap,0 as semanas,
        now() as fum,0 as suma1,0 as suma2,0 as suma3,0 as suma4,0 as parto,0 as anestesia,'0' as pesonac,0 as peso,0 as sexo,
        0 as talla,'0' as estado,0 as controlpos,0 as tabletas,0 as sfembarazada,0 as sfpuerpera,0 as vitamina,0 as eclam,0 as aborto,
        0 as hemo,0 as imc,0 as nembarazo,diagnostico,pa,0 as autoauto,0 as numpieza,0 as suma18,0 as suma19,referido,contraref,
        orientacion,diu,inyectable,condon,pildora,aqv,otras,mnatural,tipoconsulta,insumos,observa,2 as id_laboratorio,0 as suma30,
        num_pap as suma11,res_pap as suma12,ivaa as suma13,num_ivaa as suma14,res_ivaa as suma15,mama as suma16,res_mama as suma17,
        0 as suma20,fuera as tipo_egreso,0 as suma50, 0 as suma51
        from cuaderno3 
        join historiales h using (id_historial)
        join pacientes using (id_paciente) 
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} )        
        order by fecha,h.id_historial)
        order by fecha,id_historial     
    </select> 
   
    <select id="getVerCuaderno2C3Uni" resultMap="vcuaderno2C3"> 
        (select id_cuaderno,id_historial,fecha,h.id_persona,hcl,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,edad,1 as id_tipo_sexo,pap,semanas, 
        fum, suma1,suma2,suma3,suma4,parto,anestesia, cuaderno2.peso as pesonac,h.peso,sexo,
        talla,estado,controlpos,tabletas,sfembarazada,sfpuerpera,vitamina,eclam,aborto,hemo,imc,nembarazo,
        diagnostico,pa,gramos as auto,numero as numpieza,lactmaterna as suma18,apeprecoz as suma19,referido,contraref,
        0 as orientacion,0 as diu,0 as inyectable,0 as condon,0 as pildora,0 as aqv,0 as otras,0 as mnatural,
        '0' as tipoconsulta,0 as insumos,'0' as observa,1 as id_laboratorio,id_referido as suma30,
        num_pap as suma11,res_pap as suma12,ivaa as suma13,num_ivaa as suma14,res_ivaa as suma15,mama as suma16,res_mama as suma17,
        bonojap as suma20,fuera as tipo_egreso,rnmalformacion as suma50, id_refer as suma51
        from cuaderno2 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  h.cod_esta=#{cod_esta} and (fecha::date BETWEEN  #{fecha_ini} and #{fecha_fin} ) and h.id_persona=#{id_persona}
        order by fecha,h.id_historial) 
        UNION
        (select id_cuaderno,id_historial,fecha,h.id_persona,hcl,nro_registro as registro,
        (paterno||' '||materno||' '||nombre) as nombres,edad,id_tipo_sexo,pap,0 as semanas,
        now() as fum,0 as suma1,0 as suma2,0 as suma3,0 as suma4,0 as parto,0 as anestesia,'0' as pesonac,0 as peso,0 as sexo,
        0 as talla,'0' as estado,0 as controlpos,0 as tabletas,0 as sfembarazada,0 as sfpuerpera,0 as vitamina,0 as eclam,0 as aborto,
        0 as hemo,0 as imc,0 as nembarazo,diagnostico,pa,0 as autoauto,0 as numpieza,0 as suma18,0 as suma19,referido,contraref,
        orientacion,diu,inyectable,condon,pildora,aqv,otras,mnatural,tipoconsulta,insumos,observa,2 as id_laboratorio,0 as suma30,
        num_pap as suma11,res_pap as suma12,ivaa as suma13,num_ivaa as suma14,res_ivaa as suma15,mama as suma16,res_mama as suma17,
        0 as suma20,fuera as tipo_egreso,0 as suma50, 0 as suma51
        from cuaderno3 
        join historiales h using (id_historial)
        join pacientes using (id_paciente) 
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) and h.id_persona=#{id_persona}         
        order by fecha,h.id_historial)
        order by fecha,id_historial     
    </select> 
  
    <resultMap id="vcuaderno50" type="Cuadernos">
        <result property="registro"            column="registro"/>
        <result property="fechap"              column="fechap"/>
        <result property="nombres"             column="nombres"/>
        <result property="fechap"              column="fechap"/>
        <result property="nombre"              column="nombre"/>
        <result property="edad"                column="edad"/>
        <result property="diasi"               column="diasi"/>
        <result property="dia"                 column="dia"/>
        <result property="mes"                 column="mes"/>
        <result property="diagnostico_ing"     column="diagnostico_ing"/>
        <result property="fec_ingreso"         column="fec_ingreso"/>
        <result property="fec_egreso"          column="fec_egreso"/>
        <result property="cadena1"             column="cadena1"/>
    </resultMap>
   
    <select id="getVerCuaderno5Piso" resultMap="vcuaderno50"> 
        select nro_registro as registro,fecha as fechap, p.nombres, edad, (e.paterno||' '||e.materno||' '||e.nombres) as nombre,
        (CASE WHEN p.id_tipo_sexo=1 THEN 'F' ELSE 'M' END) as cadena1,
        extract(month from age( h.fecha,p.fec_nacimiento))::int  as mes,extract(day from age( h.fecha,p.fec_nacimiento))::int  as dia, 
        (extract(day from age(now(),fec_ingreso))*extract(month from age(now(),fec_ingreso)))::int  as diasi,
        (CASE WHEN (diagnostico_ing='' or diagnostico_ing is null)  THEN h.diagnostico ELSE diagnostico_ing END) as diagnostico_ing, 
        fec_ingreso, fec_egreso, cama, sala
        from cuaderno5 c
        join historiales h using (id_historial)
        join pacientes p using (id_paciente)
        inner join personas e on c.id_persona=e.id_persona
        where  (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) and internado=2 and c.id_piso between #{suma1} and #{suma2#{
        order by fecha,h.id_historial  
    </select> 
    
    <resultMap id="vcuaderno5" type="Cuadernos">
        <result property="id_laboratorio"      column="id_laboratorio"/>
        <result property="id_cuaderno"         column="id_cuaderno"/>
        <result property="id_persona"          column="id_persona"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="registro"            column="registro"/>
        <result property="fechap"              column="fechap"/>
        <result property="nombres"             column="nombres"/>
        <result property="edad"                column="edad"/>
        <result property="diasi"               column="diasi"/>
        <result property="diasc"               column="diasc"/>
        <result property="dia"                 column="dia"/>
        <result property="ingreso"             column="ingreso"/>
        <result property="diagnostico_ing"     column="diagnostico_ing"/>
        <result property="cirugia"             column="cirugia"/>
        <result property="anastecia"           column="anastecia"/>
        <result property="diagnostico"         column="diagnostico"/>    
        <result property="fec_ingreso"         column="fec_ingreso"/>    
        <result property="fec_egreso"          column="fec_egreso"/>    
        <result property="egreso"              column="egreso"/>
        <result property="tipo_egreso"         column="tipo_egreso"/>
        <result property="fallecido"           column="fallecido"/>    
        <result property="fallecidom5"         column="fallecidom5"/>    
        <result property="fallecidoy5"         column="fallecidoy5"/> 
        <result property="referido"            column="referido"/>     
        <result property="contraref"           column="contraref"/>  
        <result property="cama"                column="cama"/>  
        <result property="sala"                column="sala"/>  
    </resultMap>
   
    <select id="getVerCuaderno5Uni" resultMap="vcuaderno5"> 
        select id_historial as id_laboratorio,h.id_persona,hcl as id_historial,nro_registro as registro,fecha as fechap,
        (paterno||' '||materno||' '||nombre) as nombres, edad, id_tipo_sexo as id_cuaderno,diasi,diasc,
        extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,fec_nacimiento))::int  as dia, 
        ingreso, diagnostico_ing, cirugia, anastecia, cuaderno5.diagnostico, fec_ingreso, fec_egreso, 
        egreso, tipo_egreso, fallecido, fallecidom5, fallecidoy5, referido, contraref, cama, sala
        from cuaderno5 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  h.cod_esta=#{cod_esta} and h.id_paciente=#{id_paciente} 
        order by fecha,h.id_historial       
    </select> 
   
    <select id="getVerCuaderno5Ult" resultMap="vcuaderno5"> 
        select id_historial as id_laboratorio,h.id_persona,hcl as id_historial,nro_registro as registro,fecha as fechap,
        (paterno||' '||materno||' '||nombre) as nombres, edad, id_tipo_sexo as id_cuaderno,diasi,diasc,
        extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,fec_nacimiento))::int  as dia, 
        ingreso, diagnostico_ing, cirugia, anastecia, cuaderno5.diagnostico, fec_ingreso, fec_egreso, 
        egreso, tipo_egreso, fallecido, fallecidom5, fallecidoy5, referido, contraref, cama, sala
        from cuaderno5 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  id_paciente=#{id_paciente} and id_cuaderno in 
        (select max(id_cuaderno) from cuaderno2 join historiales using (id_historial)
        where h.cod_esta=#{cod_esta} and id_paciente=#{id_paciente}) 
        order by fecha,h.id_historial    
    </select>
   
    <select id="getVerCuaderno5" resultMap="vcuaderno5"> 
        select id_historial as id_laboratorio,h.id_persona,hcl as id_historial,nro_registro as registro,fecha as fechap,
        (paterno||' '||materno||' '||nombre) as nombres, edad, id_tipo_sexo as id_cuaderno,diasi,diasc,
        extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,fec_nacimiento))::int  as dia, 
        ingreso, diagnostico_ing, cirugia, anastecia, cuaderno5.diagnostico, fec_ingreso, fec_egreso, 
        egreso, tipo_egreso, fallecido, fallecidom5, fallecidoy5, referido, contraref, cama, sala
        from cuaderno5 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin}) and h.id_persona=#{id_persona} 
        order by fecha,h.id_historial       
    </select>    
    
    <select id="getVerCuaderno5Todos" resultMap="vcuaderno5"> 
        select id_historial as id_laboratorio,h.id_persona,hcl as id_historial,nro_registro as registro,fecha as fechap,
        (paterno||' '||materno||' '||nombre) as nombres, edad, id_tipo_sexo as id_cuaderno,diasi,diasc,
        extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,fec_nacimiento))::int  as dia, 
        ingreso, diagnostico_ing, cirugia, anastecia, cuaderno5.diagnostico, fec_ingreso, fec_egreso, 
        egreso, tipo_egreso, fallecido, fallecidom5, fallecidoy5, referido, contraref, cama, sala
        from cuaderno5 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini}  and #{fecha_fin}) 
        order by fecha,h.id_historial       
    </select> 
    
    <select id="getVerCuadernoInterServicio" resultMap="vcuaderno5"> 
        select id_historial as id_laboratorio,h.id_persona,hcl as id_historial,nro_registro as registro,fecha as fechap,
        (paterno||' '||materno||' '||nombre) as nombres, edad, id_tipo_sexo as id_cuaderno,diasi,diasc,
        extract(month from age( h.fecha,fec_nacimiento))::int  as mes,extract(day from age( h.fecha,fec_nacimiento))::int  as dia, 
        ingreso, diagnostico_ing, cirugia, anastecia, cuaderno5.diagnostico, fec_ingreso, fec_egreso, 
        egreso, tipo_egreso, fallecido, fallecidom5, fallecidoy5, referido, contraref, cama, sala
        from cuaderno5 
        join historiales h using (id_historial)
        join pacientes using (id_paciente)
        where  h.cod_esta=#{cod_esta} and(extract(month from(fecha::date))::int)=#{aqv} and (extract(year from(fecha::date))::int)=#{auto} and sala=#{bcg} 
        order by fec_ingreso,id_historial       
    </select>  
   
    <resultMap id="vsnis302" type="Cuadernos">
        <result property="suma1"            column="suma1"/>
        <result property="suma2"            column="suma2"/>
        <result property="suma3"            column="suma3"/>
        <result property="suma4"            column="suma4"/>
        <result property="suma5"            column="suma5"/>
        <result property="suma6"            column="suma6"/>
        <result property="suma7"            column="suma7"/>
        <result property="suma8"            column="suma8"/>
        <result property="suma9"            column="suma9"/>
        <result property="suma10"           column="suma10"/> 
        <result property="suma11"           column="suma11"/>
        <result property="suma12"           column="suma12"/>
        <result property="suma13"           column="suma13"/>
        <result property="suma14"           column="suma14"/>
        <result property="suma15"           column="suma15"/>
        <result property="suma16"           column="suma16"/>
        <result property="suma17"           column="suma17"/>
        <result property="suma18"           column="suma18"/>
        <result property="suma19"           column="suma19"/>
        <result property="suma20"           column="suma20"/>
        <result property="suma21"           column="suma21"/>
        <result property="suma22"           column="suma22"/>
    </resultMap>
  
    <select id="getVerSnis302" resultMap="vsnis302"> 
        select * from informe302(#{cod_esta},#{fecha_ini}, #{fecha_fin} ) 
        as (suma22 integer,suma1 integer,suma2 integer, suma3 integer,suma4 integer,suma5 integer,suma6 integer,suma7 integer, 
        suma8 integer,suma9 integer,suma10 integer,suma11 integer,suma12 integer,suma13 integer,suma14 integer,suma15 integer,suma16 integer,
        suma17 integer,suma18 integer,suma19 integer,suma20 integer,suma21 integer)
    </select>   
    <!---//////////////////////////CONTROL DE CALIDAD /////////////////////////-->
   
    <resultMap id="calidad"           type="Cuadernos">
        <result property="id_paciente"         column="id_paciente"/>    
        <result property="id_historial"        column="id_historial"/>    
        <result property="id_persona"          column="id_persona"/>
        <result property="id_consultorio"      column="id_consultorio"/>
        <result property="fecha"               column="fecha"/>
        <result property="nombres"             column="nombres"/>
        <result property="expedido"            column="expedido"/>    
        <result property="nombre"              column="nombre"/>    
    </resultMap>
   
    <select id="getO80_C2" resultMap="calidad"> 
        select id_paciente,id_historial,r.id_persona,h.id_consultorio,r.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from recetass r
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (r.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) and (prestacion='O80' or prestacion='Z381' or prestacion='PC36')  and id_historial not in
        (select id_historial from cuaderno2 
        join historiales h using(id_historial)
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) and (parto=1 or parto=3 or parto=4))
        order by r.fecha
    </select> 
   
    <select id="getC2_O80" resultMap="calidad"> 
        select id_paciente,id_historial,h.id_persona,h.id_consultorio,h.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from cuaderno2 c
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where  h.cod_esta=#{cod_esta} and (h.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) and (parto=1 or parto=3 or parto=4)  and id_historial not in
        (select id_historial from recetass 
        join historiales h using(id_historial)
        where  h.cod_esta=#{cod_esta} and (recetass.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and (prestacion='O80' or prestacion='Z381' or prestacion='PC36'))
        order by h.fecha    
    </select> 
   
    <select id="getPC42_C2" resultMap="calidad"> 
        select id_paciente,id_historial,r.id_persona,h.id_consultorio,r.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from recetass r
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (r.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) and (prestacion='PC120' or prestacion='O820' or prestacion='O410' or prestacion='O84' or prestacion='PC122' or prestacion='PC123' or prestacion='PC124' or prestacion='PC125' or prestacion='O63' or prestacion='O64' or prestacion='O65' or prestacion='O68' or prestacion='O69')  and id_historial not in
        (select id_historial from cuaderno2 
        join historiales h using(id_historial)
        where  h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) and parto=2)  
        order by r.fecha
    </select> 
   
    <select id="getC2_PC42" resultMap="calidad"> 
        select id_paciente,id_historial,h.id_persona,h.id_consultorio,h.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from cuaderno2 c
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where  h.cod_esta=#{cod_esta} and (h.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) and (parto=2)  and id_historial not in
        (select id_historial from recetass 
        join historiales h using(id_historial)
        where  h.cod_esta=#{cod_esta} and (recetass.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and (prestacion='PC120' or prestacion='O820' or prestacion='O410' or prestacion='O84' or prestacion='PC122' or prestacion='PC123' or prestacion='PC124' or prestacion='PC125' or prestacion='O63' or prestacion='O64' or prestacion='O65' or prestacion='O68' or prestacion='O69'))
        order by h.fecha   
    </select> 
   
    <select id="getPC64_C2" resultMap="calidad"> 
        select id_paciente,id_historial,r.id_persona,h.id_consultorio,r.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from recetass r
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (r.fecha BETWEEN #{fecha_ini} and #{fecha_fin}) and (prestacion='PC64' or prestacion='PC148')  and id_historial not in
        (select id_historial from cuaderno2 
        join historiales h using(id_historial)
        where h.cod_esta=#{cod_esta} and (fecha::date::date BETWEEN #{fecha_ini} and #{fecha_fin}) and parto=2)     
        order by r.fecha
    </select> 
   
    <select id="getC2_PC64" resultMap="calidad"> 
        select id_paciente,id_historial,h.id_persona,h.id_consultorio,h.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from cuaderno2 c
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (h.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and (parto=2)  and id_historial not in
        (select id_historial h from recetass 
        join historiales using(id_historial)
        where h.cod_esta=#{cod_esta} and (recetass.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) and (prestacion='PC64' or prestacion='PC148'))  
        order by h.fecha   
    </select> 
   
    <select id="getZ34_C2" resultMap="calidad"> 
        select id_paciente,id_historial,r.id_persona,h.id_consultorio,r.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from recetass r
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (r.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and (prestacion='Z34' or prestacion='Z35')  and id_historial not in
        (select id_historial from cuaderno2 
        join historiales h using(id_historial)
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) and (suma1=1 or suma2=1 or suma3=1))
        order by r.fecha
    </select> 
   
    <select id="getC2_Z34" resultMap="calidad"> 
        select id_paciente,id_historial,h.id_persona,h.id_consultorio,h.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from cuaderno2 c
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (h.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and (suma1=1 or suma2=1 or suma3=1)  and id_historial not in
        (select id_historial from recetass 
        join historiales h using(id_historial)
        where h.cod_esta=#{cod_esta} and (recetass.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and (prestacion='Z34' or prestacion='Z35'))
        order by h.fecha   
    </select> 
   
    <select id="getZ39_C2" resultMap="calidad"> 
        select id_paciente,id_historial,r.id_persona,h.id_consultorio,r.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from recetass r
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (r.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and (prestacion='Z390' or prestacion='Z392')  and id_historial not in
        (select id_historial from cuaderno2 
        join historiales h using(id_historial)
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) and controlpos>0)
        order by r.fecha   
    </select> 
   
    <select id="getC2_Z39" resultMap="calidad"> 
        select id_paciente,id_historial,h.id_persona,h.id_consultorio,h.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from cuaderno2 c
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (h.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and (controlpos>0)  and id_historial not in
        (select id_historial from recetass 
        join historiales h using(id_historial)
        where h.cod_esta=#{cod_esta} and (recetass.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and ((prestacion='Z390' or prestacion='Z39' or prestacion='Z392')))
        order by h.fecha   
    </select> 
   
    <select id="getZ301_C3" resultMap="calidad"> 
        select id_paciente,id_historial,r.id_persona,h.id_consultorio,r.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from recetass r
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (r.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and prestacion='Z301'  and id_historial not in
        (select id_historial from cuaderno3 
        join historiales h using(id_historial)
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) and diu=1 and tipoconsulta='N')
        order by r.fecha    
    </select> 
   
    <select id="getC3_Z301" resultMap="calidad"> 
        select id_paciente,id_historial,h.id_persona,h.id_consultorio,h.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from cuaderno3 c
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (h.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and (diu=1 and tipoconsulta='N')  and id_historial not in
        (select id_historial from recetass 
        join historiales h using(id_historial)
        where h.cod_esta=#{cod_esta} and (recetass.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and (prestacion='Z301'))
        order by h.fecha   
    </select> 
   
    <select id="getZ305_C3" resultMap="calidad"> 
        select id_paciente,id_historial,r.id_persona,h.id_consultorio,r.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from recetass r
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (r.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and prestacion='Z305'  and id_historial not in
        (select id_historial from cuaderno3 
        join historiales h using(id_historial)
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) and diu=1 and tipoconsulta='C')
        order by r.fecha    
    </select> 
   
    <select id="getZ124_C3" resultMap="calidad"> 
        select id_paciente,id_historial,r.id_persona,h.id_consultorio,r.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from recetass r
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (r.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and prestacion='Z124'  and id_historial not in
        (select id_historial from cuaderno3 
        join historiales h using(id_historial)
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and pap='1' 
        UNION
        select id_historial from cuaderno2 
        join historiales h using(id_historial)
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and pap='1' )
        order by fecha       
    </select> 
   
    <select id="getC3_Z305" resultMap="calidad"> 
        select id_paciente,id_historial,h.id_persona,h.id_consultorio,h.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from cuaderno3 c
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (h.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) and (diu=1 and tipoconsulta='C')  and id_historial not in
        (select id_historial from recetass 
        join historiales h using(id_historial)
        where h.cod_esta=#{cod_esta} and (recetass.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) and (prestacion='Z305'))
        order by h.fecha  
    </select> 
   
    <select id="getC3_Z124" resultMap="calidad"> 
        (select id_paciente,id_historial,h.id_persona,h.id_consultorio,h.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from cuaderno3 c
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (h.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and (pap='1' )  and id_historial not in
        (select id_historial from recetass 
        join historiales h using(id_historial)
        where h.cod_esta=#{cod_esta} and (recetass.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and (prestacion='Z124')))
        UNION
        (select id_paciente,id_historial,h.id_persona,h.id_consultorio,h.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from cuaderno2 c
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (h.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and (pap='1' )  and id_historial not in
        (select id_historial from recetass 
        join historiales h using(id_historial)
        where h.cod_esta=#{cod_esta} and (recetass.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and (prestacion='Z124')))
        order by fecha  
    </select> 
   
    <select id="getZ301_DIU" resultMap="calidad"> 
        select id_paciente,id_historial,r.id_persona,h.id_consultorio,r.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from recetass r
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (r.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin})  and prestacion='Z301'  and id_historial not in
        (select id_historial from kardex
        join pedidos using(id_pedido)
        where kardex.cod_esta=#{cod_esta} and id_medicamento=156 and fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) 
        order by r.fecha 
    </select> 
   
    <select id="getPC23_C3" resultMap="calidad"> 
        select id_paciente,id_historial,r.id_persona,h.id_consultorio,r.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from recetass r
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (r.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) and prestacion='PC23'  and id_historial not in
        (select id_historial from cuaderno3 
        join historiales h using(id_historial)
        where h.cod_esta=#{cod_esta} and (fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) and inyectable=1)
        order by r.fecha    
    </select> 
   
    <select id="getC3_PC23" resultMap="calidad"> 
        select id_paciente,id_historial,h.id_persona,h.id_consultorio,h.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from cuaderno3 c
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (h.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) and (inyectable=1)  and id_historial not in
        (select id_historial from recetass 
        join historiales h using(id_historial)
        where h.cod_esta=#{cod_esta} and (recetass.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) and (prestacion='PC23'))
        order by h.fecha   
    </select> 
   
    <select id="getPC23_DEPO" resultMap="calidad"> 
        select id_paciente,id_historial,r.id_persona,h.id_consultorio,r.fecha, p.nombres,expedido, (m.nombres||' '||m.paterno||' '||m.materno) as nombre 
        from recetass r
        join personas m using(id_persona)
        join historiales h using(id_historial)
        join pacientes p using(id_paciente)
        where h.cod_esta=#{cod_esta} and (r.fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} ) and prestacion='PC23'  and id_historial not in
        (select id_historial from kardex
        join pedidos using(id_pedido)
        where kardex.cod_esta=#{cod_esta} and id_medicamento=289 and fecha::date BETWEEN #{fecha_ini} and #{fecha_fin}) 
        order by r.fecha 
    </select> 
 
    <resultMap id="listaPresta"    type="Cuadernos">
        <result property="estado"           column="estado"/>
        <result property="aspecto"          column="aspecto"/>  
    </resultMap>
    
    <select id="getPrestacion" resultMap="listaPresta">
        select codpresta as estado,descripcion as aspecto from prestacion where id_prestacion>2999 and 
        id_prestacion in (select id_prestacion from recetass)
        order by codpresta
    </select>
    
    <resultMap id="listaPacSalmi"    type="Cuadernos">
        <result property="id_cuaderno"      column="id_cuaderno"/>
        <result property="accion"           column="accion"/>
        <result property="color"            column="color"/>
        <result property="aspecto"          column="aspecto"/>
        <result property="anti"             column="anti"/>
        <result property="bacterias"        column="bacterias"/>
        <result property="cama"             column="cama"/>
        <result property="carnet"             column="carnet"/>
        <result property="fec_ingreso"      column="fec_ingreso"/>
        <result property="cetonas"          column="cetonas"/>
        <result property="fec_egreso"       column="fec_egreso"/>
        <result property="codigo"           column="codigo"/>
        <result property="auto"             column="auto"/>
    </resultMap>
  
    <select id="getPacientesSalmi" resultMap="listaPacSalmi">
        select id_paciente as id_cuaderno,nro_registro as accion,hcl::text as color,nombre as aspecto,
        (CASE WHEN paterno='' THEN '.' ELSE paterno END) as anti,
        (CASE WHEN materno='' THEN '.' ELSE materno END) as bacterias,
        (CASE WHEN id_tipo_sexo=1 THEN 'F' ELSE 'M' END) as cama,
        (CASE WHEN carnet='' or carnet=null THEN '0' ELSE carnet END) as carnet,
        fec_nacimiento as fec_ingreso,
        (CASE WHEN direccion='' THEN 'SN' ELSE direccion END) as cetonas,
        date(fec_registro) as fec_egreso,id_estado as codigo,id_seguro as auto
        from pacientes 
        where id_paciente in 
        (select id_paciente from historiales 
        where id_paciente in (select id_paciente from historiales where fecha::date between '2015-01-01' and '2018-12-31')
        group by id_paciente)
        order by id_paciente
    </select>
  
    <resultMap id="listaPerSalmi"    type="Cuadernos">
        <result property="id_cuaderno"      column="id_cuaderno"/>
        <result property="accion"           column="accion"/>
        <result property="color"            column="color"/>
        <result property="aspecto"          column="aspecto"/>
        <result property="anti"             column="anti"/>
        <result property="bacterias"        column="bacterias"/>
        <result property="cama"             column="cama"/>
        <result property="fec_ingreso"      column="fec_ingreso"/>
        <result property="cetonas"          column="cetonas"/>
        <result property="fec_egreso"       column="fec_egreso"/>
        <result property="codigo"           column="codigo"/>
        <result property="auto"             column="auto"/>
    </resultMap>
  
    <select id="getPersonasSalmi" resultMap="listaPerSalmi">
        select id_persona as id_cuaderno,direccion as color,nombres as aspecto,
        (CASE WHEN (dip='' or dip='"' or dip is null) THEN '0' ELSE dip END) as accion,
        (CASE WHEN (paterno='' or paterno='"' or paterno is null) THEN '.' ELSE paterno END) as anti,
        (CASE WHEN (materno='' or materno='"' or materno is null) THEN '.' ELSE materno END) as bacterias,
        (CASE WHEN id_tipo_sexo=1 THEN 'F' ELSE 'M' END) as cama,
        fec_nacimiento as fec_ingreso,
        (CASE WHEN (direccion='' or direccion='"' or direccion is null) THEN 'SN' ELSE direccion END) as cetonas,
        date(fec_registro) as fec_egreso,celular as codigo,id_consultorio as auto
        from personas 
        order by id_persona
    </select>
  
    <resultMap id="listaSalidasSalmi"    type="Cuadernos">
        <result property="id_persona"       column="id_persona"/>
        <result property="fec_ingreso"      column="fec_ingreso"/>
        <result property="id_laboratorio"   column="id_laboratorio"/>
        <result property="id_cuaderno"      column="id_cuaderno"/>
        <result property="alcohol"          column="alcohol"/>
        <result property="anastecia"        column="anastecia"/>
        <result property="anestesia"        column="anestesia"/>
        <result property="aqv"              column="aqv"/>
        <result property="arterial"         column="arterial"/>
        <result property="auto"             column="auto"/>
        <result property="bcg"              column="bcg"/>
        <result property="ingreso"              column="ingreso"/>
    </resultMap>
  
    <select id="getSalidasSalmiSumi" resultMap="listaSalidasSalmi">
        select h.id_persona,(CASE WHEN (fecha::date between '2013-01-01' and #{fecha_ini}  THEN #{fecha_ini} ELSE 
        (CASE WHEN (fecha::date between #{fecha_fin} and '2019-01-01') THEN #{fecha_fin} ELSE fecha END) END) as fec_ingreso,
        id_paciente as id_laboratorio,h.id_historial as id_cuaderno,
        extract(year from age( h.fecha,p.fec_nacimiento)) as alcohol,
        extract(month from age( h.fecha,p.fec_nacimiento)) as anastecia,
        extract(day from age( h.fecha,p.fec_nacimiento)) as anestesia, 1 as aqv, 
        0 as arterial,edad as auto,1 as bcg, (CASE WHEN (internado>2) THEN 2 ELSE 1 END) as ingreso
        from pacientes p
        join historiales h using (id_paciente)
        where expedido='S' and id_historial in 
        (select id_historial from recetass r  where fecha::date between #{fecha_ini} and #{fecha_fin} group by id_historial) 
        group by h.id_persona,fecha, id_paciente,h.id_historial,alcohol,anastecia,anestesia,edad,internado
        order by h.id_historial 
    </select>
    
    <select id="getSalidasSalmiNutri" resultMap="listaSalidasSalmi">
        select h.id_persona,fecha::date as fec_ingreso,
        id_paciente as id_laboratorio,h.id_historial+20000 as id_cuaderno,
        extract(year from age( h.fecha,p.fec_nacimiento)) as alcohol,
        extract(month from age( h.fecha,p.fec_nacimiento)) as anastecia,
        extract(day from age( h.fecha,p.fec_nacimiento)) as anestesia, 2 as aqv, 
        103 as arterial,edad as auto,3 as bcg, (CASE WHEN (internado>2) THEN 2 ELSE 1 END) as ingreso
        from pacientes p
        join historiales h using (id_paciente)
        where id_historial in 
        (select id_historial from historiales where expedido='S'  and internado=0 and id_historial in
        (select id_historial from pedidos where id_pedido in 
        (select id_pedido from kardex where expedido='S' and id_medicamento=574 and 
        fecha::date between #{fecha_ini} and #{fecha_fin} 
        group by id_pedido)   )
        group by id_historial) and 
        fecha::date between #{fecha_ini} and #{fecha_fin} 
        group by h.id_persona,fecha, id_paciente,h.id_historial,alcohol,anastecia,anestesia,edad,internado
        order by h.id_historial
    </select>
    
    <select id="getSalidasSalmiOtro" resultMap="listaSalidasSalmi">
        select h.id_persona,(CASE WHEN (fecha::date between '2014-01-01' and #{fecha_ini}  THEN #{fecha_ini} ELSE 
        (CASE WHEN (fecha::date between #{fecha_fin} and '2016-01-31') THEN #{fecha_fin} ELSE fecha END) END) as fec_ingreso,
        id_paciente as id_laboratorio,h.id_historial+30000 as id_cuaderno,
        extract(year from age( h.fecha,p.fec_nacimiento)) as alcohol,
        extract(month from age( h.fecha,p.fec_nacimiento)) as anastecia,
        extract(day from age( h.fecha,p.fec_nacimiento)) as anestesia, 
        (CASE WHEN h.expedido='E' THEN 3 ELSE 2 END) as aqv, 
        (CASE WHEN h.expedido='E' THEN 0 ELSE 1 END) as arterial,
        edad as auto,3 as bcg, (CASE WHEN (internado>2) THEN 2 ELSE 1 END) as ingreso
        from pacientes p
        join historiales h using (id_paciente)
        where id_historial in 
        (select id_historial from historiales where expedido!='S' and id_historial in
        (select id_historial from pedidos where id_pedido in 
        (select id_pedido from kardex where expedido!='S' and id_medicamento!=574 and 
        fecha::date between #{fecha_ini} and #{fecha_fin} 
        group by id_pedido)   )
        group by id_historial) 
        group by h.id_persona,fecha, id_paciente,h.id_historial,alcohol,anastecia,anestesia,edad,internado
        order by h.id_historial
    </select>
    
    <select id="getSalidasSalmiExt" resultMap="listaSalidasSalmi">
        select 0 as id_persona,(CASE WHEN (fec_registro::date between '2014-01-01' and #{fecha_ini}  THEN #{fecha_ini} ELSE 
        (CASE WHEN (fec_registro::date between #{fecha_fin} and '2019-01-31') THEN #{fecha_fin} ELSE fec_registro END) END) as fec_ingreso,
        0 id_laboratorio,id_pedido as id_cuaderno,
        extract(year from age( fec_registro,'2007-11-10')) as alcohol,
        extract(month from age( fec_registro,'2007-11-10')) as anastecia,
        extract(day from age( fec_registro,'2007-11-10')) as anestesia, 
        3 as aqv, 0 as arterial, 0 as auto,3 as bcg, 1 as ingreso
        from pedidos where id_pedido in 
        (select id_pedido from kardex where expedido!='S' and id_medicamento!=574 and 
        fecha::date between #{fecha_ini} and #{fecha_fin} 
        group by id_pedido)   
        group by fec_registro,id_pedido,alcohol,anastecia,anestesia
        order by fec_registro
    </select>
  
    <resultMap id="listaLotesSalmi"    type="Cuadernos">
        <result property="id_persona"       column="id_persona"/>
        <result property="tipodent"         column="tipodent"/>
        <result property="m3ds"             column="m3ds"/>
        <result property="fec_ingreso"      column="fec_ingreso"/>
        <result property="tipo"             column="tipo"/>
        <result property="tipoconsulta"     column="tipoconsulta"/>
    </resultMap>
  
    <select id="getLotesSalmi" resultMap="listaLotesSalmi">
        (select id_medicamento as id_persona,costo_unit::text as tipodent,precio_venta as m3ds,fecha_ven as fec_ingreso,codsumi as tipo,
        (CASE WHEN nro_lote='' THEN 'SNL' ELSE nro_lote END) as tipoconsulta
        from medicamentos
        where id_medicamento between 0 and 1999 and codsumi!='' and codsumi!='0' and id_medicamento in 
        (select id_medicamento from kardex group by id_medicamento) )
        UNION
        (select id_medicamento as id_persona,costo_unit::text as tipodent,precio_venta as m3ds,fecha_ven as fec_ingreso,codsumi as tipo,
        (CASE WHEN nro_lote='' THEN 'SNL' ELSE nro_lote END) as tipoconsulta
        from medicamentos
        where id_medicamento between 2000 and 20000 and codsumi!='' and codsumi!='0' and (tipo='I' or tipo='R' or tipo='M') and id_medicamento in
        (select id_medicamento from kardex group by id_medicamento) )  
        order by id_persona
    </select>
  
    <select id="getLotesSalmiUni" resultMap="listaLotesSalmi">
        select id_medicamento as id_persona,costo_unit::text as tipodent,precio_venta as m3ds,fecha_ven as fec_ingreso,codsumi as tipo,
        (CASE WHEN nro_lote='' THEN 'SNL' ELSE nro_lote END) as tipoconsulta
        from medicamentos where codsumi=#{anti} limit 1
    </select>
  
    <resultMap id="listaMovSalmi"    type="Cuadernos">
        <result property="suma1"               column="suma1"/>
        <result property="fec_ingreso"         column="fec_ingreso"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="tipoconsulta"        column="tipoconsulta"/>
        <result property="referido"            column="referido"/>
        <result property="fec_egreso"          column="fec_egreso"/>
        <result property="tipodent"            column="tipodent"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma6"               column="suma6"/>
    </resultMap>
  
    <select id="getMovimientoSalmi" resultMap="listaMovSalmi">
        (select k.id_detalle as suma6,k.id_medicamento as suma1,(CASE WHEN (k.fecha::date between '2015-01-01' and #{fecha_ini}  THEN #{fecha_ini} ELSE 
        (CASE WHEN (k.fecha::date between #{fecha_fin} and '2018-01-01') THEN #{fecha_fin} ELSE date(k.fecha) END) END) as fec_ingreso,
        k.salida as suma3, 
        (CASE WHEN k.expedido='S' THEN id_historial ELSE 0 END) as suma2,
        costo_unit::text as tipoconsulta,k.expedido as referido,fecha_ven as fec_egreso,nro_lote as tipodent,
        (CASE WHEN k.expedido='S' THEN 1 ELSE (CASE WHEN (k.expedido='V' or k.expedido='E' or k.expedido='M' or k.expedido='X') THEN 3 ELSE 2 END) END) as suma4, 
        (CASE WHEN k.expedido='S' THEN 0 ELSE (CASE WHEN (k.expedido='V' or k.expedido='E' or k.expedido='M' or k.expedido='X') THEN 0 ELSE 1 END) END) as suma5 
        from kardex k
        inner join recetas r on r.id_detalle=id_receta
        where r.fecha::date between #{fecha_ini} and #{fecha_fin} and k.id_receta>0 and id_historial in 
        (select id_historial from recetass r  where fecha::date between #{fecha_ini} and #{fecha_fin} group by id_historial)   
        and k.id_medicamento in 
        (select id_medicamento from medica_select join medicamentos m using(id_medicamento) where m.codsumi!='' and m.codsumi!='0' and (m.tipo='I' or m.tipo='R' or m.tipo='M')
        and id_medicamento in
        (select id_medicamento from kardex where fecha::date between #{fecha_ini} and #{fecha_fin} ) )
        UNION
        (select k.id_detalle as suma6,k.id_medicamento as suma1,(CASE WHEN (k.fecha::date between '2015-01-01' and #{fecha_ini}  THEN #{fecha_ini} ELSE 
        (CASE WHEN (k.fecha::date between #{fecha_fin} and '2018-01-01') THEN #{fecha_fin} ELSE date(k.fecha) END) END) as fec_ingreso,
        k.salida as suma3, 0 as suma2,
        costo_unit::text as tipoconsulta,k.expedido as referido,fecha_ven as fec_egreso,nro_lote as tipodent,
        (CASE WHEN k.expedido='S' THEN 1 ELSE (CASE WHEN (k.expedido='V' or k.expedido='E' or k.expedido='M' or k.expedido='X') THEN 3 ELSE 2 END) END) as suma4, 
        (CASE WHEN k.expedido='S' THEN 0 ELSE (CASE WHEN (k.expedido='V' or k.expedido='E' or k.expedido='M' or k.expedido='X') THEN 0 ELSE 1 END) END) as suma5 
        from kardex k
        where k.fecha::date between #{fecha_ini} and #{fecha_fin} and k.id_receta=0 and id_medicamento in 
        (select id_medicamento from medica_select join medicamentos m using(id_medicamento) where m.codsumi!='' and m.codsumi!='0' and (m.tipo='I' or m.tipo='R' or m.tipo='M')  
        and id_medicamento in
        (select id_medicamento from kardex where fecha::date between #{fecha_ini} and #{fecha_fin} ) )
        order by suma2,fec_ingreso,suma1 
    </select>
    
    <resultMap id="listaIMMS"    type="Cuadernos">
        <result property="tipoconsulta"        column="tipoconsulta"/>
        <result property="id_persona"       column="id_persona"/>
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma6"               column="suma6"/>
        <result property="suma7"               column="suma7"/>
        <result property="suma8"               column="suma8"/>
        <result property="suma9"               column="suma9"/>
        <result property="suma10"               column="suma10"/>
        <result property="suma11"               column="suma11"/>
    </resultMap>
  
    <select id="getIMMSalmi" resultMap="listaIMMS">
        select codsumi as tipoconsulta,id_medicamento as id_persona,astockv as suma1, astocks as suma2, astockp as suma3, 
        estockv as suma4, estocks as suma5, estockp as suma6, cstockv as suma7, cstocks as suma8, cstockp as suma9,   
        mes as suma10, gestion as suma11
        from kardexmes a join medicamentos b using(id_medicamento) 
        where mes=(extract(month from #{fecha_ini#{::date)-1) and gestion=(extract(year from #{fecha_ini#{::date)) 
        AND a.id_medicamento=b.id_medicamento and  codsumi!='' AND codsumi!='LN001'  AND codsumi!='CN001' 
        and codsumi!='0' and codsumi!='IC0106'
        order by id_medicamento
    </select>
  
    <resultMap id="listaMedNoe"    type="Cuadernos">
        <result property="id_persona"       column="id_persona"/>
        <result property="color"            column="color"/>
        <result property="referido"         column="referido"/>
        <result property="contraref"        column="contraref"/>
        <result property="tipodent"         column="tipodent"/>
        <result property="tipo"             column="tipo"/>
        <result property="auto"             column="auto"/>
    </resultMap>
  
    <select id="getMedNoe" resultMap="listaMedNoe">
        select id_medicamento as id_persona,codsumi as color,medicamento as referido,forma_far as contraref,
        concentra as tipodent,tipo as tipo,stock::int as auto from medicamentos 
        where id_medicamento>2000 and codsumi!='' and codsumi!='0' and (tipo='I' or tipo='R' or tipo='M')
        and stock>0 and id_medicamento in (select id_medicamento from medica_select group by id_medicamento)
        order by tipo,medicamento
    </select>
    
    <resultMap id="listaSelecionMed"    type="Cuadernos">
        <result property="id_persona"       column="id_persona"/>
        <result property="color"            column="color"/>
        <result property="referido"         column="referido"/>
        <result property="contraref"        column="contraref"/>
        <result property="tipodent"         column="tipodent"/>
        <result property="aqv"              column="aqv"/>
        <result property="bacterias"        column="bacterias"/>
    </resultMap>
  
    <select id="getSelecionMed" resultMap="listaSelecionMed">
        (select id_medicamento as id_persona,codsumi as color,lower(medicamento) as referido,lower(forma_far) as contraref,
        concentra as tipodent,stock::text as bacterias,
        (CASE WHEN tipo='M' THEN 1 ELSE (CASE WHEN tipo='I' THEN 2 ELSE 3 END) END)  as aqv 
        from medicamentos 
        where id_medicamento between 0 and 1999 and codsumi!='' and codsumi!='0' and id_medicamento in
        (select id_medicamento from kardex group by id_medicamento))
        UNION
        (select id_medicamento as id_persona,codsumi as color,medicamento as referido,forma_far as contraref,
        concentra as tipodent,stock::text as bacterias,
        (CASE WHEN tipo='M' THEN 4 ELSE (CASE WHEN tipo='I' THEN 5 ELSE 6 END) END)  as aqv 
        from medicamentos
        where id_medicamento between 2000 and 20000 and codsumi!='' and codsumi!='0' and (tipo='I' or tipo='R' or tipo='M' and id_medicamento in
        (select id_medicamento from kardex group by id_medicamento)) )
        order by id_persona
    </select>
    
    <resultMap id="listaMSalmi"    type="Cuadernos">
        <result property="tipo"             column="tipo"/>
        <result property="id_persona"       column="id_persona"/>
        <result property="auto"             column="auto"/>
        <result property="cm"               column="cm"/>        
        <result property="aspecto"          column="aspecto"/>  
        <result property="suma1"            column="suma1"/>
    </resultMap>
  
    <select id="getMovSalmi" resultMap="listaMSalmi">
        select codsumi as tipo, id_medicamento as id_persona, entrada::int as auto,kardex.costo_unit::int as cm,expedido as aspecto,
        (CASE WHEN id_programa=7 THEN 102 ELSE (CASE WHEN id_programa=6 THEN 103 ELSE (CASE WHEN id_programa>7 THEN 1 ELSE 0 END) END) END) as suma1 
        from kardex join medicamentos using (id_medicamento)
        where (fecha::date between #{fecha_ini} and #{fecha_fin}) and entrada > 0 and salida=0 and ajuste=0 and id_medicamento in 
        (select id_medicamento from recetas r                  
        join medicamentos m using(id_medicamento)
        where fecha::date between #{fecha_ini} and #{fecha_fin} and id_medicamento in 
        (select id_medicamento from medicamentos
        where id_medicamento between 0 and 1999 and m.codsumi!='' and m.codsumi!='0' and id_medicamento in 
        (select id_medicamento from kardex group by id_medicamento) )
        UNION
        (select id_medicamento from medicamentos 
        where  codsumi!='' and codsumi!='0' and (tipo='I' or tipo='R' or tipo='M') 
        and id_medicamento in 
        (select id_medicamento from kardex group by id_medicamento)  ))
        order by id_medicamento
    </select>
   
    <resultMap id="listaInvSalmi"    type="Cuadernos">
        <result property="id_persona"       column="id_persona"/>
        <result property="suma1"            column="suma1"/>
        <result property="suma2"            column="suma2"/>
        <result property="suma3"            column="suma3"/>
        <result property="suma4"            column="suma4"/>
        <result property="suma5"            column="suma5"/>
        <result property="suma6"            column="suma6"/>
        <result property="suma7"            column="suma7"/>
    </resultMap>
  
    <select id="getInvMed" resultMap="listaInvSalmi">
        select id_medicamento as id_persona, k.astocks::int as suma1, k.astockp::int as suma2, k.astockv::int as suma3,
        (k.astocks+k.astockp+k.astockv)::int as suma4,mes as suma5, gestion as suma6, 0 as suma7
        from kardexmes k 
        join medicamentos  using(id_medicamento)
        where codsumi!='' and codsumi!='0' and (tipo='I' or tipo='R' or tipo='M') and (k.astocks+k.astockp+k.astockv)>0
        and mes=extract(month from #{fecha_ini#{::date) and gestion=extract(year from #{fecha_ini#{::date)
        order by id_medicamento
    </select>
  
    <resultMap id="listaFopo"    type="Cuadernos">
        <result property="id_paciente"         column="id_paciente"/>
        <result property="tipo"                column="tipo"/>
        <result property="cancer"              column="cancer"/>
        <result property="cancero"             column="cancero"/>
    </resultMap>
  
    <select id="getFopo" resultMap="listaFopo">
        select id_prestacion as id_paciente,prestacion as tipo,sum(cantidad) as cancer,r.costo::int as cancero
        from repes r
        inner join prestacion p on prestacion=codpresta
        WHERE (prestacion!='LECHE')  and gestion>2013
        group by id_prestacion,prestacion,r.costo
        order by prestacion
    </select>
  
    <resultMap id="listaRelSalPre"    type="Cuadernos">
        <result property="fec_ingreso"         column="fec_ingreso"/>
        <result property="id_paciente"         column="id_paciente"/>
        <result property="id_historial"        column="id_historial"/>
        <result property="tipo"                column="tipo"/>
        <result property="cancer"              column="cancer"/>
    </resultMap>
  
    <select id="getRelSalPreSalmi" resultMap="listaRelSalPre">
        select r.fecha as fec_ingreso, id_paciente,id_historial,prestacion as tipo,cantidad as cancer
        from recetass r
        join historiales using(id_historial)
        where prestacion not like 'LECHE%' and r.fecha::date between #{fecha_ini} and #{fecha_fin} 
        order by r.id_historial,r.fecha
    </select>
  
    <resultMap id="listaDiag"    type="Cuadernos">
        <result property="suma1"               column="suma1"/> 
        <result property="suma2"               column="suma2"/> 
        <result property="tipo"                column="tipo"/>
        <result property="tipodent"            column="tipodent"/>
    </resultMap>
  
    <select id="getDiagnosticoSalmi" resultMap="listaDiag">
        select id_persona as suma1, 0 as suma2, codigo as tipo,literal as tipodent
        from cie10
        join detallecie10 using(codigo)
        where id_historial in 
        (select id_historial from historiales where internado=0 
        and (fecha::date between #{fecha_ini}  and #{fecha_fin}  group by id_historial) 
        group by id_persona,codigo,literal
        order by codigo
    </select>
  
    <select id="getCie10Salmi" resultMap="listaDiag">
        (select id_persona as suma1, id_historial as suma2,codigo as tipo,literal as tipodent
        from detallecie10
        join cie10 using(codigo)
        where id_historial in 
        (select id_historial from historiales where expedido='P'  and internado=0 
        and (fecha::date between #{fecha_ini} and #{fecha_fin}  group by id_historial)) 
        UNION
        (select 0 suma1, id_historial as suma2,'0'::text tipo,'0'::text as tipodent
        from historiales where expedido='S' and internado=0 and id_historial in
        (select id_historial from recetas where expedido='S' and id_medicamento=574 
        and (fecha::date between #{fecha_ini} and #{fecha_fin}  group by id_historial))
        order by suma2        
    </select>
    
    <resultMap id="graficase"           type="Cuadernos">
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
    </resultMap>
  
    <select id="getGrafica2" resultMap="graficase"> 
        SELECT sum(CASE WHEN (h.id_consultorio=19) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (h.id_consultorio=23) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (h.id_consultorio=17) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (h.id_consultorio=45) THEN 1 ELSE 0 END) as suma4
        from historiales h
        join pacientes a using(id_paciente)
        join consultorios c using(id_consultorio)
        join personas e using(id_persona)
        where fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} and h.cod_esta=#{cod_esta} and id_cargo=24 and urgencias=1
    </select> 
    
    <resultMap id="graficas"           type="Cuadernos">
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma6"               column="suma6"/>
        <result property="suma7"               column="suma7"/>
        <result property="suma8"               column="suma8"/>
        <result property="suma9"               column="suma9"/>
        <result property="suma10"               column="suma10"/>
    </resultMap>
   
    <select id="getGrafica1" resultMap="graficas"> 
        SELECT  sum(CASE WHEN ( edad between 0 and 0) and (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5)  THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN ( edad between 0 and 0) and (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11)  THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (edad between 1 and 4) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (edad between 5 and 9) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (edad between 10 and 14) THEN 1 ELSE 0 END) as suma5,
        sum(CASE WHEN (edad between 15 and 19) THEN 1 ELSE 0 END) as suma6,
        sum(CASE WHEN (edad between 20 and 39) THEN 1 ELSE 0 END) as suma7,
        sum(CASE WHEN (edad between 40 and 49) THEN 1 ELSE 0 END) as suma8,
        sum(CASE WHEN (edad between 50 and 59) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (edad between 60 and 120) THEN 1 ELSE 0 END) as suma10
        from historiales h
        join pacientes a using(id_paciente)
        where fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} and cod_esta=#{cod_esta} 
    </select> 
    
    <select id="getGrafica3" resultMap="graficas"> 
        SELECT  sum(CASE WHEN ( edad between 0 and 0) and (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5)  THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN ( edad between 0 and 0) and (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11)  THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (edad between 1 and 4) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (edad between 5 and 9) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (edad between 10 and 14) THEN 1 ELSE 0 END) as suma5,
        sum(CASE WHEN (edad between 15 and 19) THEN 1 ELSE 0 END) as suma6,
        sum(CASE WHEN (edad between 20 and 39) THEN 1 ELSE 0 END) as suma7,
        sum(CASE WHEN (edad between 40 and 49) THEN 1 ELSE 0 END) as suma8,
        sum(CASE WHEN (edad between 50 and 59) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (edad between 60 and 120) THEN 1 ELSE 0 END) as suma10
        from historiales h
        join pacientes a using(id_paciente)
        join consultorios c using(id_consultorio)
        join personas e using(id_persona)
        where fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} and h.cod_esta=#{cod_esta} and id_cargo=24 and urgencias=1 and
        h.id_consultorio!=46 and h.id_consultorio!=2 and h.id_consultorio!=25
        <!-- menos 46 residentes 25 anasteciologia y 2 medicina general-->
    </select> 
    
    <resultMap id="graficas2"           type="Cuadernos">
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma6"               column="suma6"/>
        <result property="suma7"               column="suma7"/>
        <result property="suma8"               column="suma8"/>
        <result property="suma9"               column="suma9"/>
        <result property="suma10"              column="suma10"/>
        <result property="suma11"              column="suma11"/>
        <result property="suma12"              column="suma12"/>
        <result property="suma13"              column="suma13"/>
        <result property="suma14"              column="suma14"/>
        <result property="suma15"              column="suma15"/>
        <result property="suma16"              column="suma16"/>
        <result property="suma17"              column="suma17"/>
        <result property="suma18"              column="suma18"/>
        <result property="suma19"              column="suma19"/>
        <result property="suma20"              column="suma20"/>
        <result property="suma21"              column="suma21"/>
        <result property="suma22"              column="suma22"/>
        <result property="suma23"              column="suma23"/>
        <result property="suma24"              column="suma24"/>
        <result property="suma25"              column="suma25"/>
    </resultMap>
   
    <select id="getGrafica4" resultMap="graficas2"> 
        SELECT  sum((CASE WHEN (bcg=1 and id_tipo_sexo=1 and edad between 0 and 0 ) THEN 1 ELSE 0 END)) as suma1,
        sum((CASE WHEN (bcg=1 and id_tipo_sexo=2 and edad between 0 and 0 ) THEN 1 ELSE 0 END)) as suma2,
        sum((CASE WHEN (polio='P' and id_tipo_sexo=1 and edad between 0 and 0 ) THEN 1 ELSE 0 END)) as suma3,
        sum((CASE WHEN (polio='P' and id_tipo_sexo=2 and edad between 0 and 0 ) THEN 1 ELSE 0 END)) as suma4,
        sum((CASE WHEN (polio='S' and id_tipo_sexo=1 and edad between 0 and 0 ) THEN 1 ELSE 0 END)) as suma5,
        sum((CASE WHEN (polio='S' and id_tipo_sexo=2 and edad between 0 and 0 ) THEN 1 ELSE 0 END)) as suma6,
        sum((CASE WHEN (polio='T' and id_tipo_sexo=1 and edad between 0 and 0 ) THEN 1 ELSE 0 END)) as suma7,
        sum((CASE WHEN (polio='T' and id_tipo_sexo=2 and edad between 0 and 0 ) THEN 1 ELSE 0 END)) as suma8,
        sum((CASE WHEN (penta='P' and id_tipo_sexo=1 and edad between 0 and 0 ) THEN 1 ELSE 0 END)) as suma9,
        sum((CASE WHEN (penta='P' and id_tipo_sexo=2 and edad between 0 and 0 ) THEN 1 ELSE 0 END)) as suma10,
        sum((CASE WHEN (penta='S' and id_tipo_sexo=1 and edad between 0 and 0 ) THEN 1 ELSE 0 END)) as suma11,
        sum((CASE WHEN (penta='S' and id_tipo_sexo=2 and edad between 0 and 0 ) THEN 1 ELSE 0 END)) as suma12,
        sum((CASE WHEN (penta='T' and id_tipo_sexo=1 and edad between 0 and 0 ) THEN 1 ELSE 0 END)) as suma13,
        sum((CASE WHEN (penta='T' and id_tipo_sexo=2 and edad between 0 and 0 ) THEN 1 ELSE 0 END)) as suma14,
        sum((CASE WHEN (anti='P' and id_tipo_sexo=1 and edad between 0 and 0 ) THEN 1 ELSE 0 END)) as suma15,
        sum((CASE WHEN (anti='P' and id_tipo_sexo=2 and edad between 0 and 0 ) THEN 1 ELSE 0 END)) as suma16,
        sum((CASE WHEN (anti='S' and id_tipo_sexo=1 and edad between 0 and 0 ) THEN 1 ELSE 0 END)) as suma17,
        sum((CASE WHEN (anti='S' and id_tipo_sexo=2 and edad between 0 and 0 ) THEN 1 ELSE 0 END)) as suma18,
        sum((CASE WHEN (srp='1' and id_tipo_sexo=1 and edad between 0 and 1 ) THEN 1 ELSE 0 END)) as suma19,
        sum((CASE WHEN (srp='1' and id_tipo_sexo=2 and edad between 0 and 1 ) THEN 1 ELSE 0 END)) as suma20,
        sum((CASE WHEN (mujerdt='P' and id_tipo_sexo=1 and edad between 10 and 49 ) THEN 1 ELSE 0 END)) as suma21,
        sum((CASE WHEN (mujerdt='S' and id_tipo_sexo=1 and edad between 10 and 49 ) THEN 1 ELSE 0 END)) as suma22,
        sum((CASE WHEN (mujerdt='T' and id_tipo_sexo=1 and edad between 10 and 49 ) THEN 1 ELSE 0 END)) as suma23,
        sum((CASE WHEN (mujerdt='C' and id_tipo_sexo=1 and edad between 10 and 49 ) THEN 1 ELSE 0 END)) as suma24,
        sum((CASE WHEN (mujerdt='Q' and id_tipo_sexo=1 and edad between 10 and 49 ) THEN 1 ELSE 0 END)) as suma25
        from vacunas
        join historiales h using(id_historial) 
        join pacientes using(id_paciente)
        where fecha::date BETWEEN #{fecha_ini} and #{fecha_fin} and h.cod_esta=#{cod_esta} 
    </select> 
    
    <resultMap id="ListarEstad"           type="Cuadernos">
        <result property="tipo"               column="tipo"/>
        <result property="tipoconsulta"        column="tipoconsulta"/>
        <result property="suma1"               column="suma1"/>
        <result property="suma2"               column="suma2"/>
        <result property="suma3"               column="suma3"/>
        <result property="suma4"               column="suma4"/>
        <result property="suma5"               column="suma5"/>
        <result property="suma6"               column="suma6"/>
        <result property="suma7"               column="suma7"/>
        <result property="suma8"               column="suma8"/>
        <result property="suma9"               column="suma9"/>
        <result property="suma10"              column="suma10"/>
        <result property="suma11"              column="suma11"/>
        <result property="suma12"              column="suma12"/>
        <result property="suma13"              column="suma13"/>
        <result property="suma14"              column="suma14"/>
        <result property="suma15"              column="suma15"/>
        <result property="suma16"              column="suma16"/>
        <result property="suma17"              column="suma17"/>
        <result property="suma18"              column="suma18"/>
        <result property="suma19"              column="suma19"/>
        <result property="suma20"              column="suma20"/>
        <result property="suma21"              column="suma21"/>
        <result property="suma22"              column="suma22"/>
        <result property="suma23"              column="suma23"/>
        <result property="suma24"              column="suma24"/>
        <result property="suma25"              column="suma25"/>
        <result property="suma26"              column="suma26"/>
        <result property="suma27"              column="suma27"/>
        <result property="suma28"              column="suma28"/>
        <result property="suma29"              column="suma29"/>
        <result property="suma30"              column="suma30"/>
        <result property="suma31"              column="suma31"/>
        <result property="suma32"              column="suma32"/>
        <result property="suma33"              column="suma33"/>
        <result property="suma34"              column="suma34"/>
        <result property="suma35"              column="suma35"/>
        <result property="suma36"              column="suma36"/>
        <result property="suma37"              column="suma37"/>
        <result property="suma38"              column="suma38"/>
        <result property="suma39"              column="suma39"/>
        <result property="suma40"              column="suma40"/>
    </resultMap>
   
    <select id="getListarEstadisticas" resultMap="ListarEstad"> 
        select consultorio as tipo,'A'::text as tipoconsulta, <!--(p.nombres||' '||p.paterno||' '||p.materno) as tipoconsulta,-->
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma5,    
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma6, 
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma7,    
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma8, 
                       
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 1 and 4 )) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 1 and 4)) THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 1 and 4)) THEN 1 ELSE 0 END) as suma11,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 1 and 4)) THEN 1 ELSE 0 END) as suma12,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 5 and 9)) THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 5 and 9)) THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 5 and 9)) THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 5 and 9)) THEN 1 ELSE 0 END) as suma16,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 10 and 14)) THEN 1 ELSE 0 END) as suma17,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 10 and 14)) THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 10 and 14)) THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 10 and 14)) THEN 1 ELSE 0 END) as suma20,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 14 and 19)) THEN 1 ELSE 0 END) as suma21,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 14 and 19)) THEN 1 ELSE 0 END) as suma22,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 14 and 19)) THEN 1 ELSE 0 END) as suma23,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 14 and 19)) THEN 1 ELSE 0 END) as suma24,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 20 and 39)) THEN 1 ELSE 0 END) as suma25,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 20 and 39)) THEN 1 ELSE 0 END) as suma26,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 20 and 39)) THEN 1 ELSE 0 END) as suma27,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 20 and 39)) THEN 1 ELSE 0 END) as suma28,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 40 and 49)) THEN 1 ELSE 0 END) as suma29,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 40 and 49)) THEN 1 ELSE 0 END) as suma30,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 40 and 49)) THEN 1 ELSE 0 END) as suma31,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 40 and 49)) THEN 1 ELSE 0 END) as suma32,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 50 and 59)) THEN 1 ELSE 0 END) as suma33,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 50 and 9)) THEN 1 ELSE 0 END) as suma34,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 50 and 59)) THEN 1 ELSE 0 END) as suma35,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 50 and 9)) THEN 1 ELSE 0 END) as suma36,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 60 and 120)) THEN 1 ELSE 0 END) as suma37,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 60 and 120)) THEN 1 ELSE 0 END) as suma38,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 60 and 120)) THEN 1 ELSE 0 END) as suma39,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 60 and 120)) THEN 1 ELSE 0 END) as suma40,
        sum(CASE WHEN (a.id_tipo_sexo=1 or a.id_tipo_sexo=2) THEN 1 ELSE 0 END) as suma41
        
        from historiales h
        join consultorios c using(id_consultorio)
        join pacientes a using(id_paciente)
        join personas p using(id_persona)
        where (fecha::timestamp without time zone between #{fecha_ini} and #{fecha_fin})
        and h.id_consultorio!=0 and h.id_consultorio!=11 and h.id_consultorio!=12 and h.id_consultorio!=14 and h.id_consultorio!=15 
        and h.id_consultorio!=46 and h.id_consultorio!=61
        group by h.id_consultorio,consultorio order by suma41 desc;
    </select> 
    
    <select id="getListarEstadisticasHospi" resultMap="ListarEstad"> 
        select consultorio as tipo,'A'::text as tipoconsulta, <!--(p.nombres||' '||p.paterno||' '||p.materno) as tipoconsulta,-->
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma1,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma2,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma3,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 0 and 5) ) THEN 1 ELSE 0 END) as suma4,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma5,    
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma6, 
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma7,    
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 0 and 0) and 
        (extract(month from age( h.fecha,a.fec_nacimiento))::int between 6 and 11) ) THEN 1 ELSE 0 END) as suma8, 
                       
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 1 and 4 )) THEN 1 ELSE 0 END) as suma9,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 1 and 4)) THEN 1 ELSE 0 END) as suma10,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 1 and 4)) THEN 1 ELSE 0 END) as suma11,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 1 and 4)) THEN 1 ELSE 0 END) as suma12,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 5 and 9)) THEN 1 ELSE 0 END) as suma13,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 5 and 9)) THEN 1 ELSE 0 END) as suma14,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 5 and 9)) THEN 1 ELSE 0 END) as suma15,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 5 and 9)) THEN 1 ELSE 0 END) as suma16,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 10 and 14)) THEN 1 ELSE 0 END) as suma17,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 10 and 14)) THEN 1 ELSE 0 END) as suma18,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 10 and 14)) THEN 1 ELSE 0 END) as suma19,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 10 and 14)) THEN 1 ELSE 0 END) as suma20,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 14 and 19)) THEN 1 ELSE 0 END) as suma21,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 14 and 19)) THEN 1 ELSE 0 END) as suma22,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 14 and 19)) THEN 1 ELSE 0 END) as suma23,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 14 and 19)) THEN 1 ELSE 0 END) as suma24,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 20 and 39)) THEN 1 ELSE 0 END) as suma25,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 20 and 39)) THEN 1 ELSE 0 END) as suma26,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 20 and 39)) THEN 1 ELSE 0 END) as suma27,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 20 and 39)) THEN 1 ELSE 0 END) as suma28,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 40 and 49)) THEN 1 ELSE 0 END) as suma29,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 40 and 49)) THEN 1 ELSE 0 END) as suma30,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 40 and 49)) THEN 1 ELSE 0 END) as suma31,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 40 and 49)) THEN 1 ELSE 0 END) as suma32,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 50 and 59)) THEN 1 ELSE 0 END) as suma33,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 50 and 9)) THEN 1 ELSE 0 END) as suma34,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 50 and 59)) THEN 1 ELSE 0 END) as suma35,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 50 and 9)) THEN 1 ELSE 0 END) as suma36,
        
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 60 and 120)) THEN 1 ELSE 0 END) as suma37,
        sum(CASE WHEN (repetida='N' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 60 and 120)) THEN 1 ELSE 0 END) as suma38,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=2 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 60 and 120)) THEN 1 ELSE 0 END) as suma39,
        sum(CASE WHEN (repetida='R' and a.id_tipo_sexo=1 and (extract(year from age( h.fecha,a.fec_nacimiento))::int between 60 and 120)) THEN 1 ELSE 0 END) as suma40,
        sum(CASE WHEN (a.id_tipo_sexo=1 or a.id_tipo_sexo=2) THEN 1 ELSE 0 END) as suma41
        
        from historiales h
        join consultorios c using(id_consultorio)
        join pacientes a using(id_paciente)
        join personas p using(id_persona)
        where (h.cod_esta = #{cod_esta}  and (fecha::timestamp without time zone between #{fecha_ini} and #{fecha_fin})
        and h.id_consultorio!=0 and h.id_consultorio!=11 and h.id_consultorio!=12 and h.id_consultorio!=14 and h.id_consultorio!=15 
        and h.id_consultorio!=46 and h.id_consultorio!=61 
        group by h.id_consultorio,consultorio order by suma41 desc;
    </select> 
    
  
</mapper>
